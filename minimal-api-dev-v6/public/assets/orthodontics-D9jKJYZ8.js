import{i as Te,dg as ve,r as o,j as e,e5 as K,e as q,B as g,bt as De,T as l,S as z,I as j,o as B,dW as Ce,aB as J,v as Pe,C as ne,aK as Ne,ar as we,aC as Se,cV as Q,cI as X,d as f,bc as P,dh as b,di as y,H as Ee}from"./index-BH9ijvcg.js";import{u as Y,a as Z,F as c}from"./form-provider-b5GXhABL.js";import{g as ee}from"./url-helpers-CUK1i57f.js";import{I as Ie}from"./image-CxkC95SJ.js";import"./editor-BUp8U2Vl.js";import{C as $e}from"./confirm-dialog-U4gI9R8N.js";import{T as Ae,a as te}from"./ToggleButtonGroup-BM7GBSTh.js";import{G as n}from"./Grid-vZ7eNkvH.js";import{C as ke}from"./Card-CwEGl0A2.js";import{T as Re}from"./TableContainer-Bh7RL936.js";import{a as Oe,c as ze,T as N,b as Be}from"./TableHead-CgILorvc.js";import{T as d}from"./TableCell-C_iRAQPi.js";import{C as Le}from"./Chip-CWilL4Fh.js";import{T as Me}from"./TablePagination-B44FLsH8.js";import{D as se}from"./DialogTitle-BFho6EhL.js";import{D as ae}from"./DialogContent-CtzR1nPJ.js";import{D as re}from"./dialogTitleClasses-CSmkbKpM.js";import"./TextField-DgF_8CdY.js";import"./Select-fMsy-Lkz.js";import"./Menu-C7S9TApF.js";import"./InputLabel-OzeQogzC.js";import"./FormLabel-Cn8enUsF.js";import"./FormHelperText-CAGzEAMm.js";import"./FormControl-rHOkSiGz.js";import"./Rating-BeEojfFm.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-nP-7N9E2.js";import"./RadioGroup-7Oa-Pyj3.js";import"./FormGroup-BEVR9nif.js";import"./FormControlLabel-CVzZoZzb.js";import"./index-DVaqB1VX.js";import"./countries-DSLisFCy.js";import"./Autocomplete-Crt2raTS.js";import"./country-select-DjjsCD_N.js";import"./Checkbox-AhG6TMzi.js";import"./upload-BVxhxEL6.js";import"./preview-multi-file--Yn4-mQ8.js";import"./format-number-z67FV_-O.js";import"./file-thumbnail-GgYbZAeX.js";import"./upload-avatar-Dm2-m_zx.js";import"./avatar-url-votlVkc-.js";import"./DatePicker-Br6g6rY4.js";import"./ListItem-Ch3K_gMr.js";import"./MobileDateTimePicker-CzN3TBFx.js";import"./index-BVzUWzoE.js";import"./LastPage-DkhatgKI.js";const ie={PENDING:"شروع درمان",IN_TREATMENT:"در حال درمان",COMPLETED:"اتمام درمان",CANCELLED:"متوقف شده"};function Fe(){const{user:r}=Te(),T=ve(),[x,h]=o.useState([]),[w,L]=o.useState(!0),[S,E]=o.useState(null),[oe,M]=o.useState(!1),[le,F]=o.useState(!1),[ce,V]=o.useState(!1),[G,H]=o.useState(null),[m,W]=o.useState(null),[I,de]=o.useState("card"),[$,U]=o.useState(0),[v,me]=o.useState(10),[Ge,He]=o.useState({}),D=Y({defaultValues:{firstName:"",age:""}}),C=Y({defaultValues:{firstName:"",lastName:"",phone:"",age:"",diagnosis:"",treatment:"",status:"PENDING",notes:"",nextVisitTime:null,treatmentStartDate:null}});o.useEffect(()=>{r&&(async()=>{var s,a;try{L(!0);const p=((await b.get(y.patients,{headers:{Authorization:`Bearer ${r==null?void 0:r.accessToken}`}})).data.patients||[]).filter(u=>u.specialty==="ORTHODONTICS"),fe=await Promise.all(p.map(async u=>{try{const R=(await b.get(`${y.patients}/${u.id}/images`,{headers:{Authorization:`Bearer ${r==null?void 0:r.accessToken}`}})).data.images||[],ye=R.find(O=>O.category==="profile")||R.find(O=>O.category==="frontal");return{...u,images:R,profileImage:ye||null}}catch{return{...u,images:[],profileImage:null}}}));h(fe),E(null)}catch(i){console.error("Error fetching patients:",i),((s=i.response)==null?void 0:s.status)!==200&&((a=i.response)==null?void 0:a.status)!==404?E("خطا در بارگیری بیماران"):E(null),h([])}finally{L(!1)}})()},[r]);const xe=()=>{D.reset({firstName:"",age:""}),M(!0)},A=()=>{M(!1),D.reset()},he=t=>{H(t),C.reset({firstName:t.firstName,lastName:t.lastName,phone:t.phone,age:t.age,diagnosis:t.diagnosis,treatment:t.treatment,status:t.status,notes:t.notes||"",nextVisitTime:t.nextVisitTime?new Date(t.nextVisitTime):null,treatmentStartDate:t.treatmentStartDate?new Date(t.treatmentStartDate):null}),F(!0)},k=()=>{F(!1),H(null),C.reset()},pe=t=>{W(t),V(!0)},_=()=>{V(!1),W(null)},ue=async t=>{var s,a;try{const i=await b.post(y.patients,{...t,lastName:"-",phone:"-",diagnosis:"-",treatment:"-",specialty:"ORTHODONTICS"},{headers:{Authorization:`Bearer ${r==null?void 0:r.accessToken}`}});h(p=>[...p,i.data.patient]),A()}catch(i){console.error("Error adding patient:",i);const p=((a=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:a.message)||(i==null?void 0:i.message)||"خطا در افزودن بیمار";alert(p)}},ge=async t=>{try{const s=await b.put(`${y.patients}/${G.id}`,t,{headers:{Authorization:`Bearer ${r==null?void 0:r.accessToken}`}});h(a=>a.map(i=>i.id===G.id?s.data.patient:i)),k()}catch(s){console.error("Error updating patient:",s),alert("خطا در بروزرسانی بیمار")}},je=async t=>{try{await b.delete(`${y.patients}/${t}`,{headers:{Authorization:`Bearer ${r==null?void 0:r.accessToken}`}}),h(s=>s.filter(a=>a.id!==t))}catch(s){console.error("Error deleting patient:",s),alert("خطا در حذف بیمار")}};return w?e.jsx(K,{children:e.jsx(q,{children:e.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsx(De,{})})})}):e.jsx(K,{children:e.jsxs(q,{children:[e.jsxs(g,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(l,{variant:"h4",children:"بخش ارتودنسی"}),e.jsxs(z,{direction:"row",spacing:1,alignItems:"center",children:[e.jsxs(Ae,{value:I,exclusive:!0,onChange:(t,s)=>{s!==null&&de(s)},size:"small",color:"primary",children:[e.jsx(te,{value:"card",children:e.jsx(j,{icon:"solar:widget-2-bold",width:20})}),e.jsx(te,{value:"table",children:e.jsx(j,{icon:"solar:list-bold",width:20})})]}),e.jsx(B,{onClick:xe,sx:{borderRadius:"50%",width:40,height:40,padding:0,display:"inline-flex",alignItems:"center",justifyContent:"center"},"aria-label":"add-patient",children:e.jsx(j,{icon:"mingcute:add-line"})})]})]}),S&&e.jsx(l,{variant:"body1",color:"error",sx:{mb:4},children:S}),!S&&!w&&x.length===0&&e.jsxs(g,{sx:{textAlign:"center",py:8},children:[e.jsx(l,{variant:"h6",color:"text.secondary",sx:{mb:2},children:"هیچ بیماری یافت نشد"}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"برای افزودن بیمار جدید، روی دکمه + کلیک کنید"})]}),I==="card"&&e.jsx(n,{container:!0,spacing:3,children:x.map(t=>{const{profileImage:s}=t;return e.jsx(n,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(ke,{sx:{textAlign:"center",cursor:"pointer"},role:"button",tabIndex:0,onClick:()=>{T(`/dashboard/orthodontics/patient/${t.id}`)},onKeyDown:a=>{a.key==="Enter"&&T(`/dashboard/orthodontics/patient/${t.id}`)},children:[e.jsxs(g,{sx:{position:"relative"},children:[e.jsx(Ce,{sx:{left:0,right:0,zIndex:10,mx:"auto",bottom:-26,position:"absolute"}}),e.jsx(J,{alt:t.firstName,src:s?ee(s.path):void 0,sx:{width:64,height:64,zIndex:11,left:0,right:0,bottom:-32,mx:"auto",position:"absolute",cursor:"pointer"},onClick:a=>{a.stopPropagation(),T(`/dashboard/orthodontics/patient/${t.id}`)}}),e.jsx(Ie,{src:`${ne.site.serverUrl}/assets/images/cover/cover-2.webp`,alt:"Card cover",ratio:"16/9",slotProps:{overlay:{background:a=>Pe(a.vars.palette.grey["900Channel"],.48)}},sx:{height:180,borderRadius:0}})]}),e.jsx(Ne,{sx:{mt:7,mb:1},primary:`${t.firstName} ${t.lastName||""}`,primaryTypographyProps:{typography:"subtitle1"},secondaryTypographyProps:{component:"span",mt:.5}}),e.jsx(we,{sx:{borderStyle:"dashed"}}),e.jsxs(g,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",sx:{py:3,typography:"subtitle1"},children:[e.jsxs("div",{children:[e.jsx(l,{variant:"caption",component:"div",sx:{mb:.5,color:"text.secondary"},children:"سن"}),t.age||"-"]}),e.jsxs("div",{children:[e.jsx(l,{variant:"caption",component:"div",sx:{mb:.5,color:"text.secondary"},children:"وضعیت"}),e.jsx(l,{variant:"caption",sx:{fontSize:"0.7rem !important"},children:ie[t.status]||"مشخص نشده"})]}),e.jsxs("div",{children:[e.jsx(l,{variant:"caption",component:"div",sx:{mb:.5,color:"text.secondary"},children:"تاریخ افزودن"}),e.jsx(l,{variant:"caption",sx:{fontSize:"0.7rem !important"},children:new Date(t.createdAt).toLocaleDateString("fa-IR")})]})]})]})},t.id)})}),I==="table"&&e.jsxs(Se,{sx:{width:"100%",borderRadius:"16px",overflow:"hidden"},children:[e.jsx(Re,{children:e.jsxs(Oe,{children:[e.jsx(ze,{children:e.jsxs(N,{sx:{bgcolor:"background.neutral"},children:[e.jsx(d,{children:"نام بیمار"}),e.jsx(d,{children:"وضعیت"}),e.jsx(d,{children:"تاریخ ثبت"}),e.jsx(d,{align:"center",children:"عملیات"})]})}),e.jsx(Be,{children:w?e.jsx(N,{children:e.jsx(d,{colSpan:4,align:"center",sx:{py:3},children:e.jsx(l,{variant:"body2",children:"در حال بارگیری..."})})}):x.length===0?e.jsx(N,{children:e.jsx(d,{colSpan:4,align:"center",sx:{py:3},children:e.jsx(l,{variant:"body2",children:"بیماری یافت نشد"})})}):x.slice($*v,$*v+v).map(t=>{const{profileImage:s}=t;return e.jsxs(N,{hover:!0,sx:{cursor:"pointer"},onClick:()=>{T(`/dashboard/orthodontics/patient/${t.id}`)},children:[e.jsx(d,{children:e.jsxs(z,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(J,{src:s?ee(s.path):void 0,sx:{width:32,height:32},children:t.firstName[0]}),e.jsx(l,{variant:"body2",children:`${t.firstName} ${t.lastName||""}`})]})}),e.jsx(d,{children:e.jsx(Le,{label:ie[t.status]||"مشخص نشده",size:"small",color:t.status==="IN_TREATMENT"?"primary":t.status==="COMPLETED"?"success":t.status==="CANCELLED"?"error":"default",sx:{fontSize:"0.75rem"}})}),e.jsx(d,{children:e.jsx(l,{variant:"caption",children:new Date(t.createdAt).toLocaleDateString("fa-IR")})}),e.jsx(d,{align:"center",children:e.jsxs(z,{direction:"row",spacing:.5,justifyContent:"center",children:[e.jsx(Q,{title:"ویرایش",children:e.jsx(B,{size:"small",onClick:a=>{a.stopPropagation(),he(t)},children:e.jsx(j,{icon:"solar:pen-bold",width:18})})}),e.jsx(Q,{title:"حذف",children:e.jsx(B,{size:"small",color:"error",onClick:a=>{a.stopPropagation(),pe(t)},children:e.jsx(j,{icon:"solar:trash-bin-trash-bold",width:18})})})]})})]},t.id)})})]})}),e.jsx(Me,{component:"div",count:x.length,page:$,onPageChange:(t,s)=>U(s),rowsPerPage:v,onRowsPerPageChange:t=>{me(parseInt(t.target.value,10)),U(0)},rowsPerPageOptions:[5,10,25,50],labelRowsPerPage:"تعداد ردیف در صفحه:",labelDisplayedRows:({from:t,to:s,count:a})=>`${t}-${s} از ${a}`})]}),e.jsxs(X,{open:oe,onClose:A,maxWidth:"sm",fullWidth:!0,children:[e.jsx(se,{children:"افزودن بیمار جدید"}),e.jsxs(Z,{methods:D,onSubmit:D.handleSubmit(ue),children:[e.jsx(ae,{children:e.jsxs(n,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(n,{item:!0,xs:12,children:e.jsx(c.Text,{name:"firstName",label:"نام"})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(c.Text,{name:"age",label:"سن",type:"number"})})]})}),e.jsxs(re,{children:[e.jsx(f,{onClick:A,children:"انصراف"}),e.jsx(f,{type:"submit",variant:"contained",children:"افزودن بیمار"})]})]})]}),e.jsxs(X,{open:le,onClose:k,maxWidth:"md",fullWidth:!0,children:[e.jsx(se,{children:"ویرایش بیمار"}),e.jsxs(Z,{methods:C,onSubmit:C.handleSubmit(ge),children:[e.jsx(ae,{children:e.jsxs(n,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(c.Text,{name:"firstName",label:"نام"})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(c.Text,{name:"lastName",label:"نام خانوادگی"})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(c.Text,{name:"phone",label:"شماره تلفن"})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(c.Text,{name:"age",label:"سن",type:"number"})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(c.DatePicker,{name:"treatmentStartDate",label:"تاریخ شروع درمان"})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(c.DatePicker,{name:"nextVisitTime",label:"تایم ویزیت بعدی"})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(c.Text,{name:"diagnosis",label:"تشخیص",multiline:!0,rows:2})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(c.Text,{name:"treatment",label:"طرح درمان",multiline:!0,rows:2})}),e.jsx(n,{item:!0,xs:12,children:e.jsxs(c.Select,{name:"status",label:"وضعیت",children:[e.jsx(P,{value:"PENDING",children:"شروع درمان"}),e.jsx(P,{value:"IN_TREATMENT",children:"در حال درمان"}),e.jsx(P,{value:"COMPLETED",children:"اتمام درمان"}),e.jsx(P,{value:"CANCELLED",children:"متوقف شده"})]})})]})}),e.jsxs(re,{children:[e.jsx(f,{onClick:k,children:"انصراف"}),e.jsx(f,{type:"submit",variant:"contained",children:"بروزرسانی"})]})]})]}),e.jsx($e,{open:ce,onClose:_,title:"حذف بیمار",content:`آیا از حذف بیمار "${m==null?void 0:m.firstName} ${(m==null?void 0:m.lastName)||""}" مطمئن هستید؟`,action:e.jsx(f,{variant:"contained",color:"error",onClick:async()=>{m&&await je(m.id),_()},children:"حذف"})})]})})}const Ve={title:`ارتودنسی | ${ne.site.name}`};function zt(){return e.jsxs(e.Fragment,{children:[e.jsx(Ee,{children:e.jsx("title",{children:Ve.title})}),e.jsx(Fe,{})]})}export{zt as default};
