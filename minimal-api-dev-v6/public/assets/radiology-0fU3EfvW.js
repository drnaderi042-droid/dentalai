import{r,fI as Bt,j as e,S as ae,cV as Fe,o as Me,I as ue,B as He,T as he,ar as Xt,bc as Et,H as Tt,e as Wt,d as Ot,aE as Ht,A as bt}from"./index-BH9ijvcg.js";import{U as _t}from"./upload-BVxhxEL6.js";import"./image-CxkC95SJ.js";import{a as Lt}from"./color-preview-BjGoTE6q.js";import{S as Nt}from"./Slider-nP-7N9E2.js";import{M as $t}from"./Menu-C7S9TApF.js";import{C as ct}from"./Card-CwEGl0A2.js";import{C as at}from"./CardContent-Bbr3YBl8.js";import"./preview-multi-file--Yn4-mQ8.js";import"./index-DVaqB1VX.js";import"./format-number-z67FV_-O.js";import"./file-thumbnail-GgYbZAeX.js";import"./FormHelperText-CAGzEAMm.js";import"./visuallyHidden-Dan1xhjv.js";const Gt=(H,B,se,M,k,C=3,j)=>{const{data:f}=H,q=Math.floor(j.x),z=Math.floor(j.y),K=Math.floor(j.width),W=Math.floor(j.height),Ie=q+K,ye=z+W,ke=[];for(let P=z;P<ye;P++)for(let v=q;v<Ie;v++){const le=(P*M+v)*4,Q=f[le],Ce=f[le+1],F=f[le+2],Pe=(Q+Ce+F)/3;ke.push({x:v,y:P,gray:Pe,r:Q,g:Ce,b:F})}const pe=ke.map(P=>P.gray),ze=pe.reduce((P,v)=>P+v,0)/pe.length,_=Math.sqrt(pe.reduce((P,v)=>P+(v-ze)**2,0)/pe.length),Se=new Set,h=ze-_*.5,Z=ze+_*.5,L=(se*M+B)*4,X=(f[L]+f[L+1]+f[L+2])/3,we=X<ze;for(const P of ke){let v=!1;we?v=P.gray<h:v=P.gray>Z,Math.abs(P.gray-X)<_*.3&&(v=!0),v&&Se.add(`${P.x},${P.y}`)}if(Se.size<50){const P=Math.floor(q+K/2),v=Math.floor(z+W/2),le=Math.min(K,W)*.6,Q=Math.max(q,P-le/2),Ce=Math.max(z,v-le/2),F=Math.min(Ie,P+le/2),Pe=Math.min(ye,v+le/2);for(let ve=Ce;ve<Pe;ve++)for(let _e=Q;_e<F;_e++)Se.add(`${Math.floor(_e)},${Math.floor(ve)}`)}return Se},Ut=(H,B,se)=>{const M=new Set;for(const k of H){const[C,j]=k.split(",").map(Number),f=[[C-1,j],[C+1,j],[C,j-1],[C,j+1],[C-1,j-1],[C-1,j+1],[C+1,j-1],[C+1,j+1]];let q=!1;for(const[z,K]of f){if(z<0||z>=B||K<0||K>=se){q=!0;break}if(!H.has(`${z},${K}`)){q=!0;break}}q&&M.add(k)}return M},De={0:"Caries",1:"Crown",2:"Filling",3:"Implant",4:"Malaligned",5:"Mandibular Canal",6:"Missing teeth",7:"Periapical lesion",8:"Retained root",9:"Root Canal Treatment",10:"Root Piece",11:"impacted tooth",12:"maxillary sinus",13:"Bone Loss",14:"Fracture teeth",15:"Permanent Teeth",16:"Supra Eruption",17:"TAD",18:"abutment",19:"attrition",20:"bone defect",21:"gingival former",22:"metal band",23:"orthodontic brackets",24:"permanent retainer",25:"post - core",26:"plating",27:"wire",28:"Cyst",29:"Root resorption",30:"Primary teeth"},lt={0:"Ù¾ÙˆØ³ÛŒØ¯Ú¯ÛŒ",1:"ØªØ§Ø¬",2:"Ù¾Ø±Ú©Ø±Ø¯Ú¯ÛŒ",3:"Ø§ÛŒÙ…Ù¾Ù„Ù†Øª",4:"Ù†Ø§Ù…Ø±ØªØ¨",5:"Ú©Ø§Ù†Ø§Ù„ Ù…Ù†Ø¯ÛŒØ¨ÙˆÙ„Ø§Ø±",6:"Ø¯Ù†Ø¯Ø§Ù† Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡",7:"Ø¶Ø§ÛŒØ¹Ù‡",8:"Ø±ÛŒØ´Ù‡ Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡",9:"Ø¯Ø±Ù…Ø§Ù† Ø±ÛŒØ´Ù‡",10:"ØªÚ©Ù‡ Ø±ÛŒØ´Ù‡",11:"Ø¯Ù†Ø¯Ø§Ù† Ù†Ù‡ÙØªÙ‡",12:"Ø³ÛŒÙ†ÙˆØ³ Ù…Ø§Ú¯Ø²ÛŒÙ„Ø§",13:"ØªØ­Ù„ÛŒÙ„ Ø§Ø³ØªØ®ÙˆØ§Ù†",14:"Ø´Ú©Ø³ØªÚ¯ÛŒ Ø¯Ù†Ø¯Ø§Ù†",15:"Ø¯Ù†Ø¯Ø§Ù† Ø¯Ø§Ø¦Ù…ÛŒ",16:"Ø¨ÛŒØ±ÙˆÙ†â€ŒØ²Ø¯Ú¯ÛŒ",17:"TAD",18:"Ø§Ø¨Ø§ØªÙ…Ù†Øª",19:"Ø³Ø§ÛŒØ´",20:"Ù†Ù‚Øµ Ø§Ø³ØªØ®ÙˆØ§Ù†",21:"ÙØ±Ù…Ø± Ù„Ø«Ù‡",22:"Ø¨Ø§Ù†Ø¯ ÙÙ„Ø²ÛŒ",23:"Ø¨Ø±Ø§Ú©Øª Ø§Ø±ØªÙˆØ¯Ù†Ø³ÛŒ",24:"Ø±ÛŒØªÛŒÙ†Ø± Ø¯Ø§Ø¦Ù…ÛŒ",25:"Ù¾Ø³Øª Ùˆ Ú©ÙˆØ±",26:"Ù¾Ù„ÛŒØª",27:"Ø³ÛŒÙ…",28:"Ú©ÛŒØ³Øª",29:"Ø¬Ø°Ø¨ Ø±ÛŒØ´Ù‡",30:"Ø¯Ù†Ø¯Ø§Ù† Ø´ÛŒØ±ÛŒ"},rt=(H,B)=>{if(B&&lt[Object.keys(De).find(se=>De[se]===B)]){const se=Object.keys(De).find(M=>De[M]===B);return lt[se]||B}return lt[H]||De[H]||"Ù†Ø§Ù…Ø´Ø®Øµ"},qt=["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F7DC6F","#BB8FCE","#85C1E9","#F8C471","#82E0AA","#F1948A","#AED6F1"],$e=(H,B=null)=>{if(B)return{main:B,light:`${B}33`,dark:B};const se=["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F7DC6F","#BB8FCE","#85C1E9","#F8C471","#82E0AA","#F1948A","#AED6F1","#FF8A65","#81C784","#64B5F6","#BA68C8","#4DB6AC","#FFB74D","#F48FB1","#90CAF9","#A5D6A7","#CE93D8","#FFAB91","#80CBC4","#9FA8DA","#FFE082","#EF9A9A","#B39DDB","#BCAAA4","#EEEEEE"],M=H%se.length,k=se[M];return{main:k,light:`${k}40`,dark:k}};function pt({imageUrl:H,detections:B,imageSize:se,onDetectionsChange:M}){var ut,gt,xt,ft,mt,yt;const k=r.useRef(null),C=r.useRef(null),j=r.useRef(null),[f,q]=r.useState([]),[z,K]=r.useState(1),[W,Ie]=r.useState({x:0,y:0}),[ye,ke]=r.useState(!1),[pe,ze]=r.useState({x:0,y:0}),[_,Se]=r.useState(!1),[h,Z]=r.useState(null),[L,X]=r.useState(null),[we,P]=r.useState(!1),[v,le]=r.useState(!1),[Q,Ce]=r.useState(null),[F,Pe]=r.useState({x:0,y:0}),[ve,_e]=r.useState({x:0,y:0}),[ht,St]=r.useState({x:0,y:0}),[Ze,wt]=r.useState({x:0,y:0,width:0,height:0}),Ye=r.useRef(null),ie=r.useRef(null),[Be,Ct]=r.useState(!0),[Re,Vt]=r.useState(1),[Ae,Jt]=r.useState(14),[$,jt]=r.useState("box");Bt(["carbon:checkbox","carbon:circle-dash"]);const[Ve,Ft]=r.useState(20),[I,Je]=r.useState(null),[ge,Qe]=r.useState({}),[re,et]=r.useState([]),Xe=r.useRef(!1),Ee=r.useCallback(async s=>{if(!C.current||!_)return;console.log("Auto-processing objects in detections...");const d=document.createElement("canvas"),t=d.getContext("2d");d.width=C.current.width,d.height=C.current.height,t.drawImage(C.current,0,0);const i=t.getImageData(0,0,C.current.width,C.current.height),o=[];for(let n=0;n<s.length;n++){const b=s[n],{bbox:u}=b;if(!u){o.push(b);continue}const l=u.x||u.x1||0,g=u.y||u.y1||0,x=u.width||(u.x2||0)-(u.x1||0)||0,w=u.height||(u.y2||0)-(u.y1||0)||0,m=Math.round(l+x/2),D=Math.round(g+w/2),Y={x:l,y:g,width:x,height:w};try{const R=Gt(i,m,D,C.current.width,C.current.height,Ve,Y),A=Ut(R,C.current.width,C.current.height);if(R.size>0){let y=1/0,p=1/0,S=-1/0,a=-1/0;const E=1e5;let c=0;for(const G of R){if(c++>=E)break;const[O,U]=G.split(",").map(Number);O<y&&(y=O),U<p&&(p=U),O>S&&(S=O),U>a&&(a=U)}const V=5e4,ee=[];let N=0;for(const G of A){if(N++>=V)break;const[O,U]=G.split(",").map(Number);ee.push({x:O,y:U})}const te={...b,bbox:{x:y,y:p,width:S-y,height:a-p,x1:y,y1:p,x2:S,y2:a},boundaryPixels:ee,autoProcessed:!0};o.push(te)}else o.push(b)}catch(R){console.error(`Error processing detection ${n}:`,R),o.push(b)}}console.log("Auto-processing complete, processed detections:",o),q(o),M&&M(o),et([])},[_,M,Ve]);r.useEffect(()=>{B&&B.length>0?et([...B]):(!B||B.length===0)&&(Xe.current=!1,et([]))},[B]),r.useEffect(()=>{if(re.length>0&&_&&!Xe.current){console.log("Auto-triggering object selection in 3 seconds...");const s=setTimeout(()=>{re.length>0&&_&&(console.log("Auto object selection triggered after 3 seconds..."),Ee(re),Xe.current=!0)},3e3);return()=>clearTimeout(s)}},[re,_,Ee]),r.useEffect(()=>{_&&re.length>0&&!Xe.current&&(Xe.current=!0,console.log("Processing detections after both image and detections are ready..."),setTimeout(()=>{Ee(re)},5e3))},[_,re,Ee]);const Ge=r.useCallback((s,d)=>{var m;const t=k.current,i=C.current;if(!t||!i)return null;const o=(m=j.current)==null?void 0:m.getBoundingClientRect();if(!o)return null;const n=Math.min(o.width/i.width,o.height/i.height)*z,b=i.width*n,u=i.height*n,l=(o.width-b)/2+W.x,g=(o.height-u)/2+W.y,x=(s-l)/n,w=(d-g)/n;return x<0||x>=i.width||w<0||w>=i.height?null:{x,y:w}},[z,W]);r.useCallback((s,d)=>{var m;const t=k.current,i=C.current;if(!t||!i)return null;const o=(m=j.current)==null?void 0:m.getBoundingClientRect();if(!o)return null;const n=Math.min(o.width/i.width,o.height/i.height)*z,b=i.width*n,u=i.height*n,l=(o.width-b)/2+W.x,g=(o.height-u)/2+W.y,x=s*n+l,w=d*n+g;return{x,y:w}},[z,W]);const Ue=r.useCallback(()=>{var g;const s=k.current,d=C.current;if(!s||!d||!_)return;const t=s.getContext("2d"),i=(g=j.current)==null?void 0:g.getBoundingClientRect();if(!i)return;s.width=i.width,s.height=i.height,t.clearRect(0,0,s.width,s.height);const o=Math.min(s.width/d.width,s.height/d.height)*z,n=d.width*o,b=d.height*o,u=(s.width-n)/2+W.x,l=(s.height-b)/2+W.y;t.drawImage(d,u,l,n,b),f.forEach((x,w)=>{const{bbox:m}=x;if(!m)return;const D=m.x||m.x1||0,Y=m.y||m.y1||0,R=m.width||(m.x2||0)-(m.x1||0)||0,A=m.height||(m.y2||0)-(m.y1||0)||0,y=D*o+u,p=Y*o+l,S=R*o,a=A*o,E=ge[w],c=$e(x.classId||x.class_id||0,E),V=h===w,ee=L===w;if(x.autoProcessed&&x.boundaryPixels&&x.boundaryPixels.length>0&&$!=="point"){if(t.save(),t.strokeStyle=c.main,t.lineWidth=V?4:3,t.globalAlpha=.3,t.lineJoin="round",t.lineCap="round",t.shadowColor=c.main,t.shadowBlur=1,t.beginPath(),x.boundaryPixels.forEach((N,te)=>{const G=N.x*o+u,O=N.y*o+l;te===0?t.moveTo(G,O):t.lineTo(G,O)}),t.closePath(),t.stroke(),t.fillStyle=c.main,t.globalAlpha=.3,t.shadowBlur=0,t.fill(),t.restore(),V||ee){const N=y+S/2,te=p+a/2,G=V?6:4;t.beginPath(),t.arc(N,te,G,0,2*Math.PI),t.fillStyle=c.main,t.fill(),t.strokeStyle="#FFFFFF",t.lineWidth=2,t.stroke()}}else if($==="point"){const N=y+S/2,te=p+a/2,G=V?8:ee?6:5;t.beginPath(),t.arc(N,te,G,0,2*Math.PI),t.fillStyle=c.main,t.fill(),t.strokeStyle="#FFFFFF",t.lineWidth=1,t.stroke(),V&&(t.beginPath(),t.arc(N,te,G+4,0,2*Math.PI),t.strokeStyle=c.main,t.lineWidth=2,t.stroke())}else t.strokeStyle=V?c.dark:c.main,t.fillStyle=ee?c.light:c.light.replace("0.2","0.1"),t.lineWidth=V?Re+1:Re,t.fillRect(y,p,S,a),t.strokeRect(y,p,S,a),V&&(t.fillStyle=c.main,t.fillRect(y-8/2,p-8/2,8,8),t.fillRect(y+S-8/2,p-8/2,8,8),t.fillRect(y-8/2,p+a-8/2,8,8),t.fillRect(y+S-8/2,p+a-8/2,8,8));if(Be){const N=x.classId||x.class_id||0,te=x.className||De[N]||"Unknown",O=rt(N,te);t.font=`bold ${Ae}px Yekan Bakh, Arial, sans-serif`,t.textBaseline="top",t.textAlign="center";let U,T;$==="point"?(U=y+S/2,T=p+a/2-25):(U=y+S/2,T=p-Ae-8),t.fillStyle=c.main,t.fillText(O,U,T),t.textAlign="left"}})},[_,f,z,W,Be,Re,h,L,Ae,$,ge,C,k,j]);r.useEffect(()=>{if(!H)return;const s=new Image;s.crossOrigin="anonymous",s.onload=()=>{C.current=s,Se(!0),Ue(),re.length>0&&!Xe.current&&(Xe.current=!0,setTimeout(()=>{Ee(re)},5e3))},s.src=H},[H,re,Ee,Ue]),r.useEffect(()=>{_&&!we&&!v&&Ue()},[_,f,z,W,Be,Re,L,h,ge,$,Ae,Ue,we,v]),r.useEffect(()=>()=>{ie.current&&(cancelAnimationFrame(ie.current),ie.current=null)},[]);const Ke=r.useCallback((s,d,t=!0)=>{var u;const i=Ge(s,d);if(!i)return null;const o=C.current;if(!o)return null;const n=(u=j.current)==null?void 0:u.getBoundingClientRect();if(!n)return null;const b=Math.min(n.width/o.width,n.height/o.height)*z;for(let l=f.length-1;l>=0;l--){const g=f[l],{bbox:x}=g;if(!x)continue;const w=x.x||x.x1||0,m=x.y||x.y1||0,D=x.width||(x.x2||0)-(x.x1||0)||0,Y=x.height||(x.y2||0)-(x.y1||0)||0;if(i.x>=w&&i.x<=w+D&&i.y>=m&&i.y<=m+Y){if(t&&h===l&&$==="box"){const A=12/b*2,y=Math.sqrt((i.x-w)**2+(i.y-m)**2),p=Math.sqrt((i.x-(w+D))**2+(i.y-m)**2),S=Math.sqrt((i.x-w)**2+(i.y-(m+Y))**2),a=Math.sqrt((i.x-(w+D))**2+(i.y-(m+Y))**2);if(y<A)return{detection:l,handle:"nw"};if(p<A)return{detection:l,handle:"ne"};if(S<A)return{detection:l,handle:"sw"};if(a<A)return{detection:l,handle:"se"}}return{detection:l,handle:null}}}return null},[f,Ge,z,h,$]),It=s=>{var b;const d=(b=k.current)==null?void 0:b.getBoundingClientRect();if(!d)return;const t=s.clientX-d.left,i=s.clientY-d.top,o=Ke(t,i,!0),n=Ke(t,i,!1);if(o&&o.handle&&$==="box"){le(!0),Ce(o.handle),Z(o.detection),Pe({x:t,y:i});const u=f[o.detection],{bbox:l}=u,g=l.x||l.x1||0,x=l.y||l.y1||0,w=l.width||(l.x2||0)-(l.x1||0)||0,m=l.height||(l.y2||0)-(l.y1||0)||0;wt({x:g,y:x,width:w,height:m})}else if(n){P(!0),Z(n.detection),Pe({x:t,y:i});const u=Ge(t,i);u&&St({x:u.x,y:u.y});const l=f[n.detection],{bbox:g}=l,x=g.x||g.x1||0,w=g.y||g.y1||0;_e({x,y:w})}else ke(!0),ze({x:t-W.x,y:i-W.y}),Z(null)},kt=s=>{var o;const d=(o=k.current)==null?void 0:o.getBoundingClientRect();if(!d)return;const t=s.clientX-d.left,i=s.clientY-d.top;if(v&&h!==null&&$==="box"){const n=Ze.x,b=Ze.y,u=Ze.width,l=Ze.height,g=C.current;if(!g)return;const x=Ge(t,i);if(!x)return;let w,m;switch(Q){case"nw":w=n,m=b;break;case"ne":w=n+u,m=b;break;case"sw":w=n,m=b+l;break;case"se":w=n+u,m=b+l;break;default:w=n,m=b;break}const D=x.x-w,Y=x.y-m;let R=n,A=b,y=u,p=l;switch(Q){case"nw":R=Math.max(0,n+D),A=Math.max(0,b+Y),y=u-D,p=l-Y;break;case"ne":A=Math.max(0,b+Y),y=u+D,p=l-Y;break;case"sw":R=Math.max(0,n+D),y=u-D,p=l+Y;break;case"se":y=u+D,p=l+Y;break}y<5&&((Q==="nw"||Q==="sw")&&(R=n+u-5),y=5),p<5&&((Q==="nw"||Q==="ne")&&(A=b+l-5),p=5),R+y>g.width&&(y=g.width-R),A+p>g.height&&(p=g.height-A),Ye.current={index:h,bbox:{x:R,y:A,width:y,height:p,x1:R,y1:A,x2:R+y,y2:A+p}},ie.current&&cancelAnimationFrame(ie.current),ie.current=requestAnimationFrame(()=>{var U;const E=k.current,c=E.getContext("2d");if(!E||!c||!g)return;const V=(U=j.current)==null?void 0:U.getBoundingClientRect();if(!V)return;E.width=V.width,E.height=V.height,c.clearRect(0,0,E.width,E.height);const ee=Math.min(E.width/g.width,E.height/g.height)*z,N=g.width*ee,te=g.height*ee,G=(E.width-N)/2+W.x,O=(E.height-te)/2+W.y;c.drawImage(g,G,O,N,te),f.forEach((T,Le)=>{let ce=T.bbox;if(Le===h&&Ye.current&&(ce=Ye.current.bbox),!ce)return;const nt=ce.x||ce.x1||0,st=ce.y||ce.y1||0,xe=ce.width||(ce.x2||0)-(ce.x1||0)||0,fe=ce.height||(ce.y2||0)-(ce.y1||0)||0,J=nt*ee+G,ne=st*ee+O,je=xe*ee,oe=fe*ee,Te=ge[Le],me=$e(T.classId||T.class_id||0,Te),de=h===Le,We=L===Le;if($==="point"){const be=J+je/2,Ne=ne+oe/2,Oe=de?8:We?6:5;c.beginPath(),c.arc(be,Ne,Oe,0,2*Math.PI),c.fillStyle=me.main,c.fill(),c.strokeStyle="#FFFFFF",c.lineWidth=2,c.stroke(),de&&(c.beginPath(),c.arc(be,Ne,Oe+4,0,2*Math.PI),c.strokeStyle=me.main,c.lineWidth=2,c.stroke())}else c.strokeStyle=de?me.dark:me.main,c.fillStyle=We?me.light:me.light.replace("0.2","0.1"),c.lineWidth=de?Re+1:Re,c.fillRect(J,ne,je,oe),c.strokeRect(J,ne,je,oe),de&&(c.fillStyle=me.main,c.fillRect(J-8/2,ne-8/2,8,8),c.fillRect(J+je-8/2,ne-8/2,8,8),c.fillRect(J-8/2,ne+oe-8/2,8,8),c.fillRect(J+je-8/2,ne+oe-8/2,8,8));if(Be){const be=T.classId||T.class_id||0,Ne=T.className||De[be]||"Unknown",qe=rt(be,Ne);c.font=`bold ${Ae}px Yekan Bakh, Arial, sans-serif`,c.textBaseline="top",c.textAlign="center";let ot,it;$==="point"?(ot=J+je/2,it=ne+oe/2-25):(ot=J+je/2,it=ne-Ae-8),c.fillStyle=me.main,c.fillText(qe,ot,it),c.textAlign="left"}}),ie.current=null});const S=[...f],a=f[h];S[h]={...a,bbox:{x:R,y:A,width:y,height:p,x1:R,y1:A,x2:R+y,y2:A+p}},q(S),M&&M(S)}else if(we&&h!==null){const n=f[h],{bbox:b}=n,u=b.width||(b.x2||0)-(b.x1||0)||0,l=b.height||(b.y2||0)-(b.y1||0)||0,g=C.current;if(!g)return;Math.min(d.width/g.width,d.height/g.height)*z;const x=Ge(t,i);if(!x)return;const w=x.x-ht.x,m=x.y-ht.y;let D,Y,R,A;if($==="point"){const S=ve.x+u/2,a=ve.y+l/2,E=Math.max(u/2,Math.min(g.width-u/2,S+w)),c=Math.max(l/2,Math.min(g.height-l/2,a+m));D=E-u/2,Y=c-l/2,R=u,A=l}else D=Math.max(0,Math.min(g.width-u,ve.x+w)),Y=Math.max(0,Math.min(g.height-l,ve.y+m)),R=u,A=l;Ye.current={index:h,bbox:{x:D,y:Y,width:R,height:A,x1:D,y1:Y,x2:D+R,y2:Y+A}},ie.current&&cancelAnimationFrame(ie.current),ie.current=requestAnimationFrame(()=>{var G;const S=k.current,a=S.getContext("2d");if(!S||!a||!g)return;const E=(G=j.current)==null?void 0:G.getBoundingClientRect();if(!E)return;S.width=E.width,S.height=E.height,a.clearRect(0,0,S.width,S.height);const c=Math.min(S.width/g.width,S.height/g.height)*z,V=g.width*c,ee=g.height*c,N=(S.width-V)/2+W.x,te=(S.height-ee)/2+W.y;a.drawImage(g,N,te,V,ee),f.forEach((O,U)=>{let T=O.bbox;if(U===h&&Ye.current&&(T=Ye.current.bbox),!T)return;const Le=T.x||T.x1||0,ce=T.y||T.y1||0,nt=T.width||(T.x2||0)-(T.x1||0)||0,st=T.height||(T.y2||0)-(T.y1||0)||0,xe=Le*c+N,fe=ce*c+te,J=nt*c,ne=st*c,je=ge[U],oe=$e(O.classId||O.class_id||0,je),Te=h===U,me=L===U;if($==="point"){const de=xe+J/2,We=fe+ne/2,be=Te?8:me?6:5;a.beginPath(),a.arc(de,We,be,0,2*Math.PI),a.fillStyle=oe.main,a.fill(),a.strokeStyle="#FFFFFF",a.lineWidth=2,a.stroke(),Te&&(a.beginPath(),a.arc(de,We,be+4,0,2*Math.PI),a.strokeStyle=oe.main,a.lineWidth=2,a.stroke())}else a.strokeStyle=Te?oe.dark:oe.main,a.fillStyle=me?oe.light:oe.light.replace("0.2","0.1"),a.lineWidth=Te?Re+1:Re,a.fillRect(xe,fe,J,ne),a.strokeRect(xe,fe,J,ne),Te&&(a.fillStyle=oe.main,a.fillRect(xe-8/2,fe-8/2,8,8),a.fillRect(xe+J-8/2,fe-8/2,8,8),a.fillRect(xe-8/2,fe+ne-8/2,8,8),a.fillRect(xe+J-8/2,fe+ne-8/2,8,8));if(Be){const de=O.classId||O.class_id||0,We=O.className||De[de]||"Unknown",Ne=rt(de,We);a.font=`bold ${Ae}px Yekan Bakh, Arial, sans-serif`,a.textBaseline="top",a.textAlign="center";let Oe,qe;$==="point"?(Oe=xe+J/2,qe=fe+ne/2-25):(Oe=xe+J/2,qe=fe-Ae-8),a.fillStyle=oe.main,a.fillText(Ne,Oe,qe),a.textAlign="left"}}),ie.current=null});const y=[...f],p={...n,bbox:{x:D,y:Y,width:R,height:A,x1:D,y1:Y,x2:D+R,y2:Y+A}};if(n.autoProcessed&&n.boundaryPixels&&n.boundaryPixels.length>0){const S=D-(n.bbox.x||n.bbox.x1||0),a=Y-(n.bbox.y||n.bbox.y1||0);p.boundaryPixels=n.boundaryPixels.map(E=>({x:E.x+S,y:E.y+a}))}y[h]=p,q(y),M&&M(y)}else if(ye)Ie({x:t-pe.x,y:i-pe.y});else{const n=Ke(t,i,!0);X(n?n.detection:null),n&&n.handle&&n.detection===h&&$==="box"?k.current.style.cursor=zt(n.handle):n?k.current.style.cursor="move":k.current.style.cursor="default"}},dt=()=>{if(ie.current&&(cancelAnimationFrame(ie.current),ie.current=null),P(!1),le(!1),ke(!1),Ce(null),Ye.current=null,_&&Ue(),h!==null&&f[h]){const s=f[h],{bbox:d}=s,t=d.x||d.x1||0,i=d.y||d.y1||0;_e({x:t,y:i})}},zt=s=>{switch(s){case"nw":case"se":return"nwse-resize";case"ne":case"sw":return"nesw-resize";default:return"default"}},Pt=()=>{if(h!==null){const s=f.filter((i,o)=>o!==h),d={...ge};delete d[h];const t={};Object.keys(d).forEach(i=>{const o=parseInt(i,10);o>h?t[o-1]=d[o]:o<h&&(t[o]=d[o])}),Qe(t),q(s),Z(null),M&&M(s)}},vt=s=>{var n;s.preventDefault();const d=(n=k.current)==null?void 0:n.getBoundingClientRect();if(!d)return;const t=s.clientX-d.left,i=s.clientY-d.top,o=Ke(t,i);o?(Je({detectionIndex:o.detection,mouseX:s.clientX,mouseY:s.clientY}),Z(o.detection)):Je(null)},tt=()=>{Je(null)},Rt=()=>{if((I==null?void 0:I.detectionIndex)!==null&&(I==null?void 0:I.detectionIndex)!==void 0){const s=I.detectionIndex,d=f.filter((o,n)=>n!==s),t={...ge};delete t[s];const i={};Object.keys(t).forEach(o=>{const n=parseInt(o,10);n>s?i[n-1]=t[n]:n<s&&(i[n]=t[n])}),Qe(i),q(d),Z(null),M&&M(d)}tt()},At=s=>{(I==null?void 0:I.detectionIndex)!==null&&(I==null?void 0:I.detectionIndex)!==void 0&&Qe({...ge,[I.detectionIndex]:s}),tt()},Mt=()=>{K(s=>Math.min(s*1.2,20))},Dt=()=>{K(s=>Math.max(s/1.2,.1))},Yt=()=>{K(1),Ie({x:0,y:0})};return e.jsxs(ae,{spacing:2,children:[e.jsxs(ae,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",children:[e.jsxs(ae,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(Fe,{title:"Zoom In",children:e.jsx(Me,{size:"small",onClick:Mt,children:e.jsx(ue,{icon:"carbon:zoom-in"})})}),e.jsx(Fe,{title:"Zoom Out",children:e.jsx(Me,{size:"small",onClick:Dt,children:e.jsx(ue,{icon:"carbon:zoom-out"})})}),e.jsx(Fe,{title:"Reset Zoom",children:e.jsx(Me,{size:"small",onClick:Yt,children:e.jsx(ue,{icon:"carbon:reset"})})}),e.jsx(He,{sx:{width:2,height:24,bgcolor:"divider",mx:1}}),e.jsx(Fe,{title:Be?"Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§":"Ù†Ù…Ø§ÛŒØ´ Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§",children:e.jsx(Me,{size:"small",onClick:()=>Ct(!Be),children:e.jsx(ue,{icon:"carbon:label"})})}),e.jsx(Fe,{title:$==="box"?"Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ ØµÙˆØ±Øª Ù†Ù‚Ø·Ù‡":"Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ ØµÙˆØ±Øª Ø¬Ø¹Ø¨Ù‡",children:e.jsx(Me,{size:"small",onClick:()=>jt($==="box"?"point":"box"),children:e.jsx(ue,{icon:$==="box"?"carbon:checkbox":"carbon:circle-dash"})})}),e.jsx(Fe,{title:"Ø§Ù†ØªØ®Ø§Ø¨ Ø®ÙˆØ¯Ú©Ø§Ø± Ù…Ø±Ø²Ù‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø´ÛŒØ¡ (3 Ø«Ø§Ù†ÛŒÙ‡ Ø¨Ø¹Ø¯ Ø§Ø² ØªØ´Ø®ÛŒØµ AI)",children:e.jsx(Me,{size:"small",color:"secondary",onClick:()=>{re.length>0&&_&&(console.log("Manual object selection triggered..."),Ee(re))},disabled:!_||re.length===0,children:e.jsx(ue,{icon:"carbon:magic-wand"})})}),e.jsx(He,{sx:{width:2,height:24,bgcolor:"divider",mx:1}}),e.jsxs(He,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Fe,{title:"ØªÙ†Ø¸ÛŒÙ… tolerance Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ù…Ø±Ø²Ù‡Ø§ÛŒ Ø´ÛŒØ¡ (Ù…Ù‚Ø¯Ø§Ø± Ú©Ù…ØªØ± = Ù…Ø±Ø² Ø¯Ù‚ÛŒÙ‚â€ŒØªØ±)",children:e.jsxs(he,{variant:"caption",sx:{color:"text.secondary",minWidth:60},children:["Tolerance: ",Ve]})}),e.jsx(Nt,{value:Ve,onChange:(s,d)=>Ft(d),min:1,max:20,step:1,size:"small",sx:{width:80,"& .MuiSlider-thumb":{width:12,height:12},"& .MuiSlider-rail":{height:2},"& .MuiSlider-track":{height:2}}})]})]}),e.jsx(ae,{direction:"row",spacing:1,alignItems:"center",children:h!==null&&e.jsxs(e.Fragment,{children:[e.jsx(Fe,{title:"ØªØºÛŒÛŒØ± Ø±Ù†Ú¯",children:e.jsx(Me,{size:"small",onClick:s=>{var t;((t=k.current)==null?void 0:t.getBoundingClientRect())&&Je({detectionIndex:h,mouseX:s.clientX,mouseY:s.clientY})},sx:{bgcolor:ge[h]||$e(((ut=f[h])==null?void 0:ut.classId)||((gt=f[h])==null?void 0:gt.class_id)||0).main,color:"#FFFFFF","&:hover":{bgcolor:ge[h]||$e(((xt=f[h])==null?void 0:xt.classId)||((ft=f[h])==null?void 0:ft.class_id)||0).main}},children:e.jsx(ue,{icon:"carbon:color-palette"})})}),e.jsx(Fe,{title:"Ø­Ø°Ù",children:e.jsx(Me,{size:"small",color:"error",onClick:Pt,children:e.jsx(ue,{icon:"carbon:delete"})})})]})})]}),e.jsx(He,{ref:j,sx:{position:"relative",width:"100%",border:"1px solid",borderColor:"divider",borderRadius:1,overflow:"hidden",bgcolor:"transparent",minHeight:400},children:e.jsx(He,{component:"canvas",ref:k,onMouseDown:It,onMouseMove:kt,onMouseUp:dt,onMouseLeave:dt,onContextMenu:vt,sx:{display:"block",width:"100%",height:"100%",cursor:"default"}})}),e.jsxs(ae,{spacing:1,children:[e.jsx(he,{variant:"caption",sx:{color:"primary.main",textAlign:"center",fontWeight:"bold"},children:"ðŸ¤–ðŸ” Ø­Ø§Ù„Øª Ø®ÙˆØ¯Ú©Ø§Ø±: ØªØ´Ø®ÛŒØµ AI + Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø±Ø²Ù‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø´ÛŒØ¡"}),e.jsx(he,{variant:"caption",sx:{color:"text.secondary",textAlign:"center"},children:"ðŸ’¡ Ø±Ø§Ù‡Ù†Ù…Ø§: Ø¨Ø±Ø§ÛŒ Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ bounding boxØŒ Ø±ÙˆÛŒ Ø¢Ù† Ú©Ù„ÛŒÚ© Ùˆ drag Ú©Ù†ÛŒØ¯ | Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ø§Ù†Ø¯Ø§Ø²Ù‡ØŒ Ú¯ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ box Ø±Ø§ Ø¨Ú©Ø´ÛŒØ¯ | Ø¨Ø±Ø§ÛŒ Ù¾Ù† (pan)ØŒ Ø±ÙˆÛŒ ÙØ¶Ø§ÛŒ Ø®Ø§Ù„ÛŒ Ú©Ù„ÛŒÚ© Ùˆ drag Ú©Ù†ÛŒØ¯ | Ø±Ø§Ø³Øª Ú©Ù„ÛŒÚ© Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ Ùˆ Ø­Ø°Ù"})]}),e.jsxs($t,{open:I!==null,onClose:tt,anchorReference:"anchorPosition",anchorPosition:I!==null?{top:I.mouseY,left:I.mouseX}:void 0,PaperProps:{sx:{minWidth:200}},children:[e.jsxs(He,{sx:{px:2,py:1},children:[e.jsx(he,{variant:"caption",sx:{color:"text.secondary",display:"block",mb:1},children:"ØªØºÛŒÛŒØ± Ø±Ù†Ú¯:"}),e.jsx(Lt,{colors:qt,selected:(I==null?void 0:I.detectionIndex)!==null&&(I==null?void 0:I.detectionIndex)!==void 0&&f[I.detectionIndex]?ge[I.detectionIndex]||$e(((mt=f[I.detectionIndex])==null?void 0:mt.classId)||((yt=f[I.detectionIndex])==null?void 0:yt.class_id)||0).main:"#000000",onSelectColor:At})]}),e.jsx(Xt,{sx:{my:1}}),e.jsxs(Et,{onClick:Rt,sx:{color:"inherit"},children:[e.jsx(ue,{icon:"solar:trash-bin-trash-bold",sx:{mr:1,color:"inherit"}}),"Ø­Ø°Ù"]})]})]})}const Zt={0:"Caries",1:"Crown",2:"Filling",3:"Implant",4:"Malaligned",5:"Mandibular Canal",6:"Missing teeth",7:"Periapical lesion",8:"Retained root",9:"Root Canal Treatment",10:"Root Piece",11:"impacted tooth",12:"maxillary sinus",13:"Bone Loss",14:"Fracture teeth",15:"Permanent Teeth",16:"Supra Eruption",17:"TAD",18:"abutment",19:"attrition",20:"bone defect",21:"gingival former",22:"metal band",23:"orthodontic brackets",24:"permanent retainer",25:"post - core",26:"plating",27:"wire",28:"Cyst",29:"Root resorption",30:"Primary teeth"};function gn(){var Se;const[H,B]=r.useState(null),[se,M]=r.useState(null),[k,C]=r.useState(!1),[j,f]=r.useState(null),[q,z]=r.useState(null),[K,W]=r.useState(null),[Ie,ye]=r.useState([]),ke=r.useCallback(h=>{const Z=h[0];if(Z){B(Z);const L=URL.createObjectURL(Z);M(L),z(null),f(null),ye([]);const X=new Image;X.onload=()=>{const we=X.naturalWidth||X.width,P=X.naturalHeight||X.height;W({width:we,height:P}),console.log(`ðŸ“ Ø§Ø¨Ø¹Ø§Ø¯ ØªØµÙˆÛŒØ±: ${we} Ã— ${P}`)},X.src=L}},[]),pe=r.useCallback(()=>{B(null),M(null),f(null),ye([])},[]),ze=h=>new Promise((Z,L)=>{const X=new FileReader;X.onload=()=>Z(X.result),X.onerror=L,X.readAsDataURL(h)}),_=async()=>{var Z;if(!H){z("Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© ØªØµÙˆÛŒØ± OPG Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯");return}C(!0),z(null),f(null),ye([]);const h=Date.now();try{const L=await ze(H);console.log("ðŸ–¼ï¸ Ø´Ø±ÙˆØ¹ Ø¢Ù†Ø§Ù„ÛŒØ² OPG..."),console.log("   File name:",H.name),console.log("   File size:",H.size,"bytes"),console.log("   Image size:",K);const X=await fetch("http://localhost:5001/detect-opg",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_base64:L,conf_threshold:.25,iou_threshold:.45})}),P=(Date.now()-h)/1e3;if(!X.ok){const F=await X.text();throw new Error(`OPG Service Error: ${X.status} - ${F}`)}const v=await X.json();if(!v.success)throw new Error(v.error||"Detection failed");console.log("âœ… Ù†ØªØ§ÛŒØ¬ Ø¢Ù†Ø§Ù„ÛŒØ² OPG:",v);const Q=(v.detections||[]).map((F,Pe)=>({id:Pe,classId:F.class_id||F.class,className:Zt[F.class_id||F.class]||"Unknown",confidence:F.confidence||F.conf,bbox:F.bbox||F.box||{x:F.x||F.x1||0,y:F.y||F.y1||0,width:F.width||F.x2-F.x1||0,height:F.height||F.y2-F.y1||0},segmentation:F.segmentation||F.mask||null}));ye(Q);const Ce={success:!0,detections:Q,totalDetections:Q.length,metadata:{processingTime:P.toFixed(2),timestamp:new Date().toLocaleString("fa-IR"),model:((Z=v.metadata)==null?void 0:Z.model)||"OPG YOLO Model",imageSize:K},rawResponse:v};f(Ce),console.log(`âœ… ${Q.length} Ù…ÙˆØ±Ø¯ ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯`)}catch(L){console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù†Ø§Ù„ÛŒØ² OPG:",L),z(L.message||"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù†Ø§Ù„ÛŒØ² ØªØµÙˆÛŒØ± OPG");const X={success:!1,error:L.message,metadata:{timestamp:new Date().toLocaleString("fa-IR")}};f(X)}finally{C(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(Tt,{children:e.jsx("title",{children:"Ø±Ø§Ø¯ÛŒÙˆÙ„ÙˆÚ˜ÛŒ - Ø¢Ù†Ø§Ù„ÛŒØ² OPG | DentalAI"})}),e.jsx(Wt,{maxWidth:"xl",children:e.jsxs(ae,{spacing:3,children:[e.jsxs(ae,{direction:"row",alignItems:"center",spacing:2,children:[e.jsx(ue,{icon:"mdi:xray",width:40}),e.jsx(He,{children:e.jsx(he,{variant:"h4",children:"Ø±Ø§Ø¯ÛŒÙˆÙ„ÙˆÚ˜ÛŒ - Ø¢Ù†Ø§Ù„ÛŒØ² OPG"})})]}),e.jsxs(ae,{direction:{xs:"column",md:"row"},spacing:3,children:[e.jsxs(ae,{spacing:3,sx:{width:{xs:"100%",md:"400px"}},children:[e.jsx(ct,{children:e.jsx(at,{children:e.jsxs(ae,{spacing:2,children:[e.jsx(he,{variant:"h6",children:"ðŸ“· Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ± OPG"}),e.jsx(_t,{file:H,onDrop:ke,onDelete:pe,accept:{"image/*":[]}})]})})}),e.jsx(Ot,{fullWidth:!0,size:"large",variant:"contained",color:"primary",onClick:_,disabled:k||!H,startIcon:k?e.jsx(ue,{icon:"line-md:loading-loop"}):e.jsx(ue,{icon:"carbon:ai-status"}),children:k?"Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù†Ø§Ù„ÛŒØ²...":"Ø¢Ù†Ø§Ù„ÛŒØ² Ø¨Ø§ AI"})]}),e.jsxs(ae,{spacing:3,sx:{flex:1},children:[k&&e.jsx(ct,{children:e.jsx(at,{children:e.jsxs(ae,{spacing:2,children:[e.jsx(ae,{direction:"row",justifyContent:"space-between",children:e.jsx(he,{variant:"h6",children:"â³ Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´..."})}),e.jsx(Ht,{}),e.jsx(he,{variant:"body2",sx:{color:"text.secondary",textAlign:"center"},children:"Ø¯Ø± Ø­Ø§Ù„ ØªØ´Ø®ÛŒØµ Ù„Ù†Ø¯Ù…Ø§Ø±Ú©â€ŒÙ‡Ø§ Ùˆ Ù†Ø§Ù‡Ù†Ø¬Ø§Ø±ÛŒâ€ŒÙ‡Ø§ Ø¯Ø± ØªØµÙˆÛŒØ± OPG..."})]})})}),q&&e.jsxs(bt,{severity:"error",onClose:()=>z(null),children:[e.jsx(he,{variant:"subtitle2",children:"Ø®Ø·Ø§"}),e.jsx(he,{variant:"body2",children:q})]}),se&&e.jsx(ct,{children:e.jsx(at,{children:e.jsx(ae,{spacing:2,children:j&&j.success&&Ie.length>0?e.jsxs(e.Fragment,{children:[e.jsx(he,{variant:"h6",children:"ðŸ“Š Ù†Ù…Ø§ÛŒØ´ Ø¨ØµØ±ÛŒ Ùˆ ÙˆÛŒØ±Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬ ØªØ´Ø®ÛŒØµ"}),e.jsx(pt,{imageUrl:se,detections:Ie,imageSize:K,onDetectionsChange:h=>{ye(h),f({...j,detections:h,totalDetections:h.length})}}),e.jsx(bt,{severity:"success",children:e.jsxs(he,{variant:"body2",children:["âœ… ",j.totalDetections," Ù…ÙˆØ±Ø¯ ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯",((Se=j.metadata)==null?void 0:Se.processingTime)&&e.jsxs(e.Fragment,{children:[" â€¢ Ø²Ù…Ø§Ù† Ù¾Ø±Ø¯Ø§Ø²Ø´: ",j.metadata.processingTime," Ø«Ø§Ù†ÛŒÙ‡"]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{variant:"h6",children:"ðŸ“Š ØªØµÙˆÛŒØ± OPG"}),e.jsx(pt,{imageUrl:se,detections:[],imageSize:K,onDetectionsChange:()=>{}})]})})})})]})]})]})})]})}export{gn as default};
