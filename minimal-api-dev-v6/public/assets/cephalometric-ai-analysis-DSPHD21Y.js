import{r as u,b as rs,j as a,S as B,T as O,bc as $,B as E,o as Ft,I as nt,A as Na,bf as cs,d as Ot,bt as co,cI as ls,cV as us}from"./index-BH9ijvcg.js";import{g as Ga,b as Tn}from"./url-helpers-CUK1i57f.js";import{U as ds}from"./upload-BVxhxEL6.js";import"./image-CxkC95SJ.js";import{A as hs}from"./advanced-cephalometric-visualizer-DNecNJty.js";import{C as St}from"./Card-CwEGl0A2.js";import{C as lo}from"./CardContent-Bbr3YBl8.js";import{F as uo}from"./FormControl-rHOkSiGz.js";import{I as ho}from"./InputLabel-OzeQogzC.js";import{S as po}from"./Select-fMsy-Lkz.js";import{T as ps}from"./TextField-DgF_8CdY.js";import{F as fs}from"./FormControlLabel-CVzZoZzb.js";import{D as ms}from"./DialogTitle-BFho6EhL.js";import{D as gs}from"./DialogContent-CtzR1nPJ.js";import{D as xs}from"./dialogTitleClasses-CSmkbKpM.js";import{T as Ls,a as Eo}from"./ToggleButtonGroup-BM7GBSTh.js";import{S as ys}from"./Skeleton-Mn58_7nY.js";import"./preview-multi-file--Yn4-mQ8.js";import"./index-DVaqB1VX.js";import"./format-number-z67FV_-O.js";import"./file-thumbnail-GgYbZAeX.js";import"./FormHelperText-CAGzEAMm.js";import"./color-preview-BjGoTE6q.js";import"./Menu-C7S9TApF.js";import"./ClickAwayListener-Baho8cKO.js";import"./FormLabel-Cn8enUsF.js";const Ms=()=>a.jsxs(E,{component:"svg",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",sx:{width:"24px",height:"24px",color:"inherit","& path":{fill:"currentColor"}},children:[a.jsxs("g",{clipPath:"url(#clip0_4418_5060)",children:[a.jsx("path",{opacity:"0.4",d:"M2 12.8794V11.1194C2 10.0794 2.85 9.21945 3.9 9.21945C5.71 9.21945 6.45 7.93945 5.54 6.36945C5.02 5.46945 5.33 4.29945 6.24 3.77945L7.97 2.78945C8.76 2.31945 9.78 2.59945 10.25 3.38945L10.36 3.57945C11.26 5.14945 12.74 5.14945 13.65 3.57945L13.76 3.38945C14.23 2.59945 15.25 2.31945 16.04 2.78945L17.77 3.77945C18.68 4.29945 18.99 5.46945 18.47 6.36945C17.56 7.93945 18.3 9.21945 20.11 9.21945C21.15 9.21945 22.01 10.0694 22.01 11.1194V12.8794C22.01 13.9194 21.16 14.7794 20.11 14.7794C18.3 14.7794 17.56 16.0594 18.47 17.6294C18.99 18.5394 18.68 19.6994 17.77 20.2194L16.04 21.2094C15.25 21.6794 14.23 21.3995 13.76 20.6094L13.65 20.4194C12.75 18.8494 11.27 18.8494 10.36 20.4194L10.25 20.6094C9.78 21.3995 8.76 21.6794 7.97 21.2094L6.24 20.2194C5.33 19.6994 5.02 18.5294 5.54 17.6294C6.45 16.0594 5.71 14.7794 3.9 14.7794C2.85 14.7794 2 13.9194 2 12.8794Z",fill:"currentColor"}),a.jsx("path",{d:"M12 15.25C13.7949 15.25 15.25 13.7949 15.25 12C15.25 10.2051 13.7949 8.75 12 8.75C10.2051 8.75 8.75 10.2051 8.75 12C8.75 13.7949 10.2051 15.25 12 15.25Z",fill:"currentColor"})]}),a.jsx("defs",{children:a.jsx("clipPath",{id:"clip0_4418_5060",children:a.jsx("rect",{width:"24",height:"24",fill:"white"})})})]}),Fa=["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F7DC6F","#BB8FCE","#85C1E9","#F8C471","#82E0AA","#F1948A","#AED6F1","#FF8A65","#81C784","#64B5F6","#BA68C8","#4DB6AC","#FFB74D","#F48FB1","#90CAF9","#A5D6A7","#CE93D8","#FFAB91","#80CBC4","#9FA8DA","#FFE082","#EF9A9A","#B39DDB","#BCAAA4","#EEEEEE"],at=[{id:"local/aariz-768",name:"Aariz 768x768",provider:"",description:"Aariz Model 768x768 - High Resolution (MRE: 1.118mm, SDR: 86.92%)",color:Fa[0],isLocal:!0,requiresApiKey:!1,modelPath:"Aariz/checkpoint_best_768.pth"},{id:"local/cldetection2023",name:"CLdetection2023",provider:"",description:"CLdetection2023 Model - 38 landmarks (MICCAI CLDetection2023 Challenge)",color:Fa[1],isLocal:!0,requiresApiKey:!1,modelPath:"CLdetection2023/model_pretrained_on_train_and_val.pth"}];function bs({onLandmarksDetected:T,lateralImageUrl:D,isEditMode:Dt,onEditModeChange:bn,initialLandmarks:S,showCoordinateSystem:Oa=!1,onSaveAnalysis:As,saving:st=!1,hasPatient:Ps=!1,analysisHistory:W=[],selectedAnalysisIndex:C=null,onSelectedAnalysisIndexChange:zn,onDeleteAnalysis:To,deleteDialogOpen:Da=!1,onDeleteDialogOpenChange:it,analysisToDelete:zo=null,onAnalysisToDeleteChange:Uo,deleting:Rt=!1,selectedImageIndex:tt=0,onSelectedImageIndexChange:Un,lateralImages:K=[],onImageUpload:fo,patientId:Wo=null,onDeleteImage:Io,isUploadingImage:rt=!1,viewMode:mo="normal",onViewModeChange:qo,cephalometricTable:ks=null,selectedAnalysisType:Ht="steiner"}){var se,ie,re,ce,le;const[Ra,Ha]=u.useState(mo||"normal"),Jo=mo!==void 0?mo:Ra,Ba=e=>{qo?qo(e):Ha(e)};u.useRef({lateralImageUrl:D,initialLandmarks:S}),u.useEffect(()=>{},[D,S]);const[F,Ea]=u.useState(((se=at.find(e=>e.id==="local/cldetection2023"))==null?void 0:se.id)||at[0].id),[go,Ta]=u.useState(""),[Wn,wt]=u.useState(null),[xo,Bt]=u.useState([]),[An,ct]=u.useState(null),[Lo,Vo]=u.useState(!1),[p,I]=u.useState(null),[$o,Fn]=u.useState(null),[lt,Et]=u.useState(null),[Ko,za]=u.useState(!0),[Ss,ws]=u.useState(!1),[Cs,yo]=u.useState(!1),[_s,js]=u.useState(!0),[vs,Ns]=u.useState("auto"),[Xo,Ua]=u.useState(!1),[Gs,Fs]=u.useState([]),[Os,Ds]=u.useState(!1),[Mo,Rs]=u.useState(null),[Hs,Bs]=u.useState(null),[bo,Es]=u.useState([]),[Wa,Z]=u.useState([]),[cn,Q]=u.useState(.11),[Ts,zs]=u.useState(!1),[Us,Ws]=u.useState(null),[Is,qs]=u.useState({enabled:!0,selectedMethod:"auto",searchArea:{x:.5,y:0,width:.5,height:.5},brightness:{threshold:150,minContrast:25},verticalAlignment:{maxDx:20,minDy:.03,maxDy:.08},detection:{maxPoints:20,duplicateThreshold:10}}),[Ia,qa]=u.useState({}),[Ao,Po]=u.useState(!1),[ut,Yo]=u.useState(!1),[Zo,Qo]=u.useState(Ht||"steiner");u.useEffect(()=>{Ht&&Qo(Ht)},[Ht]),rs().palette.mode;const[Ja,Va]=u.useState(!1),dt=Dt!==void 0?Dt:Ja,Tt=u.useCallback(e=>{bn?bn(e):Va(e)},[bn]),Ct=u.useCallback(e=>{if(e.length<2)return .11;if(e.length===2){const i=e[0],d=e[1];return Math.abs(i.x-d.x),10/Math.abs(i.y-d.y)}let n=null,o=null;for(let i=0;i<e.length;i++){for(let d=i+1;d<e.length;d++){const r=e[i],c=e[d],L=Math.abs(c.x-r.x),_=Math.abs(c.y-r.y),f=Math.sqrt(L*L+_*_);if(f<15||f>200)continue;const w=L<30&&_>50,m=10/f;if(m>=.08&&m<=.17&&(n=m,o=[r,c],w))break}if(n&&o&&Math.abs(o[0].x-o[1].x)<30)break}return n||.11},[]),ne={soft_tissue_profile:{search_area_ratio:.4,edge_threshold_low:30,edge_threshold_high:100,smooth_sigma:2,contrast_alpha:1.5,contrast_beta:-30,max_points:200,simplify_epsilon:1.5,use_circle_fit:!1,use_ellipse_fit:!1},mandible_border:{search_area_ratio:.5,edge_threshold_low:40,edge_threshold_high:120,smooth_sigma:1.5,contrast_alpha:1.8,contrast_beta:-40,max_points:150,simplify_epsilon:2,use_circle_fit:!1,use_ellipse_fit:!1},maxilla_border:{search_area_ratio:.4,edge_threshold_low:35,edge_threshold_high:110,smooth_sigma:1.5,contrast_alpha:1.6,contrast_beta:-35,max_points:150,simplify_epsilon:2,use_circle_fit:!1,use_ellipse_fit:!1},sella_turcica:{search_area_ratio:.25,edge_threshold_low:25,edge_threshold_high:90,smooth_sigma:1,contrast_alpha:2,contrast_beta:-50,max_points:64,simplify_epsilon:2,use_circle_fit:!1,use_ellipse_fit:!0,ellipse_fit_points:48},orbital_rim:{search_area_ratio:.3,edge_threshold_low:30,edge_threshold_high:100,smooth_sigma:2,contrast_alpha:1.7,contrast_beta:-40,max_points:100,simplify_epsilon:2.5,use_circle_fit:!0,circle_fit_points:48,use_ellipse_fit:!1},upper_tooth:{search_area_ratio:.2,edge_threshold_low:40,edge_threshold_high:130,smooth_sigma:1,contrast_alpha:2.2,contrast_beta:-50,max_points:80,simplify_epsilon:1.5,use_circle_fit:!1,use_ellipse_fit:!1},lower_tooth:{search_area_ratio:.2,edge_threshold_low:40,edge_threshold_high:130,smooth_sigma:1,contrast_alpha:2.2,contrast_beta:-50,max_points:80,simplify_epsilon:1.5,use_circle_fit:!1,use_ellipse_fit:!1}};u.useEffect(()=>{if(bo.length>0&&Object.keys(Ia).length===0){const e={};bo.forEach(n=>{ne[n]&&(e[n]={...ne[n]})}),qa(e)}},[bo]);const In=u.useRef(null),On=u.useRef(null),ot=u.useRef(null),Dn=u.useRef(!1),ko=u.useRef(!0),ht=u.useRef(!1),Rn=u.useRef(!1),pt=u.useRef(null),_t=u.useRef(null);u.useEffect(()=>{I(null),Dn.current=!1,Rn.current=!1,pt.current=null,_t.current=null},[]),u.useEffect(()=>{Dn.current=!1},[An]),u.useEffect(()=>{K&&K.length>0&&Un&&(tt===null||tt>=K.length||tt<0)&&(Un(0),zn&&C!==null&&zn(""))},[K,Un,tt,zn,C]),u.useEffect(()=>{if(_t.current!==C&&!rt)if(C!=null&&W&&W.length>0&&C<W.length){const e=W[C];if(e!=null&&e.landmarks&&Object.keys(e.landmarks).length>0){const n=e.landmarks,o={success:!0,response:{landmarks:n},metadata:{source:"history",analysisType:e.analysisType||e.currentAnalysisType||"steiner",timestamp:e.timestamp,selectedAnalysisIndex:C}};Dn.current=!1,Rn.current=!1;const i=JSON.stringify(n);if(On.current=i,n.p1&&n.p2){const d=[n.p2,n.p1];Z(d);const r=Ct(d);Q(r)}else Z([]),Q(.11);I(o),_t.current=C}else I(null),Z([]),Q(.11),_t.current=C}else C!=null&&(I(null),Z([]),Q(.11),_t.current=C)},[C,W,T,Ct,rt,D]);const te=e=>new Promise((n,o)=>{const i=new FileReader;i.onload=()=>n(i.result),i.onerror=o,i.readAsDataURL(e)});u.useEffect(()=>{if(!D){In.current=null,ot.current=null,ko.current=!0,I(null),Z([]),Q(.11),Dn.current=!1,Rn.current=!1,On.current=null;return}const e=In.current!==D,n=ko.current,o=C!=null&&W&&W.length>0;if(e&&(rt?(I(null),Tt(!1),Z([]),Q(.11),Dn.current=!1,Rn.current=!1,On.current=null,In.current=null,ot.current=null,pt.current=null):o||n&&W&&W.length>0?In.current=null:(I(null),Tt(!1),Z([]),Q(.11),Dn.current=!1,Rn.current=!1,On.current=null,In.current=null,ot.current=null,pt.current=null)),!e&&!n&&In.current===D||ht.current)return;ht.current=!0,ko.current=!1,(async()=>{try{const d=await fetch(D);if(!d.ok){ht.current=!1;return}const r=await d.blob(),c=D.split("/").pop()||"lateral-image.jpg",L=new File([r],c,{type:r.type||"image/jpeg"}),_=await te(L);ct(_),wt(L),yo(!0),In.current=D;const f=new Image;f.onload=()=>{const w=f.naturalWidth||f.width,m=f.naturalHeight||f.height;Et({width:w,height:m}),ht.current=!1},f.onerror=w=>{ht.current=!1},f.src=_}catch{ht.current=!1}})()},[D,rt]),u.useEffect(()=>{var e,n;if(!rt){if(D&&ot.current&&ot.current!==D){ot.current=null,On.current=null;return}if(An)if(S&&Object.keys(S).length>0){const o=JSON.stringify(S),i=On.current!==o,d=((e=p==null?void 0:p.metadata)==null?void 0:e.source)==="history";if(!Dn.current&&!Rn.current&&!d&&(i||!p||!p.success||!((n=p.response)!=null&&n.landmarks)||Object.keys(p.response.landmarks).length===0)){const c=new Date().toISOString(),L={success:!0,response:{landmarks:S},metadata:{source:"initial",timestamp:c}};if(I(L),On.current=o,D&&(ot.current=D),S.p1&&S.p2){const{p2:f}=S,{p1:w}=S,m=Math.abs(f.x-w.x),g=Math.abs(f.y-w.y);if(m<30&&g>50&&g<200){const X=[S.p2,S.p1];Z(X);const an=Ct(X);Q(an)}else{const{p1:X,p2:an,...x}=S,nn=x,q={...L,response:{...L.response,landmarks:nn}};I(q)}}}}else On.current=null,p&&(I(null),Z([]),Q(.11))}},[An,S,rt,D]);const $a=u.useCallback(async e=>{if(e&&e.length>0){const n=[];for(const o of e)try{const i=await te(o),d={id:`local-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,file:o,preview:i,name:o.name,size:o.size,type:o.type,uploadedAt:new Date,isLocal:!0};if(n.push(d),n.length===1){wt(o),ct(i),yo(!1);const r=new Image;r.onload=()=>{const c=r.naturalWidth||r.width,L=r.naturalHeight||r.height;Et({width:c,height:L})},r.onerror=c=>{ct(null),Fn("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØµÙˆÛŒØ±")},r.src=i}}catch{}if(n.length>0&&(Bt(o=>[...o,...n]),Fn(null),I(null),fo&&Wo))try{const o=n.map(i=>i.file);await fo(o,"lateral"),Bt(i=>i.filter(d=>!n.some(r=>r.id===d.id))),Un&&setTimeout(()=>{Un(0)},100),zn&&C!==null&&C!==""&&zn("")}catch{}}},[fo,Wo,zn,Un,C]),oe=u.useCallback(e=>{e?Bt(n=>{var d,r;const o=n.filter(c=>typeof e=="string"?c.id!==e:c.id!==e.id&&c.file!==e);return n.some(c=>typeof e=="string"&&c.id===e||c.id===e.id||c.file===e)&&Wn&&(typeof e=="string"&&((d=n.find(c=>c.id===e))==null?void 0:d.file)===Wn||e===Wn||e.id&&((r=n.find(c=>c.id===e.id))==null?void 0:r.file)===Wn)&&(o.length>0?(wt(o[0].file),ct(o[0].preview)):(wt(null),ct(null),Et(null))),o}):(wt(null),Bt([]),ct(null),Et(null)),I(null),Fn(null),yo(!1)},[Wn]),Ka=e=>new Promise((n,o)=>{const i=new FileReader;i.onload=()=>n(i.result),i.onerror=o,i.readAsDataURL(e)}),Xa=(e,n)=>{if(!e||!n)return 1;const o=Object.values(e).map(f=>f.x),i=Object.values(e).map(f=>f.y),d=Math.max(...o),r=Math.max(...i),c=n.width/d,L=n.height/r;return(c+L)/2},ee=u.useCallback((e,n,o)=>{const i=e.x-n.x,d=e.y-n.y,r=o.x-n.x,c=o.y-n.y,L=i*r+d*c,_=r*r+c*c;if(_===0)return null;const f=L/_;let w,m;f<0?(w=n.x,m=n.y):f>1?(w=o.x,m=o.y):(w=n.x+f*r,m=n.y+f*c);const g=e.x-w,k=e.y-m;return Math.sqrt(g*g+k*k)},[]),qn=u.useCallback((e,n,o)=>{const i=ee(e,n,o);return i===null?null:i*(cn||.11)},[cn,ee]),b=(e,n,o)=>{const i=Math.atan2(e.y-n.y,e.x-n.x);let r=(Math.atan2(o.y-n.y,o.x-n.x)-i)*(180/Math.PI);return r<0&&(r+=360),r>180?360-r:r},en=(e,n)=>Math.atan2(n.y-e.y,n.x-e.x)*(180/Math.PI),j=(e,n,o,i)=>{const d=n.x-e.x,r=n.y-e.y,c=i.x-o.x,L=i.y-o.y,_=d*c+r*L,f=Math.sqrt(d*d+r*r),w=Math.sqrt(c*c+L*L);if(f===0||w===0)return 0;const m=_/(f*w),g=Math.max(-1,Math.min(1,m)),X=Math.acos(g)*(180/Math.PI);return X>90?180-X:X},ft=u.useCallback(e=>{const n={},o=r=>{for(const c of r)if(e[c])return e[c];return null},i=r=>{const c=Object.keys(e);for(const L of r){const _=c.find(f=>f.toLowerCase().includes(L.toLowerCase())||L.toLowerCase().includes(f.toLowerCase()));if(_)return e[_]}return null},d=r=>Math.round(Math.max(0,Math.min(180,r))*10)/10;try{const r=o(["S","s","sella","Sella"])||i(["s","sella"]),c=o(["N","n","nasion","Nasion"])||i(["n","nasion"]),L=o(["A","a"]),_=o(["B","b"]),f=o(["Or","or","OR","orbitale","Orbitale"])||i(["or","orbit"]),w=o(["Po","po","PO","porion","Porion"])||i(["po","porion"]),m=o(["Go","go","GO","gonion","Gonion"])||i(["go","gonion"]),g=o(["Me","me","ME","menton","Menton"])||i(["me","menton"]),k=o(["Gn","gn","GN","gnathion","Gnathion"])||i(["gn","gnathion"]),X=o(["U1","u1","UIT","uit","upper_incisor_tip","Upper_incisor_tip","upper incisor tip"])||i(["u1","uit","upper","incisor","tip"]),an=o(["U1A","u1a","UIA","uia","upper_incisor_apex","Upper_incisor_apex","upper incisor apex"])||i(["u1a","uia","upper","incisor","apex"]),x=o(["L1","l1","lower_incisor","Lower_incisor","lower incisor","LIT","lit","Lit","lower_incisor_tip","Lower_incisor_tip","lower incisor tip"])||i(["l1","lit","lower","incisor","li","tip"]),nn=o(["L1A","l1a","LIA","lia","Lia","lower_incisor_apex","Lower_incisor_apex","lower incisor apex"])||i(["l1a","lia","lower","incisor","apex"]);if(r&&c&&L&&(n.SNA=b(r,c,L)),r&&c&&_&&(n.SNB=b(r,c,_)),n.SNA!==void 0&&n.SNB!==void 0&&(n.ANB=n.SNA-n.SNB),f&&w&&m&&g&&(n.FMA=d(j(f,w,m,g))),f&&w&&x&&g&&m){let t=null,s=null;if(nn&&x?(t=nn,s=x):x&&g&&(t=x,s=g),t&&s){const l=(V,mn,H,gn)=>{const Y=V.x,rn=V.y,Mn=mn.x,Bn=mn.y,xn=H.x,Ln=H.y,Gn=gn.x,Zn=gn.y,Qn=(Y-Mn)*(Ln-Zn)-(rn-Bn)*(xn-Gn);if(Math.abs(Qn)<1e-10)return null;const En=((Y-xn)*(Ln-Zn)-(rn-Ln)*(xn-Gn))/Qn,Gt=Y+En*(Mn-Y),io=rn+En*(Bn-rn);return{x:Gt,y:io}},G=w.x-f.x,N=w.y-f.y,v=Math.sqrt(G*G+N*N);if(v>0){const V=G/v,mn=N/v,H={x:f.x-V*1e4,y:f.y-mn*1e4},gn={x:w.x+V*1e4,y:w.y+mn*1e4},Y=s.x-t.x,rn=s.y-t.y,Mn=Math.sqrt(Y*Y+rn*rn);if(Mn>0){const Bn=Y/Mn,xn=rn/Mn,Ln={x:t.x-Bn*1e4,y:t.y-xn*1e4},Gn={x:s.x+Bn*1e4,y:s.y+xn*1e4},Zn=l(H,gn,Ln,Gn),Qn=g.x-m.x,En=g.y-m.y,Gt=Math.sqrt(Qn*Qn+En*En);if(Gt>0&&Zn){const io=Qn/Gt,Aa=En/Gt,Pa={x:m.x-io*1e4,y:m.y-Aa*1e4},ka={x:g.x+io*1e4,y:g.y+Aa*1e4},Sa=l(H,gn,Pa,ka),wa=l(Pa,ka,Ln,Gn);if(Sa&&Zn&&wa){const es=((ro,Ca,_a)=>{const Do=Ca.x-ro.x,Ro=Ca.y-ro.y,Ho=_a.x-ro.x,Bo=_a.y-ro.y,as=Do*Ho+Ro*Bo,ja=Math.sqrt(Do*Do+Ro*Ro),va=Math.sqrt(Ho*Ho+Bo*Bo);if(ja===0||va===0)return 0;const ss=as/(ja*va),is=Math.max(-1,Math.min(1,ss));return Math.acos(is)*(180/Math.PI)})(Zn,Sa,wa);n.FMIA=d(es)}}}}n.FMIA===void 0&&(n.FMIA=d(j(f,w,t,s)))}}if(nn&&x&&m&&g?n.IMPA=d(j(m,g,nn,x)):x&&m&&g&&(n.IMPA=d(j(m,g,x,g))),r&&c&&m&&k){const t=en(r,c),s=en(m,k),l=Math.abs(t-s);n["GoGn-SN"]=l,n.GoGnSN=l}if(an&&X&&r&&c){const t=en(an,X),s=en(r,c);let l=Math.abs(t-s);l>180&&(l=360-l),n["U1-SN"]=d(180-l)}else if(X&&r&&c){const t=en(X,c),s=en(r,c);let l=Math.abs(t-s);l>180&&(l=360-l),n["U1-SN"]=d(180-l)}if(nn&&x&&m&&g){const t=j(m,g,nn,x);n["L1-MP"]=d(180-t)}else if(m&&g&&x){const t=b(x,g,m);n["L1-MP"]=d(t)}if(X&&an&&x&&nn){const t=j(X,an,x,nn);n.InterincisalAngle=Math.round(t*10)/10}const q=o(["U1","u1","upper_incisor","Upper_incisor","upper incisor"])||i(["u1","upper","incisor","ui"]),jt=o(["L1","l1","lower_incisor","Lower_incisor","lower incisor"])||i(["l1","lower","incisor","li"]);if(q&&jt){const t=q.y-jt.y;let s=cn||.11;const l=o(["p1","P1"]),P=o(["p2","P2"]);if(l&&P){const G=Math.abs(P.x-l.x),N=Math.abs(P.y-l.y),v=Math.sqrt(G*G+N*N);v>0&&(s=10/v)}n.Overbite=Math.round(t*s*10)/10}const sn=o(["U1","u1","upper_incisor","Upper_incisor","upper incisor"])||i(["u1","upper","incisor","ui"]),vt=o(["L1","l1","lower_incisor","Lower_incisor","lower incisor"])||i(["l1","lower","incisor","li"]);if(sn&&vt){const t=sn.x-vt.x;let s=cn||.11;const l=o(["p1","P1"]),P=o(["p2","P2"]);if(l&&P){const G=Math.abs(P.x-l.x),N=Math.abs(P.y-l.y),v=Math.sqrt(G*G+N*N);v>0&&(s=10/v)}n.Overjet=Math.round(t*s*10)/10}if(e.S&&e.N&&e.Go&&e.Gn&&!n["GoGn-SN"]){const t=en(e.S,e.N),s=en(e.Go,e.Gn);n["SN-GoGn"]=Math.abs(t-s)}if(e.Ba&&e.Na&&e.Pt&&e.Gn){const t=en(e.Ba,e.Na),s=en(e.Pt,e.Gn);n.FacialAxis=Math.abs(t-s)}if(e.Go&&e.Me){const t=en(e.Go,e.Me);n.MandibularPlane=t}if(e.N&&e.ANS&&e.Me){const t=Math.sqrt((e.N.x-e.ANS.x)**2+(e.N.y-e.ANS.y)**2),s=Math.sqrt((e.ANS.x-e.Me.x)**2+(e.ANS.y-e.Me.y)**2);s>0&&(n.UpperLowerFaceRatio=t/s)}const y=(t,s)=>!t||!s?0:Math.sqrt((s.x-t.x)**2+(s.y-t.y)**2)*(cn||.11),ue=(t,s,l)=>{const P=t.x-s.x,G=t.y-s.y,N=l.x-s.x,v=l.y-s.y,V=P*N+G*v,mn=N*N+v*v;if(mn===0)return y(t,s);const H=V/mn;let gn,Y;H<0?(gn=s.x,Y=s.y):H>1?(gn=l.x,Y=l.y):(gn=s.x+H*N,Y=s.y+H*v);const rn=t.x-gn,Mn=t.y-Y;return Math.sqrt(rn*rn+Mn*Mn)*(cn||.11)},kn=o(["Ba","ba","BA","basion","Basion"]),M=o(["Pt","pt","PT","pterygoid","Pterygoid"]),yn=o(["Gn","gn","GN","gnathion","Gnathion"]);if(kn&&M&&yn){const t=b(yn,M,kn);n["Facial Axis"]=Math.round(t*10)/10}const z=o(["N","n","Nasion","nasion"]),Sn=o(["Pog","pog","POG","pogonion","Pogonion"]),ln=o(["Or","or","OR","orbitale","Orbitale"]),un=o(["Po","po","PO","porion","Porion"]);if(z&&Sn&&ln&&un){const t=j(z,Sn,ln,un);n["Facial Depth"]=Math.round(t*10)/10}const Jn=o(["ANS","ans","Anterior Nasal Spine"]),mt=o(["Me","me","ME","menton","Menton"]),gt=o(["N","n","Nasion","nasion"]);if(Jn&&mt&&gt){const t=Math.abs(Jn.y-mt.y),s=Math.abs(gt.y-mt.y);if(s>10&&t>5){const l=t/s*100;n["Lower Face Height"]=Math.round(l*10)/10}}const xt=o(["Go","go","GO","gonion","Gonion"]),Hn=o(["Me","me","ME","menton","Menton"]),zt=o(["Or","or","OR","orbitale","Orbitale"]),Ut=o(["Po","po","PO","porion","Porion"]);if(xt&&Hn&&zt&&Ut){const t=en(xt,Hn),s=en(zt,Ut);let l=Math.abs(t-s);l>90&&(l=180-l),n["Mandibular Plane"]=Math.round(l*10)/10}const Wt=o(["A","a","Point A"]),Lt=o(["N","n","Nasion","nasion"]),It=o(["Pog","pog","POG","pogonion","Pogonion"]);if(Wt&&Lt&&It){const t=ue(Wt,Lt,It),s=It.x-Lt.x,l=It.y-Lt.y,P=Wt.x-Lt.x,G=Wt.y-Lt.y,V=(s*G-l*P>0?1:-1)*t;Math.abs(V)<=20&&(n.Convexity=Math.round(-V*10)/10)}const de=o(["U1","u1","upper_incisor","Upper Incisor"]),he=o(["A","a","Point A"]),pe=o(["Pog","pog","POG","pogonion","Pogonion"]);if(de&&he&&pe){const t=b(de,he,pe);n["Upper Incisor"]=Math.round(t*10)/10}const fe=o(["L1","l1","lower_incisor","Lower Incisor"]),me=o(["A","a","Point A"]),ge=o(["Pog","pog","POG","pogonion","Pogonion"]);if(fe&&me&&ge){const t=b(fe,me,ge);n["Lower Incisor"]=Math.round(t*10)/10}n.InterincisalAngle&&(n["Interincisal Angle"]=Math.round(n.InterincisalAngle*10)/10);const xe=o(["L1","l1","lower_incisor","Lower Incisor"]),Le=o(["LMT","lmt","LMT","lower_molar","Lower Molar","L6","l6"]),ye=o(["S","s","Sella","sella"]),Me=o(["N","n","Nasion","nasion"]);if(xe&&Le&&ye&&Me){let t=j(xe,Le,ye,Me);t>90&&(t=180-t),n["Occlusal Plane Angle"]=Math.round(t*10)/10}const be=o(["Ba","ba","BA","basion","Basion"]),Ae=o(["N","n","Nasion","nasion"]),Pe=o(["S","s","Sella","sella"]);if(be&&Ae&&Pe){const t=b(be,Ae,Pe);n["Cranial Deflection"]=Math.round(t*10)/10}const ke=o(["ANS","ans","Anterior Nasal Spine"]),Se=o(["PNS","pns","Posterior Nasal Spine"]),we=o(["S","s","Sella","sella"]),Ce=o(["N","n","Nasion","nasion"]);if(ke&&Se&&we&&Ce){let t=j(ke,Se,we,Ce);t>90&&(t=180-t),n["Palatal Plane Angle"]=Math.round(t*10)/10}const dn=o(["Pn","pn","PN","Prn","prn","PRN","Pronasale","pronasale"]),Vn=o(["Pog'","Pog'","pog'","PogSoft","pogsoft","POGSOFT","Soft Pogonion","Pg'","pg'","PgPrime","pgPrime"]),qt=o(["Ls","ls","LS","UL","ul","Labiale Superius","labiale superius","Upper Lip","upper_lip"]),Jt=o(["Li","li","LI","LL","ll","Labiale Inferius","labiale inferius","Lower Lip","lower_lip"]);if(dn&&Vn&&qt){const t=qn(qt,dn,Vn);if(t!==null){const s=(Vn.x-dn.x)*(qt.y-dn.y)-(Vn.y-dn.y)*(qt.x-dn.x)>0?1:-1;n["E-line (UL)"]=Math.round(t*s*10)/10}}if(dn&&Vn&&Jt){const t=qn(Jt,dn,Vn);if(t!==null){const s=(Vn.x-dn.x)*(Jt.y-dn.y)-(Vn.y-dn.y)*(Jt.x-dn.x)>0?1:-1;n["E-line (LL)"]=Math.round(t*s*10)/10}}const _e=o(["N","n","Nasion","nasion"]),So=o(["A","a","Point A"]),je=o(["Pog","pog","POG","pogonion","Pogonion"]);if(_e&&So&&je){const t=j(_e,So,So,je);n["N-A-Pog"]=Math.round(t*10)/10}const ns=o(["p1","P1"]),ts=o(["p2","P2"]);if(ns&&ts){const t=o(["Co","co","CO","condyle","Condyle"])||o(["Ar","ar","AR","articulare","Articulare"]),s=o(["A","a","Point A"]);if(t&&s){const P=y(t,s);P!==null&&(n["Co-A"]=Math.round(P*10)/10,n["Maxillary Length"]=n["Co-A"])}const l=o(["Gn","gn","GN","gnathion","Gnathion"]);if(t&&l){const P=y(t,l);P!==null&&(n["Co-Gn"]=Math.round(P*10)/10,n["Mandibular Length"]=n["Co-Gn"])}}const ve=o(["A","a","Point A"]),Ne=o(["B","b","Point B"]),Nt=o(["L1","l1","lower","incisor","li","lower_incisor"]),wo=o(["LMT","lmt","LMT","lower_molar","Lower Molar","L6","l6"]);if(ve&&Ne&&Nt&&wo){const t=wo.x-Nt.x,s=wo.y-Nt.y,l=Math.sqrt(t*t+s*s);if(l>0){const P=t/l,G=s/l,N=(Bn,xn,Ln,Gn)=>{const Zn=Bn.x-xn.x,Qn=Bn.y-xn.y,En=(Zn*Ln+Qn*Gn)/(Ln*Ln+Gn*Gn);return{x:xn.x+En*Ln,y:xn.y+En*Gn}},v=N(ve,Nt,P,G),V=N(Ne,Nt,P,G),mn=V.x-v.x,H=V.y-v.y,gn=mn*P+H*G,Y=cn||.11,rn=Math.abs(gn)*Y,Mn=v.x>V.x?1:-1;n["Wits Appraisal"]=Math.round(Mn*rn*10)/10,n["AO-BO"]=n["Wits Appraisal"]}}const Ge=o(["ANS","ans","Anterior Nasal Spine"]),Fe=o(["Me","me","ME","menton","Menton"]);if(Ge&&Fe){const l=Math.abs(Ge.y-Fe.y)*(cn||.11);l>=20&&l<=120&&(n["Lower Face Height"]=Math.round(l*10)/10)}const Oe=o(["N","n","Nasion","nasion"]),De=o(["ANS","ans","Anterior Nasal Spine"]);if(Oe&&De){const t=y(Oe,De);t!==null&&(n["Upper Face Height"]=Math.round(t*10)/10)}const Re=o(["N","n","Nasion","nasion"]),He=o(["ANS","ans","Anterior Nasal Spine"]),Co=o(["Me","me","ME","menton","Menton"]);if(Re&&He&&Co){const t=y(He,Co),s=y(Re,Co);t!==null&&s!==null&&s>0&&(n["Facial Height Ratio"]=Math.round(t/s*100*10)/10)}n.FMA?n["Mandibular Plane Angle"]=n.FMA:n["GoGn-SN"]&&(n["Mandibular Plane Angle"]=n["GoGn-SN"]);const Be=o(["S","s","Sella","sella"]),Ee=o(["Go","go","GO","gonion","Gonion"]),Te=o(["N","n","Nasion","nasion"]),ze=o(["Me","me","ME","menton","Menton"]);if(Be&&Ee&&Te&&ze){const t=y(Be,Ee),s=y(Te,ze);if(t!==null&&s!==null&&s>0){const l=t/s;n["PFH/AFH Ratio"]=Math.round(l*100*10)/10,n.PFH=Math.round(t*10)/10,n.AFH=Math.round(s*10)/10}}const Ue=o(["ANS","ans","Anterior Nasal Spine"]),We=o(["PNS","pns","PNS","posterior nasal spine","Posterior Nasal Spine"]),Ie=o(["Go","go","GO","gonion","Gonion"]),qe=o(["Gn","gn","GN","gnathion","Gnathion"]);if(Ue&&We&&Ie&&qe){const t=j(Ue,We,Ie,qe);n["PP/Go-Gn"]=Math.round(t*10)/10}const Je=o(["S","s","sella","Sella"]),Ve=o(["Go","go","GO","gonion","Gonion"]);if(Je&&Ve){const t=y(Je,Ve);t!==null&&(n["S-Go"]=Math.round(t*10)/10)}n.ANB!==void 0&&(n["Sagittal Jaw"]=Math.round(n.ANB*10)/10);const wn=o(["S","s","sella","Sella"]),yt=o(["N","n","Nasion","nasion"]),$n=o(["Ar","ar","AR","articulare","Articulare"]),tn=o(["Go","go","GO","gonion","Gonion"]),Cn=o(["Me","me","ME","menton","Menton"]),$e=o(["Gn","gn","GN","gnathion","Gnathion"]),Vt=o(["Or","or","OR","orbitale","Orbitale"]),$t=o(["Po","po","PO","porion","Porion"]),Ke=o(["ANS","ans","Anterior Nasal Spine"]),Xe=o(["PNS","pns","PNS","posterior nasal spine","Posterior Nasal Spine"]);if(yt&&wn&&$n){const t=b(yt,wn,$n);n["Saddle Angle (N-S-Ar)"]=Math.round(t*10)/10}if(wn&&$n&&tn){const t=b(wn,$n,tn);n["Articular Angle (S-Ar-Go)"]=Math.round(t*10)/10}if($n&&tn&&Cn){const t=b($n,tn,Cn);n["Gonial Angle (Ar-Go-Me)"]=Math.round(t*10)/10}if(n["Saddle Angle (N-S-Ar)"]&&n["Articular Angle (S-Ar-Go)"]&&n["Gonial Angle (Ar-Go-Me)"]){const t=n["Saddle Angle (N-S-Ar)"]+n["Articular Angle (S-Ar-Go)"]+n["Gonial Angle (Ar-Go-Me)"];n["Sum of Angles (Posterior Angle Sum)"]=Math.round(t*10)/10}if(wn&&$e&&Vt&&$t){const t=j(wn,$e,Vt,$t);n["Y-Axis (SGn to FH)"]=Math.round(t*10)/10}if(wn&&tn&&yt&&Cn){const t=y(wn,tn),s=y(yt,Cn);if(t!==null&&s!==null&&s>0){const l=t/s*100;n["Facial Height Ratio (Jarabak Ratio)"]=Math.round(l*10)/10}}if(yt&&Cn){const t=y(yt,Cn);t!==null&&(n["Anterior Facial Height (N-Me)"]=Math.round(t*10)/10)}if(wn&&tn){const t=y(wn,tn);t!==null&&(n["Posterior Facial Height (S-Go)"]=Math.round(t*10)/10)}if($n&&tn){const t=y($n,tn);t!==null&&(n["Ramus Height (Ar-Go)"]=Math.round(t*10)/10)}if(tn&&Cn&&Vt&&$t){const t=j(Vt,$t,tn,Cn);n["Mandibular Plane Angle (FH to MP)"]=Math.round(t*10)/10}if(Xe&&Ke&&tn&&Cn){const t=j(Xe,Ke,tn,Cn);n["Basal Plane Angle (PNS-ANS to Go-Me)"]=Math.round(t*10)/10}const _n=o(["S","s","Sella","sella"]),jn=o(["N","n","Nasion","nasion"]),hn=o(["Ar","ar","AR","articulare","Articulare"]),R=o(["Go","go","GO","gonion","Gonion"]),pn=o(["Me","me","ME","menton","Menton"]),Kt=o(["Gn","gn","GN","gnathion","Gnathion"]),Kn=o(["Or","or","OR","orbitale","Orbitale"]),Xn=o(["Po","po","PO","porion","Porion"]),Xt=o(["ANS","ans","Anterior Nasal Spine"]),Yt=o(["PNS","pns","PNS","posterior nasal spine","Posterior Nasal Spine"]);if(_n&&R&&jn&&pn){const t=y(_n,R),s=y(jn,pn);if(t!==null&&s!==null&&s>0){const l=t/s*100;n["Jarabak Ratio (Facial Height Ratio)"]=Math.round(l*10)/10}}if(_n&&R){const t=y(_n,R);t!==null&&(n["Posterior Facial Height (PFH)"]=Math.round(t*10)/10)}if(jn&&pn){const t=y(jn,pn);t!==null&&(n["Anterior Facial Height (AFH)"]=Math.round(t*10)/10)}if(jn&&_n&&hn){const t=b(jn,_n,hn);n["Saddle Angle"]=Math.round(t*10)/10}if(_n&&hn&&R){const t=b(_n,hn,R);n["Articular Angle"]=Math.round(t*10)/10}if(hn&&R&&pn){const t=b(hn,R,pn);n["Gonial Angle (Total)"]=Math.round(t*10)/10}if(hn&&R&&jn){const t=b(hn,R,jn);n["Upper Gonial Angle"]=Math.round(t*10)/10}if(jn&&R&&Kt){const t=b(jn,R,Kt);n["Lower Gonial Angle"]=Math.round(t*10)/10}if(n["Saddle Angle"]&&n["Articular Angle"]&&n["Gonial Angle (Total)"]){const t=n["Saddle Angle"]+n["Articular Angle"]+n["Gonial Angle (Total)"];n["Sum of Posterior Angles"]=Math.round(t*10)/10}if(_n&&Kt&&Kn&&Xn){const t=j(_n,Kt,Kn,Xn);n["Y-Axis (Growth Axis)"]=Math.round(t*10)/10}if(R&&pn&&Kn&&Xn){const t=j(Kn,Xn,R,pn);n["Mandibular Plane Angle"]=Math.round(t*10)/10}if(Yt&&Xt&&R&&pn){const t=j(Yt,Xt,R,pn);n["Basal Plane Angle"]=Math.round(t*10)/10}if(hn&&R){const t=y(hn,R);t!==null&&(n["Ramus Height"]=Math.round(t*10)/10)}if(hn&&R&&pn){const t=b(hn,R,pn);n["Mandibular Arc"]=Math.round(t*10)/10}if(Xt&&Yt&&Kn&&Xn){const t=j(Xt,Yt,Kn,Xn);n["Palatal Plane to FH"]=Math.round(t*10)/10}const Ye=o(["U1","u1","upper_incisor","Upper Incisor"]),Ze=o(["L1","l1","lower_incisor","Lower Incisor"]);if(Ye&&Ze&&Kn&&Xn){const t=j(Ye,Ze,Kn,Xn);n["Occlusal Plane to FH"]=Math.round(t*10)/10}const Zt=o(["N","n","Nasion","nasion"]),Mt=o(["S","s","sella","Sella"]),bt=o(["Ar","ar","AR","articulare","Articulare"]);if(Zt&&Mt&&bt){const t=b(Zt,Mt,bt);n["N-S-Ar"]=Math.round(t*10)/10}const $s=o(["Gn","gn","GN","gnathion","Gnathion"]),Qt=o(["Me","me","ME","menton","Menton"]),Qe=o(["Go","go","GO","gonion","Gonion"]);if(Zt&&Mt&&Qt&&Qe){let t=j(Mt,Zt,Qt,Qe);t>90&&(t=180-t),n["S-N/Me-Go"]=Math.round(t*10)/10}const no=o(["Go","go","GO","gonion","Gonion"]);if(Mt&&bt&&no){const t=b(Mt,bt,no);n["S-Ar-Go"]=Math.round(t*10)/10}if(bt&&no&&Qt){const t=b(bt,no,Qt);n["Ar-Go-Me"]=Math.round(t*10)/10}const na=o(["N","n","Nasion","nasion"]),ta=o(["Ar","ar","AR","articulare","Articulare"]),oa=o(["Go","go","GO","gonion","Gonion"]);if(na&&ta&&oa){const t=b(na,ta,oa);n["N-Ar-Go"]=Math.round(t*10)/10}const ea=o(["Go","go","GO","gonion","Gonion"]),aa=o(["Co","co","CO","condyle","Condyle"])||o(["Ar","ar","AR","articulare","Articulare"]),sa=o(["N","n","Nasion","nasion"]),ia=o(["S","s","sella","Sella"]);if(ea&&aa&&sa&&ia){const t=j(ea,aa,sa,ia);n["Go-Co-N-S"]=Math.round(t*10)/10}const _o=o(["Go","go","GO","gonion","Gonion"]),ra=o(["Co","co","CO","condyle","Condyle"])||o(["Ar","ar","AR","articulare","Articulare"]),ca=o(["Gn","gn","GN","gnathion","Gnathion"]);if(_o&&ra&&ca){const t=y(_o,ra),s=y(_o,ca);t!==null&&s!==null&&s>0&&(n["Go-Co-Go-Gn"]=Math.round(t/s*100*10)/10)}const la=o(["N","n","Nasion","nasion"]),jo=o(["Co","co","CO","condyle","Condyle"])||o(["Ar","ar","AR","articulare","Articulare"]),ua=o(["Go","go","GO","gonion","Gonion"]);if(la&&jo&&ua){const t=j(la,jo,ua,jo);n["N-Co-Go-Co"]=Math.round(t*10)/10}const da=o(["Ar","ar","AR","articulare","Articulare"]),vo=o(["Co","co","CO","condyle","Condyle"])||o(["Ar","ar","AR","articulare","Articulare"]),ha=o(["Gn","gn","GN","gnathion","Gnathion"]);if(da&&vo&&ha){const t=j(da,vo,vo,ha);n["Ar-Co-Co-Gn"]=Math.round(t*10)/10}const J=o(["G","g","Glabella","glabella"]),A=o(["Sn","sn","SN","Subnasale","subnasale"]),h=o(["Pogâ€²","Pog'","pogâ€²","pog'","Pog","pog","Pg'","Pg","pg","Soft tissue Pogonion","soft tissue pogonion"]),At=o(["Cm","cm","CM","Columella","columella"]),U=o(["UL","ul","ULâ€²","UL'","ulâ€²","ul'","Ls","ls","LS","Labiale Superius","labiale superius","Upper Lip"]),fn=o(["LL","ll","LLâ€²","LL'","llâ€²","ll'","Li","li","LI","Labiale Inferius","labiale inferius","Lower Lip"]),vn=o(["Meâ€²","Me'","meâ€²","me'","Me","me","Soft tissue Menton","soft tissue menton"]),on=o(["Pn","pn","PN","Prn","prn","PRN","Pronasale","pronasale"]),to=o(["Gnâ€²","Gn'","gnâ€²","gn'","Gn","gn","GN'","GN","Soft tissue Gnathion","soft tissue gnathion"]);if(J&&A&&h){const t=b(J,A,h);n["Glabella-Sn-Pog' (Facial Convexity)"]=Math.round(t*10)/10}if(A&&to){const t=y(A,to);t!==null&&(n["Sn-Gn' (Lower Face Height)"]=Math.round(t*10)/10)}if(At&&A&&U){const t=y(At,U);t!==null&&(n["Cm-Sn-UL (Upper Lip Protrusion)"]=Math.round(t*10)/10)}if(A&&vn){const t=y(A,vn);t!==null&&(n["Sn-Me' (Lower Face Height)"]=Math.round(t*10)/10)}if(J&&A){const t=y(J,A);t!==null&&(n["Glabella-Sn (Midface Length)"]=Math.round(t*10)/10)}if(A&&h){const t=y(A,h);t!==null&&(n["Sn-Pog' (Lower Face Length)"]=Math.round(t*10)/10)}if(At&&A&&U){const t=b(At,A,U);n["Nasolabial Angle"]=Math.round(t*10)/10}const No=o(["Or","or","OR","orbitale","Orbitale"]),Go=o(["Po","po","PO","porion","Porion"]);if(No&&Go&&h&&U){const t=Go.x-No.x,s=Go.y-No.y,l=U.x-h.x,P=U.y-h.y,G=t*l+s*P,N=Math.sqrt(t*t+s*s),v=Math.sqrt(l*l+P*P);if(N>0&&v>0){const V=G/(N*v),mn=Math.max(-1,Math.min(1,V));let H=Math.acos(mn)*(180/Math.PI);H>180&&(H=360-H),H>180&&(H=180-(H-180)),n["Z-Angle"]=Math.round((180-H)*10)/10}}const pa=o(["Pn","pn","PN","Prn","prn","PRN","Pronasale","pronasale"]);if(h&&pa&&J){const t=b(h,pa,J);n["Total Soft-Tissue Convexity"]=Math.round(t*10)/10}const fa=o(["C","c","Cervical","cervical","Cervical Point","cervical point","C point","c point"]);if(A&&to&&fa){const t=b(A,to,fa);n["Lower Face Throat Angle"]=Math.round(t*10)/10}const ma=o(["Nâ€²","N'","nâ€²","n'","Nprime","nprime","Soft Nasion","soft nasion","N","n","Nasion","nasion"]);if(ma&&on&&h){const t=b(ma,on,h);n["Facial Contour Angle"]=Math.round(t*10)/10}let et=null,Yn=null,Pt=null,Fo=null;if(J&&vn&&(et=y(J,vn)),A&&vn&&(Yn=y(A,vn)),J&&A&&(Pt=y(J,A)),U&&fn){const t=Math.abs(U.y-fn.y);let s=cn||.11;const l=o(["p1","P1"]),P=o(["p2","P2"]);if(l&&P){const G=Math.abs(P.x-l.x),N=Math.abs(P.y-l.y),v=Math.sqrt(G*G+N*N);v>0&&(s=10/v)}Fo=t*s}if(Yn!==null&&et!==null&&et>0){const t=Yn/et*100;n["Lower Face Height / Total Face Height"]=Math.round(t*10)/10}if(Pt!==null&&et!==null&&et>0){const t=Pt/et*100;n["Midface Height / Total Face Height"]=Math.round(t*10)/10}if(Yn!==null&&Pt!==null&&Pt>0){const t=Yn/Pt;n["Lower Face Height / Midface Height"]=Math.round(t*100)/100}if(Fo!==null&&Yn!==null&&Yn>0){const t=Fo/Yn;n["Lip Height / Lower Face Height"]=Math.round(t*100)/100}let Oo=null,oo=null;if(A&&U&&(Oo=y(A,U)),fn&&vn&&(oo=y(fn,vn)),Oo!==null&&oo!==null&&oo>0){const t=Oo/oo;n["Upper Lip Length / Lower Lipâ€“Chin Length"]=Math.round(t*100)/100}if(on&&h&&U){const t=qn(U,on,h);if(t!==null){const s=(h.x-on.x)*(U.y-on.y)-(h.y-on.y)*(U.x-on.x)>0?1:-1;n["Upper Lip to E-line"]=Math.round(t*s*10)/10}}if(on&&h&&fn){const t=qn(fn,on,h);if(t!==null){const s=(h.x-on.x)*(fn.y-on.y)-(h.y-on.y)*(fn.x-on.x)>0?1:-1;n["Lower Lip to E-line"]=Math.round(t*s*10)/10}}const kt=o(["N","n","Nasion","nasion"]),eo=o(["Pog","pog","POG","pogonion","Pogonion"]);if(h&&kt&&eo){const t=qn(h,kt,eo);if(t!==null){const s=(eo.x-kt.x)*(h.y-kt.y)-(eo.y-kt.y)*(h.x-kt.x)>0?1:-1;n["Chin Prominence"]=Math.round(t*s*10)/10}}if(n["Glabella-Sn-Pog' (Facial Convexity)"]!==void 0&&(n["Soft Facial Convexity (Glabella-Sn-Pog')"]=n["Glabella-Sn-Pog' (Facial Convexity)"]),n["Glabella-Sn-Pog' (Facial Convexity)"]!==void 0)n["Chin Prominence Angle"]=n["Glabella-Sn-Pog' (Facial Convexity)"];else if(J&&A&&h){const t=b(J,A,h);n["Chin Prominence Angle"]=Math.round(t*10)/10}n["Sn-Me' (Lower Face Height)"]!==void 0&&(n["Lower Face Height (Sn-Me')"]=n["Sn-Me' (Lower Face Height)"]),n["Cm-Sn-UL (Upper Lip Protrusion)"]!==void 0&&(n["Upper Lip Protrusion"]=n["Cm-Sn-UL (Upper Lip Protrusion)"]);const ga=o(["N","n","Nasion","nasion"]),xa=o(["Nâ€²","N'","nâ€²","n'","Nprime","nprime","Soft Nasion","soft nasion"]),ao=o(["Pog","pog","POG","pog","pogonion","Pogonion"]),so=o(["ULâ€²","UL'","ulâ€²","ul'","UL'","ul'"]),os=o(["LLâ€²","LL'","llâ€²","ll'","LL'","ll'"]),La=o(["Or","or","OR","orbitale","Orbitale"]),ya=o(["Po","po","PO","porion","Porion"]),Nn=o(["UL","ul","ULâ€²","UL'","ulâ€²","ul'","Ls","ls","LS","Labiale Superius","labiale superius","Upper Lip"]);if(ga&&ao&&h&&Nn){const t=j(ga,ao,h,Nn);n["H-angle"]=Math.round(t*10)/10}if(h&&Nn)if(so){const t=qn(so,h,Nn);if(t!==null){const s=(Nn.x-h.x)*(so.y-h.y)-(Nn.y-h.y)*(so.x-h.x)>0?1:-1;n["Upper Lip to H-line"]=Math.round(t*s*10)/10}}else n["Upper Lip to H-line"]=0;const Ma=o(["LL","ll","LLâ€²","LL'","llâ€²","ll'","Li","li","LI","Labiale Inferius","labiale inferius","Lower Lip"]);if(h&&Nn&&Ma){const t=os||Ma,s=qn(t,h,Nn);if(s!==null){const l=(Nn.x-h.x)*(t.y-h.y)-(Nn.y-h.y)*(t.x-h.x)>0?1:-1;n["Lower Lip to H-line"]=Math.round(s*l*10)/10}}if(xa&&h&&La&&ya){const t=j(xa,h,La,ya);n["Soft Tissue Facial Angle"]=Math.round(t*10)/10}if(ao&&h){const t=y(ao,h);t!==null&&(n["Soft Tissue Chin Thickness"]=Math.round(t*10)/10)}if(fn&&h&&vn){const t=b(fn,h,vn);n["Mentolabial Angle"]=Math.round(t*10)/10}const ba=o(["Nâ€²","N'","nâ€²","n'","Nprime","nprime","Soft Nasion","soft nasion","N","n","Nasion","nasion"]);if(h&&A&&ba){const t=b(h,A,ba);n["Soft Tissue Chin Angle"]=Math.round(t*10)/10}if(At&&A&&U){const t=b(At,A,U);n["Upper Lip Angle"]=Math.round(t*10)/10}if(A&&fn&&h){const t=b(A,fn,h);n["Lower Lip Angle"]=Math.round(t*10)/10}if(J&&A&&h){const t=b(J,A,h),s=b(A,h,J),l=b(h,J,A),P=t+s+l;n["Total Facial Convexity"]=Math.round(P*10)/10}}catch{}return n},[cn,qn]),Ya=u.useCallback(e=>{var d,r;Dn.current=!0,Po(!0);const n=ft(e),o={...p,response:{...p.response,landmarks:e},measurements:n};I(o);const i=Object.keys(e).filter(c=>c==="p1"||c==="p2").map(c=>e[c]);if(i.length>=2){Z(i);const c=Ct(i);Q(c)}if(T&&typeof T=="function"){const c=((d=p==null?void 0:p.metadata)==null?void 0:d.source)==="history",L=((r=p==null?void 0:p.metadata)==null?void 0:r.source)==="initial",_=c||L;T({landmarks:e,measurements:n,metadata:{...p==null?void 0:p.metadata,displayedOnly:_,manuallyEdited:!0},model:F})}},[p,Ct,ft,T,F]),ae=u.useCallback(async()=>{var e;if(!(!((e=p==null?void 0:p.response)!=null&&e.landmarks)||!T)){Yo(!0);try{const n=ft(p.response.landmarks);await T({landmarks:p.response.landmarks,measurements:n,metadata:{...p.metadata,savedAt:new Date().toISOString(),manuallyEdited:!0},model:F}),Po(!1)}catch{}finally{Yo(!1)}}},[p,ft,T,F]);u.useEffect(()=>{var r,c,L;if(!p||!((r=p.response)!=null&&r.landmarks))return;const e=p.response.landmarks;if(!e||Object.keys(e).length===0)return;const n=JSON.stringify(e),i=`${((c=p.metadata)==null?void 0:c.timestamp)||((L=p.metadata)==null?void 0:L.selectedAnalysisIndex)||"unknown"}-${n.substring(0,50)}`;pt.current!==i&&(pt.current=i,requestAnimationFrame(()=>{var f,w;const _=ft(e);if(T&&typeof T=="function"){const m=((f=p.metadata)==null?void 0:f.source)==="history",g=((w=p.metadata)==null?void 0:w.source)==="initial",k=m||g;T({landmarks:e,measurements:_,metadata:{...p.metadata,displayedOnly:k},model:F})}}))},[p,T,F,ft]);const Za=(e,n)=>{const o={};return Object.entries(e).forEach(([i,d])=>{o[i]={x:Math.round(d.x*n*100)/100,y:Math.round(d.y*n*100)/100}}),o},Qa=async()=>{var i,d,r,c,L,_,f,w,m;if(!Wn){Fn("Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© ØªØµÙˆÛŒØ± Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯");return}const e=at.find(g=>g.id===F),n=e==null?void 0:e.isLocal;if(!n&&!go){Fn("Ù„Ø·ÙØ§Ù‹ API Key Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");return}Vo(!0),Fn(null);const o=Date.now();try{const g=await Ka(Wn);let k={};if((S==null?void 0:S.p1)&&(S==null?void 0:S.p2)){k={p1:S.p1,p2:S.p2},Z([{x:S.p1.x,y:S.p1.y,label:"P1"},{x:S.p2.x,y:S.p2.y,label:"P2"}]);const M=S.p2.x-S.p1.x,yn=S.p2.y-S.p1.y,z=Math.sqrt(M*M+yn*yn),Sn=z>0?10/z:.11;Q(Sn)}else try{const M=Tn("/detect-p1-p2"),yn=await fetch(M,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_base64:g})});if(yn.ok){const z=await yn.json();if(z.success&&z.landmarks&&(k=z.landmarks,k.p1&&k.p2)){Z([{x:k.p1.x,y:k.p1.y,label:"P1"},{x:k.p2.x,y:k.p2.y,label:"P2"}]);const Sn=k.p2.x-k.p1.x,ln=k.p2.y-k.p1.y,un=Math.sqrt(Sn*Sn+ln*ln),Jn=un>0?10/un:.11;Q(Jn)}}}catch{}let an,x,nn,q,jt,sn;if(n&&F.startsWith("local/aariz")?(sn=Tn("/detect"),F==="local/aariz-768"&&(sn=Tn("/detect-768"))):n&&F==="local/cldetection2023"?sn=Tn("/detect-cldetection2023"):n&&F==="local/fast-cpu-512"?sn=Tn("/detect-fast-cpu-512"):n&&F==="local/cldetection-optimized-512"?sn=Tn("/detect-cldetection-optimized-512"):n&&F==="local/cldetection-optimized-640"?sn=Tn("/detect-cldetection-optimized-640"):n&&F==="local/cldetection-optimized-1024"?sn=Tn("/detect-cldetection-optimized-1024"):F==="train_p1_p2_heatmap"&&(sn=Tn("/detect-p1p2-heatmap")),sn){if(an=await fetch(sn,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_base64:g})}),jt=(Date.now()-o)/1e3,!an.ok){const ln=await an.text(),un=(e==null?void 0:e.name)||"Model";throw new Error(`${un} Service Error: ${an.status} - ${ln}`)}if(x=await an.json(),!x.success)throw new Error(x.error||"Detection failed");const yn=((i=x.landmarks)==null?void 0:i.p1)&&((d=x.landmarks)==null?void 0:d.p2);let z={...x.landmarks};if(F==="local/cldetection2023"&&(r=x.metadata)!=null&&r.image_size&&(c=x.metadata)!=null&&c.optimization){const ln=x.metadata.image_size.width,un=x.metadata.image_size.height,Jn=x.metadata.optimization.scale_factor||1,mt=x.metadata.optimization.image_resized||!1,gt={};Object.keys(z).forEach(xt=>{const Hn=z[xt];if(Hn&&typeof Hn.x=="number"&&typeof Hn.y=="number"){const zt=Math.max(0,Math.min(ln,Hn.x)),Ut=Math.max(0,Math.min(un,Hn.y));gt[xt]={x:zt,y:Ut}}else gt[xt]=Hn}),z=gt}q={landmarks:{...z,...k},confidence:((L=x.metadata)==null?void 0:L.avg_confidence)||.9,notes:`${((_=x.metadata)==null?void 0:_.model)||"Aariz Model"} - ${((f=x.metadata)==null?void 0:f.model_architecture)||"trained"} - ${((w=x.metadata)==null?void 0:w.valid_landmarks)||0}/29 Ù„Ù†Ø¯Ù…Ø§Ø±Ú©`,metadata:{...x.metadata,frontend_image_size:lt,p1p2_detected:!!(k.p1&&k.p2)}},nn=JSON.stringify(q)}else q={landmarks:k,confidence:.9,notes:"No model selected",metadata:{frontend_image_size:lt,p1p2_detected:!!(k.p1&&k.p2)}},nn=JSON.stringify(q);let vt=q||{landmarks:k},y=null;if(Ko&&lt&&q&&q.landmarks&&F!=="train_p1_p2_heatmap"){const M=Xa(q.landmarks,lt);(M>1.5||M<.5)&&(vt={...q,landmarks:Za(q.landmarks,M),original_landmarks:q.landmarks},y={factor:M.toFixed(4),imageSize:lt,applied:!0})}const kn={success:!0,model:at.find(M=>M.id===F),response:vt,metadata:{processingTime:jt.toFixed(2),tokensUsed:x.usage,timestamp:new Date().toLocaleString("fa-IR"),scaling:y},rawResponse:nn};if(kn.success&&((m=kn.response)!=null&&m.landmarks)){const{landmarks:M}=kn.response;if(M.p1&&M.p2&&typeof M.p1=="object"&&typeof M.p2=="object"&&typeof M.p1.x<"u"&&typeof M.p1.y<"u"&&typeof M.p2.x<"u"&&typeof M.p2.y<"u"&&(Z([{x:M.p1.x,y:M.p1.y,label:"P1"},{x:M.p2.x,y:M.p2.y,label:"P2"}]),cn===.11)){const ln=M.p2.x-M.p1.x,un=M.p2.y-M.p1.y,Jn=Math.sqrt(ln*ln+un*un),mt=Jn>0?10/Jn:.11;Q(mt)}const yn=M,z=new Date().toISOString(),Sn={...kn,response:{...kn.response,landmarks:yn},metadata:{...kn.metadata,timestamp:z,source:"analysis"}};Rn.current=!0,pt.current=null,setTimeout(()=>{Rn.current=!1},5e3),I(Sn),Po(!1)}else I(kn)}catch(g){Fn(g.message||"Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª Ù…Ø¯Ù„"),at.find(k=>k.id===F),g.message,new Date().toLocaleString("fa-IR")}finally{Vo(!1)}},Pn=at.find(e=>e.id===F);return a.jsx(B,{spacing:3,children:a.jsxs(B,{direction:{xs:"column",md:"row"},spacing:3,children:[a.jsxs(B,{spacing:3,sx:{width:{xs:"100%",md:"400px"},order:{xs:2,md:1}},children:[W&&W.length>0&&a.jsx(St,{children:a.jsx(lo,{children:a.jsxs(B,{spacing:2,children:[a.jsx(O,{variant:"h6",children:"ðŸ“‹ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¢Ù†Ø§Ù„ÛŒØ²"}),a.jsxs(B,{direction:"row",spacing:1,alignItems:"flex-start",children:[a.jsxs(uo,{fullWidth:!0,size:"small",children:[a.jsx(ho,{children:"Ø§Ù†ØªØ®Ø§Ø¨ Ø¢Ù†Ø§Ù„ÛŒØ²"}),a.jsx(po,{value:C??(W.length>0?W.length-1:""),onChange:e=>{const n=e.target.value,o=n===""?null:parseInt(n);zn&&zn(o)},label:"Ø§Ù†ØªØ®Ø§Ø¨ Ø¢Ù†Ø§Ù„ÛŒØ²",children:W.map((e,n)=>{const i=(e.imageIndex!==void 0?e.imageIndex:0)+1;return e.analysisType||e.currentAnalysisType,a.jsx($,{value:n,children:a.jsx(E,{sx:{width:"100%"},children:a.jsxs(E,{sx:{flex:1},children:[a.jsxs(O,{variant:"body2",children:["Ø¢Ù†Ø§Ù„ÛŒØ² ",n+1," - ØªØµÙˆÛŒØ± ",i]}),a.jsx(O,{variant:"caption",color:"text.secondary",children:e.timestamp?new Date(e.timestamp).toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"ØªØ§Ø±ÛŒØ® Ù†Ø§Ù…Ø´Ø®Øµ"})]})})},n)})})]}),C!=null&&C>=0&&C<W.length&&a.jsx(Ft,{color:"error",size:"small",onClick:()=>{const e=W[C];e&&Uo&&it&&(Uo(e),it(!0))},sx:{mt:1.5},children:a.jsx(nt,{icon:"solar:trash-bin-trash-bold",width:20})})]})]})})}),a.jsx(St,{children:a.jsx(lo,{children:a.jsxs(B,{spacing:2,children:[a.jsx(O,{variant:"h6",children:"ðŸ“· Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ±"}),K&&K.length>1&&Un&&a.jsxs(uo,{fullWidth:!0,children:[a.jsx(ho,{children:"Ø§Ù†ØªØ®Ø§Ø¨ ØªØµÙˆÛŒØ± Ø¨Ø±Ø§ÛŒ Ø¢Ù†Ø§Ù„ÛŒØ²"}),a.jsx(po,{value:tt,label:"Ø§Ù†ØªØ®Ø§Ø¨ ØªØµÙˆÛŒØ± Ø¨Ø±Ø§ÛŒ Ø¢Ù†Ø§Ù„ÛŒØ²",onChange:e=>{const n=parseInt(e.target.value);Un(n),n!==tt&&(I(null),Fn(null),Tt(!1),Z([]),Q(.11),Dn.current=!1,Rn.current=!1,On.current=null)},children:K.map((e,n)=>{const i=(e.createdAt?new Date(e.createdAt):new Date).toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),d=K.length-n,r=n===tt;return a.jsx($,{value:n,children:a.jsxs(E,{sx:{display:"flex",flexDirection:"column",width:"100%"},children:[a.jsxs(O,{variant:"body2",children:["ØªØµÙˆÛŒØ± ",d," ",r?"âœ…":""," - ",e.category||"lateral"]}),a.jsxs(O,{variant:"caption",color:"text.secondary",children:["ØªØ§Ø±ÛŒØ®: ",i]})]})},e.id||n)})})]}),a.jsx(ds,{multiple:!0,onDrop:$a,onDelete:oe,accept:{"image/*":[".jpg",".jpeg",".png"]}}),(xo.length>0||K&&K.length>0)&&a.jsxs(E,{children:[a.jsxs(O,{variant:"subtitle2",sx:{mb:1},children:["ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡ (",xo.length+((K==null?void 0:K.length)||0),")"]}),a.jsxs(B,{spacing:0,children:[xo.map((e,n)=>{const o=e.name.length>20?`${e.name.substring(0,20)}...`:e.name;return a.jsx(St,{sx:{p:1.5,border:1,borderColor:"divider",bgcolor:"background.paper",marginTop:"0 !important"},children:a.jsxs(B,{direction:"row",spacing:1,alignItems:"center",children:[a.jsx(E,{component:"img",src:e.preview,alt:e.name,sx:{width:36,height:36,objectFit:"cover",borderRadius:1}}),a.jsxs(E,{sx:{flex:1,minWidth:0},children:[a.jsx(O,{variant:"body2",noWrap:!0,children:o}),a.jsxs(O,{variant:"caption",color:"text.secondary",children:[(e.size/1024).toFixed(1)," KB"]})]}),a.jsx(Ft,{onClick:i=>{i.stopPropagation(),oe(e)},sx:{width:26,height:26,p:0},children:a.jsx(nt,{icon:"mingcute:close-line",width:16})})]})},e.id)}),K&&K.map((e,n)=>{var d,r;const o=(d=e.path)!=null&&d.startsWith("http")?e.path:(r=e.path)!=null&&r.startsWith("/uploads/")?`${Ga(e.path)}`:`${Ga(e.path)}`,i=(e.originalName||`ØªØµÙˆÛŒØ±-${e.id}`).length>20?`${(e.originalName||`ØªØµÙˆÛŒØ±-${e.id}`).substring(0,20)}...`:e.originalName||`ØªØµÙˆÛŒØ±-${e.id}`;return a.jsx(St,{sx:{p:1.5,border:1,borderColor:"divider",bgcolor:"background.paper",marginTop:"0 !important"},children:a.jsxs(B,{direction:"row",spacing:1,alignItems:"center",children:[a.jsx(E,{component:"img",src:o,alt:i,sx:{width:36,height:36,objectFit:"cover",borderRadius:1}}),a.jsxs(E,{sx:{flex:1,minWidth:0},children:[a.jsx(O,{variant:"body2",noWrap:!0,children:i}),a.jsx(O,{variant:"caption",color:"text.secondary",children:e.size?`${(e.size/1024).toFixed(1)} KB`:"Ø­Ø¬Ù… Ù†Ø§Ù…Ø´Ø®Øµ"})]}),Io&&a.jsx(Ft,{onClick:c=>{c.stopPropagation(),Io(e)},sx:{width:26,height:26,p:0},children:a.jsx(nt,{icon:"mingcute:close-line",width:16})})]})},e.id||n)})]})]})]})})}),Xo&&a.jsx(St,{children:a.jsx(lo,{children:a.jsxs(B,{spacing:2,children:[a.jsx(O,{variant:"h6",children:"âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª"}),a.jsxs(uo,{fullWidth:!0,children:[a.jsx(ho,{children:"Ù…Ø¯Ù„ AI"}),a.jsx(po,{value:F,label:"Ù…Ø¯Ù„ AI",onChange:e=>Ea(e.target.value),children:at.map(e=>a.jsx($,{value:e.id,children:a.jsxs(B,{direction:"row",spacing:1,alignItems:"center",sx:{width:"100%"},children:[a.jsx(E,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:e.color}}),a.jsxs(E,{sx:{flex:1},children:[a.jsx(O,{variant:"body2",children:e.name}),e.provider&&a.jsx(O,{variant:"caption",sx:{color:"text.secondary"},children:e.provider})]})]})},e.id))})]}),Pn&&a.jsx(Na,{severity:Pn.isLocal?"success":"info",icon:a.jsx(nt,{icon:Pn.isLocal?"carbon:checkmark-filled":"carbon:information"}),sx:{display:"none"},children:Pn.description}),!(Pn!=null&&Pn.isLocal)&&a.jsx(ps,{fullWidth:!0,type:"password",label:"OpenRouter API Key",value:go,onChange:e=>Ta(e.target.value),placeholder:"sk-or-v1-..."}),a.jsx(fs,{control:a.jsx(cs,{checked:Ko,onChange:e=>za(e.target.checked),color:"primary"}),label:a.jsxs(B,{children:[a.jsx(O,{variant:"body2",children:"ØªØµØ­ÛŒØ­ Ø®ÙˆØ¯Ú©Ø§Ø± Ù…Ù‚ÛŒØ§Ø³"}),a.jsx(O,{variant:"caption",sx:{color:"text.secondary"},children:"Ø§ØµÙ„Ø§Ø­ Ù…Ø®ØªØµØ§Øª Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ø¨Ø¹Ø§Ø¯ ØªØµÙˆÛŒØ±"})]}),sx:{display:"none"}})]})})}),a.jsxs(B,{direction:"row",spacing:1,alignItems:"center",children:[a.jsx(Ot,{fullWidth:!0,size:"medium",variant:"contained",color:"primary",onClick:Qa,disabled:Lo||!Wn||!(Pn!=null&&Pn.isLocal)&&!go,startIcon:Lo?a.jsx(co,{size:16,sx:{color:"inherit"}}):null,sx:{letterSpacing:"normal"},children:Lo?"Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´":"Ø¢Ù†Ø§Ù„ÛŒØ²"}),a.jsx(Ft,{onClick:()=>Ua(!Xo),sx:{borderRadius:"50%",width:40,height:40,backgroundColor:"transparent",color:"inherit",flexShrink:0,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:a.jsx(Ms,{})})]})]}),a.jsxs(ls,{open:Da,onClose:()=>{!Rt&&it&&it(!1)},children:[a.jsx(ms,{children:"Ø­Ø°Ù Ø¢Ù†Ø§Ù„ÛŒØ² Ø³ÙØ§Ù„ÙˆÙ…ØªØ±ÛŒ"}),a.jsx(gs,{children:a.jsx(O,{variant:"body2",sx:{color:"var(--palette-text-secondary)"},children:"Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø¢Ù†Ø§Ù„ÛŒØ² Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª."})}),a.jsxs(xs,{children:[a.jsx(Ot,{onClick:()=>{it&&it(!1)},color:"inherit",disabled:Rt,children:"Ø§Ù†ØµØ±Ø§Ù"}),a.jsx(Ot,{onClick:()=>{To&&zo&&To(zo)},color:"error",variant:"contained",disabled:Rt,children:Rt?"Ø¯Ø± Ø­Ø§Ù„ Ø­Ø°Ù...":"Ø­Ø°Ù"})]})]}),a.jsxs(B,{spacing:3,sx:{flex:1,order:{xs:1,md:2}},children:[$o&&a.jsxs(Na,{severity:"error",onClose:()=>Fn(null),children:[a.jsx(O,{variant:"subtitle2",children:"Ø®Ø·Ø§"}),a.jsx(O,{variant:"body2",children:$o})]}),(An||D)&&a.jsx(a.Fragment,{children:a.jsx(St,{sx:{overflow:"hidden"},children:a.jsx(lo,{sx:{"&:last-child":{pb:4},overflow:"hidden"},children:a.jsxs(B,{spacing:2,sx:{overflow:"hidden"},children:[An&&p&&p.success&&((ie=p.response)==null?void 0:ie.landmarks)&&a.jsxs(a.Fragment,{children:[a.jsxs(B,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[a.jsx(O,{variant:"h6",children:"ðŸ“Š Ù„Ù†Ø¯Ù…Ø§Ø±Ú© Ù‡Ø§"}),a.jsx(B,{direction:"row",spacing:1,alignItems:"center"})]}),a.jsx(B,{direction:"row",spacing:.5,justifyContent:"center",alignItems:"center",sx:{py:1},children:a.jsxs(Ls,{value:Jo,exclusive:!0,onChange:(e,n)=>{n!==null&&Ba(n)},size:"small",color:"standard",children:[a.jsx(Eo,{value:"normal","aria-label":"Ø¹Ø§Ø¯ÛŒ",children:a.jsx(E,{sx:{width:20,height:20,mask:"url(/assets/icons/images.svg) no-repeat center",maskSize:"contain",backgroundColor:"text.secondary",WebkitMask:"url(/assets/icons/images.svg) no-repeat center",WebkitMaskSize:"contain"}})}),a.jsx(Eo,{value:"coordinate","aria-label":"Ù…Ø­ÙˆØ± Ù…Ø®ØªØµØ§Øª",children:a.jsx(E,{sx:{width:20,height:20,mask:"url(/assets/icons/coordinate.svg) no-repeat center",maskSize:"contain",backgroundColor:"text.secondary",WebkitMask:"url(/assets/icons/coordinate.svg) no-repeat center",WebkitMaskSize:"contain"}})}),a.jsx(Eo,{value:"edit",selected:dt,onClick:()=>Tt(!dt),"aria-label":"ÙˆÛŒØ±Ø§ÛŒØ´",size:"small",children:a.jsx(nt,{icon:"solar:pen-bold",width:20,sx:{color:"var(--palette-text-secondary)"}})}),a.jsx(us,{title:"Ø¯Ø§Ù†Ù„ÙˆØ¯ ØªØµÙˆÛŒØ±",children:a.jsx(Ft,{size:"small",onClick:()=>{const e=document.querySelector("#cephalometric-canvas");if(e){const n=e,o=document.createElement("canvas");o.width=n.width,o.height=n.height,o.getContext("2d").drawImage(n,0,0),o.toBlob(d=>{if(!d)return;const r=URL.createObjectURL(d),c=document.createElement("a");c.href=r,c.download=`cephalometric-analysis-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.png`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(r)},"image/png")}},sx:{ml:.5},children:a.jsx(nt,{icon:"solar:download-linear",width:20})})})]})})]}),a.jsx(E,{sx:{width:"100%",maxWidth:"100%",minWidth:0,minHeight:400,position:"relative",borderRadius:{xs:2,sm:2},overflow:"hidden",boxSizing:"border-box"},children:!An&&D?a.jsxs(a.Fragment,{children:[a.jsx(ys,{variant:"rectangular",height:400,sx:{width:"100%",borderRadius:{xs:2,sm:2}}}),a.jsxs(E,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[a.jsx(co,{size:40}),a.jsx(O,{variant:"body2",color:"text.secondary",children:"Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØµÙˆÛŒØ±..."})]})]}):An&&p&&p.success&&((re=p.response)!=null&&re.landmarks)?a.jsxs(E,{sx:{overflow:"hidden",borderRadius:{xs:2,sm:2},minHeight:400,width:"100%",maxWidth:"100%",minWidth:0,position:"relative",boxSizing:"border-box"},children:[p&&p.success&&((ce=p.response)==null?void 0:ce.landmarks)&&a.jsx(E,{sx:{mt:1.25,mb:2},children:a.jsxs(uo,{fullWidth:!0,size:"small",children:[a.jsx(ho,{children:"Ù†ÙˆØ¹ Ø¢Ù†Ø§Ù„ÛŒØ²"}),a.jsxs(po,{value:Zo,onChange:e=>Qo(e.target.value),label:"Ù†ÙˆØ¹ Ø¢Ù†Ø§Ù„ÛŒØ²",children:[a.jsx($,{value:"general",children:"Ø¹Ù…ÙˆÙ…ÛŒ"}),a.jsx($,{value:"steiner",children:"Steiner"}),a.jsx($,{value:"ricketts",children:"Ricketts"}),a.jsx($,{value:"mcnamara",children:"McNamara"}),a.jsx($,{value:"wits",children:"Wits"}),a.jsx($,{value:"tweed",children:"Tweed"}),a.jsx($,{value:"jarabak",children:"Jarabak"}),a.jsx($,{value:"sassouni",children:"Sassouni"}),a.jsx($,{value:"leganBurstone",children:"Legan & Burstone"}),a.jsx($,{value:"arnettMcLaughlin",children:"Arnett & McLaughlin"}),a.jsx($,{value:"holdaway",children:"Holdaway"}),a.jsx($,{value:"softTissueAngular",children:"Soft Tissue Angular"}),a.jsx($,{value:"all",children:"Ù‡Ù…Ù‡ Ø§Ù†ÙˆØ§Ø¹"})]})]})}),a.jsx(hs,{imageUrl:An,landmarks:p.response.landmarks,imageSize:lt,contours:(Mo==null?void 0:Mo.contours)||null,calibrationPoints:Wa,readOnly:!dt,onLandmarksChange:Ya,showMeasurements:!0,showCoordinateSystem:Oa,viewMode:Jo,analysisType:Zo,measurements:p.measurements||((le=p.response)==null?void 0:le.measurements)||{},pixelToMmConversion:cn}),dt&&Ao||p&&p.success?a.jsx(B,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mt:2,mb:1.25,width:"100%"},children:dt&&Ao&&a.jsx(Ot,{variant:"contained",color:"primary",fullWidth:!0,onClick:ae,disabled:ut||st,startIcon:ut||st?a.jsx(co,{size:16,sx:{color:"inherit"}}):a.jsx(nt,{icon:"carbon:save",width:20}),sx:{letterSpacing:"normal"},children:ut||st?"Ø¯Ø± Ø­Ø§Ù„ Ø°Ø®ÛŒØ±Ù‡...":"Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª"})}):null]}):An?a.jsxs(a.Fragment,{children:[a.jsx(E,{component:"img",src:An,alt:"Lateral Cephalometric Image",sx:{width:"100%",height:"auto",maxHeight:600,minHeight:400,aspectRatio:"auto",objectFit:"contain",borderRadius:{xs:2,sm:2},border:"1px solid",borderColor:"divider",display:"block"}}),dt&&Ao&&a.jsx(B,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mt:2,mb:1.25,width:"100%"},children:a.jsx(Ot,{variant:"contained",color:"primary",fullWidth:!0,onClick:ae,disabled:ut||st,startIcon:ut||st?a.jsx(co,{size:16,sx:{color:"inherit"}}):a.jsx(nt,{icon:"carbon:save",width:20}),sx:{letterSpacing:"normal"},children:ut||st?"Ø¯Ø± Ø­Ø§Ù„ Ø°Ø®ÛŒØ±Ù‡...":"Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª"})})]}):null})]})})})})]})]})})}const Pi=u.memo(bs,(T,D)=>{const Dt=["lateralImageUrl","selectedImageIndex","selectedAnalysisIndex","initialLandmarks","viewMode","showCoordinateSystem","isUploadingImage","deleteDialogOpen","analysisToDelete","deleting"];for(const bn of Dt)if(T[bn]!==D[bn])if(typeof T[bn]=="object"&&T[bn]!==null){if(JSON.stringify(T[bn])!==JSON.stringify(D[bn]))return!1}else return!1;return!0});export{bs as CephalometricAIAnalysis,Pi as MemoizedCephalometricAIAnalysis};
