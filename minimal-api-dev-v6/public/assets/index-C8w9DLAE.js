import{i as F,r as w,dh as I,dA as N,j as e,T as l,G as A,B as E,S as U,fB as L,bc as y,k as Y,n as S,o as C,I as d,e5 as R,p as $,cL as H,cK as J,H as W,C as _}from"./index-BSItzkt3.js";import{u as q}from"./use-tabs-Wx4MQbak.js";import{C as K}from"./custom-breadcrumbs-u_kfWYpE.js";import{t as O,z as o}from"./zod-BOXuI70n.js";import{u as V,a as G,F as a}from"./form-provider-IFaCVrX4.js";import{a as Q}from"./format-number-BVcmMM5V.js";import"./image-BuqYs7tq.js";import"./editor-cOR4tKCy.js";import{C as j}from"./Card-BqWDE3fr.js";import{L as M}from"./LoadingButton-HyVDRRh6.js";import"./TextField-DpdcsLRb.js";import"./Select-QPCMlUZ4.js";import"./Menu-Cy0n4kRw.js";import"./InputLabel-DqZ4yv4U.js";import"./FormLabel-Dg62SF9b.js";import"./FormHelperText-CBXzj8d7.js";import"./FormControl-1z33WGqh.js";import"./Rating-LRaLudfA.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-B4qW6LuH.js";import"./RadioGroup-DuXlXr3g.js";import"./FormGroup-DIAu_15X.js";import"./FormControlLabel-CtXEP1QR.js";import"./index-b5NUrSMh.js";import"./countries-DSLisFCy.js";import"./Autocomplete-B4c-hVbi.js";import"./Chip-CHY_XJWs.js";import"./country-select-B4qFdROS.js";import"./Checkbox-p5PKnry8.js";import"./upload-C5NUn5Ko.js";import"./preview-multi-file-C1SdoyfF.js";import"./file-thumbnail-J0C6dV__.js";import"./upload-avatar-DTAGrxFf.js";import"./avatar-url-S8pB8DFh.js";import"./DatePicker-BK0jorBV.js";import"./dialogTitleClasses-BJYaWiXv.js";import"./ListItem-Doeuyi4X.js";import"./DialogContent-CPx_wcNJ.js";import"./MobileDateTimePicker-Baldv5MM.js";import"./index-DC_o48Ax.js";const X=o.object({firstName:o.string().min(1,{message:"نام الزامی است!"}),lastName:o.string().min(1,{message:"نام خانوادگی الزامی است!"}),email:o.string().min(1,{message:"ایمیل الزامی است!"}).email({message:"ایمیل معتبر نیست!"}),phone:o.string().optional(),licenseNumber:o.string().optional(),specialty:o.string().optional(),city:o.string().optional(),province:o.string().optional(),avatarUrl:o.any().optional()}),Z=["ارتودنسی","پروستودونتیکس","پریودونتیکس","دندانپزشکی عمومی","دندانپزشکی کودکان","جراحی دهان و فک"],ee=["آذربایجان شرقی","آذربایجان غربی","اردبیل","اصفهان","البرز","ایلام","بوشهر","تهران","چهارمحال و بختیاری","خراسان جنوبی","خراسان رضوی","خراسان شمالی","خوزستان","زنجان","سمنان","سیستان و بلوچستان","فارس","قزوین","قم","کردستان","کرمان","کرمانشاه","کهگیلویه و بویراحمد","گلستان","گیلان","لرستان","مازندران","مرکزی","هرمزگان","همدان","یزد"];function se(){const{user:r,checkUserSession:t}=F(),[n,x]=w.useState(null),[u,P]=w.useState(!0);w.useEffect(()=>{(async()=>{if(r!=null&&r.accessToken)try{const c=await I.get("/api/auth/me",{headers:{Authorization:`Bearer ${r.accessToken}`}});x(c.data.user)}catch(c){console.error("Error fetching user profile:",c)}finally{P(!1)}})()},[r]);const T={firstName:"",lastName:"",email:"",phone:"",licenseNumber:"",specialty:"",city:"",province:"",avatarUrl:null},b=V({mode:"all",resolver:O(X),defaultValues:T}),{handleSubmit:h,formState:{isSubmitting:v},reset:f}=b;w.useEffect(()=>{if(n&&!u){const s={firstName:n.firstName||"",lastName:n.lastName||"",email:n.email||"",phone:n.phone||"",licenseNumber:n.licenseNumber||"",specialty:n.specialty||"",city:n.city||"",province:n.province||"",avatarUrl:n.avatarUrl||n.avatar||null};f(s,{keepDefaultValues:!1,keepErrors:!1})}},[n,u,f]);const g=h(async s=>{var c,k;try{const m=s.avatarUrl instanceof File;let p;const D={Authorization:`Bearer ${r==null?void 0:r.accessToken}`};if(m){const i=new FormData;i.append("firstName",s.firstName),i.append("lastName",s.lastName),i.append("email",s.email),s.phone&&i.append("phone",s.phone),s.licenseNumber&&i.append("licenseNumber",s.licenseNumber),s.specialty&&i.append("specialty",s.specialty),s.city&&i.append("city",s.city),s.province&&i.append("province",s.province),i.append("avatar",s.avatarUrl),p=i}else p={firstName:s.firstName,lastName:s.lastName,email:s.email,phone:s.phone||null,licenseNumber:s.licenseNumber||null,specialty:s.specialty||null,city:s.city||null,province:s.province||null},D["Content-Type"]="application/json";console.log("Updating profile:",{hasAvatarFile:m,data:p});const B=await I.put("/api/auth/profile",p,{headers:D});console.log("Profile update response:",B.data);const z=B.data.user;x(z),t&&await t(),N.success("پروفایل با موفقیت بروزرسانی شد!")}catch(m){console.error("Error updating profile:",m);const p=((k=(c=m.response)==null?void 0:c.data)==null?void 0:k.message)||m.message||"خطا در بروزرسانی پروفایل";N.error(p)}});return u?e.jsx(j,{sx:{p:3,textAlign:"center"},children:e.jsx(l,{variant:"h6",children:"بارگیری اطلاعات پروفایل..."})}):n?e.jsx(G,{methods:b,onSubmit:g,children:e.jsxs(A,{container:!0,spacing:3,children:[e.jsx(A,{xs:12,md:4,children:e.jsxs(j,{sx:{pt:10,pb:5,px:3,textAlign:"center"},children:[e.jsx(E,{sx:{mb:5},children:e.jsx(a.UploadAvatar,{name:"avatarUrl",maxSize:3145728,helperText:e.jsxs(l,{variant:"caption",sx:{mt:3,mx:"auto",display:"block",textAlign:"center",color:"text.disabled"},children:["فرمت‌های مجاز: *.jpeg, *.jpg, *.png, *.gif",e.jsx("br",{})," حداکثر حجم: ",Q(3145728)]})})}),e.jsxs(U,{spacing:2,sx:{mb:3},children:[e.jsxs(l,{variant:"body1",children:[e.jsx("strong",{children:"نقش:"})," ",n.role==="DOCTOR"||n.role==="doctor"?"دکتر":n.role==="ADMIN"||n.role==="admin"?"ادمین":"بیمار"]}),e.jsxs(l,{variant:"body2",color:"text.secondary",children:["تاریخ عضویت: ",n.createdAt?L(n.createdAt,"jYYYY/jMM/jDD"):"نامشخص"]}),n.isVerified&&e.jsx(l,{variant:"body2",color:"success.main",children:"✓ حساب تایید شده"})]})]})}),e.jsx(A,{xs:12,md:8,children:e.jsxs(j,{sx:{p:3},children:[e.jsx(l,{variant:"h6",sx:{mb:3},children:"اطلاعات شخصی"}),e.jsxs(E,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[e.jsx(a.Text,{name:"firstName",label:"نام"}),e.jsx(a.Text,{name:"lastName",label:"نام خانوادگی"}),e.jsx(a.Text,{name:"email",label:"آدرس ایمیل"}),e.jsx(a.Phone,{name:"phone",label:"شماره تلفن"}),e.jsxs(a.Select,{name:"province",label:"استان",children:[e.jsx(y,{value:"",children:e.jsx("em",{children:"انتخاب کنید"})}),ee.map(s=>e.jsx(y,{value:s,children:s},s))]}),e.jsx(a.Text,{name:"city",label:"شهر"}),(n.role==="DOCTOR"||n.role==="doctor")&&e.jsxs(e.Fragment,{children:[e.jsx(a.Text,{name:"licenseNumber",label:"شماره نظام پزشکی"}),e.jsxs(a.Select,{name:"specialty",label:"تخصص",children:[e.jsx(y,{value:"",children:e.jsx("em",{children:"انتخاب کنید"})}),Z.map(s=>e.jsx(y,{value:s,children:s},s))]})]})]}),e.jsx(U,{spacing:3,alignItems:"flex-end",sx:{mt:3},children:e.jsx(M,{type:"submit",variant:"contained",loading:v,sx:{minWidth:120},children:"ذخیره تغییرات"})})]})})]})}):e.jsx(j,{sx:{p:3,textAlign:"center"},children:e.jsx(l,{variant:"h6",color:"error",children:"خطا در بارگیری اطلاعات پروفایل"})})}const re=o.object({oldPassword:o.string().min(1,{message:"رمز عبور فعلی الزامی است!"}).min(6,{message:"رمز عبور باید حداقل 6 کاراکتر باشد!"}),newPassword:o.string().min(1,{message:"رمز عبور جدید الزامی است!"}),confirmNewPassword:o.string().min(1,{message:"تکرار رمز عبور الزامی است!"})}).refine(r=>r.oldPassword!==r.newPassword,{message:"رمز عبور جدید باید متفاوت از رمز عبور فعلی باشد",path:["newPassword"]}).refine(r=>r.newPassword===r.confirmNewPassword,{message:"رمز عبور جدید با تکرار آن مطابقت ندارد!",path:["confirmNewPassword"]});function ne(){const r=Y(),{user:t}=F(),n={oldPassword:"",newPassword:"",confirmNewPassword:""},x=V({mode:"all",resolver:O(re),defaultValues:n}),{reset:u,handleSubmit:P,formState:{isSubmitting:T}}=x,b=P(async h=>{var v,f;try{const g=await I.put("/api/auth/change-password",{currentPassword:h.oldPassword,newPassword:h.newPassword,confirmPassword:h.confirmNewPassword},{headers:{Authorization:`Bearer ${t==null?void 0:t.accessToken}`}});u(),N.success("رمز عبور با موفقیت تغییر کرد!")}catch(g){console.error("Error changing password:",g),N.error(((f=(v=g.response)==null?void 0:v.data)==null?void 0:f.message)||"خطا در تغییر رمز عبور")}});return e.jsx(G,{methods:x,onSubmit:b,children:e.jsxs(j,{sx:{p:3,gap:3,display:"flex",flexDirection:"column"},children:[e.jsx(a.Text,{name:"oldPassword",type:r.value?"text":"password",label:"رمز عبور فعلی",InputProps:{endAdornment:e.jsx(S,{position:"end",children:e.jsx(C,{onClick:r.onToggle,edge:"end",children:e.jsx(d,{icon:r.value?"solar:eye-bold":"solar:eye-closed-bold"})})})}}),e.jsx(a.Text,{name:"newPassword",label:"رمز عبور جدید",type:r.value?"text":"password",InputProps:{endAdornment:e.jsx(S,{position:"end",children:e.jsx(C,{onClick:r.onToggle,edge:"end",children:e.jsx(d,{icon:r.value?"solar:eye-bold":"solar:eye-closed-bold"})})})},helperText:e.jsxs(U,{component:"span",direction:"row",alignItems:"center",children:[e.jsx(d,{icon:"eva:info-fill",width:16,sx:{mr:.5}})," رمز عبور باید حداقل ۶ کاراکتر باشد"]})}),e.jsx(a.Text,{name:"confirmNewPassword",type:r.value?"text":"password",label:"تکرار رمز عبور جدید",InputProps:{endAdornment:e.jsx(S,{position:"end",children:e.jsx(C,{onClick:r.onToggle,edge:"end",children:e.jsx(d,{icon:r.value?"solar:eye-bold":"solar:eye-closed-bold"})})})}}),e.jsx(M,{type:"submit",variant:"contained",loading:T,sx:{ml:"auto"},children:"ذخیره تغییرات"})]})})}const oe=[{value:"general",label:"اطلاعات حساب",icon:e.jsx(d,{icon:"solar:user-id-bold",width:24})},{value:"security",label:"امنیت",icon:e.jsx(d,{icon:"ic:round-vpn-key",width:24})}];function ae(){const r=q("general");return e.jsxs(R,{children:[e.jsx(K,{heading:"ویرایش حساب کاربری",links:[{name:"داشبورد",href:$.dashboard.root},{name:"حساب کاربری"}],sx:{mb:{xs:3,md:5}}}),e.jsx(H,{value:r.value,onChange:r.onChange,sx:{mb:{xs:3,md:5},"& .MuiTab-root":{transition:"none !important",transform:"none !important","&:active":{transform:"none !important"},"&:hover":{transform:"none !important"}}},children:oe.map(t=>e.jsx(J,{label:t.label,icon:t.icon,value:t.value,sx:{transition:"none !important",transform:"none !important","&:active":{transform:"none !important"},"&:hover":{transform:"none !important"}}},t.value))}),r.value==="general"&&e.jsx(se,{}),r.value==="security"&&e.jsx(ne,{})]})}const te={title:`حساب کاربری | داشبورد - ${_.site.name}`};function We(){return e.jsxs(e.Fragment,{children:[e.jsx(W,{children:e.jsxs("title",{children:[" ",te.title]})}),e.jsx(ae,{})]})}export{We as default};
