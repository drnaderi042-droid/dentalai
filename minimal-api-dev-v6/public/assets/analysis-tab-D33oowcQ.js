import{b as be,b7 as we,r as w,j as e,T as s,B as n,S as p,bc as ue,i as ke,I as X,o as Le,cI as Pe,d as ge,aE as qe,ar as le,dh as he,di as pe,dA as me}from"./index-BSItzkt3.js";import{C as xe}from"./chart-D8aPrAeV.js";import{u as fe}from"./chart-legends-C2zjVOvD.js";import{C as Ne}from"./Card-BqWDE3fr.js";import{C as Ce}from"./CardContent-DE24Aeed.js";import{F as je}from"./FormControl-1z33WGqh.js";import{I as ye}from"./InputLabel-DqZ4yv4U.js";import{S as ve}from"./Select-QPCMlUZ4.js";import{D as Se}from"./DialogTitle-D9mOMHyE.js";import{D as De}from"./DialogContent-CPx_wcNJ.js";import{D as $e}from"./dialogTitleClasses-BJYaWiXv.js";import{G as D}from"./Grid-BaG8uD1u.js";import"./index-b5NUrSMh.js";import"./FormLabel-Dg62SF9b.js";import"./Menu-Cy0n4kRw.js";const de=[{universalNumber:1,quadrantNumber:1,quadrant:"Upper Right",jaw:"Upper",side:"Right"},{universalNumber:2,quadrantNumber:2,quadrant:"Upper Right",jaw:"Upper",side:"Right"},{universalNumber:3,quadrantNumber:3,quadrant:"Upper Right",jaw:"Upper",side:"Right"},{universalNumber:4,quadrantNumber:4,quadrant:"Upper Right",jaw:"Upper",side:"Right"},{universalNumber:5,quadrantNumber:5,quadrant:"Upper Right",jaw:"Upper",side:"Right"},{universalNumber:6,quadrantNumber:6,quadrant:"Upper Right",jaw:"Upper",side:"Right"},{universalNumber:7,quadrantNumber:7,quadrant:"Upper Right",jaw:"Upper",side:"Right"},{universalNumber:8,quadrantNumber:8,quadrant:"Upper Right",jaw:"Upper",side:"Right"},{universalNumber:9,quadrantNumber:1,quadrant:"Upper Left",jaw:"Upper",side:"Left"},{universalNumber:10,quadrantNumber:2,quadrant:"Upper Left",jaw:"Upper",side:"Left"},{universalNumber:11,quadrantNumber:3,quadrant:"Upper Left",jaw:"Upper",side:"Left"},{universalNumber:12,quadrantNumber:4,quadrant:"Upper Left",jaw:"Upper",side:"Left"},{universalNumber:13,quadrantNumber:5,quadrant:"Upper Left",jaw:"Upper",side:"Left"},{universalNumber:14,quadrantNumber:6,quadrant:"Upper Left",jaw:"Upper",side:"Left"},{universalNumber:15,quadrantNumber:7,quadrant:"Upper Left",jaw:"Upper",side:"Left"},{universalNumber:16,quadrantNumber:8,quadrant:"Upper Left",jaw:"Upper",side:"Left"},{universalNumber:17,quadrantNumber:1,quadrant:"Lower Left",jaw:"Lower",side:"Left"},{universalNumber:18,quadrantNumber:2,quadrant:"Lower Left",jaw:"Lower",side:"Left"},{universalNumber:19,quadrantNumber:3,quadrant:"Lower Left",jaw:"Lower",side:"Left"},{universalNumber:20,quadrantNumber:4,quadrant:"Lower Left",jaw:"Lower",side:"Left"},{universalNumber:21,quadrantNumber:5,quadrant:"Lower Left",jaw:"Lower",side:"Left"},{universalNumber:22,quadrantNumber:6,quadrant:"Lower Left",jaw:"Lower",side:"Left"},{universalNumber:23,quadrantNumber:7,quadrant:"Lower Left",jaw:"Lower",side:"Left"},{universalNumber:24,quadrantNumber:8,quadrant:"Lower Left",jaw:"Lower",side:"Left"},{universalNumber:25,quadrantNumber:1,quadrant:"Lower Right",jaw:"Lower",side:"Right"},{universalNumber:26,quadrantNumber:2,quadrant:"Lower Right",jaw:"Lower",side:"Right"},{universalNumber:27,quadrantNumber:3,quadrant:"Lower Right",jaw:"Lower",side:"Right"},{universalNumber:28,quadrantNumber:4,quadrant:"Lower Right",jaw:"Lower",side:"Right"},{universalNumber:29,quadrantNumber:5,quadrant:"Lower Right",jaw:"Lower",side:"Right"},{universalNumber:30,quadrantNumber:6,quadrant:"Lower Right",jaw:"Lower",side:"Right"},{universalNumber:31,quadrantNumber:7,quadrant:"Lower Right",jaw:"Lower",side:"Right"},{universalNumber:32,quadrantNumber:8,quadrant:"Lower Right",jaw:"Lower",side:"Right"}];function Re({chartData:c}){const h=be(),[a,N]=we.useState("facial"),f=w.useMemo(()=>{const g=[],P=[];for(let l=8;l>=1;l--)g.push(de.find(m=>m.universalNumber===l));for(let l=9;l<=16;l++)g.push(de.find(m=>m.universalNumber===l));for(let l=32;l>=25;l--){const m=de.find(E=>E.universalNumber===l);m&&P.push(m)}for(let l=17;l<=24;l++){const m=de.find(E=>E.universalNumber===l);m&&P.push(m)}return{upperTeeth:g,lowerTeeth:P}},[]),v=35,k=100,I=5,W=50,O=2.5,ne=3*O,T=20,K=w.useCallback((g,P)=>{if(!c||!g||g.length===0)return{gmLinePath:null,pdLinePath:null,gmShadedPath:null,pdShadedPath:null};const l=[],m=[],E=[.2,.5,.8];let B=null,o=null;g.forEach((b,j)=>{var S;if(!b)return;const t=(S=c==null?void 0:c.teeth)==null?void 0:S[b.universalNumber],i=j*(v+I);if(!t||t.missing){B=null,o=null;return}const r=t[a]||{},d=r.gingivalMargin||[null,null,null],u=r.pocketDepth||[null,null,null];if(B!==null){const L=((j-1)*(v+I)+v+i)/2;l.push({x:L,y:B.y,value:B.value,toothIndex:j,siteIndex:-1,isBridge:!0}),o!==null&&m.push({x:L,y:o.y,value:o.value,toothIndex:j,siteIndex:-1,isBridge:!0})}E.forEach((q,C)=>{const L=d[C],A=u[C],H=i+q*v,R=L??0,U=W+P-R*O,z={x:H,y:U,value:R,toothIndex:j,siteIndex:C};if(l.push(z),B=z,A!=null){const J=U+A*O,_={x:H,y:J,value:A,toothIndex:j,siteIndex:C};m.push(_),o=_}})});const x=b=>{if(b.length===0)return null;if(b.length===1)return`M ${b[0].x} ${b[0].y}`;const j=[];j.push(`M ${b[0].x} ${b[0].y}`);for(let t=1;t<b.length;t++)j.push(`L ${b[t].x} ${b[t].y}`);return j.join(" ")},Q=x(l),te=x(m);let ie=null;if(l.length>0&&l.some(j=>j.value>0)){const j=[],t=W+P;j.push(`M ${l[0].x} ${t}`),l.forEach(r=>{const d=r.value>0?r.y:t;j.push(`L ${r.x} ${d}`)});const i=l[l.length-1].x;j.push(`L ${i} ${t}`),j.push("Z"),ie=j.join(" ")}let oe=null;if(l.length>0&&m.length>0){const b=[],j=new Map;if(m.forEach(t=>{const i=`${t.toothIndex}-${t.siteIndex}`;j.set(i,t)}),l.forEach(t=>{const i=`${t.toothIndex}-${t.siteIndex}`,r=j.get(i);r&&(t.isBridge||r.value>0&&!r.isBridge)&&b.push({gm:t,pd:r})}),b.length>0){const t=[];t.push(`M ${b[0].gm.x} ${b[0].gm.y}`);for(let i=1;i<b.length;i++)t.push(`L ${b[i].gm.x} ${b[i].gm.y}`);for(let i=b.length-1;i>=0;i--)t.push(`L ${b[i].pd.x} ${b[i].pd.y}`);t.push("Z"),oe=t.join(" ")}}return{gmLinePath:Q,pdLinePath:te,gmShadedPath:ie,pdShadedPath:oe}},[c,a]),M=w.useMemo(()=>K(f.upperTeeth,0),[f.upperTeeth,K]),$=w.useMemo(()=>K(f.lowerTeeth,k+T),[f.lowerTeeth,K]),ee=(g,P,l=0)=>{var Q;if(!g)return null;const m=(Q=c==null?void 0:c.teeth)==null?void 0:Q[g.universalNumber],E=P*(v+I);let B;g.jaw==="Upper"?B=`${g.quadrantNumber}.png`:B=`${g.quadrantNumber+10}.png`;const x=!!(m!=null&&m.implant&&!(m!=null&&m.missing))?"/teeth/implant.png":`/teeth/${B}`;return e.jsxs("g",{transform:`translate(${E}, ${l})`,children:[e.jsx("image",{x:0,y:0,width:v,height:k,href:x,opacity:!m||m.missing?.3:1,style:{objectFit:"contain",filter:!m||m.missing?"grayscale(100%)":"none"},onError:te=>{te.target.style.display="none"}}),e.jsx("text",{x:v/2,y:k+15,textAnchor:"middle",fontSize:10,fill:h.palette.text.primary,fontWeight:"bold",children:g.quadrantNumber})]},g.universalNumber)};return c?e.jsxs(n,{sx:{border:`1px solid ${h.palette.divider}`,borderRadius:1,bgcolor:"background.paper",overflow:"hidden"},children:[e.jsxs(n,{sx:{p:2.5,borderBottom:`1px solid ${h.palette.divider}`},children:[e.jsx(s,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"نمایش بصری چارت پریودونتال"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"نواحی آبی: پسروی لثه (Gingival Recession) | نواحی قرمز: عمق پاکت (Pocket Depth)"})]}),e.jsx(n,{sx:{p:2.5},children:e.jsxs(p,{spacing:3,children:[e.jsx(p,{direction:"row",spacing:2,alignItems:"center",children:e.jsxs(je,{size:"small",sx:{minWidth:150},children:[e.jsx(ye,{children:"سطح"}),e.jsxs(ve,{value:a,label:"سطح",onChange:g=>N(g.target.value),children:[e.jsx(ue,{value:"facial",children:"Facial (باکال)"}),e.jsx(ue,{value:"lingual",children:"Lingual (پالاتال)"})]})]})}),e.jsxs(n,{sx:{display:"flex",gap:3,p:2,bgcolor:"background.neutral",borderRadius:1},children:[e.jsxs(p,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(n,{sx:{width:20,height:3,bgcolor:h.palette.error.main}}),e.jsx(s,{variant:"caption",children:"خط مرجع CEJ"})]}),e.jsxs(p,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(n,{sx:{width:20,height:3,bgcolor:h.palette.info.main}}),e.jsx(s,{variant:"caption",children:"حاشیه لثه (Gingival Margin)"})]}),e.jsxs(p,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(n,{sx:{width:20,height:12,bgcolor:h.palette.info.main,opacity:.3}}),e.jsx(s,{variant:"caption",children:"پسروی لثه (Recession)"})]}),e.jsxs(p,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(n,{sx:{width:20,height:3,bgcolor:h.palette.error.main}}),e.jsx(s,{variant:"caption",children:"عمق پاکت (Pocket Depth)"})]}),e.jsxs(p,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(n,{sx:{width:20,height:12,bgcolor:h.palette.error.main,opacity:.4}}),e.jsx(s,{variant:"caption",children:"پاکت پریودونتال"})]})]}),e.jsx(n,{sx:{overflowX:"auto",border:`1px solid ${h.palette.divider}`,borderRadius:1,bgcolor:"background.paper"},children:e.jsxs("svg",{width:16*(v+I),height:k*2+T+30,style:{display:"block"},children:[e.jsx("rect",{width:"100%",height:"100%",fill:h.palette.background.paper}),Array.from({length:Math.floor((k*2+T)/ne)+1}).map((g,P)=>{const l=P*ne;return e.jsxs("g",{children:[e.jsx("line",{x1:0,y1:l,x2:16*(v+I),y2:l,stroke:h.palette.divider,strokeWidth:.5,opacity:.2}),l<k&&e.jsx("line",{x1:0,y1:k+T+l,x2:16*(v+I),y2:k+T+l,stroke:h.palette.divider,strokeWidth:.5,opacity:.2})]},`grid-${P}`)}),e.jsx("line",{x1:0,y1:W,x2:16*(v+I),y2:W,stroke:h.palette.error.main,strokeWidth:2}),e.jsx("line",{x1:0,y1:k+T+W,x2:16*(v+I),y2:k+T+W,stroke:h.palette.error.main,strokeWidth:2}),f.upperTeeth.map((g,P)=>ee(g,P,0)),f.lowerTeeth.map((g,P)=>ee(g,P,k+T)),M.gmShadedPath&&e.jsx("path",{d:M.gmShadedPath,fill:h.palette.info.main,fillOpacity:.3,stroke:h.palette.info.main,strokeWidth:1.5}),M.gmLinePath&&e.jsx("path",{d:M.gmLinePath,fill:"none",stroke:h.palette.info.main,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),M.pdShadedPath&&e.jsx("path",{d:M.pdShadedPath,fill:h.palette.error.main,fillOpacity:.4,stroke:h.palette.error.main,strokeWidth:1.5}),M.pdLinePath&&e.jsx("path",{d:M.pdLinePath,fill:"none",stroke:h.palette.error.main,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),$.gmShadedPath&&e.jsx("path",{d:$.gmShadedPath,fill:h.palette.info.main,fillOpacity:.3,stroke:h.palette.info.main,strokeWidth:1.5}),$.gmLinePath&&e.jsx("path",{d:$.gmLinePath,fill:"none",stroke:h.palette.info.main,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),$.pdShadedPath&&e.jsx("path",{d:$.pdShadedPath,fill:h.palette.error.main,fillOpacity:.4,stroke:h.palette.error.main,strokeWidth:1.5}),$.pdLinePath&&e.jsx("path",{d:$.pdLinePath,fill:"none",stroke:h.palette.error.main,strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsxs("text",{x:-40,y:k/2,fontSize:14,fill:h.palette.text.primary,textAnchor:"middle",fontWeight:"bold",transform:"rotate(-90, -40, 50)",children:[a==="facial"?"Buccal":"Palatal"," (فک بالا)"]}),e.jsxs("text",{x:-40,y:k+T+k/2,fontSize:14,fill:h.palette.text.primary,textAnchor:"middle",fontWeight:"bold",transform:"rotate(-90, -40, 150)",children:[a==="facial"?"Buccal":"Palatal"," (فک پایین)"]})]})})]})})]}):e.jsx(Ne,{children:e.jsx(Ce,{children:e.jsx(s,{variant:"body2",color:"text.secondary",textAlign:"center",children:"چارت پریودونتال ثبت نشده است"})})})}function Ie({patient:c,onUpdate:h}){const a=be(),{user:N}=ke(),[f,v]=w.useState(null),[k,I]=w.useState([]),[W,O]=w.useState(null),[ne,T]=w.useState(!0),[K,M]=w.useState(!1),[$,ee]=w.useState(null),[g,P]=w.useState(!1),l=w.useCallback(t=>{if(!t){v(null);return}let i=t.teeth;if(typeof i=="string")try{i=JSON.parse(i)}catch(r){console.error("Error parsing teeth data:",r),i={}}(!i||typeof i!="object")&&(i={}),v({...t,teeth:i})},[]);w.useEffect(()=>{N&&c?(async()=>{try{T(!0);const r=(await he.get(`${pe.patients}/${c.id}/periodontal-charts`,{headers:{Authorization:`Bearer ${N==null?void 0:N.accessToken}`}})).data.charts||[];if(I(r),r.length>0){const d=r[0];O(d.id),l(d)}else v(null),O(null)}catch(i){console.error("Error fetching charts:",i),v(null),I([]),O(null)}finally{T(!1)}})():(v(null),I([]),O(null),T(!1))},[N,c,l]);const m=t=>{const i=t.target.value;if(O(i),i&&i!==""){const r=k.find(d=>d.id===i);r&&l(r)}else v(null)},E=t=>{ee(t),M(!0)},B=async()=>{if($)try{P(!0),await he.delete(`${pe.patients}/${c.id}/periodontal-charts/${$.id}`,{headers:{Authorization:`Bearer ${N==null?void 0:N.accessToken}`}}),me.success("چارت با موفقیت حذف شد");const i=(await he.get(`${pe.patients}/${c.id}/periodontal-charts`,{headers:{Authorization:`Bearer ${N==null?void 0:N.accessToken}`}})).data.charts||[];if(I(i),W===$.id)if(i.length>0){const r=i[0];O(r.id),l(r)}else O(null),v(null);M(!1),ee(null)}catch(t){console.error("Error deleting chart:",t),me.error("خطا در حذف چارت")}finally{P(!1)}},o=w.useMemo(()=>{if(!f||!f.teeth)return console.log("Analysis: No chart data or teeth found",{chartData:f}),null;const{teeth:t}=f;if(Object.keys(t).length===0)return console.log("Analysis: No teeth found in chart data"),null;const i={bopPercentage:0,avgPocketDepth:0,avgCAL:0,pocketDepthDistribution:{healthy:0,mild:0,moderate:0,severe:0},diseaseExtent:"Localized",diseaseSeverity:"Stage I",totalSites:0,bopSites:0,totalBopSurfaces:0,affectedTeeth:0,totalTeeth:0};let r=0,d=0,u=0,S=0,q=0,C=0,L=0;if(Object.keys(t).forEach(R=>{const U=t[R];if(!U||U.missing)return;const z=U.facial||{},J=U.lingual||{},_=z.pocketDepth||[],re=z.gingivalMargin||[],se=J.pocketDepth||[],Y=J.gingivalMargin||[],G=z.bleeding||[],F=J.bleeding||[];L+=1,q+=2;let V=0;G.some(y=>y===!0)&&(S+=1),F.some(y=>y===!0)&&(S+=1),_.forEach((y,Z)=>{if(y==null)return;const ce=re[Z]!==null&&re[Z]!==void 0?re[Z]:0,ae=y+ce;r+=y,d+=ae,u+=1,V=Math.max(V,ae),y<=3?i.pocketDepthDistribution.healthy+=1:y<=5?i.pocketDepthDistribution.mild+=1:y===6?i.pocketDepthDistribution.moderate+=1:y>=7&&(i.pocketDepthDistribution.severe+=1)}),se.forEach((y,Z)=>{if(y==null)return;const ce=Y[Z]!==null&&Y[Z]!==void 0?Y[Z]:0,ae=y+ce;r+=y,d+=ae,u+=1,V=Math.max(V,ae),y<=3?i.pocketDepthDistribution.healthy+=1:y<=5?i.pocketDepthDistribution.mild+=1:y===6?i.pocketDepthDistribution.moderate+=1:y>=7&&(i.pocketDepthDistribution.severe+=1)}),V>=3&&(C+=1)}),i.totalSites=u,i.bopSites=S,i.totalBopSurfaces=q,i.totalTeeth=L,i.affectedTeeth=C,u>0&&(i.avgPocketDepth=r/u,i.avgCAL=d/u),q>0&&(i.bopPercentage=S/q*100),L>0){const R=C/L*100;i.diseaseExtent=R<30?"Localized":"Generalized"}const A=Object.values(t).filter(R=>R&&!R.missing).flatMap(R=>{const U=R.facial||{},z=R.lingual||{},J=U.pocketDepth||[],_=U.gingivalMargin||[],re=z.pocketDepth||[],se=z.gingivalMargin||[],Y=[];return J.forEach((G,F)=>{if(G!=null){const V=_[F]!==null&&_[F]!==void 0?_[F]:0;Y.push(G+V)}}),re.forEach((G,F)=>{if(G!=null){const V=se[F]!==null&&se[F]!==void 0?se[F]:0;Y.push(G+V)}}),Y}),H=A.length>0?Math.max(...A):0;return H<=2?i.diseaseSeverity="Stage I - Mild":H<=4?i.diseaseSeverity="Stage II - Moderate":H>=5&&L===32?i.diseaseSeverity="Stage III - Severe":H>=5?i.diseaseSeverity="Stage IV - Very Severe":i.diseaseSeverity="Stage I - Mild",i},[f]),x=w.useMemo(()=>{if(!o||!f)return null;const t={phase1:{items:[],description:"",duration:"",priority:"high"},phase2:{items:[],description:"",duration:"",priority:"medium"},phase3:{items:[],description:"",duration:"",priority:"low"},phase4:{items:[],description:"",duration:"",priority:"high"}};t.phase1.description="درمان اولیه شامل کنترل پلاک، اسکلینگ و روت پلنینگ برای حذف عوامل بیماری‌زا",t.phase1.duration="4-6 هفته",t.phase1.items.push({title:"آموزش بهداشت دهان و دندان",description:"آموزش تکنیک‌های صحیح مسواک زدن، استفاده از نخ دندان و دهانشویه",icon:"solar:book-bookmark-bold"}),t.phase1.items.push({title:"اسکلینگ و روت پلنینگ (SRP)",description:"حذف پلاک و جرم از سطح دندان و ریشه در تمام دهان",icon:"solar:scissors-bold"}),o.bopPercentage>30&&(t.phase1.items.push({title:"کنترل شدید پلاک",description:"برنامه کنترل پلاک فشرده با ویزیت‌های مکرر",icon:"solar:shield-check-bold"}),t.phase1.items.push({title:"دهانشویه ضدمیکروبی",description:"کلرهگزیدین 0.12% دو بار در روز به مدت 2-4 هفته",icon:"solar:droplet-bold"})),o.avgPocketDepth>5&&t.phase1.items.push({title:"آنتی‌بیوتیک موضعی",description:"تجویز آنتی‌بیوتیک موضعی در پاکت‌های عمیق (در صورت نیاز)",icon:"solar:pill-bold"}),t.phase2.description="ارزیابی پاسخ به درمان اولیه و در صورت نیاز، انجام درمان‌های جراحی",t.phase2.duration="4-8 هفته پس از فاز 1",(o.avgPocketDepth>5||o.avgCAL>4)&&(t.phase2.items.push({title:"ارزیابی مجدد",description:"بررسی بهبودی BOP، CAL و عمق پاکت 4-6 هفته پس از SRP",icon:"solar:clipboard-check-bold"}),o.avgPocketDepth>6&&(t.phase2.items.push({title:"جراحی فلپ",description:"جراحی فلپ برای دسترسی بهتر به ریشه و حذف پاکت‌های عمیق",icon:"solar:scalpel-bold"}),t.phase2.items.push({title:"جراحی استخوان",description:"جراحی استخوان برای اصلاح نقایص استخوانی",icon:"solar:bone-bold"})),t.phase2.items.push({title:"پیوند استخوان",description:"پیوند استخوان و بازسازی بافت هدایت شده (GBR) در صورت نیاز",icon:"solar:heart-pulse-bold"})),t.phase3.description="درمان‌های بازسازی‌ای و پروتزی برای بهبود عملکرد و زیبایی",t.phase3.duration="پس از بهبودی کامل فاز 2";const{teeth:i}=f,r=Object.values(i).filter(q=>{var C,L;return!q.missing&&(((C=q.facial)==null?void 0:C.mobility)>1||((L=q.lingual)==null?void 0:L.mobility)>1)}).length;r>0&&t.phase3.items.push({title:`اسپلینت کردن ${r} دندان`,description:"اسپلینت کردن دندان‌های با تحرک بالا برای کاهش تحرک و بهبود ثبات",icon:"solar:link-bold"});const d=Object.values(i).filter(q=>q.missing).length;d>0&&t.phase3.items.push({title:`بازسازی پروتزی ${d} دندان`,description:`برنامه‌ریزی برای جایگزینی ${d} دندان از دست رفته با ایمپلنت یا پروتز`,icon:"solar:tooth-bold"}),t.phase3.items.length===0&&t.phase3.items.push({title:"نیازی به درمان بازسازی‌ای نیست",description:"وضعیت فعلی نیاز به درمان بازسازی‌ای ندارد",icon:"solar:check-circle-bold"}),t.phase4.description="برنامه نگهداری طولانی‌مدت برای حفظ سلامت پریودونتال";const u=o.bopPercentage<10?"6 ماه":"3 ماه";t.phase4.duration=`هر ${u}`,t.phase4.items.push({title:`بازدید دوره‌ای هر ${u}`,description:`ویزیت منظم هر ${u} برای مانیتورینگ وضعیت پریودونتال`,icon:"solar:calendar-mark-bold"}),t.phase4.items.push({title:"مانیتورینگ شاخص‌ها",description:"بررسی BOP، CAL، عمق پاکت و وضعیت کلی لثه",icon:"solar:graph-up-bold"}),t.phase4.items.push({title:"اسکلینگ و پولیش",description:"اسکلینگ و پولیش حرفه‌ای در صورت نیاز",icon:"solar:brush-bold"}),t.phase4.items.push({title:"بررسی و اصلاح تکنیک‌های بهداشتی",description:"بررسی تکنیک‌های بهداشت دهان بیمار و ارائه راهنمایی‌های لازم",icon:"solar:book-bookmark-bold"});const S=typeof c.medicalHistory=="string"?JSON.parse(c.medicalHistory):c.medicalHistory||{};return S.diabetes&&t.phase1.items.unshift({title:"هماهنگی با پزشک برای کنترل قند خون",description:"هماهنگی با پزشک معالج برای کنترل بهینه قند خون (HbA1c < 7%)",icon:"solar:heart-pulse-bold",warning:!0}),S.smoking&&t.phase1.items.unshift({title:"مشاوره ترک سیگار",description:"مشاوره و راهنمایی برای ترک سیگار (بسیار مهم برای موفقیت درمان)",icon:"solar:smoking-bold",warning:!0}),S.pregnancy&&t.phase1.items.push({title:"توجه ویژه به ژنژیویت بارداری",description:"درمان محافظه‌کارانه با توجه به وضعیت بارداری",icon:"solar:heart-bold",warning:!0}),t},[o,f,c]),Q=fe({chart:{type:"bar"},xaxis:{categories:["فک بالا راست","فک بالا چپ","فک پایین چپ","فک پایین راست"]},colors:[a.palette.error.main],plotOptions:{bar:{borderRadius:8,distributed:!1}}}),te=w.useMemo(()=>{if(!f)return[];const t={q1:{bop:0,total:0},q2:{bop:0,total:0},q3:{bop:0,total:0},q4:{bop:0,total:0}};return Object.keys(f.teeth).forEach(i=>{const r=f.teeth[i],d=parseInt(i,10);if(!r||r.missing)return;let u;d>=1&&d<=8?u="q1":d>=9&&d<=16?u="q2":d>=17&&d<=24?u="q3":u="q4";const S=r.facial&&r.facial.bleeding||[],q=r.lingual&&r.lingual.bleeding||[],C=S.some(A=>A===!0),L=q.some(A=>A===!0);C&&(t[u].bop+=1),L&&(t[u].bop+=1),t[u].total+=2}),[{name:"BOP %",data:[t.q1.total>0?t.q1.bop/t.q1.total*100:0,t.q2.total>0?t.q2.bop/t.q2.total*100:0,t.q3.total>0?t.q3.bop/t.q3.total*100:0,t.q4.total>0?t.q4.bop/t.q4.total*100:0]}]},[f]),ie=w.useMemo(()=>{if(!o||!f||!c)return null;const t=Object.values(f.teeth).filter(u=>u.missing).length,i=typeof c.medicalHistory=="string"?JSON.parse(c.medicalHistory):c.medicalHistory||{};let r=0;i.diabetes&&(r+=1),i.hypertension&&(r+=1),i.heartDisease&&(r+=1),i.kidneyDisease&&(r+=1),i.liverDisease&&(r+=1),i.autoimmune&&(r+=1),i.cancer&&(r+=1),i.otherDiseases&&(r+=1);const d=i.smoking&&i.smokingCigarettesPerDay||0;return{missingTeeth:t,bop:o.bopPercentage,pd:o.avgPocketDepth,cal:o.avgCAL,systemicDiseases:r,smoking:d}},[o,f,c]),oe=w.useMemo(()=>({xaxis:{categories:["دندان از دست رفته","میانگین BOP (%)","میانگین PD (mm)","میانگین CAL (mm)","بیماری‌های سیستمیک","مصرف سیگار (نخ/روز)"]},yaxis:{show:!1,max:100,min:0},plotOptions:{radar:{polygons:{strokeColors:a.palette.divider,strokeWidth:1,fill:{colors:["transparent"]}}}},markers:{size:4,strokeColors:[a.palette.primary.main],strokeWidth:2},stroke:{width:2,curve:"smooth"},fill:{opacity:.2},colors:[a.palette.primary.main],tooltip:{y:{formatter:(t,i)=>{const{dataPointIndex:r}=i,d=ie;return d?r===0?`${d.missingTeeth} دندان`:r===1?`${d.bop.toFixed(1)}%`:r===2?`${d.pd.toFixed(1)} mm`:r===3?`${d.cal.toFixed(1)} mm`:r===4?`${d.systemicDiseases} بیماری`:r===5?`${d.smoking} نخ/روز`:`${t.toFixed(1)}`:r===0?`${Math.round(t/100*32)} دندان`:`${t.toFixed(1)}`}}},states:{hover:{filter:{type:"lighten",value:.1}},active:{filter:{type:"none"}}}}),[a.palette.divider,a.palette.primary.main,ie]),b=fe(oe),j=w.useMemo(()=>{if(!o||!f||!c)return[];const t=Object.values(f.teeth).filter(R=>R.missing).length,i=typeof c.medicalHistory=="string"?JSON.parse(c.medicalHistory):c.medicalHistory||{};let r=0;i.diabetes&&(r+=1),i.hypertension&&(r+=1),i.heartDisease&&(r+=1),i.kidneyDisease&&(r+=1),i.liverDisease&&(r+=1),i.autoimmune&&(r+=1),i.cancer&&(r+=1),i.otherDiseases&&(r+=1);const d=i.smoking&&i.smokingCigarettesPerDay||0,u={missingTeeth:10,bop:100,pd:6,cal:8,systemicDiseases:5,smoking:30},S=t>0?Math.min(t/u.missingTeeth*100,100):0,q=Math.min(o.bopPercentage/u.bop*100,100),C=o.avgPocketDepth>0?Math.min(o.avgPocketDepth/u.pd*100,100):0,L=o.avgCAL>0?Math.min(o.avgCAL/u.cal*100,100):0,A=r>0?Math.min(r/u.systemicDiseases*100,100):0,H=d>0?Math.min(d/u.smoking*100,100):0;return[{name:"وضعیت پریودونتال",data:[S,q,C,L,A,H]}]},[o,f,c]);return ne?e.jsx(n,{sx:{textAlign:"center",py:4},children:e.jsx(s,{children:"در حال بارگیری آنالیز..."})}):!f||!o?e.jsxs(n,{sx:{textAlign:"center",py:4},children:[e.jsx(s,{variant:"h6",color:"text.secondary",children:"چارت پریودونتال ثبت نشده است"}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mt:1},children:'لطفاً ابتدا به تب "چارت پریودونتال" بروید و اطلاعات را ثبت کنید'})]}):e.jsxs(p,{spacing:3,children:[k.length>0&&e.jsx(n,{sx:{p:2,border:`1px solid ${a.palette.divider}`,borderRadius:1,bgcolor:"background.paper"},children:e.jsxs(p,{direction:"row",spacing:2,alignItems:"center",children:[e.jsxs(je,{fullWidth:!0,size:"small",children:[e.jsx(ye,{children:"انتخاب چارت برای آنالیز"}),e.jsx(ve,{value:W||"",onChange:m,label:"انتخاب چارت برای آنالیز",children:k.map(t=>e.jsx(ue,{value:t.id,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(X,{icon:"solar:calendar-bold",width:18}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",children:new Date(t.date).toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric"})}),e.jsx(s,{variant:"caption",color:"text.secondary",children:new Date(t.date).toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})})]})]})},t.id))})]}),W&&e.jsx(Le,{color:"error",size:"small",onClick:()=>{const t=k.find(i=>i.id===W);t&&E(t)},children:e.jsx(X,{icon:"solar:trash-bin-trash-bold",width:20})})]})}),e.jsxs(Pe,{open:K,onClose:()=>!g&&M(!1),children:[e.jsx(Se,{children:"حذف چارت پریودونتال"}),e.jsx(De,{children:e.jsxs(s,{children:["آیا از حذف چارت تاریخ"," ",$&&new Date($.date).toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric"})," ","مطمئن هستید؟ این عمل غیرقابل بازگشت است."]})}),e.jsxs($e,{children:[e.jsx(ge,{onClick:()=>M(!1),color:"inherit",disabled:g,children:"انصراف"}),e.jsx(ge,{onClick:B,color:"error",variant:"contained",disabled:g,startIcon:g?e.jsx(X,{icon:"eva:loader-fill"}):e.jsx(X,{icon:"solar:trash-bin-trash-bold"}),children:g?"در حال حذف...":"حذف"})]})]}),e.jsxs(D,{container:!0,spacing:2,children:[e.jsx(D,{item:!0,xs:12,md:4,children:e.jsx(n,{sx:{p:2.5,border:`1px solid ${a.palette.divider}`,borderRadius:1,bgcolor:"background.paper"},children:e.jsxs(p,{spacing:1.5,children:[e.jsx(s,{variant:"body2",color:"text.secondary",fontWeight:500,children:"BOP درصد"}),e.jsxs(s,{variant:"h4",fontWeight:600,children:[o.bopPercentage.toFixed(1),"%"]}),e.jsx(qe,{variant:"determinate",value:Math.min(o.bopPercentage,100),color:o.bopPercentage>30?"error":"success",sx:{height:6,borderRadius:1}}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:[o.bopSites," از ",o.totalBopSurfaces," سطح"]})]})})}),e.jsx(D,{item:!0,xs:12,md:4,children:e.jsx(n,{sx:{p:2.5,border:`1px solid ${a.palette.divider}`,borderRadius:1,bgcolor:"background.paper"},children:e.jsxs(p,{spacing:1.5,children:[e.jsx(s,{variant:"body2",color:"text.secondary",fontWeight:500,children:"میانگین عمق پاکت"}),e.jsxs(s,{variant:"h4",fontWeight:600,children:[o.avgPocketDepth.toFixed(1)," mm"]}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Pocket Depth"})]})})}),e.jsx(D,{item:!0,xs:12,md:4,children:e.jsx(n,{sx:{p:2.5,border:`1px solid ${a.palette.divider}`,borderRadius:1,bgcolor:"background.paper"},children:e.jsxs(p,{spacing:1.5,children:[e.jsx(s,{variant:"body2",color:"text.secondary",fontWeight:500,children:"میانگین CAL"}),e.jsxs(s,{variant:"h4",fontWeight:600,children:[o.avgCAL.toFixed(1)," mm"]}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Clinical Attachment Level"})]})})})]}),e.jsxs(D,{container:!0,spacing:2,children:[e.jsx(D,{item:!0,xs:12,md:6,children:e.jsxs(n,{sx:{p:2.5,border:`1px solid ${a.palette.divider}`,borderRadius:1,bgcolor:"background.paper"},children:[e.jsx(s,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"گستردگی بیماری"}),e.jsxs(n,{sx:{mt:2,p:2,textAlign:"center",borderRadius:1,bgcolor:o.diseaseExtent==="Generalized"?a.palette.error.lighter:a.palette.success.lighter},children:[e.jsx(s,{variant:"h6",fontWeight:600,children:o.diseaseExtent}),e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{mt:1},children:[o.affectedTeeth," از ",o.totalTeeth," دندان درگیر (",(o.affectedTeeth/o.totalTeeth*100).toFixed(0),"%)"]})]})]})}),e.jsx(D,{item:!0,xs:12,md:6,children:e.jsxs(n,{sx:{p:2.5,border:`1px solid ${a.palette.divider}`,borderRadius:1,bgcolor:"background.paper"},children:[e.jsx(s,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"شدت بیماری"}),e.jsxs(n,{sx:{mt:2,p:2,textAlign:"center",borderRadius:1,bgcolor:a.palette.warning.lighter},children:[e.jsx(s,{variant:"h6",fontWeight:600,children:o.diseaseSeverity}),e.jsxs(p,{spacing:.5,sx:{mt:1.5},children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Stage I: CAL 1-2mm"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Stage II: CAL 3-4mm"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Stage III: CAL ≥5mm"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Stage IV: CAL ≥5mm + tooth loss"})]})]})]})})]}),e.jsxs(D,{container:!0,spacing:2,children:[e.jsx(D,{item:!0,xs:12,md:6,children:e.jsxs(n,{sx:{p:2.5,border:`1px solid ${a.palette.divider}`,borderRadius:1,bgcolor:"background.paper"},children:[e.jsx(s,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"توزیع BOP در کادران‌ها"}),e.jsx(xe,{type:"bar",series:te,options:Q,height:300})]})}),e.jsx(D,{item:!0,xs:12,md:6,children:e.jsxs(n,{sx:{p:2.5,border:`1px solid ${a.palette.divider}`,borderRadius:1,bgcolor:"background.paper"},children:[e.jsx(s,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"تحلیل جامع پریودونتال"}),e.jsx(s,{variant:"caption",color:"text.secondary",sx:{mb:2,display:"block"},children:"نمایش چندبعدی عوامل مؤثر بر سلامت پریودونتال"}),e.jsx(xe,{type:"radar",series:j,options:b,height:300})]})})]}),e.jsx(Re,{chartData:f}),x&&e.jsxs(n,{sx:{border:`1px solid ${a.palette.divider}`,borderRadius:2,bgcolor:"background.paper",overflow:"hidden"},children:[e.jsx(n,{sx:{p:3,borderBottom:`1px solid ${a.palette.divider}`,bgcolor:"background.paper"},children:e.jsxs(p,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(X,{icon:"medical-icon:i-あprescription",width:32,sx:{color:a.palette.text.primary}}),e.jsxs(n,{children:[e.jsx(s,{variant:"h6",fontWeight:600,children:"طرح درمان پیشنهادی"}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:"بر اساس ارزیابی جامع وضعیت پریودونتال بیمار"})]})]})}),e.jsx(n,{sx:{p:3},children:e.jsxs(D,{container:!0,spacing:3,children:[e.jsx(D,{item:!0,xs:12,md:6,children:e.jsx(n,{sx:{p:2.5,border:`1px solid ${a.palette.divider}`,borderRadius:2,bgcolor:"background.paper",height:"100%"},children:e.jsxs(p,{spacing:2.5,children:[e.jsxs(n,{children:[e.jsxs(p,{direction:"row",spacing:1.5,alignItems:"center",sx:{mb:1.5},children:[e.jsx(n,{sx:{width:28,height:28,borderRadius:1,bgcolor:"transparent",border:`2px solid ${a.palette.primary.main}`,display:"flex",alignItems:"center",justifyContent:"center",color:a.palette.primary.main,fontWeight:600,fontSize:"0.875rem"},children:"1"}),e.jsxs(n,{children:[e.jsx(s,{variant:"subtitle1",fontWeight:600,children:"فاز 1: درمان اولیه"}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:["مدت زمان: ",x.phase1.duration]})]})]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:x.phase1.description})]}),e.jsx(le,{}),e.jsx(p,{spacing:1.5,children:x.phase1.items.map((t,i)=>e.jsx(n,{sx:{p:1.5,borderRadius:1,bgcolor:"background.paper",border:t.warning?`1px solid ${a.palette.warning.main}`:`1px solid ${a.palette.divider}`},children:e.jsxs(p,{direction:"row",spacing:1.5,alignItems:"flex-start",children:[e.jsx(X,{icon:t.icon,width:18,sx:{color:t.warning?a.palette.warning.main:a.palette.text.secondary,mt:.25}}),e.jsxs(n,{sx:{flex:1},children:[e.jsx(s,{variant:"body2",fontWeight:500,sx:{mb:.5},children:t.title}),e.jsx(s,{variant:"caption",color:"text.secondary",sx:{lineHeight:1.6},children:t.description})]})]})},i))})]})})}),e.jsx(D,{item:!0,xs:12,md:6,children:e.jsx(n,{sx:{p:2.5,border:`1px solid ${a.palette.divider}`,borderRadius:2,bgcolor:"background.paper",height:"100%"},children:e.jsxs(p,{spacing:2.5,children:[e.jsxs(n,{children:[e.jsxs(p,{direction:"row",spacing:1.5,alignItems:"center",sx:{mb:1.5},children:[e.jsx(n,{sx:{width:28,height:28,borderRadius:1,bgcolor:"transparent",border:`2px solid ${x.phase2.items.length>0?a.palette.warning.main:a.palette.text.disabled}`,display:"flex",alignItems:"center",justifyContent:"center",color:x.phase2.items.length>0?a.palette.warning.main:a.palette.text.disabled,fontWeight:600,fontSize:"0.875rem"},children:"2"}),e.jsxs(n,{children:[e.jsx(s,{variant:"subtitle1",fontWeight:600,color:x.phase2.items.length>0?"text.primary":"text.secondary",children:"فاز 2: ارزیابی مجدد و جراحی"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:x.phase2.duration})]})]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:x.phase2.description})]}),e.jsx(le,{}),e.jsx(p,{spacing:1.5,children:x.phase2.items.length>0?x.phase2.items.map((t,i)=>e.jsx(n,{sx:{p:1.5,borderRadius:1,bgcolor:"background.paper",border:`1px solid ${a.palette.divider}`},children:e.jsxs(p,{direction:"row",spacing:1.5,alignItems:"flex-start",children:[e.jsx(X,{icon:t.icon,width:18,sx:{color:a.palette.text.secondary,mt:.25}}),e.jsxs(n,{sx:{flex:1},children:[e.jsx(s,{variant:"body2",fontWeight:500,sx:{mb:.5},children:t.title}),e.jsx(s,{variant:"caption",color:"text.secondary",sx:{lineHeight:1.6},children:t.description})]})]})},i)):e.jsx(n,{sx:{p:2,borderRadius:1,bgcolor:"background.paper",border:`1px dashed ${a.palette.divider}`,textAlign:"center"},children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"بر اساس نتایج فاز 1 تعیین می‌شود"})})})]})})}),e.jsx(D,{item:!0,xs:12,md:6,children:e.jsx(n,{sx:{p:2.5,border:`1px solid ${a.palette.divider}`,borderRadius:2,bgcolor:"background.paper",height:"100%"},children:e.jsxs(p,{spacing:2.5,children:[e.jsxs(n,{children:[e.jsxs(p,{direction:"row",spacing:1.5,alignItems:"center",sx:{mb:1.5},children:[e.jsx(n,{sx:{width:28,height:28,borderRadius:1,bgcolor:"transparent",border:`2px solid ${x.phase3.items.length>0&&x.phase3.items[0].title!=="نیازی به درمان بازسازی‌ای نیست"?a.palette.info.main:a.palette.text.disabled}`,display:"flex",alignItems:"center",justifyContent:"center",color:x.phase3.items.length>0&&x.phase3.items[0].title!=="نیازی به درمان بازسازی‌ای نیست"?a.palette.info.main:a.palette.text.disabled,fontWeight:600,fontSize:"0.875rem"},children:"3"}),e.jsxs(n,{children:[e.jsx(s,{variant:"subtitle1",fontWeight:600,color:x.phase3.items.length>0&&x.phase3.items[0].title!=="نیازی به درمان بازسازی‌ای نیست"?"text.primary":"text.secondary",children:"فاز 3: بازسازی"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:x.phase3.duration})]})]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:x.phase3.description})]}),e.jsx(le,{}),e.jsx(p,{spacing:1.5,children:x.phase3.items.map((t,i)=>e.jsx(n,{sx:{p:1.5,borderRadius:1,bgcolor:"background.paper",border:`1px solid ${a.palette.divider}`},children:e.jsxs(p,{direction:"row",spacing:1.5,alignItems:"flex-start",children:[e.jsx(X,{icon:t.icon,width:18,sx:{color:a.palette.text.secondary,mt:.25}}),e.jsxs(n,{sx:{flex:1},children:[e.jsx(s,{variant:"body2",fontWeight:500,sx:{mb:.5},children:t.title}),e.jsx(s,{variant:"caption",color:"text.secondary",sx:{lineHeight:1.6},children:t.description})]})]})},i))})]})})}),e.jsx(D,{item:!0,xs:12,md:6,children:e.jsx(n,{sx:{p:2.5,border:`1px solid ${a.palette.divider}`,borderRadius:2,bgcolor:"background.paper",height:"100%"},children:e.jsxs(p,{spacing:2.5,children:[e.jsxs(n,{children:[e.jsxs(p,{direction:"row",spacing:1.5,alignItems:"center",sx:{mb:1.5},children:[e.jsx(n,{sx:{width:28,height:28,borderRadius:1,bgcolor:"transparent",border:`2px solid ${a.palette.success.main}`,display:"flex",alignItems:"center",justifyContent:"center",color:a.palette.success.main,fontWeight:600,fontSize:"0.875rem"},children:"4"}),e.jsxs(n,{children:[e.jsx(s,{variant:"subtitle1",fontWeight:600,children:"فاز 4: نگهداری"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:x.phase4.duration})]})]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:x.phase4.description})]}),e.jsx(le,{}),e.jsx(p,{spacing:1.5,children:x.phase4.items.map((t,i)=>e.jsx(n,{sx:{p:1.5,borderRadius:1,bgcolor:"background.paper",border:`1px solid ${a.palette.divider}`},children:e.jsxs(p,{direction:"row",spacing:1.5,alignItems:"flex-start",children:[e.jsx(X,{icon:t.icon,width:18,sx:{color:a.palette.text.secondary,mt:.25}}),e.jsxs(n,{sx:{flex:1},children:[e.jsx(s,{variant:"body2",fontWeight:500,sx:{mb:.5},children:t.title}),e.jsx(s,{variant:"caption",color:"text.secondary",sx:{lineHeight:1.6},children:t.description})]})]})},i))})]})})})]})})]})]})}const Ze=w.memo(Ie,(c,h)=>{var a,N;return((a=c.patient)==null?void 0:a.id)===((N=h.patient)==null?void 0:N.id)&&c.onUpdate===h.onUpdate});export{Ze as AnalysisTab};
