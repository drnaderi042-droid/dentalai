import{r as u,j as r,I as l,T as d,S as c,o as w,B,ar as R,d as h,cI as L,A as H}from"./index-BSItzkt3.js";import{P as g}from"./index-b5NUrSMh.js";import{C as j}from"./Card-BqWDE3fr.js";import{C as U}from"./Chip-CHY_XJWs.js";import{G as A}from"./Grid-BaG8uD1u.js";import{D as F}from"./DialogTitle-D9mOMHyE.js";import{D as G}from"./DialogContent-CPx_wcNJ.js";import{T as O}from"./TextField-DpdcsLRb.js";import{D as P}from"./dialogTitleClasses-BJYaWiXv.js";import"./Select-QPCMlUZ4.js";import"./Menu-Cy0n4kRw.js";import"./InputLabel-DqZ4yv4U.js";import"./FormLabel-Dg62SF9b.js";import"./FormHelperText-CBXzj8d7.js";import"./FormControl-1z33WGqh.js";const T=o=>{if(!o)return{summary:"",intraoral:"",extraoral:"",radiographic:"",cephalometric:"",recommendations:"",raw:""};const i={summary:"",intraoral:"",extraoral:"",radiographic:"",cephalometric:"",recommendations:"",raw:o},f=o.split(`
`);let s="summary",t=[];return f.forEach(m=>{const a=m.trim();a.includes("داخل دهانی")||a.includes("تحلیل داخل دهانی")?(t.length>0&&(i[s]=t.join(`
`).trim()),s="intraoral",t=[]):a.includes("خارج دهانی")||a.includes("تحلیل خارج دهانی")?(t.length>0&&(i[s]=t.join(`
`).trim()),s="extraoral",t=[]):a.includes("رادیولوژی")||a.includes("تحلیل رادیولوژی")?(t.length>0&&(i[s]=t.join(`
`).trim()),s="radiographic",t=[]):a.includes("سفالومتری")||a.includes("آنالیز سفالومتری")?(t.length>0&&(i[s]=t.join(`
`).trim()),s="cephalometric",t=[]):a.includes("توصیه")||a.includes("طرح درمان")?(t.length>0&&(i[s]=t.join(`
`).trim()),s="recommendations",t=[]):a.length>0&&!a.match(/^[*#-]+$/)&&t.push(a)}),t.length>0&&(i[s]=t.join(`
`).trim()),!i.intraoral&&!i.extraoral&&!i.radiographic&&!i.cephalometric&&(i.summary=o),Object.keys(i).forEach(m=>{if(m!=="raw"){const a=i[m];(a.length<3||a.match(/^[:\s\-•و]+$/))&&(i[m]="")}}),i},k=o=>{const i=[];return o.summary&&i.push(`**خلاصه:**
${o.summary}`),o.intraoral&&i.push(`
**تحلیل داخل دهانی:**
${o.intraoral}`),o.extraoral&&i.push(`
**تحلیل خارج دهانی:**
${o.extraoral}`),o.radiographic&&i.push(`
**تحلیل رادیولوژی:**
${o.radiographic}`),o.cephalometric&&i.push(`
**تحلیل سفالومتری:**
${o.cephalometric}`),o.recommendations&&i.push(`
**توصیه‌های درمانی:**
${o.recommendations}`),i.join(`
`)};function V({diagnosis:o,onUpdate:i,onSave:f,readOnly:s=!1}){var D;const[t,m]=u.useState(()=>T(o)),[a,p]=u.useState(!1),[C,v]=u.useState(""),[b,y]=u.useState("");u.useEffect(()=>{m(T(o))},[o]);const I=(e,n)=>{v(e),y(n),p(!0)},W=()=>{const e={...t,[C]:b};m(e);const n=k(e);i(n),p(!1),v(""),y("")},z=e=>{if(!e)return"default";const n=e.toLowerCase();return n.includes("شدید")||n.includes("severe")?"error":n.includes("متوسط")||n.includes("moderate")?"warning":"success"},S=e=>{if(!e)return[];const n=[];return e.split(`
`).forEach(x=>{x.match(/^[•\-\d.]/)&&n.push(x.replace(/^[•\-\d.]\s*/,"").trim())}),n.slice(0,5)},$=[{key:"summary",title:"خلاصه تشخیص",icon:"solar:document-text-bold",color:"primary"},{key:"intraoral",title:"تحلیل داخل دهانی",icon:"solar:tooth-bold",color:"info"},{key:"extraoral",title:"تحلیل خارج دهانی",icon:"solar:user-bold",color:"success"},{key:"radiographic",title:"تحلیل رادیولوژی",icon:"solar:camera-bold",color:"warning"},{key:"cephalometric",title:"تحلیل سفالومتری",icon:"solar:ruler-bold",color:"secondary"},{key:"recommendations",title:"توصیه‌های درمانی",icon:"solar:health-bold",color:"error"}];return!o||o.trim()===""?r.jsxs(j,{sx:{p:4,textAlign:"center",bgcolor:"background.neutral"},children:[r.jsx(l,{icon:"solar:robot-outline",width:64,color:"text.disabled"}),r.jsx(d,{variant:"h6",sx:{mt:2,color:"text.secondary"},children:"هنوز تحلیل AI انجام نشده است"}),r.jsx(d,{variant:"body2",color:"text.secondary",sx:{mt:1},children:'روی دکمه "تحلیل کامل با AI" کلیک کنید تا تشخیص شروع شود'})]}):r.jsxs(c,{spacing:3,children:[t.summary&&r.jsxs(j,{sx:{p:3,border:2,borderColor:"primary.main",bgcolor:"primary.lighter"},children:[r.jsxs(c,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:2},children:[r.jsxs(c,{direction:"row",alignItems:"center",spacing:2,children:[r.jsx(l,{icon:"solar:star-bold",width:28,color:"primary.main"}),r.jsx(d,{variant:"h5",color:"primary.main",fontWeight:700,children:"خلاصه تشخیص AI"})]}),!s&&r.jsx(w,{size:"small",onClick:()=>I("summary",t.summary),sx:{color:"primary.main"},children:r.jsx(l,{icon:"solar:pen-bold",width:20})})]}),r.jsx(d,{variant:"body1",sx:{lineHeight:2,fontSize:"1.1rem"},children:t.summary})]}),t.intraoral&&S(t.intraoral).length>0&&r.jsxs(j,{sx:{p:3,bgcolor:"background.neutral"},children:[r.jsxs(c,{direction:"row",alignItems:"center",spacing:1.5,sx:{mb:2},children:[r.jsx(l,{icon:"solar:flag-bold",width:24,color:"warning.main"}),r.jsx(d,{variant:"h6",fontWeight:600,children:"یافته‌های کلیدی"})]}),r.jsx(c,{direction:"row",flexWrap:"wrap",gap:1,children:S(t.intraoral).map((e,n)=>r.jsx(U,{label:e,size:"medium",color:z(e),variant:"outlined",sx:{fontSize:"0.9rem",py:2.5}},n))})]}),r.jsx(A,{container:!0,spacing:3,children:$.map(e=>{const n=t[e.key];return!n||e.key==="summary"?null:r.jsx(A,{item:!0,xs:12,md:6,children:r.jsx(j,{sx:{p:3,height:"100%",border:1,borderColor:`${e.color}.main`,borderRadius:2,transition:"all 0.3s","&:hover":{boxShadow:`0 8px 24px ${e.color==="primary"?"rgba(0, 123, 255, 0.2)":e.color==="error"?"rgba(255, 0, 0, 0.2)":"rgba(0, 0, 0, 0.1)"}`,transform:"translateY(-4px)"}},children:r.jsxs(c,{spacing:2,children:[r.jsxs(c,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[r.jsxs(c,{direction:"row",alignItems:"center",spacing:1.5,children:[r.jsx(B,{sx:{width:48,height:48,borderRadius:2,bgcolor:`${e.color}.lighter`,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsx(l,{icon:e.icon,width:28,color:`${e.color}.main`})}),r.jsx(d,{variant:"h6",fontWeight:600,color:`${e.color}.darker`,children:e.title})]}),!s&&r.jsx(w,{size:"small",onClick:()=>I(e.key,n),sx:{color:`${e.color}.main`},children:r.jsx(l,{icon:"solar:pen-bold",width:18})})]}),r.jsx(R,{}),r.jsx(d,{variant:"body2",sx:{lineHeight:2,whiteSpace:"pre-wrap",color:"text.secondary",minHeight:100},children:n}),!s&&r.jsx(c,{direction:"row",spacing:1,sx:{pt:1},children:r.jsx(h,{size:"small",variant:"text",startIcon:r.jsx(l,{icon:"solar:copy-bold"}),onClick:()=>navigator.clipboard.writeText(n),sx:{color:"text.secondary"},children:"کپی"})})]})})},e.key)})}),r.jsxs(L,{open:a,onClose:()=>p(!1),maxWidth:"md",fullWidth:!0,children:[r.jsx(F,{children:r.jsxs(c,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[r.jsxs(d,{variant:"h6",children:["ویرایش ",(D=$.find(e=>e.key===C))==null?void 0:D.title]}),r.jsx(w,{onClick:()=>p(!1),children:r.jsx(l,{icon:"solar:close-circle-bold"})})]})}),r.jsxs(G,{children:[r.jsx(H,{severity:"info",sx:{mb:2},children:"شما می‌توانید نتایج AI را ویرایش کنید. تغییرات شما بعد از ذخیره اعمال خواهد شد."}),r.jsx(O,{fullWidth:!0,multiline:!0,rows:12,value:b,onChange:e=>y(e.target.value),placeholder:"متن خود را وارد کنید...",sx:{mt:2}}),r.jsxs(d,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["تعداد کلمات: ",b.split(/\s+/).filter(e=>e.length>0).length]})]}),r.jsxs(P,{children:[r.jsx(h,{onClick:()=>p(!1),children:"انصراف"}),r.jsx(h,{variant:"contained",onClick:W,startIcon:r.jsx(l,{icon:"solar:check-circle-bold"}),children:"ذخیره تغییرات"})]})]}),!s&&r.jsx(j,{sx:{p:2,bgcolor:"background.neutral"},children:r.jsxs(c,{direction:"row",spacing:2,flexWrap:"wrap",children:[r.jsx(h,{variant:"outlined",startIcon:r.jsx(l,{icon:"solar:printer-bold"}),onClick:()=>window.print(),children:"پرینت تحلیل"}),r.jsx(h,{variant:"outlined",startIcon:r.jsx(l,{icon:"solar:export-bold"}),onClick:()=>{const e=k(t),n=new Blob([e],{type:"text/plain"}),E=URL.createObjectURL(n),x=document.createElement("a");x.href=E,x.download="ai-diagnosis.txt",x.click()},children:"دانلود متن"}),r.jsx(h,{variant:"outlined",startIcon:r.jsx(l,{icon:"solar:copy-bold"}),onClick:()=>{const e=k(t);navigator.clipboard.writeText(e)},children:"کپی همه"}),f&&r.jsx(h,{variant:"contained",startIcon:r.jsx(l,{icon:"solar:diskette-bold"}),onClick:f,sx:{ml:"auto !important"},children:"ذخیره نهایی"})]})})]})}V.propTypes={diagnosis:g.string,onUpdate:g.func,onSave:g.func,readOnly:g.bool};export{V as default};
