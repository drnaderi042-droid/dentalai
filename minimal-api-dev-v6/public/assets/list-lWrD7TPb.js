import{k as A,b9 as L,j as s,S as C,aB as Q,L as X,B as F,dd as B,cV as M,o as w,I as x,dl as D,bb as V,bc as b,d as y,r as p,n as Y,h as Z,i as $,dr as ee,dh as R,di as k,dA as v,p as T,e5 as O,bt as se,R as te,cL as oe,v as ae,cK as ne,dq as re,fa as le,H as ie,C as ce}from"./index-BSItzkt3.js";import{U as de}from"./user-quick-edit-form-BnVqhAi0.js";import{C as z}from"./confirm-dialog-DqS9qtsb.js";import{C as he}from"./custom-breadcrumbs-u_kfWYpE.js";import{u as me,g as pe,r as ue,T as xe,e as ge}from"./table-selected-action-0G1slXmy.js";import{T as je}from"./table-no-data-36lSiWIp.js";import{T as be}from"./table-empty-rows-MM8A-hC6.js";import{T as Ce}from"./table-head-custom-Dm2EGBL8.js";import{T as fe}from"./table-pagination-custom-FhZ3GpxG.js";import{T as ve,a as Te,b as we}from"./TableHead-DAuzvg-9.js";import{T as j}from"./TableCell-B7TbLBfh.js";import{C as H}from"./Checkbox-p5PKnry8.js";import{F as Re}from"./FormControl-1z33WGqh.js";import{I as ke}from"./InputLabel-DqZ4yv4U.js";import{S as Pe,O as Se}from"./Select-QPCMlUZ4.js";import{T as Ie}from"./TextField-DpdcsLRb.js";import{F as Ae,a as P,c as S}from"./filters-result-CMxzGTKR.js";import{C as I}from"./Chip-CHY_XJWs.js";import{C as Fe}from"./Card-BqWDE3fr.js";import"./image-BuqYs7tq.js";import"./zod-BOXuI70n.js";import"./form-provider-IFaCVrX4.js";import"./FormHelperText-CBXzj8d7.js";import"./Rating-LRaLudfA.js";import"./visuallyHidden-Dan1xhjv.js";import"./editor-cOR4tKCy.js";import"./Menu-Cy0n4kRw.js";import"./index-DC_o48Ax.js";import"./Slider-B4qW6LuH.js";import"./FormLabel-Dg62SF9b.js";import"./RadioGroup-DuXlXr3g.js";import"./FormGroup-DIAu_15X.js";import"./FormControlLabel-CtXEP1QR.js";import"./index-b5NUrSMh.js";import"./countries-DSLisFCy.js";import"./Autocomplete-B4c-hVbi.js";import"./country-select-B4qFdROS.js";import"./upload-C5NUn5Ko.js";import"./preview-multi-file-C1SdoyfF.js";import"./format-number-BVcmMM5V.js";import"./file-thumbnail-J0C6dV__.js";import"./upload-avatar-DTAGrxFf.js";import"./avatar-url-S8pB8DFh.js";import"./DatePicker-BK0jorBV.js";import"./dialogTitleClasses-BJYaWiXv.js";import"./ListItem-Doeuyi4X.js";import"./DialogContent-CPx_wcNJ.js";import"./MobileDateTimePicker-Baldv5MM.js";import"./schema-helper-DeS_g_Vm.js";import"./LoadingButton-HyVDRRh6.js";import"./DialogTitle-D9mOMHyE.js";import"./empty-content-Cx4hswZg.js";import"./TablePagination-BVQvXhS8.js";import"./LastPage-DHcM-itg.js";function ye({row:e,selected:l,onEditRow:d,onSelectRow:o,onDeleteRow:h}){const m=A(),n=L(),a=A();return s.jsxs(s.Fragment,{children:[s.jsxs(ve,{hover:!0,selected:l,"aria-checked":l,tabIndex:-1,children:[s.jsx(j,{padding:"checkbox",children:s.jsx(H,{id:e.id,checked:l,onClick:o})}),s.jsx(j,{children:s.jsxs(C,{spacing:2,direction:"row",alignItems:"center",children:[s.jsx(Q,{alt:e.name,src:e.avatarUrl}),s.jsxs(C,{sx:{typography:"body2",flex:"1 1 auto",alignItems:"flex-start"},children:[s.jsx(X,{color:"inherit",onClick:d,sx:{cursor:"pointer"},children:e.name}),s.jsx(F,{component:"span",sx:{color:"text.disabled"},children:e.email})]})]})}),s.jsx(j,{sx:{whiteSpace:"nowrap"},children:e.phoneNumber}),s.jsx(j,{sx:{whiteSpace:"nowrap"},children:e.role}),s.jsx(j,{children:s.jsx(B,{variant:"soft",color:e.status==="active"&&"success"||e.status==="pending"&&"warning"||e.status==="banned"&&"error"||"default",children:e.status==="active"?"فعال":e.status==="pending"?"در انتظار":e.status==="banned"?"مسدود":e.status})}),s.jsx(j,{children:s.jsxs(C,{direction:"row",alignItems:"center",children:[s.jsx(M,{title:"ویرایش سریع",placement:"top",arrow:!0,children:s.jsx(w,{color:a.value?"inherit":"default",onClick:a.onTrue,children:s.jsx(x,{icon:"solar:pen-bold"})})}),s.jsx(w,{color:n.open?"inherit":"default",onClick:n.onOpen,children:s.jsx(x,{icon:"eva:more-vertical-fill"})})]})})]}),s.jsx(de,{currentUser:e,open:a.value,onClose:a.onFalse}),s.jsx(D,{open:n.open,anchorEl:n.anchorEl,onClose:n.onClose,slotProps:{arrow:{placement:"right-top"}},children:s.jsxs(V,{children:[s.jsxs(b,{onClick:()=>{m.onTrue(),n.onClose()},sx:{color:"error.main"},children:[s.jsx(x,{icon:"solar:trash-bin-trash-bold"}),"حذف"]}),s.jsxs(b,{onClick:()=>{d(),n.onClose()},children:[s.jsx(x,{icon:"solar:pen-bold"}),"ویرایش"]})]})}),s.jsx(z,{open:m.value,onClose:m.onFalse,title:"حذف",content:"آیا از حذف این کاربر مطمئن هستید؟",action:s.jsx(y,{variant:"contained",color:"error",onClick:h,children:"حذف"})})]})}function Ue({filters:e,options:l,onResetPage:d}){const o=L(),h=p.useCallback(n=>{d(),e.setState({name:n.target.value})},[e,d]),m=p.useCallback(n=>{const a=typeof n.target.value=="string"?n.target.value.split(","):n.target.value;d(),e.setState({role:a})},[e,d]);return s.jsxs(s.Fragment,{children:[s.jsxs(C,{spacing:2,alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5,pr:{xs:2.5,md:1}},children:[s.jsxs(Re,{sx:{flexShrink:0,width:{xs:1,md:200}},children:[s.jsx(ke,{htmlFor:"user-filter-role-select-label",children:"نقش"}),s.jsx(Pe,{multiple:!0,value:e.state.role,onChange:m,input:s.jsx(Se,{label:"نقش"}),renderValue:n=>n.map(a=>({DOCTOR:"دکتر",PATIENT:"بیمار",ADMIN:"ادمین"})[a]||a).join(", "),inputProps:{id:"user-filter-role-select-label"},MenuProps:{PaperProps:{sx:{maxHeight:240}}},IconComponent:()=>null,children:l.roles.map(n=>{const a={DOCTOR:"دکتر",PATIENT:"بیمار",ADMIN:"ادمین"};return s.jsxs(b,{value:n,children:[s.jsx(H,{disableRipple:!0,size:"small",checked:e.state.role.includes(n)}),a[n]||n]},n)})})]}),s.jsxs(C,{direction:"row",alignItems:"center",spacing:2,flexGrow:1,sx:{width:1},children:[s.jsx(Ie,{fullWidth:!0,value:e.state.name,onChange:h,placeholder:"جستجو...",InputProps:{startAdornment:s.jsx(Y,{position:"start",children:s.jsx(x,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),s.jsx(w,{onClick:o.onOpen,children:s.jsx(x,{icon:"eva:more-vertical-fill"})})]})]}),s.jsx(D,{open:o.open,anchorEl:o.anchorEl,onClose:o.onClose,slotProps:{arrow:{placement:"right-top"}},children:s.jsxs(V,{children:[s.jsxs(b,{onClick:()=>{o.onClose()},children:[s.jsx(x,{icon:"solar:printer-minimalistic-bold"}),"چاپ"]}),s.jsxs(b,{onClick:()=>{o.onClose()},children:[s.jsx(x,{icon:"solar:import-bold"}),"وارد کردن"]}),s.jsxs(b,{onClick:()=>{o.onClose()},children:[s.jsx(x,{icon:"solar:export-bold"}),"خروجی گرفتن"]})]})})]})}function Ee({filters:e,onResetPage:l,totalResults:d,sx:o}){const h=p.useCallback(()=>{l(),e.setState({name:""})},[e,l]),m=p.useCallback(()=>{l(),e.setState({status:"all"})},[e,l]),n=p.useCallback(r=>{const c=e.state.role.filter(g=>g!==r);l(),e.setState({role:c})},[e,l]),a=p.useCallback(()=>{l(),e.onResetState()},[e,l]);return s.jsxs(Ae,{totalResults:d,onReset:a,sx:o,children:[s.jsx(P,{label:"وضعیت:",isShow:e.state.status!=="all",children:s.jsx(I,{...S,label:e.state.status==="active"?"فعال":e.state.status==="pending"?"در انتظار":e.state.status==="banned"?"مسدود":e.state.status,onDelete:m})}),s.jsx(P,{label:"نقش:",isShow:!!e.state.role.length,children:e.state.role.map(r=>{const c={DOCTOR:"دکتر",PATIENT:"بیمار",ADMIN:"ادمین"};return p.createElement(I,{...S,key:r,label:c[r]||r,onDelete:()=>n(r)})})}),s.jsx(P,{label:"کلمه کلیدی:",isShow:!!e.state.name,children:s.jsx(I,{...S,label:e.state.name,onDelete:h})})]})}const Ne=[{value:"all",label:"همه"},{value:"active",label:"فعال"},{value:"pending",label:"در انتظار"},{value:"banned",label:"مسدود"}],Oe=["DOCTOR","PATIENT","ADMIN"],Le=[{id:"name",label:"نام"},{id:"phoneNumber",label:"شماره تلفن",width:180},{id:"role",label:"نقش",width:180},{id:"status",label:"وضعیت",width:100},{id:"",width:88}];function Be(){var E;const e=me(),l=Z(),d=A(),{user:o}=$(),[h,m]=p.useState([]),[n,a]=p.useState(!0);p.useEffect(()=>{(async()=>{if(!(o!=null&&o.accessToken)){a(!1);return}try{a(!0);const i=await R.get(k.user.list,{headers:{Authorization:`Bearer ${o.accessToken}`}});console.log("Users API Response:",i.data);const f=(i.data.users||[]).map(u=>{const N=(u.role||"").toUpperCase();return{id:u.id,name:`${u.firstName||""} ${u.lastName||""}`.trim()||u.email,email:u.email,phoneNumber:u.phone||"",role:N==="DOCTOR"?"دکتر":N==="ADMIN"?"ادمین":"بیمار",roleValue:u.role,status:u.status||"active",avatarUrl:u.photoURL||u.avatar||u.avatarUrl||null,isVerified:u.isVerified||!1}});console.log("Transformed Users:",f),m(f),a(!1)}catch(i){console.error("Error fetching users:",i),m([]),a(!1)}})()},[o]);const r=ee({name:"",role:[],status:"all"}),c=Me({inputData:h,comparator:pe(e.order,e.orderBy),filters:r.state}),g=ue(c,e.page,e.rowsPerPage),U=!!r.state.name||r.state.role.length>0||r.state.status!=="all",_=!c.length&&U||!c.length,q=p.useCallback(async t=>{try{await R.delete(k.user.delete(t),{headers:{Authorization:`Bearer ${o==null?void 0:o.accessToken}`}});const i=h.filter(f=>f.id!==t);m(i),v.success("کاربر با موفقیت حذف شد!"),e.onUpdatePageDeleteRow(g.length)}catch(i){console.error("Error deleting user:",i),v.error(i.message||"خطا در حذف کاربر")}},[g.length,e,h,o]),G=p.useCallback(async()=>{try{await Promise.all(e.selected.map(i=>R.delete(k.user.delete(i),{headers:{Authorization:`Bearer ${o==null?void 0:o.accessToken}`}})));const t=h.filter(i=>!e.selected.includes(i.id));m(t),v.success(`${e.selected.length} کاربر با موفقیت حذف شدند!`),e.onUpdatePageDeleteRows({totalRowsInPage:g.length,totalRowsFiltered:c.length})}catch(t){console.error("Error deleting users:",t),v.error(t.message||"خطا در حذف کاربران")}},[c.length,g.length,e,h,o]),K=p.useCallback(t=>{l.push(T.dashboard.user.edit(t))},[l]),W=p.useCallback((t,i)=>{e.onResetPage(),r.setState({status:i})},[r,e]),J=(E=o==null?void 0:o.role)==null?void 0:E.toUpperCase();return!o||J!=="ADMIN"?(l.push("/dashboard"),null):n?s.jsx(O,{children:s.jsx(F,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:s.jsx(se,{})})}):s.jsxs(s.Fragment,{children:[s.jsxs(O,{children:[s.jsx(he,{heading:"لیست کاربران",links:[{name:"داشبورد",href:T.dashboard.root},{name:"کاربران",href:T.dashboard.user.root},{name:"لیست"}],action:s.jsx(y,{component:te,href:T.dashboard.user.new,variant:"contained",startIcon:s.jsx(x,{icon:"mingcute:add-line"}),children:"کاربر جدید"}),sx:{mb:{xs:3,md:5}}}),s.jsxs(Fe,{children:[s.jsx(oe,{value:r.state.status,onChange:W,sx:{px:2.5,boxShadow:t=>`inset 0 -2px 0 0 ${ae(t.vars.palette.grey["500Channel"],.08)}`},children:Ne.map(t=>s.jsx(ne,{iconPosition:"end",value:t.value,label:t.label,icon:s.jsx(B,{variant:(t.value==="all"||t.value===r.state.status)&&"filled"||"soft",color:t.value==="active"&&"success"||t.value==="pending"&&"warning"||t.value==="banned"&&"error"||"default",children:["active","pending","banned"].includes(t.value)?h.filter(i=>i.status===t.value).length:h.length})},t.value))}),s.jsx(Ue,{filters:r,onResetPage:e.onResetPage,options:{roles:Oe}}),U&&s.jsx(Ee,{filters:r,totalResults:c.length,onResetPage:e.onResetPage,sx:{p:2.5,pt:0}}),s.jsxs(F,{sx:{position:"relative"},children:[s.jsx(xe,{dense:e.dense,numSelected:e.selected.length,rowCount:c.length,onSelectAllRows:t=>e.onSelectAllRows(t,c.map(i=>i.id)),action:s.jsx(M,{title:"حذف",children:s.jsx(w,{color:"primary",onClick:d.onTrue,children:s.jsx(x,{icon:"solar:trash-bin-trash-bold"})})})}),s.jsx(re,{children:s.jsxs(Te,{size:e.dense?"small":"medium",sx:{minWidth:960},children:[s.jsx(Ce,{order:e.order,orderBy:e.orderBy,headLabel:Le,rowCount:c.length,numSelected:e.selected.length,onSort:e.onSort,onSelectAllRows:t=>e.onSelectAllRows(t,c.map(i=>i.id))}),s.jsxs(we,{children:[c.slice(e.page*e.rowsPerPage,e.page*e.rowsPerPage+e.rowsPerPage).map(t=>s.jsx(ye,{row:t,selected:e.selected.includes(t.id),onSelectRow:()=>e.onSelectRow(t.id),onDeleteRow:()=>q(t.id),onEditRow:()=>K(t.id)},t.id)),s.jsx(be,{height:e.dense?56:76,emptyRows:ge(e.page,e.rowsPerPage,c.length)}),s.jsx(je,{notFound:_})]})]})})]}),s.jsx(fe,{page:e.page,dense:e.dense,count:c.length,rowsPerPage:e.rowsPerPage,onPageChange:e.onChangePage,onChangeDense:e.onChangeDense,onRowsPerPageChange:e.onChangeRowsPerPage})]})]}),s.jsx(z,{open:d.value,onClose:d.onFalse,title:"حذف",content:s.jsxs(s.Fragment,{children:["آیا از حذف ",s.jsxs("strong",{children:[" ",e.selected.length," "]})," کاربر مطمئن هستید؟"]}),action:s.jsx(y,{variant:"contained",color:"error",onClick:()=>{G(),d.onFalse()},children:"حذف"})})]})}function Me({inputData:e,comparator:l,filters:d}){const{name:o,status:h,role:m}=d,n=e.map((a,r)=>[a,r]);return n.sort((a,r)=>{const c=l(a[0],r[0]);return c!==0?c:a[1]-r[1]}),e=n.map(a=>a[0]),o&&(e=e.filter(a=>a.name.toLowerCase().indexOf(o.toLowerCase())!==-1||a.email.toLowerCase().indexOf(o.toLowerCase())!==-1)),h!=="all"&&(e=e.filter(a=>a.status===h)),m.length&&(e=e.filter(a=>m.includes(a.roleValue))),e}const De={title:`لیست کاربران | داشبورد - ${ce.site.name}`};function Vs(){var d;const{user:e}=$(),l=(d=e==null?void 0:e.role)==null?void 0:d.toUpperCase();return!e||l!=="ADMIN"?s.jsx(le,{to:"/dashboard",replace:!0}):s.jsxs(s.Fragment,{children:[s.jsx(ie,{children:s.jsxs("title",{children:[" ",De.title]})}),s.jsx(Be,{})]})}export{Vs as default};
