import{i as Te,dg as ve,r as o,j as e,e5 as _,e as K,B as u,bt as Ce,T as n,S as O,I as g,o as z,dW as De,aB as q,v as Pe,C as ie,aK as we,ar as Ne,aC as Ee,cV as J,cI as Q,d as j,bc as D,dh as f,di as b,H as Ie}from"./index-BSItzkt3.js";import{u as X,a as Y,F as l}from"./form-provider-IFaCVrX4.js";import{g as Z}from"./url-helpers-DK-EJxWr.js";import{I as Se}from"./image-BuqYs7tq.js";import"./editor-cOR4tKCy.js";import{C as $e}from"./confirm-dialog-DqS9qtsb.js";import{T as Ae,a as ee}from"./ToggleButtonGroup-Dsynh9XZ.js";import{G as i}from"./Grid-BaG8uD1u.js";import{C as ke}from"./Card-BqWDE3fr.js";import{T as Re}from"./TableContainer-BOBiasNg.js";import{a as Oe,c as ze,T as P,b as Be}from"./TableHead-DAuzvg-9.js";import{T as c}from"./TableCell-B7TbLBfh.js";import{C as Le}from"./Chip-CHY_XJWs.js";import{T as Me}from"./TablePagination-BVQvXhS8.js";import{D as te}from"./DialogTitle-D9mOMHyE.js";import{D as se}from"./DialogContent-CPx_wcNJ.js";import{D as re}from"./dialogTitleClasses-BJYaWiXv.js";import"./TextField-DpdcsLRb.js";import"./Select-QPCMlUZ4.js";import"./Menu-Cy0n4kRw.js";import"./InputLabel-DqZ4yv4U.js";import"./FormLabel-Dg62SF9b.js";import"./FormHelperText-CBXzj8d7.js";import"./FormControl-1z33WGqh.js";import"./Rating-LRaLudfA.js";import"./visuallyHidden-Dan1xhjv.js";import"./Slider-B4qW6LuH.js";import"./RadioGroup-DuXlXr3g.js";import"./FormGroup-DIAu_15X.js";import"./FormControlLabel-CtXEP1QR.js";import"./index-b5NUrSMh.js";import"./countries-DSLisFCy.js";import"./Autocomplete-B4c-hVbi.js";import"./country-select-B4qFdROS.js";import"./Checkbox-p5PKnry8.js";import"./upload-C5NUn5Ko.js";import"./preview-multi-file-C1SdoyfF.js";import"./format-number-BVcmMM5V.js";import"./file-thumbnail-J0C6dV__.js";import"./upload-avatar-DTAGrxFf.js";import"./avatar-url-S8pB8DFh.js";import"./DatePicker-BK0jorBV.js";import"./ListItem-Doeuyi4X.js";import"./MobileDateTimePicker-Baldv5MM.js";import"./index-DC_o48Ax.js";import"./LastPage-DHcM-itg.js";const ae={PENDING:"شروع درمان",IN_TREATMENT:"در حال درمان",COMPLETED:"اتمام درمان",CANCELLED:"متوقف شده"};function Ve(){const{user:a}=Te(),y=ve(),[x,h]=o.useState([]),[w,B]=o.useState(!0),[N,E]=o.useState(null),[ne,L]=o.useState(!1),[oe,M]=o.useState(!1),[le,V]=o.useState(!1),[F,G]=o.useState(null),[d,W]=o.useState(null),[I,ce]=o.useState("card"),[S,H]=o.useState(0),[T,de]=o.useState(10),v=X({defaultValues:{firstName:"",age:""}}),C=X({defaultValues:{firstName:"",lastName:"",phone:"",age:"",diagnosis:"",treatment:"",status:"PENDING",notes:"",nextVisitTime:null,treatmentStartDate:null}});o.useEffect(()=>{a&&(async()=>{var s,r;try{B(!0);const je=((await f.get(b.patients,{headers:{Authorization:`Bearer ${a==null?void 0:a.accessToken}`}})).data.patients||[]).filter(p=>p.specialty==="PERIODONTICS"),fe=await Promise.all(je.map(async p=>{try{const k=(await f.get(`${b.patients}/${p.id}/images`,{headers:{Authorization:`Bearer ${a==null?void 0:a.accessToken}`}})).data.images||[],ye=k.find(R=>R.category==="profile")||k.find(R=>R.category==="frontal");return{...p,images:k,profileImage:ye||null}}catch{return{...p,images:[],profileImage:null}}}));h(fe),E(null)}catch(m){console.error("Error fetching patients:",m),((s=m.response)==null?void 0:s.status)!==200&&((r=m.response)==null?void 0:r.status)!==404?E("خطا در بارگیری بیماران"):E(null),h([])}finally{B(!1)}})()},[a]);const me=()=>{v.reset({firstName:"",age:""}),L(!0)},$=()=>{L(!1),v.reset()},xe=t=>{G(t),C.reset({firstName:t.firstName,lastName:t.lastName,phone:t.phone,age:t.age,diagnosis:t.diagnosis,treatment:t.treatment,status:t.status,notes:t.notes||"",nextVisitTime:t.nextVisitTime?new Date(t.nextVisitTime):null,treatmentStartDate:t.treatmentStartDate?new Date(t.treatmentStartDate):null}),M(!0)},A=()=>{M(!1),G(null),C.reset()},he=t=>{W(t),V(!0)},U=()=>{V(!1),W(null)},pe=async t=>{try{const s=await f.post(b.patients,{...t,lastName:"-",phone:"-",diagnosis:"-",treatment:"-",specialty:"PERIODONTICS"},{headers:{Authorization:`Bearer ${a==null?void 0:a.accessToken}`}});h(r=>[...r,s.data.patient]),$()}catch(s){console.error("Error adding patient:",s),alert("خطا در افزودن بیمار")}},ue=async t=>{try{const s=await f.put(`${b.patients}/${F.id}`,t,{headers:{Authorization:`Bearer ${a==null?void 0:a.accessToken}`}});h(r=>r.map(m=>m.id===F.id?s.data.patient:m)),A()}catch(s){console.error("Error updating patient:",s),alert("خطا در بروزرسانی بیمار")}},ge=async t=>{try{await f.delete(`${b.patients}/${t}`,{headers:{Authorization:`Bearer ${a==null?void 0:a.accessToken}`}}),h(s=>s.filter(r=>r.id!==t))}catch(s){console.error("Error deleting patient:",s),alert("خطا در حذف بیمار")}};return w?e.jsx(_,{children:e.jsx(K,{children:e.jsx(u,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsx(Ce,{})})})}):e.jsx(_,{children:e.jsxs(K,{children:[e.jsxs(u,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(n,{variant:"h4",children:"بخش پریودونتیکس"}),e.jsxs(O,{direction:"row",spacing:1,alignItems:"center",children:[e.jsxs(Ae,{value:I,exclusive:!0,onChange:(t,s)=>{s!==null&&ce(s)},size:"small",color:"primary",children:[e.jsx(ee,{value:"card",children:e.jsx(g,{icon:"solar:widget-2-bold",width:20})}),e.jsx(ee,{value:"table",children:e.jsx(g,{icon:"solar:list-bold",width:20})})]}),e.jsx(z,{onClick:me,sx:{borderRadius:"50%",width:40,height:40,padding:0,display:"inline-flex",alignItems:"center",justifyContent:"center"},"aria-label":"add-patient",children:e.jsx(g,{icon:"mingcute:add-line"})})]})]}),N&&e.jsx(n,{variant:"body1",color:"error",sx:{mb:4},children:N}),!N&&!w&&x.length===0&&e.jsxs(u,{sx:{textAlign:"center",py:8},children:[e.jsx(n,{variant:"h6",color:"text.secondary",sx:{mb:2},children:"هیچ بیماری یافت نشد"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"برای افزودن بیمار جدید، روی دکمه + کلیک کنید"})]}),I==="card"&&e.jsx(i,{container:!0,spacing:3,children:x.map(t=>{const{profileImage:s}=t;return e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(ke,{sx:{textAlign:"center",cursor:"pointer"},role:"button",tabIndex:0,onClick:()=>{y(`/dashboard/periodontics/patient/${t.id}`)},onKeyDown:r=>{r.key==="Enter"&&y(`/dashboard/periodontics/patient/${t.id}`)},children:[e.jsxs(u,{sx:{position:"relative"},children:[e.jsx(De,{sx:{left:0,right:0,zIndex:10,mx:"auto",bottom:-26,position:"absolute"}}),e.jsx(q,{alt:t.firstName,src:s?Z(s.path):void 0,sx:{width:64,height:64,zIndex:11,left:0,right:0,bottom:-32,mx:"auto",position:"absolute",cursor:"pointer"},onClick:r=>{r.stopPropagation(),y(`/dashboard/periodontics/patient/${t.id}`)}}),e.jsx(Se,{src:`${ie.site.serverUrl}/assets/images/cover/cover-2.webp`,alt:"Card cover",ratio:"16/9",slotProps:{overlay:{background:r=>Pe(r.vars.palette.grey["900Channel"],.48)}},sx:{height:180,borderRadius:0}})]}),e.jsx(we,{sx:{mt:7,mb:1},primary:`${t.firstName} ${t.lastName||""}`,primaryTypographyProps:{typography:"subtitle1"},secondaryTypographyProps:{component:"span",mt:.5}}),e.jsx(Ne,{sx:{borderStyle:"dashed"}}),e.jsxs(u,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",sx:{py:3,typography:"subtitle1"},children:[e.jsxs("div",{children:[e.jsx(n,{variant:"caption",component:"div",sx:{mb:.5,color:"text.secondary"},children:"سن"}),t.age||"-"]}),e.jsxs("div",{children:[e.jsx(n,{variant:"caption",component:"div",sx:{mb:.5,color:"text.secondary"},children:"وضعیت"}),e.jsx(n,{variant:"caption",sx:{fontSize:"0.7rem !important"},children:ae[t.status]||"مشخص نشده"})]}),e.jsxs("div",{children:[e.jsx(n,{variant:"caption",component:"div",sx:{mb:.5,color:"text.secondary"},children:"تاریخ افزودن"}),e.jsx(n,{variant:"caption",sx:{fontSize:"0.7rem !important"},children:new Date(t.createdAt).toLocaleDateString("fa-IR")})]})]})]})},t.id)})}),I==="table"&&e.jsxs(Ee,{sx:{width:"100%",borderRadius:"16px",overflow:"hidden"},children:[e.jsx(Re,{children:e.jsxs(Oe,{children:[e.jsx(ze,{children:e.jsxs(P,{sx:{bgcolor:"background.neutral"},children:[e.jsx(c,{children:"نام بیمار"}),e.jsx(c,{children:"وضعیت"}),e.jsx(c,{children:"تاریخ ثبت"}),e.jsx(c,{align:"center",children:"عملیات"})]})}),e.jsx(Be,{children:w?e.jsx(P,{children:e.jsx(c,{colSpan:4,align:"center",sx:{py:3},children:e.jsx(n,{variant:"body2",children:"در حال بارگیری..."})})}):x.length===0?e.jsx(P,{children:e.jsx(c,{colSpan:4,align:"center",sx:{py:3},children:e.jsx(n,{variant:"body2",children:"بیماری یافت نشد"})})}):x.slice(S*T,S*T+T).map(t=>{const{profileImage:s}=t;return e.jsxs(P,{hover:!0,sx:{cursor:"pointer"},onClick:()=>{y(`/dashboard/periodontics/patient/${t.id}`)},children:[e.jsx(c,{children:e.jsxs(O,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(q,{src:s?Z(s.path):void 0,sx:{width:32,height:32},children:t.firstName[0]}),e.jsx(n,{variant:"body2",children:`${t.firstName} ${t.lastName||""}`})]})}),e.jsx(c,{children:e.jsx(Le,{label:ae[t.status]||"مشخص نشده",size:"small",color:t.status==="IN_TREATMENT"?"primary":t.status==="COMPLETED"?"success":t.status==="CANCELLED"?"error":"default",sx:{fontSize:"0.75rem"}})}),e.jsx(c,{children:e.jsx(n,{variant:"caption",children:new Date(t.createdAt).toLocaleDateString("fa-IR")})}),e.jsx(c,{align:"center",children:e.jsxs(O,{direction:"row",spacing:.5,justifyContent:"center",children:[e.jsx(J,{title:"ویرایش",children:e.jsx(z,{size:"small",onClick:r=>{r.stopPropagation(),xe(t)},children:e.jsx(g,{icon:"solar:pen-bold",width:18})})}),e.jsx(J,{title:"حذف",children:e.jsx(z,{size:"small",color:"error",onClick:r=>{r.stopPropagation(),he(t)},children:e.jsx(g,{icon:"solar:trash-bin-trash-bold",width:18})})})]})})]},t.id)})})]})}),e.jsx(Me,{component:"div",count:x.length,page:S,onPageChange:(t,s)=>H(s),rowsPerPage:T,onRowsPerPageChange:t=>{de(parseInt(t.target.value,10)),H(0)},rowsPerPageOptions:[5,10,25,50],labelRowsPerPage:"تعداد ردیف در صفحه:",labelDisplayedRows:({from:t,to:s,count:r})=>`${t}-${s} از ${r}`})]}),e.jsxs(Q,{open:ne,onClose:$,maxWidth:"sm",fullWidth:!0,children:[e.jsx(te,{children:"افزودن بیمار جدید"}),e.jsxs(Y,{methods:v,onSubmit:v.handleSubmit(pe),children:[e.jsx(se,{children:e.jsxs(i,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(i,{item:!0,xs:12,children:e.jsx(l.Text,{name:"firstName",label:"نام"})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(l.Text,{name:"age",label:"سن",type:"number"})})]})}),e.jsxs(re,{children:[e.jsx(j,{onClick:$,children:"انصراف"}),e.jsx(j,{type:"submit",variant:"contained",children:"افزودن بیمار"})]})]})]}),e.jsxs(Q,{open:oe,onClose:A,maxWidth:"md",fullWidth:!0,children:[e.jsx(te,{children:"ویرایش بیمار"}),e.jsxs(Y,{methods:C,onSubmit:C.handleSubmit(ue),children:[e.jsx(se,{children:e.jsxs(i,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(l.Text,{name:"firstName",label:"نام"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(l.Text,{name:"lastName",label:"نام خانوادگی"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(l.Text,{name:"phone",label:"شماره تلفن"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(l.Text,{name:"age",label:"سن",type:"number"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(l.DatePicker,{name:"treatmentStartDate",label:"تاریخ شروع درمان"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(l.DatePicker,{name:"nextVisitTime",label:"تایم ویزیت بعدی"})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(l.Text,{name:"diagnosis",label:"تشخیص",multiline:!0,rows:2})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(l.Text,{name:"treatment",label:"طرح درمان",multiline:!0,rows:2})}),e.jsx(i,{item:!0,xs:12,children:e.jsxs(l.Select,{name:"status",label:"وضعیت",children:[e.jsx(D,{value:"PENDING",children:"شروع درمان"}),e.jsx(D,{value:"IN_TREATMENT",children:"در حال درمان"}),e.jsx(D,{value:"COMPLETED",children:"اتمام درمان"}),e.jsx(D,{value:"CANCELLED",children:"متوقف شده"})]})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(l.Text,{name:"notes",label:"یادداشت ها",multiline:!0,rows:3})})]})}),e.jsxs(re,{children:[e.jsx(j,{onClick:A,children:"انصراف"}),e.jsx(j,{type:"submit",variant:"contained",children:"بروزرسانی"})]})]})]}),e.jsx($e,{open:le,onClose:U,title:"حذف بیمار",content:`آیا از حذف بیمار "${d==null?void 0:d.firstName} ${(d==null?void 0:d.lastName)||""}" مطمئن هستید؟`,action:e.jsx(j,{variant:"contained",color:"error",onClick:async()=>{d&&await ge(d.id),U()},children:"حذف"})})]})})}const Fe={title:`پریودونتیکس | ${ie.site.name}`};function Rt(){return e.jsxs(e.Fragment,{children:[e.jsx(Ie,{children:e.jsx("title",{children:Fe.title})}),e.jsx(Ve,{})]})}export{Rt as default};
