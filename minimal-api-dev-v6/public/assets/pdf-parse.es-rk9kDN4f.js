var Hv=Object.defineProperty;var Yp=c=>{throw TypeError(c)};var $v=(c,e,t)=>e in c?Hv(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var M=(c,e,t)=>$v(c,typeof e!="symbol"?e+"":e,t),Vu=(c,e,t)=>e.has(c)||Yp("Cannot "+t);var r=(c,e,t)=>(Vu(c,e,"read from private field"),t?t.call(c):e.get(c)),y=(c,e,t)=>e.has(c)?Yp("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(c):e.set(c,t),g=(c,e,t,s)=>(Vu(c,e,"write to private field"),s?s.call(c,t):e.set(c,t),t),w=(c,e,t)=>(Vu(c,e,"access private method"),t);var he=(c,e,t,s)=>({set _(i){g(c,e,i,t)},get _(){return r(c,e,s)}});var Cg=c=>{throw TypeError(c)},Tp=(c,e,t)=>e.has(c)||Cg("Cannot "+t),Ht=(c,e,t)=>(Tp(c,e,"read from private field"),t?t.call(c):e.get(c)),En=(c,e,t)=>e.has(c)?Cg("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(c):e.set(c,t),Ss=(c,e,t,s)=>(Tp(c,e,"write to private field"),e.set(c,t),t),Sn=(c,e,t)=>(Tp(c,e,"access private method"),t),jv=(c,e,t,s)=>({set _(i){Ss(c,e,i)},get _(){return Ht(c,e,s)}}),Wa,ki,Tr,po,Cp,Hl,oo,ii,Fu,Pg,Rg,Kl,mh,Qd,zv={34:(c,e,t)=>{var s=t(4901);c.exports=function(i){return typeof i=="object"?i!==null:s(i)}},81:(c,e,t)=>{var s=t(9565),i=t(9306),n=t(8551),a=t(6823),o=t(851),l=TypeError;c.exports=function(h,d){var u=arguments.length<2?o(h):d;if(i(u))return n(s(u,h));throw new l(a(h)+" is not iterable")}},116:(c,e,t)=>{var s=t(6518),i=t(9565),n=t(2652),a=t(9306),o=t(8551),l=t(1767),h=t(9539),d=t(4549),u=d("find",TypeError);s({target:"Iterator",proto:!0,real:!0,forced:u},{find:function(p){o(this);try{a(p)}catch(A){h(this,"throw",A)}if(u)return i(u,this,p);var m=l(this),v=0;return n(m,function(A,b){if(p(A,v++))return b(A)},{IS_RECORD:!0,INTERRUPTED:!0}).result}})},283:(c,e,t)=>{var s=t(9504),i=t(9039),n=t(4901),a=t(9297),o=t(3724),l=t(350).CONFIGURABLE,h=t(3706),d=t(1181),u=d.enforce,f=d.get,p=String,m=Object.defineProperty,v=s("".slice),A=s("".replace),b=s([].join),S=o&&!i(function(){return m(function(){},"length",{value:8}).length!==8}),E=String(String).split("String"),T=c.exports=function(x,C,P){v(p(C),0,7)==="Symbol("&&(C="["+A(p(C),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),P&&P.getter&&(C="get "+C),P&&P.setter&&(C="set "+C),(!a(x,"name")||l&&x.name!==C)&&(o?m(x,"name",{value:C,configurable:!0}):x.name=C),S&&P&&a(P,"arity")&&x.length!==P.arity&&m(x,"length",{value:P.arity});try{P&&a(P,"constructor")&&P.constructor?o&&m(x,"prototype",{writable:!1}):x.prototype&&(x.prototype=void 0)}catch{}var I=u(x);return a(I,"source")||(I.source=b(E,typeof C=="string"?C:"")),x};Function.prototype.toString=T(function(){return n(this)&&f(this).source||h(this)},"toString")},350:(c,e,t)=>{var s=t(3724),i=t(9297),n=Function.prototype,a=s&&Object.getOwnPropertyDescriptor,o=i(n,"name"),l=o&&(function(){}).name==="something",h=o&&(!s||s&&a(n,"name").configurable);c.exports={EXISTS:o,PROPER:l,CONFIGURABLE:h}},397:(c,e,t)=>{var s=t(7751);c.exports=s("document","documentElement")},421:c=>{c.exports={}},456:(c,e,t)=>{var s=t(6518),i=t(4576),n=t(9504),a=t(4154),o=t(5169),l=n(1.1.toString),h=i.Uint8Array,d=!h||!h.prototype.toHex||!function(){try{var u=new h([255,255,255,255,255,255,255,255]);return u.toHex()==="ffffffffffffffff"}catch{return!1}}();h&&s({target:"Uint8Array",proto:!0,forced:d},{toHex:function(){a(this),o(this.buffer);for(var f="",p=0,m=this.length;p<m;p++){var v=l(this[p],16);f+=v.length===1?"0"+v:v}return f}})},507:(c,e,t)=>{var s=t(9565);c.exports=function(i,n,a){for(var o=a?i:i.iterator,l=i.next,h,d;!(h=s(l,o)).done;)if(d=n(h.value),d!==void 0)return d}},531:(c,e,t)=>{var s=t(6518),i=t(9565),n=t(9306),a=t(8551),o=t(1767),l=t(8646),h=t(9462),d=t(9539),u=t(6395),f=t(684),p=t(4549),m=!u&&!f("flatMap",function(){}),v=!u&&!m&&p("flatMap",TypeError),A=u||m||v,b=h(function(){for(var S=this.iterator,E=this.mapper,T,x;;){if(x=this.inner)try{if(T=a(i(x.next,x.iterator)),!T.done)return T.value;this.inner=null}catch(C){d(S,"throw",C)}if(T=a(i(this.next,S)),this.done=!!T.done)return;try{this.inner=l(E(T.value,this.counter++),!1)}catch(C){d(S,"throw",C)}}});s({target:"Iterator",proto:!0,real:!0,forced:A},{flatMap:function(E){a(this);try{n(E)}catch(T){d(this,"throw",T)}return v?i(v,this,E):new b(o(this),{mapper:E,inner:null})}})},616:(c,e,t)=>{var s=t(9039);c.exports=!s(function(){var i=(function(){}).bind();return typeof i!="function"||i.hasOwnProperty("prototype")})},655:(c,e,t)=>{var s=t(6955),i=String;c.exports=function(n){if(s(n)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return i(n)}},679:(c,e,t)=>{var s=t(1625),i=TypeError;c.exports=function(n,a){if(s(a,n))return n;throw new i("Incorrect invocation")}},684:c=>{c.exports=function(e,t){var s=typeof Iterator=="function"&&Iterator.prototype[e];if(s)try{s.call({next:null},t).next()}catch{return!0}}},741:c=>{var e=Math.ceil,t=Math.floor;c.exports=Math.trunc||function(i){var n=+i;return(n>0?t:e)(n)}},757:(c,e,t)=>{var s=t(7751),i=t(4901),n=t(1625),a=t(7040),o=Object;c.exports=a?function(l){return typeof l=="symbol"}:function(l){var h=s("Symbol");return i(h)&&n(h.prototype,o(l))}},851:(c,e,t)=>{var s=t(6955),i=t(5966),n=t(4117),a=t(6269),o=t(8227),l=o("iterator");c.exports=function(h){if(!n(h))return i(h,l)||i(h,"@@iterator")||a[s(h)]}},944:c=>{var e=TypeError;c.exports=function(t){var s=t&&t.alphabet;if(s===void 0||s==="base64"||s==="base64url")return s||"base64";throw new e("Incorrect `alphabet` option")}},1072:(c,e,t)=>{var s=t(1828),i=t(8727);c.exports=Object.keys||function(a){return s(a,i)}},1103:c=>{c.exports=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}}},1108:(c,e,t)=>{var s=t(6955);c.exports=function(i){var n=s(i);return n==="BigInt64Array"||n==="BigUint64Array"}},1148:(c,e,t)=>{var s=t(6518),i=t(9565),n=t(2652),a=t(9306),o=t(8551),l=t(1767),h=t(9539),d=t(4549),u=d("every",TypeError);s({target:"Iterator",proto:!0,real:!0,forced:u},{every:function(p){o(this);try{a(p)}catch(A){h(this,"throw",A)}if(u)return i(u,this,p);var m=l(this),v=0;return!n(m,function(A,b){if(!p(A,v++))return b()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},1181:(c,e,t)=>{var s=t(8622),i=t(4576),n=t(34),a=t(6699),o=t(9297),l=t(7629),h=t(6119),d=t(421),u="Object already initialized",f=i.TypeError,p=i.WeakMap,m,v,A,b=function(x){return A(x)?v(x):m(x,{})},S=function(x){return function(C){var P;if(!n(C)||(P=v(C)).type!==x)throw new f("Incompatible receiver, "+x+" required");return P}};if(s||l.state){var E=l.state||(l.state=new p);E.get=E.get,E.has=E.has,E.set=E.set,m=function(x,C){if(E.has(x))throw new f(u);return C.facade=x,E.set(x,C),C},v=function(x){return E.get(x)||{}},A=function(x){return E.has(x)}}else{var T=h("state");d[T]=!0,m=function(x,C){if(o(x,T))throw new f(u);return C.facade=x,a(x,T,C),C},v=function(x){return o(x,T)?x[T]:{}},A=function(x){return o(x,T)}}c.exports={set:m,get:v,has:A,enforce:b,getterFor:S}},1291:(c,e,t)=>{var s=t(741);c.exports=function(i){var n=+i;return n!==n||n===0?0:s(n)}},1385:(c,e,t)=>{var s=t(9539);c.exports=function(i,n,a){for(var o=i.length-1;o>=0;o--)if(i[o]!==void 0)try{a=s(i[o].iterator,n,a)}catch(l){n="throw",a=l}if(n==="throw")throw a;return a}},1548:(c,e,t)=>{var s=t(4576),i=t(9039),n=t(9519),a=t(4215),o=s.structuredClone;c.exports=!!o&&!i(function(){if(a==="DENO"&&n>92||a==="NODE"&&n>94||a==="BROWSER"&&n>97)return!1;var l=new ArrayBuffer(8),h=o(l,{transfer:[l]});return l.byteLength!==0||h.byteLength!==8})},1549:(c,e,t)=>{t(6632)},1625:(c,e,t)=>{var s=t(9504);c.exports=s({}.isPrototypeOf)},1689:(c,e,t)=>{var s=t(6518),i=t(4576),n=t(8745),a=t(7680),o=t(6043),l=t(9306),h=t(1103),d=i.Promise,u=!1,f=!d||!d.try||h(function(){d.try(function(p){u=p===8},8)}).error||!u;s({target:"Promise",stat:!0,forced:f},{try:function(p){var m=arguments.length>1?a(arguments,1):[],v=o.f(this),A=h(function(){return n(l(p),void 0,m)});return(A.error?v.reject:v.resolve)(A.value),v.promise}})},1698:(c,e,t)=>{var s=t(6518),i=t(4204),n=t(9835),a=t(4916),o=!a("union")||!n("union");s({target:"Set",proto:!0,real:!0,forced:o},{union:i})},1701:(c,e,t)=>{var s=t(6518),i=t(9565),n=t(9306),a=t(8551),o=t(1767),l=t(9462),h=t(6319),d=t(9539),u=t(684),f=t(4549),p=t(6395),m=!p&&!u("map",function(){}),v=!p&&!m&&f("map",TypeError),A=p||m||v,b=l(function(){var S=this.iterator,E=a(i(this.next,S)),T=this.done=!!E.done;if(!T)return h(S,this.mapper,[E.value,this.counter++],!0)});s({target:"Iterator",proto:!0,real:!0,forced:A},{map:function(E){a(this);try{n(E)}catch(T){d(this,"throw",T)}return v?i(v,this,E):new b(o(this),{mapper:E})}})},1767:c=>{c.exports=function(e){return{iterator:e,next:e.next,done:!1}}},1828:(c,e,t)=>{var s=t(9504),i=t(9297),n=t(5397),a=t(9617).indexOf,o=t(421),l=s([].push);c.exports=function(h,d){var u=n(h),f=0,p=[],m;for(m in u)!i(o,m)&&i(u,m)&&l(p,m);for(;d.length>f;)i(u,m=d[f++])&&(~a(p,m)||l(p,m));return p}},2106:(c,e,t)=>{var s=t(283),i=t(4913);c.exports=function(n,a,o){return o.get&&s(o.get,a,{getter:!0}),o.set&&s(o.set,a,{setter:!0}),i.f(n,a,o)}},2140:(c,e,t)=>{var s=t(8227),i=s("toStringTag"),n={};n[i]="z",c.exports=String(n)==="[object z]"},2195:(c,e,t)=>{var s=t(9504),i=s({}.toString),n=s("".slice);c.exports=function(a){return n(i(a),8,-1)}},2211:(c,e,t)=>{var s=t(9039);c.exports=!s(function(){function i(){}return i.prototype.constructor=null,Object.getPrototypeOf(new i)!==i.prototype})},2303:(c,e,t)=>{var s=t(4576),i=t(9504),n=s.Uint8Array,a=s.SyntaxError,o=s.parseInt,l=Math.min,h=/[^\da-f]/i,d=i(h.exec),u=i("".slice);c.exports=function(f,p){var m=f.length;if(m%2!==0)throw new a("String should be an even number of characters");for(var v=p?l(p.length,m/2):m/2,A=p||new n(v),b=0,S=0;S<v;){var E=u(f,b,b+=2);if(d(h,E))throw new a("String should only contain hex characters");A[S++]=o(E,16)}return{bytes:A,read:b}}},2360:(c,e,t)=>{var s=t(8551),i=t(6801),n=t(8727),a=t(421),o=t(397),l=t(4055),h=t(6119),d=">",u="<",f="prototype",p="script",m=h("IE_PROTO"),v=function(){},A=function(x){return u+p+d+x+u+"/"+p+d},b=function(x){x.write(A("")),x.close();var C=x.parentWindow.Object;return x=null,C},S=function(){var x=l("iframe"),C="java"+p+":",P;return x.style.display="none",o.appendChild(x),x.src=String(C),P=x.contentWindow.document,P.open(),P.write(A("document.F=Object")),P.close(),P.F},E,T=function(){try{E=new ActiveXObject("htmlfile")}catch{}T=typeof document<"u"?document.domain&&E?b(E):S():b(E);for(var x=n.length;x--;)delete T[f][n[x]];return T()};a[m]=!0,c.exports=Object.create||function(C,P){var I;return C!==null?(v[f]=s(C),I=new v,v[f]=null,I[m]=C):I=T(),P===void 0?I:i.f(I,P)}},2475:(c,e,t)=>{var s=t(6518),i=t(8527),n=t(4916),a=!n("isSupersetOf",function(o){return!o});s({target:"Set",proto:!0,real:!0,forced:a},{isSupersetOf:i})},2489:(c,e,t)=>{var s=t(6518),i=t(9565),n=t(9306),a=t(8551),o=t(1767),l=t(9462),h=t(6319),d=t(6395),u=t(9539),f=t(684),p=t(4549),m=!d&&!f("filter",function(){}),v=!d&&!m&&p("filter",TypeError),A=d||m||v,b=l(function(){for(var S=this.iterator,E=this.predicate,T=this.next,x,C,P;;){if(x=a(i(T,S)),C=this.done=!!x.done,C)return;if(P=x.value,h(S,E,[P,this.counter++],!0))return P}});s({target:"Iterator",proto:!0,real:!0,forced:A},{filter:function(E){a(this);try{n(E)}catch(T){u(this,"throw",T)}return v?i(v,this,E):new b(o(this),{predicate:E})}})},2529:c=>{c.exports=function(e,t){return{value:e,done:t}}},2603:(c,e,t)=>{var s=t(655);c.exports=function(i,n){return i===void 0?arguments.length<2?"":n:s(i)}},2652:(c,e,t)=>{var s=t(6080),i=t(9565),n=t(8551),a=t(6823),o=t(4209),l=t(6198),h=t(1625),d=t(81),u=t(851),f=t(9539),p=TypeError,m=function(A,b){this.stopped=A,this.result=b},v=m.prototype;c.exports=function(A,b,S){var E=S&&S.that,T=!!(S&&S.AS_ENTRIES),x=!!(S&&S.IS_RECORD),C=!!(S&&S.IS_ITERATOR),P=!!(S&&S.INTERRUPTED),I=s(b,E),R,L,D,O,F,B,W,_=function(X){return R&&f(R,"normal"),new m(!0,X)},k=function(X){return T?(n(X),P?I(X[0],X[1],_):I(X[0],X[1])):P?I(X,_):I(X)};if(x)R=A.iterator;else if(C)R=A;else{if(L=u(A),!L)throw new p(a(A)+" is not iterable");if(o(L)){for(D=0,O=l(A);O>D;D++)if(F=k(A[D]),F&&h(v,F))return F;return new m(!1)}R=d(A,L)}for(B=x?A.next:R.next;!(W=i(B,R)).done;){try{F=k(W.value)}catch(X){f(R,"throw",X)}if(typeof F=="object"&&F&&h(v,F))return F}return new m(!1)}},2777:(c,e,t)=>{var s=t(9565),i=t(34),n=t(757),a=t(5966),o=t(4270),l=t(8227),h=TypeError,d=l("toPrimitive");c.exports=function(u,f){if(!i(u)||n(u))return u;var p=a(u,d),m;if(p){if(f===void 0&&(f="default"),m=s(p,u,f),!i(m)||n(m))return m;throw new h("Can't convert object to primitive value")}return f===void 0&&(f="number"),o(u,f)}},2787:(c,e,t)=>{var s=t(9297),i=t(4901),n=t(8981),a=t(6119),o=t(2211),l=a("IE_PROTO"),h=Object,d=h.prototype;c.exports=o?h.getPrototypeOf:function(u){var f=n(u);if(s(f,l))return f[l];var p=f.constructor;return i(p)&&f instanceof p?p.prototype:f instanceof h?d:null}},2796:(c,e,t)=>{var s=t(9039),i=t(4901),n=/#|\.prototype\./,a=function(u,f){var p=l[o(u)];return p===d?!0:p===h?!1:i(f)?s(f):!!f},o=a.normalize=function(u){return String(u).replace(n,".").toLowerCase()},l=a.data={},h=a.NATIVE="N",d=a.POLYFILL="P";c.exports=a},2804:c=>{var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=e+"+/",s=e+"-_",i=function(n){for(var a={},o=0;o<64;o++)a[n.charAt(o)]=o;return a};c.exports={i2c:t,c2i:i(t),i2cUrl:s,c2iUrl:i(s)}},2812:c=>{var e=TypeError;c.exports=function(t,s){if(t<s)throw new e("Not enough arguments");return t}},2839:(c,e,t)=>{var s=t(4576),i=s.navigator,n=i&&i.userAgent;c.exports=n?String(n):""},2967:(c,e,t)=>{var s=t(6706),i=t(34),n=t(7750),a=t(3506);c.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var o=!1,l={},h;try{h=s(Object.prototype,"__proto__","set"),h(l,[]),o=l instanceof Array}catch{}return function(u,f){return n(u),a(f),i(u)&&(o?h(u,f):u.__proto__=f),u}}():void 0)},3068:(c,e,t)=>{var s=t(6518),i=t(9504),n=t(2652),a=RangeError,o=TypeError,l=1/0,h=NaN,d=Math.abs,u=Math.pow,f=i([].push),p=u(2,1023),m=u(2,53)-1,v=Number.MAX_VALUE,A=u(2,971),b={},S={},E={},T={},x={},C=function(P,I){var R=P+I,L=I-(R-P);return{hi:R,lo:L}};s({target:"Math",stat:!0},{sumPrecise:function(I){var R=[],L=0,D=T;switch(n(I,function(H){if(++L>=m)throw new a("Maximum allowed index exceeded");if(typeof H!="number")throw new o("Value is not a number");D!==b&&(H!==H?D=b:H===l?D=D===S?b:E:H===-l?D=D===E?b:S:(H!==0||1/H===l)&&(D===T||D===x)&&(D=x,f(R,H)))}),D){case b:return h;case S:return-l;case E:return l;case T:return-0}for(var O=[],F=0,B,W,_,k,X,Z,gt=0;gt<R.length;gt++){B=R[gt];for(var zt=0,q=0;q<O.length;q++){if(W=O[q],d(B)<d(W)&&(Z=B,B=W,W=Z),_=C(B,W),k=_.hi,X=_.lo,d(k)===l){var ht=k===l?1:-1;F+=ht,B=B-ht*p-ht*p,d(B)<d(W)&&(Z=B,B=W,W=Z),_=C(B,W),k=_.hi,X=_.lo}X!==0&&(O[zt++]=X),B=k}O.length=zt,B!==0&&f(O,B)}var bt=O.length-1;if(k=0,X=0,F!==0){var Qt=bt>=0?O[bt]:0;if(bt--,d(F)>1||F>0&&Qt>0||F<0&&Qt<0)return F>0?l:-l;if(_=C(F*p,Qt/2),k=_.hi,X=_.lo,X*=2,d(2*k)===l)return k>0?k===p&&X===-(A/2)&&bt>=0&&O[bt]<0?v:l:k===-p&&X===A/2&&bt>=0&&O[bt]>0?-v:-l;X!==0&&(O[++bt]=X,X=0),k*=2}for(;bt>=0&&(_=C(k,O[bt--]),k=_.hi,X=_.lo,X===0););return bt>=0&&(X<0&&O[bt]<0||X>0&&O[bt]>0)&&(W=X*2,B=k+W,W===B-k&&(k=B)),k}})},3167:(c,e,t)=>{var s=t(4901),i=t(34),n=t(2967);c.exports=function(a,o,l){var h,d;return n&&s(h=o.constructor)&&h!==l&&i(d=h.prototype)&&d!==l.prototype&&n(a,d),a}},3238:(c,e,t)=>{var s=t(4576),i=t(7811),n=t(7394),a=s.DataView;c.exports=function(o){if(!i||n(o)!==0)return!1;try{return new a(o),!1}catch{return!0}}},3392:(c,e,t)=>{var s=t(9504),i=0,n=Math.random(),a=s(1.1.toString);c.exports=function(o){return"Symbol("+(o===void 0?"":o)+")_"+a(++i+n,36)}},3440:(c,e,t)=>{var s=t(7080),i=t(4402),n=t(9286),a=t(5170),o=t(3789),l=t(8469),h=t(507),d=i.has,u=i.remove;c.exports=function(p){var m=s(this),v=o(p),A=n(m);return a(m)<=v.size?l(m,function(b){v.includes(b)&&u(A,b)}):h(v.getIterator(),function(b){d(A,b)&&u(A,b)}),A}},3463:c=>{var e=TypeError;c.exports=function(t){if(typeof t=="string")return t;throw new e("Argument is not a string")}},3506:(c,e,t)=>{var s=t(3925),i=String,n=TypeError;c.exports=function(a){if(s(a))return a;throw new n("Can't set "+i(a)+" as a prototype")}},3579:(c,e,t)=>{var s=t(6518),i=t(9565),n=t(2652),a=t(9306),o=t(8551),l=t(1767),h=t(9539),d=t(4549),u=d("some",TypeError);s({target:"Iterator",proto:!0,real:!0,forced:u},{some:function(p){o(this);try{a(p)}catch(A){h(this,"throw",A)}if(u)return i(u,this,p);var m=l(this),v=0;return n(m,function(A,b){if(p(A,v++))return b()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},3650:(c,e,t)=>{var s=t(7080),i=t(4402),n=t(9286),a=t(3789),o=t(507),l=i.add,h=i.has,d=i.remove;c.exports=function(f){var p=s(this),m=a(f).getIterator(),v=n(p);return o(m,function(A){h(p,A)?d(v,A):l(v,A)}),v}},3706:(c,e,t)=>{var s=t(9504),i=t(4901),n=t(7629),a=s(Function.toString);i(n.inspectSource)||(n.inspectSource=function(o){return a(o)}),c.exports=n.inspectSource},3717:(c,e)=>{e.f=Object.getOwnPropertySymbols},3724:(c,e,t)=>{var s=t(9039);c.exports=!s(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})},3789:(c,e,t)=>{var s=t(9306),i=t(8551),n=t(9565),a=t(1291),o=t(1767),l="Invalid size",h=RangeError,d=TypeError,u=Math.max,f=function(p,m){this.set=p,this.size=u(m,0),this.has=s(p.has),this.keys=s(p.keys)};f.prototype={getIterator:function(){return o(i(n(this.keys,this.set)))},includes:function(p){return n(this.has,this.set,p)}},c.exports=function(p){i(p);var m=+p.size;if(m!==m)throw new d(l);var v=a(m);if(v<0)throw new h(l);return new f(p,v)}},3838:(c,e,t)=>{var s=t(7080),i=t(5170),n=t(8469),a=t(3789);c.exports=function(l){var h=s(this),d=a(l);return i(h)>d.size?!1:n(h,function(u){if(!d.includes(u))return!1},!0)!==!1}},3853:(c,e,t)=>{var s=t(6518),i=t(4449),n=t(4916),a=!n("isDisjointFrom",function(o){return!o});s({target:"Set",proto:!0,real:!0,forced:a},{isDisjointFrom:i})},3925:(c,e,t)=>{var s=t(34);c.exports=function(i){return s(i)||i===null}},3972:(c,e,t)=>{var s=t(34),i=String,n=TypeError;c.exports=function(a){if(a===void 0||s(a))return a;throw new n(i(a)+" is not an object or undefined")}},4055:(c,e,t)=>{var s=t(4576),i=t(34),n=s.document,a=i(n)&&i(n.createElement);c.exports=function(o){return a?n.createElement(o):{}}},4114:(c,e,t)=>{var s=t(6518),i=t(8981),n=t(6198),a=t(4527),o=t(6837),l=t(9039),h=l(function(){return[].push.call({length:4294967296},1)!==4294967297}),d=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(f){return f instanceof TypeError}},u=h||!d();s({target:"Array",proto:!0,arity:1,forced:u},{push:function(p){var m=i(this),v=n(m),A=arguments.length;o(v+A);for(var b=0;b<A;b++)m[v]=arguments[b],v++;return a(m,v),v}})},4117:c=>{c.exports=function(e){return e==null}},4149:c=>{var e=RangeError;c.exports=function(t){if(t===t)return t;throw new e("NaN is not allowed")}},4154:(c,e,t)=>{var s=t(6955),i=TypeError;c.exports=function(n){if(s(n)==="Uint8Array")return n;throw new i("Argument is not an Uint8Array")}},4204:(c,e,t)=>{var s=t(7080),i=t(4402).add,n=t(9286),a=t(3789),o=t(507);c.exports=function(h){var d=s(this),u=a(h).getIterator(),f=n(d);return o(u,function(p){i(f,p)}),f}},4209:(c,e,t)=>{var s=t(8227),i=t(6269),n=s("iterator"),a=Array.prototype;c.exports=function(o){return o!==void 0&&(i.Array===o||a[n]===o)}},4215:(c,e,t)=>{var s=t(4576),i=t(2839),n=t(2195),a=function(o){return i.slice(0,o.length)===o};c.exports=function(){return a("Bun/")?"BUN":a("Cloudflare-Workers")?"CLOUDFLARE":a("Deno/")?"DENO":a("Node.js/")?"NODE":s.Bun&&typeof Bun.version=="string"?"BUN":s.Deno&&typeof Deno.version=="object"?"DENO":n(s.process)==="process"?"NODE":s.window&&s.document?"BROWSER":"REST"}()},4226:(c,e,t)=>{var s=t(6518),i=t(4576),n=t(3463),a=t(4154),o=t(5169),l=t(2303);i.Uint8Array&&s({target:"Uint8Array",proto:!0},{setFromHex:function(d){a(this),n(d),o(this.buffer);var u=l(d,this).read;return{read:u,written:u/2}}})},4235:(c,e,t)=>{t(3068)},4270:(c,e,t)=>{var s=t(9565),i=t(4901),n=t(34),a=TypeError;c.exports=function(o,l){var h,d;if(l==="string"&&i(h=o.toString)&&!n(d=s(h,o))||i(h=o.valueOf)&&!n(d=s(h,o))||l!=="string"&&i(h=o.toString)&&!n(d=s(h,o)))return d;throw new a("Can't convert object to primitive value")}},4376:(c,e,t)=>{var s=t(2195);c.exports=Array.isArray||function(n){return s(n)==="Array"}},4402:(c,e,t)=>{var s=t(9504),i=Set.prototype;c.exports={Set,add:s(i.add),has:s(i.has),remove:s(i.delete),proto:i}},4449:(c,e,t)=>{var s=t(7080),i=t(4402).has,n=t(5170),a=t(3789),o=t(8469),l=t(507),h=t(9539);c.exports=function(u){var f=s(this),p=a(u);if(n(f)<=p.size)return o(f,function(v){if(p.includes(v))return!1},!0)!==!1;var m=p.getIterator();return l(m,function(v){if(i(f,v))return h(m,"normal",!1)})!==!1}},4483:(c,e,t)=>{var s=t(4576),i=t(9429),n=t(1548),a=s.structuredClone,o=s.ArrayBuffer,l=s.MessageChannel,h=!1,d,u,f,p;if(n)h=function(m){a(m,{transfer:[m]})};else if(o)try{l||(d=i("worker_threads"),d&&(l=d.MessageChannel)),l&&(u=new l,f=new o(2),p=function(m){u.port1.postMessage(null,[m])},f.byteLength===2&&(p(f),f.byteLength===0&&(h=p)))}catch{}c.exports=h},4495:(c,e,t)=>{var s=t(9519),i=t(9039),n=t(4576),a=n.String;c.exports=!!Object.getOwnPropertySymbols&&!i(function(){var o=Symbol("symbol detection");return!a(o)||!(Object(o)instanceof Symbol)||!Symbol.sham&&s&&s<41})},4527:(c,e,t)=>{var s=t(3724),i=t(4376),n=TypeError,a=Object.getOwnPropertyDescriptor,o=s&&!function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(l){return l instanceof TypeError}}();c.exports=o?function(l,h){if(i(l)&&!a(l,"length").writable)throw new n("Cannot set read only .length");return l.length=h}:function(l,h){return l.length=h}},4549:(c,e,t)=>{var s=t(4576);c.exports=function(i,n){var a=s.Iterator,o=a&&a.prototype,l=o&&o[i],h=!1;if(l)try{l.call({next:function(){return{done:!0}},return:function(){h=!0}},-1)}catch(d){d instanceof n||(h=!1)}if(!h)return l}},4576:function(c){var e=function(t){return t&&t.Math===Math&&t};c.exports=e(typeof globalThis=="object"&&globalThis)||e(typeof window=="object"&&window)||e(typeof self=="object"&&self)||e(typeof global=="object"&&global)||e(typeof this=="object"&&this)||function(){return this}()||Function("return this")()},4603:(c,e,t)=>{var s=t(6840),i=t(9504),n=t(655),a=t(2812),o=URLSearchParams,l=o.prototype,h=i(l.append),d=i(l.delete),u=i(l.forEach),f=i([].push),p=new o("a=1&a=2&b=3");p.delete("a",1),p.delete("b",void 0),p+""!="a=2"&&s(l,"delete",function(m){var v=arguments.length,A=v<2?void 0:arguments[1];if(v&&A===void 0)return d(this,m);var b=[];u(this,function(R,L){f(b,{key:L,value:R})}),a(v,1);for(var S=n(m),E=n(A),T=0,x=0,C=!1,P=b.length,I;T<P;)I=b[T++],C||I.key===S?(C=!0,d(this,I.key)):x++;for(;x<P;)I=b[x++],I.key===S&&I.value===E||h(this,I.key,I.value)},{enumerable:!0,unsafe:!0})},4628:(c,e,t)=>{var s=t(6518),i=t(6043);s({target:"Promise",stat:!0},{withResolvers:function(){var a=i.f(this);return{promise:a.promise,resolve:a.resolve,reject:a.reject}}})},4644:(c,e,t)=>{var s=t(7811),i=t(3724),n=t(4576),a=t(4901),o=t(34),l=t(9297),h=t(6955),d=t(6823),u=t(6699),f=t(6840),p=t(2106),m=t(1625),v=t(2787),A=t(2967),b=t(8227),S=t(3392),E=t(1181),T=E.enforce,x=E.get,C=n.Int8Array,P=C&&C.prototype,I=n.Uint8ClampedArray,R=I&&I.prototype,L=C&&v(C),D=P&&v(P),O=Object.prototype,F=n.TypeError,B=b("toStringTag"),W=S("TYPED_ARRAY_TAG"),_="TypedArrayConstructor",k=s&&!!A&&h(n.opera)!=="Opera",X=!1,Z,gt,zt,q={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},ht={BigInt64Array:8,BigUint64Array:8},bt=function(Dt){if(!o(Dt))return!1;var kt=h(Dt);return kt==="DataView"||l(q,kt)||l(ht,kt)},Qt=function(K){var Dt=v(K);if(o(Dt)){var kt=x(Dt);return kt&&l(kt,_)?kt[_]:Qt(Dt)}},H=function(K){if(!o(K))return!1;var Dt=h(K);return l(q,Dt)||l(ht,Dt)},N=function(K){if(H(K))return K;throw new F("Target is not a typed array")},$=function(K){if(a(K)&&(!A||m(L,K)))return K;throw new F(d(K)+" is not a typed array constructor")},et=function(K,Dt,kt,Cs){if(i){if(kt)for(var Fe in q){var le=n[Fe];if(le&&l(le.prototype,K))try{delete le.prototype[K]}catch{try{le.prototype[K]=Dt}catch{}}}(!D[K]||kt)&&f(D,K,kt?Dt:k&&P[K]||Dt,Cs)}},mt=function(K,Dt,kt){var Cs,Fe;if(i){if(A){if(kt){for(Cs in q)if(Fe=n[Cs],Fe&&l(Fe,K))try{delete Fe[K]}catch{}}if(!L[K]||kt)try{return f(L,K,kt?Dt:k&&L[K]||Dt)}catch{}else return}for(Cs in q)Fe=n[Cs],Fe&&(!Fe[K]||kt)&&f(Fe,K,Dt)}};for(Z in q)gt=n[Z],zt=gt&&gt.prototype,zt?T(zt)[_]=gt:k=!1;for(Z in ht)gt=n[Z],zt=gt&&gt.prototype,zt&&(T(zt)[_]=gt);if((!k||!a(L)||L===Function.prototype)&&(L=function(){throw new F("Incorrect invocation")},k))for(Z in q)n[Z]&&A(n[Z],L);if((!k||!D||D===O)&&(D=L.prototype,k))for(Z in q)n[Z]&&A(n[Z].prototype,D);if(k&&v(R)!==D&&A(R,D),i&&!l(D,B)){X=!0,p(D,B,{configurable:!0,get:function(){return o(this)?this[W]:void 0}});for(Z in q)n[Z]&&u(n[Z],W,Z)}c.exports={NATIVE_ARRAY_BUFFER_VIEWS:k,TYPED_ARRAY_TAG:X&&W,aTypedArray:N,aTypedArrayConstructor:$,exportTypedArrayMethod:et,exportTypedArrayStaticMethod:mt,getTypedArrayConstructor:Qt,isView:bt,isTypedArray:H,TypedArray:L,TypedArrayPrototype:D}},4659:(c,e,t)=>{var s=t(3724),i=t(4913),n=t(6980);c.exports=function(a,o,l){s?i.f(a,o,n(0,l)):a[o]=l}},4901:c=>{var e=typeof document=="object"&&document.all;c.exports=typeof e>"u"&&e!==void 0?function(t){return typeof t=="function"||t===e}:function(t){return typeof t=="function"}},4913:(c,e,t)=>{var s=t(3724),i=t(5917),n=t(8686),a=t(8551),o=t(6969),l=TypeError,h=Object.defineProperty,d=Object.getOwnPropertyDescriptor,u="enumerable",f="configurable",p="writable";e.f=s?n?function(v,A,b){if(a(v),A=o(A),a(b),typeof v=="function"&&A==="prototype"&&"value"in b&&p in b&&!b[p]){var S=d(v,A);S&&S[p]&&(v[A]=b.value,b={configurable:f in b?b[f]:S[f],enumerable:u in b?b[u]:S[u],writable:!1})}return h(v,A,b)}:h:function(v,A,b){if(a(v),A=o(A),a(b),i)try{return h(v,A,b)}catch{}if("get"in b||"set"in b)throw new l("Accessors not supported");return"value"in b&&(v[A]=b.value),v}},4916:(c,e,t)=>{var s=t(7751),i=function(a){return{size:a,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},n=function(a){return{size:a,has:function(){return!0},keys:function(){throw new Error("e")}}};c.exports=function(a,o){var l=s("Set");try{new l()[a](i(0));try{return new l()[a](i(-1)),!1}catch{if(!o)return!0;try{return new l()[a](n(-1/0)),!1}catch{var h=new l;return h.add(1),h.add(2),o(h[a](n(1/0)))}}}catch{return!1}}},4972:(c,e,t)=>{var s=t(6518),i=t(9565),n=t(8551),a=t(1767),o=t(4149),l=t(9590),h=t(9462),d=t(9539),u=t(4549),f=t(6395),p=!f&&u("take",RangeError),m=h(function(){var v=this.iterator;if(!this.remaining--)return this.done=!0,d(v,"normal",void 0);var A=n(i(this.next,v)),b=this.done=!!A.done;if(!b)return A.value});s({target:"Iterator",proto:!0,real:!0,forced:f||p},{take:function(A){n(this);var b;try{b=l(o(+A))}catch(S){d(this,"throw",S)}return p?i(p,this,b):new m(a(this),{remaining:b})}})},4979:(c,e,t)=>{var s=t(6518),i=t(4576),n=t(7751),a=t(6980),o=t(4913).f,l=t(9297),h=t(679),d=t(3167),u=t(2603),f=t(5002),p=t(8574),m=t(3724),v=t(6395),A="DOMException",b=n("Error"),S=n(A),E=function(){h(this,T);var _=arguments.length,k=u(_<1?void 0:arguments[0]),X=u(_<2?void 0:arguments[1],"Error"),Z=new S(k,X),gt=new b(k);return gt.name=A,o(Z,"stack",a(1,p(gt.stack,1))),d(Z,this,E),Z},T=E.prototype=S.prototype,x="stack"in new b(A),C="stack"in new S(1,2),P=S&&m&&Object.getOwnPropertyDescriptor(i,A),I=!!P&&!(P.writable&&P.configurable),R=x&&!I&&!C;s({global:!0,constructor:!0,forced:v||R},{DOMException:R?E:S});var L=n(A),D=L.prototype;if(D.constructor!==L){v||o(D,"constructor",a(1,L));for(var O in f)if(l(f,O)){var F=f[O],B=F.s;l(L,B)||o(L,B,a(6,F.c))}}},5002:c=>{c.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},5024:(c,e,t)=>{var s=t(6518),i=t(3650),n=t(9835),a=t(4916),o=!a("symmetricDifference")||!n("symmetricDifference");s({target:"Set",proto:!0,real:!0,forced:o},{symmetricDifference:i})},5031:(c,e,t)=>{var s=t(7751),i=t(9504),n=t(8480),a=t(3717),o=t(8551),l=i([].concat);c.exports=s("Reflect","ownKeys")||function(d){var u=n.f(o(d)),f=a.f;return f?l(u,f(d)):u}},5169:(c,e,t)=>{var s=t(3238),i=TypeError;c.exports=function(n){if(s(n))throw new i("ArrayBuffer is detached");return n}},5170:(c,e,t)=>{var s=t(6706),i=t(4402);c.exports=s(i.proto,"size","get")||function(n){return n.size}},5213:(c,e,t)=>{var s=t(6518),i=t(4576),n=t(5370),a=t(9143),o=i.Uint8Array,l=!o||!o.fromBase64||!function(){try{o.fromBase64("a");return}catch{}try{o.fromBase64("",null)}catch{return!0}}();o&&s({target:"Uint8Array",stat:!0,forced:l},{fromBase64:function(d){var u=a(d,arguments.length>1?arguments[1]:void 0,null,9007199254740991);return n(o,u.bytes)}})},5370:(c,e,t)=>{var s=t(6198);c.exports=function(i,n,a){for(var o=0,l=arguments.length>2?a:s(n),h=new i(l);l>o;)h[o]=n[o++];return h}},5397:(c,e,t)=>{var s=t(7055),i=t(7750);c.exports=function(n){return s(i(n))}},5610:(c,e,t)=>{var s=t(1291),i=Math.max,n=Math.min;c.exports=function(a,o){var l=s(a);return l<0?i(l+o,0):n(l,o)}},5623:(c,e,t)=>{t(456)},5636:(c,e,t)=>{var s=t(4576),i=t(9504),n=t(6706),a=t(7696),o=t(5169),l=t(7394),h=t(4483),d=t(1548),u=s.structuredClone,f=s.ArrayBuffer,p=s.DataView,m=Math.min,v=f.prototype,A=p.prototype,b=i(v.slice),S=n(v,"resizable","get"),E=n(v,"maxByteLength","get"),T=i(A.getInt8),x=i(A.setInt8);c.exports=(d||h)&&function(C,P,I){var R=l(C),L=P===void 0?R:a(P),D=!S||!S(C),O;if(o(C),d&&(C=u(C,{transfer:[C]}),R===L&&(I||D)))return C;if(R>=L&&(!I||D))O=b(C,0,L);else{var F=I&&!D&&E?{maxByteLength:E(C)}:void 0;O=new f(L,F);for(var B=new p(C),W=new p(O),_=m(L,R),k=0;k<_;k++)x(W,k,T(B,k))}return d||h(C),O}},5745:(c,e,t)=>{var s=t(7629);c.exports=function(i,n){return s[i]||(s[i]=n||{})}},5781:(c,e,t)=>{var s=t(6518),i=t(7751),n=t(2812),a=t(655),o=t(7416),l=i("URL");s({target:"URL",stat:!0,forced:!o},{parse:function(d){var u=n(arguments.length,1),f=a(d),p=u<2||arguments[1]===void 0?void 0:a(arguments[1]);try{return new l(f,p)}catch{return null}}})},5854:(c,e,t)=>{var s=t(2777),i=TypeError;c.exports=function(n){var a=s(n,"number");if(typeof a=="number")throw new i("Can't convert number to bigint");return BigInt(a)}},5876:(c,e,t)=>{var s=t(6518),i=t(3838),n=t(4916),a=!n("isSubsetOf",function(o){return o});s({target:"Set",proto:!0,real:!0,forced:a},{isSubsetOf:i})},5917:(c,e,t)=>{var s=t(3724),i=t(9039),n=t(4055);c.exports=!s&&!i(function(){return Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a!==7})},5966:(c,e,t)=>{var s=t(9306),i=t(4117);c.exports=function(n,a){var o=n[a];return i(o)?void 0:s(o)}},6043:(c,e,t)=>{var s=t(9306),i=TypeError,n=function(a){var o,l;this.promise=new a(function(h,d){if(o!==void 0||l!==void 0)throw new i("Bad Promise constructor");o=h,l=d}),this.resolve=s(o),this.reject=s(l)};c.exports.f=function(a){return new n(a)}},6080:(c,e,t)=>{var s=t(7476),i=t(9306),n=t(616),a=s(s.bind);c.exports=function(o,l){return i(o),l===void 0?o:n?a(o,l):function(){return o.apply(l,arguments)}}},6119:(c,e,t)=>{var s=t(5745),i=t(3392),n=s("keys");c.exports=function(a){return n[a]||(n[a]=i(a))}},6193:(c,e,t)=>{var s=t(4215);c.exports=s==="NODE"},6198:(c,e,t)=>{var s=t(8014);c.exports=function(i){return s(i.length)}},6269:c=>{c.exports={}},6279:(c,e,t)=>{var s=t(6840);c.exports=function(i,n,a){for(var o in n)s(i,o,n[o],a);return i}},6319:(c,e,t)=>{var s=t(8551),i=t(9539);c.exports=function(n,a,o,l){try{return l?a(s(o)[0],o[1]):a(o)}catch(h){i(n,"throw",h)}}},6395:c=>{c.exports=!1},6518:(c,e,t)=>{var s=t(4576),i=t(7347).f,n=t(6699),a=t(6840),o=t(9433),l=t(7740),h=t(2796);c.exports=function(d,u){var f=d.target,p=d.global,m=d.stat,v,A,b,S,E,T;if(p?A=s:m?A=s[f]||o(f,{}):A=s[f]&&s[f].prototype,A)for(b in u){if(E=u[b],d.dontCallGetSet?(T=i(A,b),S=T&&T.value):S=A[b],v=h(p?b:f+(m?".":"#")+b,d.forced),!v&&S!==void 0){if(typeof E==typeof S)continue;l(E,S)}(d.sham||S&&S.sham)&&n(E,"sham",!0),a(A,b,E,d)}}},6573:(c,e,t)=>{var s=t(3724),i=t(2106),n=t(3238),a=ArrayBuffer.prototype;s&&!("detached"in a)&&i(a,"detached",{configurable:!0,get:function(){return n(this)}})},6632:(c,e,t)=>{var s=t(6518),i=t(4576),n=t(9143),a=t(4154),o=i.Uint8Array,l=!o||!o.prototype.setFromBase64||!function(){var h=new o([255,255,255,255,255]);try{h.setFromBase64("",null);return}catch{}try{h.setFromBase64("a");return}catch{}try{h.setFromBase64("MjYyZg===")}catch{return h[0]===50&&h[1]===54&&h[2]===50&&h[3]===255&&h[4]===255}}();o&&s({target:"Uint8Array",proto:!0,forced:l},{setFromBase64:function(d){a(this);var u=n(d,arguments.length>1?arguments[1]:void 0,this,this.length);return{read:u.read,written:u.written}}})},6699:(c,e,t)=>{var s=t(3724),i=t(4913),n=t(6980);c.exports=s?function(a,o,l){return i.f(a,o,n(1,l))}:function(a,o,l){return a[o]=l,a}},6706:(c,e,t)=>{var s=t(9504),i=t(9306);c.exports=function(n,a,o){try{return s(i(Object.getOwnPropertyDescriptor(n,a)[o]))}catch{}}},6801:(c,e,t)=>{var s=t(3724),i=t(8686),n=t(4913),a=t(8551),o=t(5397),l=t(1072);e.f=s&&!i?Object.defineProperties:function(d,u){a(d);for(var f=o(u),p=l(u),m=p.length,v=0,A;m>v;)n.f(d,A=p[v++],f[A]);return d}},6823:c=>{var e=String;c.exports=function(t){try{return e(t)}catch{return"Object"}}},6837:c=>{var e=TypeError,t=9007199254740991;c.exports=function(s){if(s>t)throw e("Maximum allowed index exceeded");return s}},6840:(c,e,t)=>{var s=t(4901),i=t(4913),n=t(283),a=t(9433);c.exports=function(o,l,h,d){d||(d={});var u=d.enumerable,f=d.name!==void 0?d.name:l;if(s(h)&&n(h,f,d),d.global)u?o[l]=h:a(l,h);else{try{d.unsafe?o[l]&&(u=!0):delete o[l]}catch{}u?o[l]=h:i.f(o,l,{value:h,enumerable:!1,configurable:!d.nonConfigurable,writable:!d.nonWritable})}return o}},6955:(c,e,t)=>{var s=t(2140),i=t(4901),n=t(2195),a=t(8227),o=a("toStringTag"),l=Object,h=n(function(){return arguments}())==="Arguments",d=function(u,f){try{return u[f]}catch{}};c.exports=s?n:function(u){var f,p,m;return u===void 0?"Undefined":u===null?"Null":typeof(p=d(f=l(u),o))=="string"?p:h?n(f):(m=n(f))==="Object"&&i(f.callee)?"Arguments":m}},6969:(c,e,t)=>{var s=t(2777),i=t(757);c.exports=function(n){var a=s(n,"string");return i(a)?a:a+""}},6980:c=>{c.exports=function(e,t){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:t}}},7040:(c,e,t)=>{var s=t(4495);c.exports=s&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},7055:(c,e,t)=>{var s=t(9504),i=t(9039),n=t(2195),a=Object,o=s("".split);c.exports=i(function(){return!a("z").propertyIsEnumerable(0)})?function(l){return n(l)==="String"?o(l,""):a(l)}:a},7080:(c,e,t)=>{var s=t(4402).has;c.exports=function(i){return s(i),i}},7347:(c,e,t)=>{var s=t(3724),i=t(9565),n=t(8773),a=t(6980),o=t(5397),l=t(6969),h=t(9297),d=t(5917),u=Object.getOwnPropertyDescriptor;e.f=s?u:function(p,m){if(p=o(p),m=l(m),d)try{return u(p,m)}catch{}if(h(p,m))return a(!i(n.f,p,m),p[m])}},7394:(c,e,t)=>{var s=t(4576),i=t(6706),n=t(2195),a=s.ArrayBuffer,o=s.TypeError;c.exports=a&&i(a.prototype,"byteLength","get")||function(l){if(n(l)!=="ArrayBuffer")throw new o("ArrayBuffer expected");return l.byteLength}},7416:(c,e,t)=>{var s=t(9039),i=t(8227),n=t(3724),a=t(6395),o=i("iterator");c.exports=!s(function(){var l=new URL("b?a=1&b=2&c=3","https://a"),h=l.searchParams,d=new URLSearchParams("a=1&a=2&b=3"),u="";return l.pathname="c%20d",h.forEach(function(f,p){h.delete("b"),u+=p+f}),d.delete("a",2),d.delete("b",void 0),a&&(!l.toJSON||!d.has("a",1)||d.has("a",2)||!d.has("a",void 0)||d.has("b"))||!h.size&&(a||!n)||!h.sort||l.href!=="https://a/c%20d?a=1&c=3"||h.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!h[o]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://тест").host!=="xn--e1aybc"||new URL("https://a#б").hash!=="#%D0%B1"||u!=="a1c3"||new URL("https://x",void 0).host!=="x"})},7476:(c,e,t)=>{var s=t(2195),i=t(9504);c.exports=function(n){if(s(n)==="Function")return i(n)}},7566:(c,e,t)=>{var s=t(6840),i=t(9504),n=t(655),a=t(2812),o=URLSearchParams,l=o.prototype,h=i(l.getAll),d=i(l.has),u=new o("a=1");(u.has("a",2)||!u.has("a",void 0))&&s(l,"has",function(p){var m=arguments.length,v=m<2?void 0:arguments[1];if(m&&v===void 0)return d(this,p);var A=h(this,p);a(m,1);for(var b=n(v),S=0;S<A.length;)if(A[S++]===b)return!0;return!1},{enumerable:!0,unsafe:!0})},7588:(c,e,t)=>{var s=t(6518),i=t(9565),n=t(2652),a=t(9306),o=t(8551),l=t(1767),h=t(9539),d=t(4549),u=d("forEach",TypeError);s({target:"Iterator",proto:!0,real:!0,forced:u},{forEach:function(p){o(this);try{a(p)}catch(A){h(this,"throw",A)}if(u)return i(u,this,p);var m=l(this),v=0;n(m,function(A){p(A,v++)},{IS_RECORD:!0})}})},7629:(c,e,t)=>{var s=t(6395),i=t(4576),n=t(9433),a="__core-js_shared__",o=c.exports=i[a]||n(a,{});(o.versions||(o.versions=[])).push({version:"3.45.1",mode:s?"pure":"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.45.1/LICENSE",source:"https://github.com/zloirock/core-js"})},7642:(c,e,t)=>{var s=t(6518),i=t(3440),n=t(9039),a=t(4916),o=!a("difference",function(h){return h.size===0}),l=o||n(function(){var h={size:1,has:function(){return!0},keys:function(){var u=0;return{next:function(){var f=u++>1;return d.has(1)&&d.clear(),{done:f,value:2}}}}},d=new Set([1,2,3,4]);return d.difference(h).size!==3});s({target:"Set",proto:!0,real:!0,forced:l},{difference:i})},7657:(c,e,t)=>{var s=t(9039),i=t(4901),n=t(34),a=t(2360),o=t(2787),l=t(6840),h=t(8227),d=t(6395),u=h("iterator"),f=!1,p,m,v;[].keys&&(v=[].keys(),"next"in v?(m=o(o(v)),m!==Object.prototype&&(p=m)):f=!0);var A=!n(p)||s(function(){var b={};return p[u].call(b)!==b});A?p={}:d&&(p=a(p)),i(p[u])||l(p,u,function(){return this}),c.exports={IteratorPrototype:p,BUGGY_SAFARI_ITERATORS:f}},7680:(c,e,t)=>{var s=t(9504);c.exports=s([].slice)},7696:(c,e,t)=>{var s=t(1291),i=t(8014),n=RangeError;c.exports=function(a){if(a===void 0)return 0;var o=s(a),l=i(o);if(o!==l)throw new n("Wrong length or index");return l}},7740:(c,e,t)=>{var s=t(9297),i=t(5031),n=t(7347),a=t(4913);c.exports=function(o,l,h){for(var d=i(l),u=a.f,f=n.f,p=0;p<d.length;p++){var m=d[p];!s(o,m)&&!(h&&s(h,m))&&u(o,m,f(l,m))}}},7750:(c,e,t)=>{var s=t(4117),i=TypeError;c.exports=function(n){if(s(n))throw new i("Can't call method on "+n);return n}},7751:(c,e,t)=>{var s=t(4576),i=t(4901),n=function(a){return i(a)?a:void 0};c.exports=function(a,o){return arguments.length<2?n(s[a]):s[a]&&s[a][o]}},7811:c=>{c.exports=typeof ArrayBuffer<"u"&&typeof DataView<"u"},7936:(c,e,t)=>{var s=t(6518),i=t(5636);i&&s({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return i(this,arguments.length?arguments[0]:void 0,!1)}})},8004:(c,e,t)=>{var s=t(6518),i=t(9039),n=t(8750),a=t(4916),o=!a("intersection",function(l){return l.size===2&&l.has(1)&&l.has(2)})||i(function(){return String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))!=="3,2"});s({target:"Set",proto:!0,real:!0,forced:o},{intersection:n})},8014:(c,e,t)=>{var s=t(1291),i=Math.min;c.exports=function(n){var a=s(n);return a>0?i(a,9007199254740991):0}},8100:(c,e,t)=>{var s=t(6518),i=t(5636);i&&s({target:"ArrayBuffer",proto:!0},{transfer:function(){return i(this,arguments.length?arguments[0]:void 0,!0)}})},8111:(c,e,t)=>{var s=t(6518),i=t(4576),n=t(679),a=t(8551),o=t(4901),l=t(2787),h=t(2106),d=t(4659),u=t(9039),f=t(9297),p=t(8227),m=t(7657).IteratorPrototype,v=t(3724),A=t(6395),b="constructor",S="Iterator",E=p("toStringTag"),T=TypeError,x=i[S],C=A||!o(x)||x.prototype!==m||!u(function(){x({})}),P=function(){if(n(this,m),l(this)===m)throw new T("Abstract class Iterator not directly constructable")},I=function(R,L){v?h(m,R,{configurable:!0,get:function(){return L},set:function(D){if(a(this),this===m)throw new T("You can't redefine this property");f(this,R)?this[R]=D:d(this,R,D)}}):m[R]=L};f(m,E)||I(E,S),(C||!f(m,b)||m[b]===Object)&&I(b,P),P.prototype=m,s({global:!0,constructor:!0,forced:C},{Iterator:P})},8227:(c,e,t)=>{var s=t(4576),i=t(5745),n=t(9297),a=t(3392),o=t(4495),l=t(7040),h=s.Symbol,d=i("wks"),u=l?h.for||h:h&&h.withoutSetter||a;c.exports=function(f){return n(d,f)||(d[f]=o&&n(h,f)?h[f]:u("Symbol."+f)),d[f]}},8235:(c,e,t)=>{var s=t(9504),i=t(9297),n=SyntaxError,a=parseInt,o=String.fromCharCode,l=s("".charAt),h=s("".slice),d=s(/./.exec),u={'\\"':'"',"\\\\":"\\","\\/":"/","\\b":"\b","\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	"},f=/^[\da-f]{4}$/i,p=/^[\u0000-\u001F]$/;c.exports=function(m,v){for(var A=!0,b="";v<m.length;){var S=l(m,v);if(S==="\\"){var E=h(m,v,v+2);if(i(u,E))b+=u[E],v+=2;else if(E==="\\u"){v+=2;var T=h(m,v,v+4);if(!d(f,T))throw new n("Bad Unicode escape at: "+v);b+=o(a(T,16)),v+=4}else throw new n('Unknown escape sequence: "'+E+'"')}else if(S==='"'){A=!1,v++;break}else{if(d(p,S))throw new n("Bad control character in string literal at: "+v);b+=S,v++}}if(A)throw new n("Unterminated string at: "+v);return{value:b,end:v}}},8237:(c,e,t)=>{var s=t(6518),i=t(2652),n=t(9306),a=t(8551),o=t(1767),l=t(9539),h=t(4549),d=t(8745),u=t(9039),f=TypeError,p=u(function(){[].keys().reduce(function(){},void 0)}),m=!p&&h("reduce",f);s({target:"Iterator",proto:!0,real:!0,forced:p||m},{reduce:function(A){a(this);try{n(A)}catch(x){l(this,"throw",x)}var b=arguments.length<2,S=b?void 0:arguments[1];if(m)return d(m,this,b?[A]:[A,S]);var E=o(this),T=0;if(i(E,function(x){b?(b=!1,S=x):S=A(S,x,T),T++},{IS_RECORD:!0}),b)throw new f("Reduce of empty iterator with no initial value");return S}})},8335:(c,e,t)=>{var s=t(6518),i=t(3724),n=t(4576),a=t(7751),o=t(9504),l=t(9565),h=t(4901),d=t(34),u=t(4376),f=t(9297),p=t(655),m=t(6198),v=t(4659),A=t(9039),b=t(8235),S=t(4495),E=n.JSON,T=n.Number,x=n.SyntaxError,C=E&&E.parse,P=a("Object","keys"),I=Object.getOwnPropertyDescriptor,R=o("".charAt),L=o("".slice),D=o(/./.exec),O=o([].push),F=/^\d$/,B=/^[1-9]$/,W=/^[\d-]$/,_=/^[\t\n\r ]$/,k=0,X=1,Z=function(H,N){H=p(H);var $=new ht(H,0),et=$.parse(),mt=et.value,K=$.skip(_,et.end);if(K<H.length)throw new x('Unexpected extra character: "'+R(H,K)+'" after the parsed data at: '+K);return h(N)?gt({"":mt},"",N,et):mt},gt=function(H,N,$,et){var mt=H[N],K=et&&mt===et.value,Dt=K&&typeof et.source=="string"?{source:et.source}:{},kt,Cs,Fe,le,Qa;if(d(mt)){var zu=u(mt),cd=K?et.nodes:zu?[]:{};if(zu)for(kt=cd.length,Fe=m(mt),le=0;le<Fe;le++)zt(mt,le,gt(mt,""+le,$,le<kt?cd[le]:void 0));else for(Cs=P(mt),Fe=m(Cs),le=0;le<Fe;le++)Qa=Cs[le],zt(mt,Qa,gt(mt,Qa,$,f(cd,Qa)?cd[Qa]:void 0))}return l($,H,N,mt,Dt)},zt=function(H,N,$){if(i){var et=I(H,N);if(et&&!et.configurable)return}$===void 0?delete H[N]:v(H,N,$)},q=function(H,N,$,et){this.value=H,this.end=N,this.source=$,this.nodes=et},ht=function(H,N){this.source=H,this.index=N};ht.prototype={fork:function(H){return new ht(this.source,H)},parse:function(){var H=this.source,N=this.skip(_,this.index),$=this.fork(N),et=R(H,N);if(D(W,et))return $.number();switch(et){case"{":return $.object();case"[":return $.array();case'"':return $.string();case"t":return $.keyword(!0);case"f":return $.keyword(!1);case"n":return $.keyword(null)}throw new x('Unexpected character: "'+et+'" at: '+N)},node:function(H,N,$,et,mt){return new q(N,et,H?null:L(this.source,$,et),mt)},object:function(){for(var H=this.source,N=this.index+1,$=!1,et={},mt={};N<H.length;){if(N=this.until(['"',"}"],N),R(H,N)==="}"&&!$){N++;break}var K=this.fork(N).string(),Dt=K.value;N=K.end,N=this.until([":"],N)+1,N=this.skip(_,N),K=this.fork(N).parse(),v(mt,Dt,K),v(et,Dt,K.value),N=this.until([",","}"],K.end);var kt=R(H,N);if(kt===",")$=!0,N++;else if(kt==="}"){N++;break}}return this.node(X,et,this.index,N,mt)},array:function(){for(var H=this.source,N=this.index+1,$=!1,et=[],mt=[];N<H.length;){if(N=this.skip(_,N),R(H,N)==="]"&&!$){N++;break}var K=this.fork(N).parse();if(O(mt,K),O(et,K.value),N=this.until([",","]"],K.end),R(H,N)===",")$=!0,N++;else if(R(H,N)==="]"){N++;break}}return this.node(X,et,this.index,N,mt)},string:function(){var H=this.index,N=b(this.source,this.index+1);return this.node(k,N.value,H,N.end)},number:function(){var H=this.source,N=this.index,$=N;if(R(H,$)==="-"&&$++,R(H,$)==="0")$++;else if(D(B,R(H,$)))$=this.skip(F,$+1);else throw new x("Failed to parse number at: "+$);if(R(H,$)==="."&&($=this.skip(F,$+1)),R(H,$)==="e"||R(H,$)==="E"){$++,(R(H,$)==="+"||R(H,$)==="-")&&$++;var et=$;if($=this.skip(F,$),et===$)throw new x("Failed to parse number's exponent value at: "+$)}return this.node(k,T(L(H,N,$)),N,$)},keyword:function(H){var N=""+H,$=this.index,et=$+N.length;if(L(this.source,$,et)!==N)throw new x("Failed to parse value at: "+$);return this.node(k,H,$,et)},skip:function(H,N){for(var $=this.source;N<$.length&&D(H,R($,N));N++);return N},until:function(H,N){N=this.skip(_,N);for(var $=R(this.source,N),et=0;et<H.length;et++)if(H[et]===$)return N;throw new x('Unexpected character: "'+$+'" at: '+N)}};var bt=A(function(){var H="9007199254740993",N;return C(H,function($,et,mt){N=mt.source}),N!==H}),Qt=S&&!A(function(){return 1/C("-0 	")!==-1/0});s({target:"JSON",stat:!0,forced:bt},{parse:function(N,$){return Qt&&!h($)?C(N):Z(N,$)}})},8469:(c,e,t)=>{var s=t(9504),i=t(507),n=t(4402),a=n.Set,o=n.proto,l=s(o.forEach),h=s(o.keys),d=h(new a).next;c.exports=function(u,f,p){return p?i({iterator:h(u),next:d},f):l(u,f)}},8480:(c,e,t)=>{var s=t(1828),i=t(8727),n=i.concat("length","prototype");e.f=Object.getOwnPropertyNames||function(o){return s(o,n)}},8527:(c,e,t)=>{var s=t(7080),i=t(4402).has,n=t(5170),a=t(3789),o=t(507),l=t(9539);c.exports=function(d){var u=s(this),f=a(d);if(n(u)<f.size)return!1;var p=f.getIterator();return o(p,function(m){if(!i(u,m))return l(p,"normal",!1)})!==!1}},8551:(c,e,t)=>{var s=t(34),i=String,n=TypeError;c.exports=function(a){if(s(a))return a;throw new n(i(a)+" is not an object")}},8574:(c,e,t)=>{var s=t(9504),i=Error,n=s("".replace),a=function(h){return String(new i(h).stack)}("zxcasd"),o=/\n\s*at [^:]*:[^\n]*/,l=o.test(a);c.exports=function(h,d){if(l&&typeof h=="string"&&!i.prepareStackTrace)for(;d--;)h=n(h,o,"");return h}},8622:(c,e,t)=>{var s=t(4576),i=t(4901),n=s.WeakMap;c.exports=i(n)&&/native code/.test(String(n))},8646:(c,e,t)=>{var s=t(9565),i=t(8551),n=t(1767),a=t(851);c.exports=function(o,l){(!l||typeof o!="string")&&i(o);var h=a(o);return n(i(h!==void 0?s(h,o):o))}},8686:(c,e,t)=>{var s=t(3724),i=t(9039);c.exports=s&&i(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42})},8721:(c,e,t)=>{var s=t(3724),i=t(9504),n=t(2106),a=URLSearchParams.prototype,o=i(a.forEach);s&&!("size"in a)&&n(a,"size",{get:function(){var h=0;return o(this,function(){h++}),h},configurable:!0,enumerable:!0})},8727:c=>{c.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},8745:(c,e,t)=>{var s=t(616),i=Function.prototype,n=i.apply,a=i.call;c.exports=typeof Reflect=="object"&&Reflect.apply||(s?a.bind(n):function(){return a.apply(n,arguments)})},8750:(c,e,t)=>{var s=t(7080),i=t(4402),n=t(5170),a=t(3789),o=t(8469),l=t(507),h=i.Set,d=i.add,u=i.has;c.exports=function(p){var m=s(this),v=a(p),A=new h;return n(m)>v.size?l(v.getIterator(),function(b){u(m,b)&&d(A,b)}):o(m,function(b){v.includes(b)&&d(A,b)}),A}},8773:(c,e)=>{var t={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,i=s&&!t.call({1:2},1);e.f=i?function(a){var o=s(this,a);return!!o&&o.enumerable}:t},8981:(c,e,t)=>{var s=t(7750),i=Object;c.exports=function(n){return i(s(n))}},9039:c=>{c.exports=function(e){try{return!!e()}catch{return!0}}},9143:(c,e,t)=>{var s=t(4576),i=t(9504),n=t(3972),a=t(3463),o=t(9297),l=t(2804),h=t(944),d=t(5169),u=l.c2i,f=l.c2iUrl,p=s.SyntaxError,m=s.TypeError,v=i("".charAt),A=function(E,T){for(var x=E.length;T<x;T++){var C=v(E,T);if(C!==" "&&C!=="	"&&C!==`
`&&C!=="\f"&&C!=="\r")break}return T},b=function(E,T,x){var C=E.length;C<4&&(E+=C===2?"AA":"A");var P=(T[v(E,0)]<<18)+(T[v(E,1)]<<12)+(T[v(E,2)]<<6)+T[v(E,3)],I=[P>>16&255,P>>8&255,P&255];if(C===2){if(x&&I[1]!==0)throw new p("Extra bits");return[I[0]]}if(C===3){if(x&&I[2]!==0)throw new p("Extra bits");return[I[0],I[1]]}return I},S=function(E,T,x){for(var C=T.length,P=0;P<C;P++)E[x+P]=T[P];return x+C};c.exports=function(E,T,x,C){a(E),n(T);var P=h(T)==="base64"?u:f,I=T?T.lastChunkHandling:void 0;if(I===void 0&&(I="loose"),I!=="loose"&&I!=="strict"&&I!=="stop-before-partial")throw new m("Incorrect `lastChunkHandling` option");x&&d(x.buffer);var R=E.length,L=x||[],D=0,O=0,F="",B=0;if(C)for(;;){if(B=A(E,B),B===R){if(F.length>0){if(I==="stop-before-partial")break;if(I==="loose"){if(F.length===1)throw new p("Malformed padding: exactly one additional character");D=S(L,b(F,P,!1),D)}else throw new p("Missing padding")}O=R;break}var W=v(E,B);if(++B,W==="="){if(F.length<2)throw new p("Padding is too early");if(B=A(E,B),F.length===2){if(B===R){if(I==="stop-before-partial")break;throw new p("Malformed padding: only one =")}v(E,B)==="="&&(++B,B=A(E,B))}if(B<R)throw new p("Unexpected character after padding");D=S(L,b(F,P,I==="strict"),D),O=R;break}if(!o(P,W))throw new p("Unexpected character");var _=C-D;if(_===1&&F.length===2||_===2&&F.length===3||(F+=W,F.length===4&&(D=S(L,b(F,P,!1),D),F="",O=B,D===C)))break}return{bytes:L,read:O,written:D}}},9286:(c,e,t)=>{var s=t(4402),i=t(8469),n=s.Set,a=s.add;c.exports=function(o){var l=new n;return i(o,function(h){a(l,h)}),l}},9297:(c,e,t)=>{var s=t(9504),i=t(8981),n=s({}.hasOwnProperty);c.exports=Object.hasOwn||function(o,l){return n(i(o),l)}},9306:(c,e,t)=>{var s=t(4901),i=t(6823),n=TypeError;c.exports=function(a){if(s(a))return a;throw new n(i(a)+" is not a function")}},9314:(c,e,t)=>{var s=t(6518),i=t(9565),n=t(8551),a=t(1767),o=t(4149),l=t(9590),h=t(9539),d=t(9462),u=t(684),f=t(4549),p=t(6395),m=!p&&!u("drop",0),v=!p&&!m&&f("drop",RangeError),A=p||m||v,b=d(function(){for(var S=this.iterator,E=this.next,T,x;this.remaining;)if(this.remaining--,T=n(i(E,S)),x=this.done=!!T.done,x)return;if(T=n(i(E,S)),x=this.done=!!T.done,!x)return T.value});s({target:"Iterator",proto:!0,real:!0,forced:A},{drop:function(E){n(this);var T;try{T=l(o(+E))}catch(x){h(this,"throw",x)}return v?i(v,this,T):new b(a(this),{remaining:T})}})},9429:(c,e,t)=>{var s=t(4576),i=t(6193);c.exports=function(n){if(i){try{return s.process.getBuiltinModule(n)}catch{}try{return Function('return require("'+n+'")')()}catch{}}}},9432:(c,e,t)=>{t(5213)},9433:(c,e,t)=>{var s=t(4576),i=Object.defineProperty;c.exports=function(n,a){try{i(s,n,{value:a,configurable:!0,writable:!0})}catch{s[n]=a}return a}},9462:(c,e,t)=>{var s=t(9565),i=t(2360),n=t(6699),a=t(6279),o=t(8227),l=t(1181),h=t(5966),d=t(7657).IteratorPrototype,u=t(2529),f=t(9539),p=t(1385),m=o("toStringTag"),v="IteratorHelper",A="WrapForValidIterator",b="normal",S="throw",E=l.set,T=function(P){var I=l.getterFor(P?A:v);return a(i(d),{next:function(){var L=I(this);if(P)return L.nextHandler();if(L.done)return u(void 0,!0);try{var D=L.nextHandler();return L.returnHandlerResult?D:u(D,L.done)}catch(O){throw L.done=!0,O}},return:function(){var R=I(this),L=R.iterator;if(R.done=!0,P){var D=h(L,"return");return D?s(D,L):u(void 0,!0)}if(R.inner)try{f(R.inner.iterator,b)}catch(O){return f(L,S,O)}if(R.openIters)try{p(R.openIters,b)}catch(O){return f(L,S,O)}return L&&f(L,b),u(void 0,!0)}})},x=T(!0),C=T(!1);n(C,m,"Iterator Helper"),c.exports=function(P,I,R){var L=function(O,F){F?(F.iterator=O.iterator,F.next=O.next):F=O,F.type=I?A:v,F.returnHandlerResult=!!R,F.nextHandler=P,F.counter=0,F.done=!1,E(this,F)};return L.prototype=I?x:C,L}},9486:(c,e,t)=>{var s=t(6518),i=t(4576),n=t(9504),a=t(3972),o=t(4154),l=t(5169),h=t(2804),d=t(944),u=h.i2c,f=h.i2cUrl,p=n("".charAt),m=i.Uint8Array,v=!m||!m.prototype.toBase64||!function(){try{var A=new m;A.toBase64(null)}catch{return!0}}();m&&s({target:"Uint8Array",proto:!0,forced:v},{toBase64:function(){var b=o(this),S=arguments.length?a(arguments[0]):void 0,E=d(S)==="base64"?u:f,T=!!S&&!!S.omitPadding;l(this.buffer);for(var x="",C=0,P=b.length,I,R=function(L){return p(E,I>>6*L&63)};C+2<P;C+=3)I=(b[C]<<16)+(b[C+1]<<8)+b[C+2],x+=R(3)+R(2)+R(1)+R(0);return C+2===P?(I=(b[C]<<16)+(b[C+1]<<8),x+=R(3)+R(2)+R(1)+(T?"":"=")):C+1===P&&(I=b[C]<<16,x+=R(3)+R(2)+(T?"":"==")),x}})},9504:(c,e,t)=>{var s=t(616),i=Function.prototype,n=i.call,a=s&&i.bind.bind(n,n);c.exports=s?a:function(o){return function(){return n.apply(o,arguments)}}},9519:(c,e,t)=>{var s=t(4576),i=t(2839),n=s.process,a=s.Deno,o=n&&n.versions||a&&a.version,l=o&&o.v8,h,d;l&&(h=l.split("."),d=h[0]>0&&h[0]<4?1:+(h[0]+h[1])),!d&&i&&(h=i.match(/Edge\/(\d+)/),(!h||h[1]>=74)&&(h=i.match(/Chrome\/(\d+)/),h&&(d=+h[1]))),c.exports=d},9539:(c,e,t)=>{var s=t(9565),i=t(8551),n=t(5966);c.exports=function(a,o,l){var h,d;i(a);try{if(h=n(a,"return"),!h){if(o==="throw")throw l;return l}h=s(h,a)}catch(u){d=!0,h=u}if(o==="throw")throw l;if(d)throw h;return i(h),l}},9565:(c,e,t)=>{var s=t(616),i=Function.prototype.call;c.exports=s?i.bind(i):function(){return i.apply(i,arguments)}},9577:(c,e,t)=>{var s=t(9928),i=t(4644),n=t(1108),a=t(1291),o=t(5854),l=i.aTypedArray,h=i.getTypedArrayConstructor,d=i.exportTypedArrayMethod,u=function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(p){return p===8}}(),f=u&&function(){try{new Int8Array(1).with(-.5,1)}catch{return!0}}();d("with",function(p,m){var v=l(this),A=a(p),b=n(v)?o(m):+m;return s(v,h(v),A,b)},!u||f)},9590:(c,e,t)=>{var s=t(1291),i=RangeError;c.exports=function(n){var a=s(n);if(a<0)throw new i("The argument can't be less than 0");return a}},9617:(c,e,t)=>{var s=t(5397),i=t(5610),n=t(6198),a=function(o){return function(l,h,d){var u=s(l),f=n(u);if(f===0)return!o&&-1;var p=i(d,f),m;if(o&&h!==h){for(;f>p;)if(m=u[p++],m!==m)return!0}else for(;f>p;p++)if((o||p in u)&&u[p]===h)return o||p||0;return!o&&-1}};c.exports={includes:a(!0),indexOf:a(!1)}},9631:(c,e,t)=>{t(9486)},9797:(c,e,t)=>{t(4226)},9835:c=>{c.exports=function(e){try{var t=new Set,s={size:0,has:function(){return!0},keys:function(){return Object.defineProperty({},"next",{get:function(){return t.clear(),t.add(4),function(){return{done:!0}}}})}},i=t[e](s);return i.size===1&&i.values().next().value===4}catch{return!1}}},9928:(c,e,t)=>{var s=t(6198),i=t(1291),n=RangeError;c.exports=function(a,o,l,h){var d=s(a),u=i(l),f=u<0?d+u:u;if(f>=d||f<0)throw new n("Incorrect index");for(var p=new o(d),m=0;m<d;m++)p[m]=m===f?h:a[m];return p}}},Kp={};function nt(c){var e=Kp[c];if(e!==void 0)return e.exports;var t=Kp[c]={exports:{}};return zv[c].call(t.exports,t,t.exports,nt),t.exports}nt.d=(c,e)=>{for(var t in e)nt.o(e,t)&&!nt.o(c,t)&&Object.defineProperty(c,t,{enumerable:!0,get:e[t]})};nt.o=(c,e)=>Object.prototype.hasOwnProperty.call(c,e);nt(4114);nt(6573);nt(8100);nt(7936);nt(8111);nt(8237);nt(1689);nt(9577);nt(4235);nt(9432);nt(1549);nt(9797);nt(9631);nt(5623);nt(4979);nt(5781);const je=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),tf=[.001,0,0,.001,0,0],Gu=1.35,As={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},xn={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},vh="pdfjs_internal_editor_",tt={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},dt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},Ig={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},be={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},si={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Yt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},qa={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},jl={ERRORS:0,WARNINGS:1,INFOS:5},ze={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},dd={moveTo:0,lineTo:1,curveTo:2,closePath:3},Mg={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Bu=jl.WARNINGS;function Vv(c){Number.isInteger(c)&&(Bu=c)}function Gv(){return Bu}function _u(c){Bu>=jl.INFOS&&console.info(`Info: ${c}`)}function Q(c){Bu>=jl.WARNINGS&&console.warn(`Warning: ${c}`)}function Mt(c){throw new Error(c)}function ut(c,e){c||Mt(e)}function Wv(c){switch(c==null?void 0:c.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Pp(c,e=null,t=null){if(!c)return null;if(t&&typeof c=="string"){if(t.addDefaultProtocol&&c.startsWith("www.")){const i=c.match(/\./g);(i==null?void 0:i.length)>=2&&(c=`http://${c}`)}if(t.tryConvertEncoding)try{c=Qv(c)}catch{}}const s=e?URL.parse(c,e):URL.parse(c);return Wv(s)?s:null}function Rp(c,e,t=!1){const s=URL.parse(c);return s?(s.hash=e,s.href):t&&Pp(c,"http://example.com")?c.split("#",1)[0]+`${e?`#${e}`:""}`:""}function at(c,e,t,s=!1){return Object.defineProperty(c,e,{value:t,enumerable:!s,configurable:!0,writable:!1}),t}const Ka=function(){function e(t,s){this.message=t,this.name=s}return e.prototype=new Error,e.constructor=e,e}();let Jp=class extends Ka{constructor(e,t){super(e,"PasswordException"),this.code=t}},Wu=class extends Ka{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}},Zd=class extends Ka{constructor(e){super(e,"InvalidPDFException")}},yh=class extends Ka{constructor(e,t,s){super(e,"ResponseException"),this.status=t,this.missing=s}},Xv=class extends Ka{constructor(e){super(e,"FormatError")}},Pn=class extends Ka{constructor(e){super(e,"AbortException")}};function Dg(c){(typeof c!="object"||(c==null?void 0:c.length)===void 0)&&Mt("Invalid argument for bytesToString");const e=c.length,t=8192;if(e<t)return String.fromCharCode.apply(null,c);const s=[];for(let i=0;i<e;i+=t){const n=Math.min(i+t,e),a=c.subarray(i,n);s.push(String.fromCharCode.apply(null,a))}return s.join("")}function nd(c){typeof c!="string"&&Mt("Invalid argument for stringToBytes");const e=c.length,t=new Uint8Array(e);for(let s=0;s<e;++s)t[s]=c.charCodeAt(s)&255;return t}function Yv(c){return String.fromCharCode(c>>24&255,c>>16&255,c>>8&255,c&255)}function Kv(){const c=new Uint8Array(4);return c[0]=1,new Uint32Array(c.buffer,0,1)[0]===1}function Jv(){try{return new Function(""),!0}catch{return!1}}class ye{static get isLittleEndian(){return at(this,"isLittleEndian",Kv())}static get isEvalSupported(){return at(this,"isEvalSupported",Jv())}static get isOffscreenCanvasSupported(){return at(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return at(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return at(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){var e,t;return at(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const Xu=Array.from(Array(256).keys(),c=>c.toString(16).padStart(2,"0"));var Tn,wd,ef;class j{static makeHexColor(e,t,s){return`#${Xu[e]}${Xu[t]}${Xu[s]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let s;e[0]?(e[0]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[3],t[3]*=e[3]):(s=t[0],t[0]=t[1],t[1]=s,s=t[2],t[2]=t[3],t[3]=s,e[1]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t,s=0){const i=e[s],n=e[s+1];e[s]=i*t[0]+n*t[2]+t[4],e[s+1]=i*t[1]+n*t[3]+t[5]}static applyTransformToBezier(e,t,s=0){const i=t[0],n=t[1],a=t[2],o=t[3],l=t[4],h=t[5];for(let d=0;d<6;d+=2){const u=e[s+d],f=e[s+d+1];e[s+d]=u*i+f*a+l,e[s+d+1]=u*n+f*o+h}}static applyInverseTransform(e,t){const s=e[0],i=e[1],n=t[0]*t[3]-t[1]*t[2];e[0]=(s*t[3]-i*t[2]+t[2]*t[5]-t[4]*t[3])/n,e[1]=(-s*t[1]+i*t[0]+t[4]*t[1]-t[5]*t[0])/n}static axialAlignedBoundingBox(e,t,s){const i=t[0],n=t[1],a=t[2],o=t[3],l=t[4],h=t[5],d=e[0],u=e[1],f=e[2],p=e[3];let m=i*d+l,v=m,A=i*f+l,b=A,S=o*u+h,E=S,T=o*p+h,x=T;if(n!==0||a!==0){const C=n*d,P=n*f,I=a*u,R=a*p;m+=I,b+=I,A+=R,v+=R,S+=C,x+=C,T+=P,E+=P}s[0]=Math.min(s[0],m,A,v,b),s[1]=Math.min(s[1],S,T,E,x),s[2]=Math.max(s[2],m,A,v,b),s[3]=Math.max(s[3],S,T,E,x)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const s=e[0],i=e[1],n=e[2],a=e[3],o=s**2+i**2,l=s*n+i*a,h=n**2+a**2,d=(o+h)/2,u=Math.sqrt(d**2-(o*h-l**2));t[0]=Math.sqrt(d+u||1),t[1]=Math.sqrt(d-u||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const s=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(s>i)return null;const n=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return n>a?null:[s,n,i,a]}static pointBoundingBox(e,t,s){s[0]=Math.min(s[0],e),s[1]=Math.min(s[1],t),s[2]=Math.max(s[2],e),s[3]=Math.max(s[3],t)}static rectBoundingBox(e,t,s,i,n){n[0]=Math.min(n[0],e,s),n[1]=Math.min(n[1],t,i),n[2]=Math.max(n[2],e,s),n[3]=Math.max(n[3],t,i)}static bezierBoundingBox(e,t,s,i,n,a,o,l,h){h[0]=Math.min(h[0],e,o),h[1]=Math.min(h[1],t,l),h[2]=Math.max(h[2],e,o),h[3]=Math.max(h[3],t,l),w(this,Tn,ef).call(this,e,s,n,o,t,i,a,l,3*(-e+3*(s-n)+o),6*(e-2*s+n),3*(s-e),h),w(this,Tn,ef).call(this,e,s,n,o,t,i,a,l,3*(-t+3*(i-a)+l),6*(t-2*i+a),3*(i-t),h)}}Tn=new WeakSet,wd=function(e,t,s,i,n,a,o,l,h,d){if(h<=0||h>=1)return;const u=1-h,f=h*h,p=f*h,m=u*(u*(u*e+3*h*t)+3*f*s)+p*i,v=u*(u*(u*n+3*h*a)+3*f*o)+p*l;d[0]=Math.min(d[0],m),d[1]=Math.min(d[1],v),d[2]=Math.max(d[2],m),d[3]=Math.max(d[3],v)},ef=function(e,t,s,i,n,a,o,l,h,d,u,f){if(Math.abs(h)<1e-12){Math.abs(d)>=1e-12&&w(this,Tn,wd).call(this,e,t,s,i,n,a,o,l,-u/d,f);return}const p=d**2-4*u*h;if(p<0)return;const m=Math.sqrt(p),v=2*h;w(this,Tn,wd).call(this,e,t,s,i,n,a,o,l,(-d+m)/v,f),w(this,Tn,wd).call(this,e,t,s,i,n,a,o,l,(-d-m)/v,f)},y(j,Tn);function Qv(c){return decodeURIComponent(escape(c))}let Yu=null,Qp=null;function Lg(c){return Yu||(Yu=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Qp=new Map([["ﬅ","ſt"]])),c.replaceAll(Yu,(e,t,s)=>t?t.normalize("NFKC"):Qp.get(s))}function Ip(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const c=new Uint8Array(32);return crypto.getRandomValues(c),Dg(c)}const Mp="pdfjs_internal_id_";function Zv(c,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[s,i,...n]=t;if(!c(s)&&!Number.isInteger(s)||!e(i))return!1;const a=n.length;let o=!0;switch(i.name){case"XYZ":if(a<2||a>3)return!1;break;case"Fit":case"FitB":return a===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(a>1)return!1;break;case"FitR":if(a!==4)return!1;o=!1;break;default:return!1}for(const l of n)if(!(typeof l=="number"||o&&l===null))return!1;return!0}function Ne(c,e,t){return Math.min(Math.max(c,e),t)}function Og(c){return Uint8Array.prototype.toBase64?c.toBase64():btoa(Dg(c))}function qv(c){return Uint8Array.fromBase64?Uint8Array.fromBase64(c):nd(atob(c))}typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(c){return c.reduce((e,t)=>e+t,0)});typeof AbortSignal.any!="function"&&(AbortSignal.any=function(c){const e=new AbortController,{signal:t}=e;for(const s of c)if(s.aborted)return e.abort(s.reason),t;for(const s of c)s.addEventListener("abort",()=>{e.abort(s.reason)},{signal:t});return t});nt(1701);nt(4603);nt(7566);nt(8721);class bh{static textContent(e){const t=[],s={items:t,styles:Object.create(null)};function i(n){var l;if(!n)return;let a=null;const o=n.name;if(o==="#text")a=n.value;else if(bh.shouldBuildText(o))(l=n==null?void 0:n.attributes)!=null&&l.textContent?a=n.attributes.textContent:n.value&&(a=n.value);else return;if(a!==null&&t.push({str:a}),!!n.children)for(const h of n.children)i(h)}return i(e),s}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}class Dp{static setupStorage(e,t,s,i,n){const a=i.getValue(t,{value:null});switch(s.name){case"textarea":if(a.value!==null&&(e.textContent=a.value),n==="print")break;e.addEventListener("input",o=>{i.setValue(t,{value:o.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(a.value===s.attributes.xfaOn?e.setAttribute("checked",!0):a.value===s.attributes.xfaOff&&e.removeAttribute("checked"),n==="print")break;e.addEventListener("change",o=>{i.setValue(t,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&e.setAttribute("value",a.value),n==="print")break;e.addEventListener("input",o=>{i.setValue(t,{value:o.target.value})})}break;case"select":if(a.value!==null){e.setAttribute("value",a.value);for(const o of s.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}e.addEventListener("input",o=>{const l=o.target.options,h=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(t,{value:h})});break}}static setAttributes({html:e,element:t,storage:s=null,intent:i,linkService:n}){const{attributes:a}=t,o=e instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${i}`);for(const[l,h]of Object.entries(a))if(h!=null)switch(l){case"class":h.length&&e.setAttribute(l,h.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",h);break;case"style":Object.assign(e.style,h);break;case"textContent":e.textContent=h;break;default:(!o||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,h)}o&&n.addLinkAttributes(e,a.href,a.newWindow),s&&a.dataId&&this.setupStorage(e,a.dataId,t,s)}static render(e){var u,f;const t=e.annotationStorage,s=e.linkService,i=e.xfaHtml,n=e.intent||"display",a=document.createElement(i.name);i.attributes&&this.setAttributes({html:a,element:i,intent:n,linkService:s});const o=n!=="richText",l=e.div;if(l.append(a),e.viewport){const p=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=p}o&&l.setAttribute("class","xfaLayer xfaFont");const h=[];if(i.children.length===0){if(i.value){const p=document.createTextNode(i.value);a.append(p),o&&bh.shouldBuildText(i.name)&&h.push(p)}return{textDivs:h}}const d=[[i,-1,a]];for(;d.length>0;){const[p,m,v]=d.at(-1);if(m+1===p.children.length){d.pop();continue}const A=p.children[++d.at(-1)[1]];if(A===null)continue;const{name:b}=A;if(b==="#text"){const E=document.createTextNode(A.value);h.push(E),v.append(E);continue}const S=(u=A==null?void 0:A.attributes)!=null&&u.xmlns?document.createElementNS(A.attributes.xmlns,b):document.createElement(b);if(v.append(S),A.attributes&&this.setAttributes({html:S,element:A,storage:t,intent:n,linkService:s}),((f=A.children)==null?void 0:f.length)>0)d.push([A,-1,S]);else if(A.value){const E=document.createTextNode(A.value);o&&bh.shouldBuildText(b)&&h.push(E),S.append(E)}}for(const p of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))p.setAttribute("readOnly",!0);return{textDivs:h}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const Fi="http://www.w3.org/2000/svg",kr=class kr{};M(kr,"CSS",96),M(kr,"PDF",72),M(kr,"PDF_TO_CSS_UNITS",kr.CSS/kr.PDF);let Rn=kr;async function zl(c,e="text"){if(Jl(c,document.baseURI)){const t=await fetch(c);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,s)=>{const i=new XMLHttpRequest;i.open("GET",c,!0),i.responseType=e,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(i.response);return}t(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class rd{constructor({viewBox:e,userUnit:t,scale:s,rotation:i,offsetX:n=0,offsetY:a=0,dontFlip:o=!1}){this.viewBox=e,this.userUnit=t,this.scale=s,this.rotation=i,this.offsetX=n,this.offsetY=a,s*=t;const l=(e[2]+e[0])/2,h=(e[3]+e[1])/2;let d,u,f,p;switch(i%=360,i<0&&(i+=360),i){case 180:d=-1,u=0,f=0,p=1;break;case 90:d=0,u=1,f=1,p=0;break;case 270:d=0,u=-1,f=-1,p=0;break;case 0:d=1,u=0,f=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(f=-f,p=-p);let m,v,A,b;d===0?(m=Math.abs(h-e[1])*s+n,v=Math.abs(l-e[0])*s+a,A=(e[3]-e[1])*s,b=(e[2]-e[0])*s):(m=Math.abs(l-e[0])*s+n,v=Math.abs(h-e[1])*s+a,A=(e[2]-e[0])*s,b=(e[3]-e[1])*s),this.transform=[d*s,u*s,f*s,p*s,m-d*s*l-f*s*h,v-u*s*l-p*s*h],this.width=A,this.height=b}get rawDims(){const e=this.viewBox;return at(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:n=!1}={}){return new rd({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:n})}convertToViewportPoint(e,t){const s=[e,t];return j.applyTransform(s,this.transform),s}convertToViewportRectangle(e){const t=[e[0],e[1]];j.applyTransform(t,this.transform);const s=[e[2],e[3]];return j.applyTransform(s,this.transform),[t[0],t[1],s[0],s[1]]}convertToPdfPoint(e,t){const s=[e,t];return j.applyInverseTransform(s,this.transform),s}}class Uu extends Ka{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function ad(c){const e=c.length;let t=0;for(;t<e&&c[t].trim()==="";)t++;return c.substring(t,t+5).toLowerCase()==="data:"}function Hu(c){return typeof c=="string"&&/\.pdf$/i.test(c)}function kg(c){return[c]=c.split(/[#?]/,1),c.substring(c.lastIndexOf("/")+1)}function Ng(c,e="document.pdf"){if(typeof c!="string")return e;if(ad(c))return Q('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const s=(o=>{try{return new URL(o)}catch{try{return new URL(decodeURIComponent(o))}catch{try{return new URL(o,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(o),"https://foo.bar")}catch{return null}}}}})(c);if(!s)return e;const i=o=>{try{let l=decodeURIComponent(o);return l.includes("/")?(l=l.split("/").at(-1),l.test(/^\.pdf$/i)?l:o):l}catch{return o}},n=/\.pdf$/i,a=s.pathname.split("/").at(-1);if(n.test(a))return i(a);if(s.searchParams.size>0){const o=Array.from(s.searchParams.values()).reverse();for(const h of o)if(n.test(h))return i(h);const l=Array.from(s.searchParams.keys()).reverse();for(const h of l)if(n.test(h))return i(h)}if(s.hash){const l=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(s.hash);if(l)return i(l[0])}return e}class Zp{constructor(){M(this,"started",Object.create(null));M(this,"times",[])}time(e){e in this.started&&Q(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Q(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:s}of this.times)t=Math.max(s.length,t);for(const{name:s,start:i,end:n}of this.times)e.push(`${s.padEnd(t)} ${n-i}ms
`);return e.join("")}}function Jl(c,e){const t=e?URL.parse(c,e):URL.parse(c);return(t==null?void 0:t.protocol)==="http:"||(t==null?void 0:t.protocol)==="https:"}function Ts(c){c.preventDefault()}function $t(c){c.preventDefault(),c.stopPropagation()}function ty(c){console.log("Deprecated API usage: "+c)}var xh;class Xa{static toDateObject(e){if(e instanceof Date)return e;if(!e||typeof e!="string")return null;r(this,xh)||g(this,xh,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=r(this,xh).exec(e);if(!t)return null;const s=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let n=parseInt(t[3],10);n=n>=1&&n<=31?n:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(t[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const h=t[7]||"Z";let d=parseInt(t[8],10);d=d>=0&&d<=23?d:0;let u=parseInt(t[9],10)||0;return u=u>=0&&u<=59?u:0,h==="-"?(a+=d,o+=u):h==="+"&&(a-=d,o-=u),new Date(Date.UTC(s,i,n,a,o,l))}}xh=new WeakMap,y(Xa,xh);function Fg(c,{scale:e=1,rotation:t=0}){const{width:s,height:i}=c.attributes.style,n=[0,0,parseInt(s),parseInt(i)];return new rd({viewBox:n,userUnit:1,scale:e,rotation:t})}function Vl(c){if(c.startsWith("#")){const e=parseInt(c.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return c.startsWith("rgb(")?c.slice(4,-1).split(",").map(e=>parseInt(e)):c.startsWith("rgba(")?c.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Q(`Not a valid color format: "${c}"`),[0,0,0])}function ey(c){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of c.keys()){e.style.color=t;const s=window.getComputedStyle(e).color;c.set(t,Vl(s))}e.remove()}function Ut(c){const{a:e,b:t,c:s,d:i,e:n,f:a}=c.getTransform();return[e,t,s,i,n,a]}function oi(c){const{a:e,b:t,c:s,d:i,e:n,f:a}=c.getTransform().invertSelf();return[e,t,s,i,n,a]}function Cr(c,e,t=!1,s=!0){if(e instanceof rd){const{pageWidth:i,pageHeight:n}=e.rawDims,{style:a}=c,o=ye.isCSSRoundSupported,l=`var(--total-scale-factor) * ${i}px`,h=`var(--total-scale-factor) * ${n}px`,d=o?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,u=o?`round(down, ${h}, var(--scale-round-y))`:`calc(${h})`;!t||e.rotation%180===0?(a.width=d,a.height=u):(a.width=u,a.height=d)}s&&c.setAttribute("data-main-rotation",e.rotation)}class ri{constructor(){const{pixelRatio:e}=ri;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,s,i,n=-1){let a=1/0,o=1/0,l=1/0;s=ri.capPixels(s,n),s>0&&(a=Math.sqrt(s/(e*t))),i!==-1&&(o=i/e,l=i/t);const h=Math.min(a,o,l);return this.sx>h||this.sy>h?(this.sx=h,this.sy=h,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const s=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,s):s}return e}}const qd=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class sy{static get isDarkMode(){var e;return at(this,"isDarkMode",!!((e=window==null?void 0:window.matchMedia)!=null&&e.call(window,"(prefers-color-scheme: dark)").matches))}}class Bg{static get commentForegroundColor(){const e=document.createElement("span");e.classList.add("comment","sidebar");const{style:t}=e;t.width=t.height="0",t.display="none",t.color="var(--comment-fg-color)",document.body.append(e);const{color:s}=window.getComputedStyle(e);return e.remove(),at(this,"commentForegroundColor",Vl(s))}}function _g(c,e,t,s){s=Math.min(Math.max(s??1,0),1);const i=255*(1-s);return c=Math.round(c*s+i),e=Math.round(e*s+i),t=Math.round(t*s+i),[c,e,t]}function qp(c,e){const t=c[0]/255,s=c[1]/255,i=c[2]/255,n=Math.max(t,s,i),a=Math.min(t,s,i),o=(n+a)/2;if(n===a)e[0]=e[1]=0;else{const l=n-a;switch(e[1]=o<.5?l/(n+a):l/(2-n-a),n){case t:e[0]=((s-i)/l+(s<i?6:0))*60;break;case s:e[0]=((i-t)/l+2)*60;break;case i:e[0]=((t-s)/l+4)*60;break}}e[2]=o}function sf(c,e){const t=c[0],s=c[1],i=c[2],n=(1-Math.abs(2*i-1))*s,a=n*(1-Math.abs(t/60%2-1)),o=i-n/2;switch(Math.floor(t/60)){case 0:e[0]=n+o,e[1]=a+o,e[2]=o;break;case 1:e[0]=a+o,e[1]=n+o,e[2]=o;break;case 2:e[0]=o,e[1]=n+o,e[2]=a+o;break;case 3:e[0]=o,e[1]=a+o,e[2]=n+o;break;case 4:e[0]=a+o,e[1]=o,e[2]=n+o;break;case 5:case 6:e[0]=n+o,e[1]=o,e[2]=a+o;break}}function tg(c){return c<=.03928?c/12.92:((c+.055)/1.055)**2.4}function eg(c,e,t){sf(c,t),t.map(tg);const s=.2126*t[0]+.7152*t[1]+.0722*t[2];sf(e,t),t.map(tg);const i=.2126*t[0]+.7152*t[1]+.0722*t[2];return s>i?(s+.05)/(i+.05):(i+.05)/(s+.05)}const sg=new Map;function Ug(c,e){const t=c[0]+c[1]*256+c[2]*65536+e[0]*16777216+e[1]*4294967296+e[2]*1099511627776;let s=sg.get(t);if(s)return s;const i=new Float32Array(9),n=i.subarray(0,3),a=i.subarray(3,6);qp(c,a);const o=i.subarray(6,9);qp(e,o);const l=o[2]<.5,h=l?12:4.5;if(a[2]=l?Math.sqrt(a[2]):1-Math.sqrt(1-a[2]),eg(a,o,n)<h){let d,u;l?(d=a[2],u=1):(d=0,u=a[2]);const f=.005;for(;u-d>f;){const p=a[2]=(d+u)/2;l===eg(a,o,n)<h?d=p:u=p}a[2]=l?u:d}return sf(a,n),s=j.makeHexColor(Math.round(n[0]*255),Math.round(n[1]*255),Math.round(n[2]*255)),sg.set(t,s),s}function Lp({html:c,dir:e,className:t},s){const i=document.createDocumentFragment();if(typeof c=="string"){const n=document.createElement("p");n.dir=e||"auto";const a=c.split(/(?:\r\n?|\n)/);for(let o=0,l=a.length;o<l;++o){const h=a[o];n.append(document.createTextNode(h)),o<l-1&&n.append(document.createElement("br"))}i.append(n)}else Dp.render({xfaHtml:c,div:i,intent:"richText"});i.firstChild.classList.add("richText",t),s.append(i)}nt(4972);nt(4628);nt(7642);nt(8004);nt(3853);nt(5876);nt(2475);nt(5024);nt(1698);nt(9314);nt(1148);nt(3579);nt(8335);var Ln,On,Is,Ms,Th,kn,mo,vo,Ch,yu,Hg,Pe,$g,jg,to,Ql;const Hi=class Hi{constructor(e){y(this,Pe);y(this,Ln,null);y(this,On,null);y(this,Is);y(this,Ms,null);y(this,Th,null);y(this,kn,null);y(this,mo,null);y(this,vo,null);g(this,Is,e),r(Hi,Ch)||g(Hi,Ch,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const e=g(this,Ln,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=r(this,Is)._uiManager._signal;t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("contextmenu",Ts,{signal:t}),e.addEventListener("pointerdown",w(Hi,yu,Hg),{signal:t}));const s=g(this,Ms,document.createElement("div"));s.className="buttons",e.append(s);const i=r(this,Is).toolbarPosition;if(i){const{style:n}=e,a=r(this,Is)._uiManager.direction==="ltr"?1-i[0]:i[0];n.insetInlineEnd=`${100*a}%`,n.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return r(this,Ln)}hide(){var e;r(this,Ln).classList.add("hidden"),(e=r(this,On))==null||e.hideDropdown()}show(){var e,t;r(this,Ln).classList.remove("hidden"),(e=r(this,Th))==null||e.shown(),(t=r(this,kn))==null||t.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=r(this,Is),s=document.createElement("button");s.classList.add("basic","deleteButton"),s.tabIndex=0,s.setAttribute("data-l10n-id",r(Hi,Ch)[e]),w(this,Pe,to).call(this,s)&&s.addEventListener("click",i=>{t.delete()},{signal:t._signal}),r(this,Ms).append(s)}async addAltText(e){const t=await e.render();w(this,Pe,to).call(this,t),r(this,Ms).append(t,r(this,Pe,Ql)),g(this,Th,e)}addComment(e,t=null){if(r(this,kn))return;const s=e.renderForToolbar();if(!s)return;w(this,Pe,to).call(this,s);const i=g(this,mo,r(this,Pe,Ql));t?(r(this,Ms).insertBefore(s,t),r(this,Ms).insertBefore(i,t)):r(this,Ms).append(s,i),g(this,kn,e),e.toolbar=this}addColorPicker(e){if(r(this,On))return;g(this,On,e);const t=e.renderButton();w(this,Pe,to).call(this,t),r(this,Ms).append(t,r(this,Pe,Ql))}async addEditSignatureButton(e){const t=g(this,vo,await e.renderEditButton(r(this,Is)));w(this,Pe,to).call(this,t),r(this,Ms).append(t,r(this,Pe,Ql))}removeButton(e){var t,s;switch(e){case"comment":(t=r(this,kn))==null||t.removeToolbarCommentButton(),g(this,kn,null),(s=r(this,mo))==null||s.remove(),g(this,mo,null);break}}async addButton(e,t){switch(e){case"colorPicker":this.addColorPicker(t);break;case"altText":await this.addAltText(t);break;case"editSignature":await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(t);break}}async addButtonBefore(e,t,s){const i=r(this,Ms).querySelector(s);i&&e==="comment"&&this.addComment(t,i)}updateEditSignatureButton(e){r(this,vo)&&(r(this,vo).title=e)}remove(){var e;r(this,Ln).remove(),(e=r(this,On))==null||e.destroy(),g(this,On,null)}};Ln=new WeakMap,On=new WeakMap,Is=new WeakMap,Ms=new WeakMap,Th=new WeakMap,kn=new WeakMap,mo=new WeakMap,vo=new WeakMap,Ch=new WeakMap,yu=new WeakSet,Hg=function(e){e.stopPropagation()},Pe=new WeakSet,$g=function(e){r(this,Is)._focusEventsAllowed=!1,$t(e)},jg=function(e){r(this,Is)._focusEventsAllowed=!0,$t(e)},to=function(e){const t=r(this,Is)._uiManager._signal;return!(t instanceof AbortSignal)||t.aborted?!1:(e.addEventListener("focusin",w(this,Pe,$g).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",w(this,Pe,jg).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Ts,{signal:t}),!0)},Ql=function(){const e=document.createElement("div");return e.className="divider",e},y(Hi,yu),y(Hi,Ch,null);let nf=Hi;var Ph,Br,ji,In,zg,Vg,rf;class iy{constructor(e){y(this,In);y(this,Ph,null);y(this,Br,null);y(this,ji);g(this,ji,e)}show(e,t,s){const[i,n]=w(this,In,Vg).call(this,t,s),{style:a}=r(this,Br)||g(this,Br,w(this,In,zg).call(this));e.append(r(this,Br)),a.insetInlineEnd=`${100*i}%`,a.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){r(this,Br).remove()}}Ph=new WeakMap,Br=new WeakMap,ji=new WeakMap,In=new WeakSet,zg=function(){const e=g(this,Br,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar");const t=r(this,ji)._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener("contextmenu",Ts,{signal:t});const s=g(this,Ph,document.createElement("div"));return s.className="buttons",e.append(s),r(this,ji).hasCommentManager()&&w(this,In,rf).call(this,"commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{r(this,ji).commentSelection("floating_button")}),w(this,In,rf).call(this,"highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{r(this,ji).highlightSelection("floating_button")}),e},Vg=function(e,t){let s=0,i=0;for(const n of e){const a=n.y+n.height;if(a<s)continue;const o=n.x+(t?n.width:0);if(a>s){i=o,s=a;continue}t?o>i&&(i=o):o<i&&(i=o)}return[t?1-i:i,s]},rf=function(e,t,s,i){const n=document.createElement("button");n.classList.add("basic",e),n.tabIndex=0,n.setAttribute("data-l10n-id",t);const a=document.createElement("span");n.append(a),a.className="visuallyHidden",a.setAttribute("data-l10n-id",s);const o=r(this,ji)._signal;o instanceof AbortSignal&&!o.aborted&&(n.addEventListener("contextmenu",Ts,{signal:o}),n.addEventListener("click",i,{signal:o})),r(this,Ph).append(n)};function Gg(c,e,t){for(const s of t)e.addEventListener(s,c[s].bind(c))}var bu;class ny{constructor(){y(this,bu,0)}get id(){return`${vh}${he(this,bu)._++}`}}bu=new WeakMap;var yo,Rh,Ie,bo,Ed;const jp=class jp{constructor(){y(this,bo);y(this,yo,Ip());y(this,Rh,0);y(this,Ie,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=e;const n=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return at(this,"_isSVGFittingCanvas",n)}async getFromFile(e){const{lastModified:t,name:s,size:i,type:n}=e;return w(this,bo,Ed).call(this,`${t}_${s}_${i}_${n}`,e)}async getFromUrl(e){return w(this,bo,Ed).call(this,e,e)}async getFromBlob(e,t){const s=await t;return w(this,bo,Ed).call(this,e,s)}async getFromId(e){r(this,Ie)||g(this,Ie,new Map);const t=r(this,Ie).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:s}=t;return delete t.blobPromise,this.getFromBlob(t.id,s)}return this.getFromUrl(t.url)}getFromCanvas(e,t){r(this,Ie)||g(this,Ie,new Map);let s=r(this,Ie).get(e);if(s!=null&&s.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${r(this,yo)}_${he(this,Rh)._++}`,refCounter:1,isSvg:!1},r(this,Ie).set(e,s),r(this,Ie).set(s.id,s),s}getSvgUrl(e){const t=r(this,Ie).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var i;r(this,Ie)||g(this,Ie,new Map);const t=r(this,Ie).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:s}=t;if(!t.url&&!t.file){const n=new OffscreenCanvas(s.width,s.height);n.getContext("bitmaprenderer").transferFromImageBitmap(s),t.blobPromise=n.convertToBlob()}(i=s.close)==null||i.call(s),t.bitmap=null}isValidId(e){return e.startsWith(`image_${r(this,yo)}_`)}};yo=new WeakMap,Rh=new WeakMap,Ie=new WeakMap,bo=new WeakSet,Ed=async function(e,t){r(this,Ie)||g(this,Ie,new Map);let s=r(this,Ie).get(e);if(s===null)return null;if(s!=null&&s.bitmap)return s.refCounter+=1,s;try{s||(s={bitmap:null,id:`image_${r(this,yo)}_${he(this,Rh)._++}`,refCounter:0,isSvg:!1});let i;if(typeof t=="string"?(s.url=t,i=await zl(t,"blob")):t instanceof File?i=s.file=t:t instanceof Blob&&(i=t),i.type==="image/svg+xml"){const n=jp._isSVGFittingCanvas,a=new FileReader,o=new Image,l=new Promise((h,d)=>{o.onload=()=>{s.bitmap=o,s.isSvg=!0,h()},a.onload=async()=>{const u=s.svgUrl=a.result;o.src=await n?`${u}#svgView(preserveAspectRatio(none))`:u},o.onerror=a.onerror=d});a.readAsDataURL(i),await l}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){Q(i),s=null}return r(this,Ie).set(e,s),s&&r(this,Ie).set(s.id,s),s};let af=jp;var Kt,Nn,Ih,_t;class ry{constructor(e=128){y(this,Kt,[]);y(this,Nn,!1);y(this,Ih);y(this,_t,-1);g(this,Ih,e)}add({cmd:e,undo:t,post:s,mustExec:i,type:n=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(i&&e(),r(this,Nn))return;const l={cmd:e,undo:t,post:s,type:n};if(r(this,_t)===-1){r(this,Kt).length>0&&(r(this,Kt).length=0),g(this,_t,0),r(this,Kt).push(l);return}if(a&&r(this,Kt)[r(this,_t)].type===n){o&&(l.undo=r(this,Kt)[r(this,_t)].undo),r(this,Kt)[r(this,_t)]=l;return}const h=r(this,_t)+1;h===r(this,Ih)?r(this,Kt).splice(0,1):(g(this,_t,h),h<r(this,Kt).length&&r(this,Kt).splice(h)),r(this,Kt).push(l)}undo(){if(r(this,_t)===-1)return;g(this,Nn,!0);const{undo:e,post:t}=r(this,Kt)[r(this,_t)];e(),t==null||t(),g(this,Nn,!1),g(this,_t,r(this,_t)-1)}redo(){if(r(this,_t)<r(this,Kt).length-1){g(this,_t,r(this,_t)+1),g(this,Nn,!0);const{cmd:e,post:t}=r(this,Kt)[r(this,_t)];e(),t==null||t(),g(this,Nn,!1)}}hasSomethingToUndo(){return r(this,_t)!==-1}hasSomethingToRedo(){return r(this,_t)<r(this,Kt).length-1}cleanType(e){if(r(this,_t)!==-1){for(let t=r(this,_t);t>=0;t--)if(r(this,Kt)[t].type!==e){r(this,Kt).splice(t+1,r(this,_t)-t),g(this,_t,t);return}r(this,Kt).length=0,g(this,_t,-1)}}destroy(){g(this,Kt,null)}}Kt=new WeakMap,Nn=new WeakMap,Ih=new WeakMap,_t=new WeakMap;var Au,Wg;class od{constructor(e){y(this,Au);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=ye.platform;for(const[s,i,n={}]of e)for(const a of s){const o=a.startsWith("mac+");t&&o?(this.callbacks.set(a.slice(4),{callback:i,options:n}),this.allKeys.add(a.split("+").at(-1))):!t&&!o&&(this.callbacks.set(a,{callback:i,options:n}),this.allKeys.add(a.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const s=this.callbacks.get(w(this,Au,Wg).call(this,t));if(!s)return;const{callback:i,options:{bubbles:n=!1,args:a=[],checker:o=null}}=s;o&&!o(e,t)||(i.bind(e,...a,t)(),n||$t(t))}}Au=new WeakSet,Wg=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const wu=class wu{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return ey(e),at(this,"_colors",e)}convert(e){const t=Vl(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[s,i]of this._colors)if(i.every((n,a)=>n===t[a]))return wu._colorsMapping.get(s);return t}getHexCode(e){const t=this._colors.get(e);return t?j.makeHexColor(...t):e}};M(wu,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let of=wu;var Ao,is,wo,Vt,ne,Eo,Ds,So,Ls,Me,Fn,Bn,xo,_n,ci,Os,_r,Mh,Dh,To,Lh,di,Un,Co,Hn,ui,Eu,$n,Po,Oh,jn,Ur,Ro,zn,kh,qt,At,zi,Vn,Gn,Nh,Io,Fh,Wn,fi,Vi,Bh,_h,ks,U,Sd,lf,Xg,Yg,Zl,Kg,Jg,Qg,hf,Zg,cf,df,qg,Be,Bi,tm,em,uf,sm,ql,ff;const ho=class ho{constructor(e,t,s,i,n,a,o,l,h,d,u,f,p,m,v,A){y(this,U);y(this,Ao,new AbortController);y(this,is,null);y(this,wo,null);y(this,Vt,new Map);y(this,ne,new Map);y(this,Eo,null);y(this,Ds,null);y(this,So,null);y(this,Ls,new ry);y(this,Me,null);y(this,Fn,null);y(this,Bn,null);y(this,xo,0);y(this,_n,new Set);y(this,ci,null);y(this,Os,null);y(this,_r,new Set);M(this,"_editorUndoBar",null);y(this,Mh,!1);y(this,Dh,!1);y(this,To,!1);y(this,Lh,null);y(this,di,null);y(this,Un,null);y(this,Co,null);y(this,Hn,!1);y(this,ui,null);y(this,Eu,new ny);y(this,$n,!1);y(this,Po,!1);y(this,Oh,!1);y(this,jn,null);y(this,Ur,null);y(this,Ro,null);y(this,zn,null);y(this,kh,null);y(this,qt,tt.NONE);y(this,At,new Set);y(this,zi,null);y(this,Vn,null);y(this,Gn,null);y(this,Nh,null);y(this,Io,null);y(this,Fh,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});y(this,Wn,[0,0]);y(this,fi,null);y(this,Vi,null);y(this,Bh,null);y(this,_h,null);y(this,ks,null);const b=this._signal=r(this,Ao).signal;g(this,Vi,e),g(this,Bh,t),g(this,_h,s),g(this,Eo,i),g(this,Me,n),g(this,Vn,a),g(this,Io,l),this._eventBus=o,o._on("editingaction",this.onEditingAction.bind(this),{signal:b}),o._on("pagechanging",this.onPageChanging.bind(this),{signal:b}),o._on("scalechanging",this.onScaleChanging.bind(this),{signal:b}),o._on("rotationchanging",this.onRotationChanging.bind(this),{signal:b}),o._on("setpreference",this.onSetPreference.bind(this),{signal:b}),o._on("switchannotationeditorparams",S=>this.updateParams(S.type,S.value),{signal:b}),window.addEventListener("pointerdown",()=>{g(this,Po,!0)},{capture:!0,signal:b}),window.addEventListener("pointerup",()=>{g(this,Po,!1)},{capture:!0,signal:b}),w(this,U,Kg).call(this),w(this,U,qg).call(this),w(this,U,hf).call(this),g(this,Ds,l.annotationStorage),g(this,Lh,l.filterFactory),g(this,Gn,h),g(this,Co,d||null),g(this,Mh,u),g(this,Dh,f),g(this,To,p),g(this,kh,m||null),this.viewParameters={realScale:Rn.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=v||null,this._supportsPinchToZoom=A!==!1,n==null||n.setSidebarUiManager(this)}static get _keyboardManager(){const e=ho.prototype,t=a=>r(a,Vi).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),s=(a,{target:o})=>{if(o instanceof HTMLInputElement){const{type:l}=o;return l!=="text"&&l!=="number"}return!0},i=this.TRANSLATE_SMALL,n=this.TRANSLATE_BIG;return at(this,"_keyboardManager",new od([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],e.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:s}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&r(a,Vi).contains(o)&&!a.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&r(a,Vi).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-n,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[n,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-n],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,n],checker:t}]]))}destroy(){var e,t,s,i,n,a,o,l,h;(e=r(this,ks))==null||e.resolve(),g(this,ks,null),(t=r(this,Ao))==null||t.abort(),g(this,Ao,null),this._signal=null;for(const d of r(this,ne).values())d.destroy();r(this,ne).clear(),r(this,Vt).clear(),r(this,_r).clear(),(s=r(this,zn))==null||s.clear(),g(this,is,null),r(this,At).clear(),r(this,Ls).destroy(),(i=r(this,Eo))==null||i.destroy(),(n=r(this,Me))==null||n.destroy(),(a=r(this,Vn))==null||a.destroy(),(o=r(this,ui))==null||o.hide(),g(this,ui,null),(l=r(this,Ro))==null||l.destroy(),g(this,Ro,null),g(this,wo,null),r(this,di)&&(clearTimeout(r(this,di)),g(this,di,null)),r(this,fi)&&(clearTimeout(r(this,fi)),g(this,fi,null)),(h=this._editorUndoBar)==null||h.destroy(),g(this,Io,null)}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return r(this,kh)}get useNewAltTextFlow(){return r(this,Dh)}get useNewAltTextWhenAddingImage(){return r(this,To)}get hcmFilter(){return at(this,"hcmFilter",r(this,Gn)?r(this,Lh).addHCMFilter(r(this,Gn).foreground,r(this,Gn).background):"none")}get direction(){return at(this,"direction",getComputedStyle(r(this,Vi)).direction)}get _highlightColors(){return at(this,"_highlightColors",r(this,Co)?new Map(r(this,Co).split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){const{_highlightColors:e}=this;if(!e)return at(this,"highlightColors",null);const t=new Map,s=!!r(this,Gn);for(const[i,n]of e){const a=i.endsWith("_HCM");if(s&&a){t.set(i.replace("_HCM",""),n);continue}!s&&!a&&t.set(i,n)}return at(this,"highlightColors",t)}get highlightColorNames(){return at(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;const t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),g(this,Bn,e)}setMainHighlightColorPicker(e){g(this,Ro,e)}editAltText(e,t=!1){var s;(s=r(this,Eo))==null||s.editAltText(this,e,t)}hasCommentManager(){return!!r(this,Me)}editComment(e,t,s,i){var n;(n=r(this,Me))==null||n.showDialog(this,e,t,s,i)}selectComment(e,t){const s=r(this,ne).get(e),i=s==null?void 0:s.getEditorByUID(t);i==null||i.toggleComment(!0,!0)}updateComment(e){var t;(t=r(this,Me))==null||t.updateComment(e.getData())}updatePopupColor(e){var t;(t=r(this,Me))==null||t.updatePopupColor(e)}removeComment(e){var t;(t=r(this,Me))==null||t.removeComments([e.uid])}toggleComment(e,t,s=void 0){var i;(i=r(this,Me))==null||i.toggleCommentPopup(e,t,s)}makeCommentColor(e,t){var s;return e&&((s=r(this,Me))==null?void 0:s.makeCommentColor(e,t))||null}getCommentDialogElement(){var e;return((e=r(this,Me))==null?void 0:e.dialogElement)||null}async waitForEditorsRendered(e){if(r(this,ne).has(e-1))return;const{resolve:t,promise:s}=Promise.withResolvers(),i=n=>{n.pageNumber===e&&(this._eventBus._off("editorsrendered",i),t())};this._eventBus.on("editorsrendered",i),await s}getSignature(e){var t;(t=r(this,Vn))==null||t.getSignature({uiManager:this,editor:e})}get signatureManager(){return r(this,Vn)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":g(this,To,t);break}}onPageChanging({pageNumber:e}){g(this,xo,e-1)}focusMainContainer(){r(this,Vi).focus()}findParent(e,t){for(const s of r(this,ne).values()){const{x:i,y:n,width:a,height:o}=s.div.getBoundingClientRect();if(e>=i&&e<=i+a&&t>=n&&t<=n+o)return s}return null}disableUserSelect(e=!1){r(this,Bh).classList.toggle("noUserSelect",e)}addShouldRescale(e){r(this,_r).add(e)}removeShouldRescale(e){r(this,_r).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*Rn.PDF_TO_CSS_UNITS;for(const s of r(this,_r))s.onScaleChanging();(t=r(this,Bn))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e="",t=!1){const s=document.getSelection();if(!s||s.isCollapsed)return;const{anchorNode:i,anchorOffset:n,focusNode:a,focusOffset:o}=s,l=s.toString(),d=w(this,U,Sd).call(this,s).closest(".textLayer"),u=this.getSelectionBoxes(d);if(!u)return;s.empty();const f=w(this,U,lf).call(this,d),p=r(this,qt)===tt.NONE,m=()=>{const v=f==null?void 0:f.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:u,anchorNode:i,anchorOffset:n,focusNode:a,focusOffset:o,text:l});p&&this.showAllEditors("highlight",!0,!0),t&&(v==null||v.editComment())};if(p){this.switchToMode(tt.HIGHLIGHT,m);return}m()}commentSelection(e=""){this.highlightSelection(e,!0)}getAndRemoveDataFromAnnotationStorage(e){if(!r(this,Ds))return null;const t=`${vh}${e}`,s=r(this,Ds).getRawValue(t);return s&&r(this,Ds).remove(t),s}addToAnnotationStorage(e){!e.isEmpty()&&r(this,Ds)&&!r(this,Ds).has(e.id)&&r(this,Ds).setValue(e.id,e)}a11yAlert(e,t=null){const s=r(this,_h);s&&(s.setAttribute("data-l10n-id",e),t?s.setAttribute("data-l10n-args",JSON.stringify(t)):s.removeAttribute("data-l10n-args"))}blur(){if(this.isShiftKeyDown=!1,r(this,Hn)&&(g(this,Hn,!1),w(this,U,Zl).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of r(this,At))if(t.div.contains(e)){g(this,Ur,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!r(this,Ur))return;const[e,t]=r(this,Ur);g(this,Ur,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){w(this,U,hf).call(this),w(this,U,cf).call(this)}removeEditListeners(){w(this,U,Zg).call(this),w(this,U,df).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const s of r(this,Os))if(s.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const s of r(this,Os))if(s.isHandlingMimeForPasting(t.type)){s.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var s;if(e.preventDefault(),(s=r(this,is))==null||s.commitOrRemove(),!this.hasSelection)return;const t=[];for(const i of r(this,At)){const n=i.serialize(!0);n&&t.push(n)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const n of t.items)for(const a of r(this,Os))if(a.isHandlingMimeForPasting(n.type)){a.paste(n,this.currentLayer);return}let s=t.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(n){Q(`paste: "${n.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const n=[];for(const l of s){const h=await i.deserialize(l);if(!h)return;n.push(h)}const a=()=>{for(const l of n)w(this,U,uf).call(this,l);w(this,U,ff).call(this,n)},o=()=>{for(const l of n)l.remove()};this.addCommands({cmd:a,undo:o,mustExec:!0})}catch(n){Q(`paste: "${n.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),r(this,qt)!==tt.NONE&&!this.isEditorHandlingKeyboard&&ho._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,r(this,Hn)&&(g(this,Hn,!1),w(this,U,Zl).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}setEditingState(e){e?(w(this,U,Jg).call(this),w(this,U,cf).call(this),w(this,U,Be).call(this,{isEditing:r(this,qt)!==tt.NONE,isEmpty:w(this,U,ql).call(this),hasSomethingToUndo:r(this,Ls).hasSomethingToUndo(),hasSomethingToRedo:r(this,Ls).hasSomethingToRedo(),hasSelectedEditor:!1})):(w(this,U,Qg).call(this),w(this,U,df).call(this),w(this,U,Be).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!r(this,Os)){g(this,Os,e);for(const t of r(this,Os))w(this,U,Bi).call(this,t.defaultPropertiesToUpdate)}}getId(){return r(this,Eu).id}get currentLayer(){return r(this,ne).get(r(this,xo))}getLayer(e){return r(this,ne).get(e)}get currentPageIndex(){return r(this,xo)}addLayer(e){r(this,ne).set(e.pageIndex,e),r(this,$n)?e.enable():e.disable()}removeLayer(e){r(this,ne).delete(e.pageIndex)}async updateMode(e,t=null,s=!1,i=!1,n=!1){var a,o,l,h,d,u;if(r(this,qt)!==e&&!(r(this,ks)&&(await r(this,ks).promise,!r(this,ks)))){if(g(this,ks,Promise.withResolvers()),(a=r(this,Bn))==null||a.commitOrRemove(),r(this,qt)===tt.POPUP&&((o=r(this,Me))==null||o.hideSidebar()),(l=r(this,Me))==null||l.destroyPopup(),g(this,qt,e),e===tt.NONE){this.setEditingState(!1),w(this,U,em).call(this);for(const f of r(this,Vt).values())f.hideStandaloneCommentButton();(h=this._editorUndoBar)==null||h.hide(),this.toggleComment(null),r(this,ks).resolve();return}for(const f of r(this,Vt).values())f.addStandaloneCommentButton();e===tt.SIGNATURE&&await((d=r(this,Vn))==null?void 0:d.loadSignatures()),this.setEditingState(!0),await w(this,U,tm).call(this),this.unselectAll();for(const f of r(this,ne).values())f.updateMode(e);if(e===tt.POPUP){r(this,wo)||g(this,wo,await r(this,Io).getAnnotationsByType(new Set(r(this,Os).map(m=>m._editorType))));const f=new Set,p=[];for(const m of r(this,Vt).values()){const{annotationElementId:v,hasComment:A,deleted:b}=m;v&&f.add(v),A&&!b&&p.push(m.getData())}for(const m of r(this,wo)){const{id:v,popupRef:A,contentsObj:b}=m;A&&(b!=null&&b.str)&&!f.has(v)&&!r(this,_n).has(v)&&p.push(m)}(u=r(this,Me))==null||u.showSidebar(p)}if(!t){s&&this.addNewEditorFromKeyboard(),r(this,ks).resolve();return}for(const f of r(this,Vt).values())f.uid===t?(this.setSelected(f),n?f.editComment():i?f.enterInEditMode():f.focus()):f.unselect();r(this,ks).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==r(this,qt)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(r(this,Os)){switch(e){case dt.CREATE:this.currentLayer.addNewEditor(t);return;case dt.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(r(this,Nh)||g(this,Nh,new Map)).set(e,t),this.showAllEditors("highlight",t);break}if(this.hasSelection)for(const s of r(this,At))s.updateParams(e,t);else for(const s of r(this,Os))s.updateDefaultParams(e,t)}}showAllEditors(e,t,s=!1){var n;for(const a of r(this,Vt).values())a.editorType===e&&a.show(t);(((n=r(this,Nh))==null?void 0:n.get(dt.HIGHLIGHT_SHOW_ALL))??!0)!==t&&w(this,U,Bi).call(this,[[dt.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(r(this,Oh)!==e){g(this,Oh,e);for(const t of r(this,ne).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}*getEditors(e){for(const t of r(this,Vt).values())t.pageIndex===e&&(yield t)}getEditor(e){return r(this,Vt).get(e)}addEditor(e){r(this,Vt).set(e.id,e)}removeEditor(e){var t,s;e.div.contains(document.activeElement)&&(r(this,di)&&clearTimeout(r(this,di)),g(this,di,setTimeout(()=>{this.focusMainContainer(),g(this,di,null)},0))),r(this,Vt).delete(e.id),e.annotationElementId&&((t=r(this,zn))==null||t.delete(e.annotationElementId)),this.unselect(e),(!e.annotationElementId||!r(this,_n).has(e.annotationElementId))&&((s=r(this,Ds))==null||s.remove(e.id))}addDeletedAnnotationElement(e){r(this,_n).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return r(this,_n).has(e)}removeDeletedAnnotationElement(e){r(this,_n).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){r(this,is)!==e&&(g(this,is,e),e&&w(this,U,Bi).call(this,e.propertiesToUpdate))}updateUI(e){r(this,U,sm)===e&&w(this,U,Bi).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){w(this,U,Bi).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(r(this,At).has(e)){r(this,At).delete(e),e.unselect(),w(this,U,Be).call(this,{hasSelectedEditor:this.hasSelection});return}r(this,At).add(e),e.select(),w(this,U,Bi).call(this,e.propertiesToUpdate),w(this,U,Be).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;this.updateToolbar({mode:e.mode,editId:e.id}),(t=r(this,Bn))==null||t.commitOrRemove();for(const s of r(this,At))s!==e&&s.unselect();r(this,At).clear(),r(this,At).add(e),e.select(),w(this,U,Bi).call(this,e.propertiesToUpdate),w(this,U,Be).call(this,{hasSelectedEditor:!0})}isSelected(e){return r(this,At).has(e)}get firstSelectedEditor(){return r(this,At).values().next().value}unselect(e){e.unselect(),r(this,At).delete(e),w(this,U,Be).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return r(this,At).size!==0}get isEnterHandled(){return r(this,At).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;r(this,Ls).undo(),w(this,U,Be).call(this,{hasSomethingToUndo:r(this,Ls).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:w(this,U,ql).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){r(this,Ls).redo(),w(this,U,Be).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:r(this,Ls).hasSomethingToRedo(),isEmpty:w(this,U,ql).call(this)})}addCommands(e){r(this,Ls).add(e),w(this,U,Be).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:w(this,U,ql).call(this)})}cleanUndoStack(e){r(this,Ls).cleanType(e)}delete(){var n;this.commitOrRemove();const e=(n=this.currentLayer)==null?void 0:n.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...r(this,At)],s=()=>{var a;(a=this._editorUndoBar)==null||a.show(i,t.length===1?t[0].editorType:t.length);for(const o of t)o.remove()},i=()=>{for(const a of t)w(this,U,uf).call(this,a)};this.addCommands({cmd:s,undo:i,mustExec:!0})}commitOrRemove(){var e;(e=r(this,is))==null||e.commitOrRemove()}hasSomethingToControl(){return r(this,is)||this.hasSelection}selectAll(){for(const e of r(this,At))e.commit();w(this,U,ff).call(this,r(this,Vt).values())}unselectAll(){var e;if(!(r(this,is)&&(r(this,is).commitOrRemove(),r(this,qt)!==tt.NONE))&&!((e=r(this,Bn))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of r(this,At))t.unselect();r(this,At).clear(),w(this,U,Be).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;r(this,Wn)[0]+=e,r(this,Wn)[1]+=t;const[i,n]=r(this,Wn),a=[...r(this,At)],o=1e3;r(this,fi)&&clearTimeout(r(this,fi)),g(this,fi,setTimeout(()=>{g(this,fi,null),r(this,Wn)[0]=r(this,Wn)[1]=0,this.addCommands({cmd:()=>{for(const l of a)r(this,Vt).has(l.id)&&(l.translateInPage(i,n),l.translationDone())},undo:()=>{for(const l of a)r(this,Vt).has(l.id)&&(l.translateInPage(-i,-n),l.translationDone())},mustExec:!1})},o));for(const l of a)l.translateInPage(e,t),l.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),g(this,ci,new Map);for(const e of r(this,At))r(this,ci).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!r(this,ci))return!1;this.disableUserSelect(!1);const e=r(this,ci);g(this,ci,null);let t=!1;for(const[{x:i,y:n,pageIndex:a},o]of e)o.newX=i,o.newY=n,o.newPageIndex=a,t||(t=i!==o.savedX||n!==o.savedY||a!==o.savedPageIndex);if(!t)return!1;const s=(i,n,a,o)=>{if(r(this,Vt).has(i.id)){const l=r(this,ne).get(o);l?i._setParentAndPosition(l,n,a):(i.pageIndex=o,i.x=n,i.y=a)}};return this.addCommands({cmd:()=>{for(const[i,{newX:n,newY:a,newPageIndex:o}]of e)s(i,n,a,o)},undo:()=>{for(const[i,{savedX:n,savedY:a,savedPageIndex:o}]of e)s(i,n,a,o)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(r(this,ci))for(const s of r(this,ci).keys())s.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||r(this,At).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return r(this,is)===e}getActive(){return r(this,is)}getMode(){return r(this,qt)}isEditingMode(){return r(this,qt)!==tt.NONE}get imageManager(){return at(this,"imageManager",new af)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let h=0,d=t.rangeCount;h<d;h++)if(!e.contains(t.getRangeAt(h).commonAncestorContainer))return null;const{x:s,y:i,width:n,height:a}=e.getBoundingClientRect();let o;switch(e.getAttribute("data-main-rotation")){case"90":o=(h,d,u,f)=>({x:(d-i)/a,y:1-(h+u-s)/n,width:f/a,height:u/n});break;case"180":o=(h,d,u,f)=>({x:1-(h+u-s)/n,y:1-(d+f-i)/a,width:u/n,height:f/a});break;case"270":o=(h,d,u,f)=>({x:1-(d+f-i)/a,y:(h-s)/n,width:f/a,height:u/n});break;default:o=(h,d,u,f)=>({x:(h-s)/n,y:(d-i)/a,width:u/n,height:f/a});break}const l=[];for(let h=0,d=t.rangeCount;h<d;h++){const u=t.getRangeAt(h);if(!u.collapsed)for(const{x:f,y:p,width:m,height:v}of u.getClientRects())m===0||v===0||l.push(o(f,p,m,v))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(r(this,So)||g(this,So,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=r(this,So))==null||t.delete(e)}renderAnnotationElement(e){var i;const t=(i=r(this,So))==null?void 0:i.get(e.data.id);if(!t)return;const s=r(this,Ds).getRawValue(t);s&&(r(this,qt)===tt.NONE&&!s.hasBeenModified||s.renderAnnotationElement(e))}setMissingCanvas(e,t,s){var n;const i=(n=r(this,zn))==null?void 0:n.get(e);i&&(i.setCanvas(t,s),r(this,zn).delete(e))}addMissingCanvas(e,t){(r(this,zn)||g(this,zn,new Map)).set(e,t)}};Ao=new WeakMap,is=new WeakMap,wo=new WeakMap,Vt=new WeakMap,ne=new WeakMap,Eo=new WeakMap,Ds=new WeakMap,So=new WeakMap,Ls=new WeakMap,Me=new WeakMap,Fn=new WeakMap,Bn=new WeakMap,xo=new WeakMap,_n=new WeakMap,ci=new WeakMap,Os=new WeakMap,_r=new WeakMap,Mh=new WeakMap,Dh=new WeakMap,To=new WeakMap,Lh=new WeakMap,di=new WeakMap,Un=new WeakMap,Co=new WeakMap,Hn=new WeakMap,ui=new WeakMap,Eu=new WeakMap,$n=new WeakMap,Po=new WeakMap,Oh=new WeakMap,jn=new WeakMap,Ur=new WeakMap,Ro=new WeakMap,zn=new WeakMap,kh=new WeakMap,qt=new WeakMap,At=new WeakMap,zi=new WeakMap,Vn=new WeakMap,Gn=new WeakMap,Nh=new WeakMap,Io=new WeakMap,Fh=new WeakMap,Wn=new WeakMap,fi=new WeakMap,Vi=new WeakMap,Bh=new WeakMap,_h=new WeakMap,ks=new WeakMap,U=new WeakSet,Sd=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},lf=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const s of r(this,ne).values())if(s.hasTextLayer(e))return s;return null},Xg=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const s=w(this,U,Sd).call(this,e).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(r(this,ui)||g(this,ui,new iy(this)),r(this,ui).show(s,i,this.direction==="ltr"))},Yg=function(){var n,a,o;const e=document.getSelection();if(!e||e.isCollapsed){r(this,zi)&&((n=r(this,ui))==null||n.hide(),g(this,zi,null),w(this,U,Be).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===r(this,zi))return;const i=w(this,U,Sd).call(this,e).closest(".textLayer");if(!i){r(this,zi)&&((a=r(this,ui))==null||a.hide(),g(this,zi,null),w(this,U,Be).call(this,{hasSelectedText:!1}));return}if((o=r(this,ui))==null||o.hide(),g(this,zi,t),w(this,U,Be).call(this,{hasSelectedText:!0}),!(r(this,qt)!==tt.HIGHLIGHT&&r(this,qt)!==tt.NONE)&&(r(this,qt)===tt.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),g(this,Hn,this.isShiftKeyDown),!this.isShiftKeyDown)){const l=r(this,qt)===tt.HIGHLIGHT?w(this,U,lf).call(this,i):null;if(l==null||l.toggleDrawing(),r(this,Po)){const h=new AbortController,d=this.combinedSignal(h),u=f=>{f.type==="pointerup"&&f.button!==0||(h.abort(),l==null||l.toggleDrawing(!0),f.type==="pointerup"&&w(this,U,Zl).call(this,"main_toolbar"))};window.addEventListener("pointerup",u,{signal:d}),window.addEventListener("blur",u,{signal:d})}else l==null||l.toggleDrawing(!0),w(this,U,Zl).call(this,"main_toolbar")}},Zl=function(e=""){r(this,qt)===tt.HIGHLIGHT?this.highlightSelection(e):r(this,Mh)&&w(this,U,Xg).call(this)},Kg=function(){document.addEventListener("selectionchange",w(this,U,Yg).bind(this),{signal:this._signal})},Jg=function(){if(r(this,Un))return;g(this,Un,new AbortController);const e=this.combinedSignal(r(this,Un));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},Qg=function(){var e;(e=r(this,Un))==null||e.abort(),g(this,Un,null)},hf=function(){if(r(this,jn))return;g(this,jn,new AbortController);const e=this.combinedSignal(r(this,jn));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},Zg=function(){var e;(e=r(this,jn))==null||e.abort(),g(this,jn,null)},cf=function(){if(r(this,Fn))return;g(this,Fn,new AbortController);const e=this.combinedSignal(r(this,Fn));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},df=function(){var e;(e=r(this,Fn))==null||e.abort(),g(this,Fn,null)},qg=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},Be=function(e){Object.entries(e).some(([s,i])=>r(this,Fh)[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(r(this,Fh),e)}),r(this,qt)===tt.HIGHLIGHT&&e.hasSelectedEditor===!1&&w(this,U,Bi).call(this,[[dt.HIGHLIGHT_FREE,!0]]))},Bi=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},tm=async function(){if(!r(this,$n)){g(this,$n,!0);const e=[];for(const t of r(this,ne).values())e.push(t.enable());await Promise.all(e);for(const t of r(this,Vt).values())t.enable()}},em=function(){if(this.unselectAll(),r(this,$n)){g(this,$n,!1);for(const e of r(this,ne).values())e.disable();for(const e of r(this,Vt).values())e.disable()}},uf=function(e){const t=r(this,ne).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},sm=function(){let e=null;for(e of r(this,At));return e},ql=function(){if(r(this,Vt).size===0)return!0;if(r(this,Vt).size===1)for(const e of r(this,Vt).values())return e.isEmpty();return!1},ff=function(e){for(const t of r(this,At))t.unselect();r(this,At).clear();for(const t of e)t.isEmpty()||(r(this,At).add(t),t.select());w(this,U,Be).call(this,{hasSelectedEditor:this.hasSelection})},M(ho,"TRANSLATE_SMALL",1),M(ho,"TRANSLATE_BIG",10);let Pr=ho;var ce,pi,Gs,Mo,gi,ns,Do,mi,Xe,Gi,Hr,vi,Xn,ni,th,xd;const _e=class _e{constructor(e){y(this,ni);y(this,ce,null);y(this,pi,!1);y(this,Gs,null);y(this,Mo,null);y(this,gi,null);y(this,ns,null);y(this,Do,!1);y(this,mi,null);y(this,Xe,null);y(this,Gi,null);y(this,Hr,null);y(this,vi,!1);g(this,Xe,e),g(this,vi,e._uiManager.useNewAltTextFlow),r(_e,Xn)||g(_e,Xn,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){_e._l10n??(_e._l10n=e)}async render(){const e=g(this,Gs,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=g(this,Mo,document.createElement("span"));e.append(t),r(this,vi)?(e.classList.add("new"),e.setAttribute("data-l10n-id",r(_e,Xn).missing),t.setAttribute("data-l10n-id",r(_e,Xn)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=r(this,Xe)._uiManager._signal;e.addEventListener("contextmenu",Ts,{signal:s}),e.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:s});const i=n=>{n.preventDefault(),r(this,Xe)._uiManager.editAltText(r(this,Xe)),r(this,vi)&&r(this,Xe)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:r(this,ni,th)}})};return e.addEventListener("click",i,{capture:!0,signal:s}),e.addEventListener("keydown",n=>{n.target===e&&n.key==="Enter"&&(g(this,Do,!0),i(n))},{signal:s}),await w(this,ni,xd).call(this),e}finish(){r(this,Gs)&&(r(this,Gs).focus({focusVisible:r(this,Do)}),g(this,Do,!1))}isEmpty(){return r(this,vi)?r(this,ce)===null:!r(this,ce)&&!r(this,pi)}hasData(){return r(this,vi)?r(this,ce)!==null||!!r(this,Gi):this.isEmpty()}get guessedText(){return r(this,Gi)}async setGuessedText(e){r(this,ce)===null&&(g(this,Gi,e),g(this,Hr,await _e._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),w(this,ni,xd).call(this))}toggleAltTextBadge(e=!1){var t;if(!r(this,vi)||r(this,ce)){(t=r(this,mi))==null||t.remove(),g(this,mi,null);return}if(!r(this,mi)){const s=g(this,mi,document.createElement("div"));s.className="noAltTextBadge",r(this,Xe).div.append(s)}r(this,mi).classList.toggle("hidden",!e)}serialize(e){let t=r(this,ce);return!e&&r(this,Gi)===t&&(t=r(this,Hr)),{altText:t,decorative:r(this,pi),guessedText:r(this,Gi),textWithDisclaimer:r(this,Hr)}}get data(){return{altText:r(this,ce),decorative:r(this,pi)}}set data({altText:e,decorative:t,guessedText:s,textWithDisclaimer:i,cancel:n=!1}){s&&(g(this,Gi,s),g(this,Hr,i)),!(r(this,ce)===e&&r(this,pi)===t)&&(n||(g(this,ce,e),g(this,pi,t)),w(this,ni,xd).call(this))}toggle(e=!1){r(this,Gs)&&(!e&&r(this,ns)&&(clearTimeout(r(this,ns)),g(this,ns,null)),r(this,Gs).disabled=!e)}shown(){r(this,Xe)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:r(this,ni,th)}})}destroy(){var e,t;(e=r(this,Gs))==null||e.remove(),g(this,Gs,null),g(this,Mo,null),g(this,gi,null),(t=r(this,mi))==null||t.remove(),g(this,mi,null)}};ce=new WeakMap,pi=new WeakMap,Gs=new WeakMap,Mo=new WeakMap,gi=new WeakMap,ns=new WeakMap,Do=new WeakMap,mi=new WeakMap,Xe=new WeakMap,Gi=new WeakMap,Hr=new WeakMap,vi=new WeakMap,Xn=new WeakMap,ni=new WeakSet,th=function(){return r(this,ce)&&"added"||r(this,ce)===null&&this.guessedText&&"review"||"missing"},xd=async function(){var i,n,a;const e=r(this,Gs);if(!e)return;if(r(this,vi)){if(e.classList.toggle("done",!!r(this,ce)),e.setAttribute("data-l10n-id",r(_e,Xn)[r(this,ni,th)]),(i=r(this,Mo))==null||i.setAttribute("data-l10n-id",r(_e,Xn)[`${r(this,ni,th)}-label`]),!r(this,ce)){(n=r(this,gi))==null||n.remove();return}}else{if(!r(this,ce)&&!r(this,pi)){e.classList.remove("done"),(a=r(this,gi))==null||a.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=r(this,gi);if(!t){g(this,gi,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${r(this,Xe).id}`;const o=100,l=r(this,Xe)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(r(this,ns)),g(this,ns,null)},{once:!0}),e.addEventListener("mouseenter",()=>{g(this,ns,setTimeout(()=>{g(this,ns,null),r(this,gi).classList.add("show"),r(this,Xe)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:l}),e.addEventListener("mouseleave",()=>{var h;r(this,ns)&&(clearTimeout(r(this,ns)),g(this,ns,null)),(h=r(this,gi))==null||h.classList.remove("show")},{signal:l})}r(this,pi)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=r(this,ce)),t.parentNode||e.append(t);const s=r(this,Xe).getElementForAltText();s==null||s.setAttribute("aria-describedby",t.id)},y(_e,Xn,null),M(_e,"_l10n",null);let tu=_e;var Ae,Ns,$r,Lt,Uh,jr,Ws,zr,Vr,Gr,Hh,pf;class ud{constructor(e){y(this,Hh);y(this,Ae,null);y(this,Ns,null);y(this,$r,!1);y(this,Lt,null);y(this,Uh,null);y(this,jr,null);y(this,Ws,null);y(this,zr,null);y(this,Vr,!1);y(this,Gr,null);g(this,Lt,e)}renderForToolbar(){const e=g(this,Ns,document.createElement("button"));return e.className="comment",w(this,Hh,pf).call(this,e,!1)}renderForStandalone(){const e=g(this,Ae,document.createElement("button"));e.className="annotationCommentButton";const t=r(this,Lt).commentButtonPosition;if(t){const{style:s}=e;s.insetInlineEnd=`calc(${100*(r(this,Lt)._uiManager.direction==="ltr"?1-t[0]:t[0])}% - var(--comment-button-dim))`,s.top=`calc(${100*t[1]}% - var(--comment-button-dim))`;const i=r(this,Lt).commentButtonColor;i&&(s.backgroundColor=i)}return w(this,Hh,pf).call(this,e,!0)}focusButton(){setTimeout(()=>{var e;(e=r(this,Ae)??r(this,Ns))==null||e.focus()},0)}onUpdatedColor(){if(!r(this,Ae))return;const e=r(this,Lt).commentButtonColor;e&&(r(this,Ae).style.backgroundColor=e),r(this,Lt)._uiManager.updatePopupColor(r(this,Lt))}get commentButtonWidth(){var e;return(((e=r(this,Ae))==null?void 0:e.getBoundingClientRect().width)??0)/r(this,Lt).parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(r(this,Gr))return r(this,Gr);if(!r(this,Ae))return null;const{x:e,y:t,height:s}=r(this,Ae).getBoundingClientRect(),{x:i,y:n,width:a,height:o}=r(this,Lt).parent.boundingClientRect;return[(e-i)/a,(t+s-n)/o]}set commentPopupPositionInLayer(e){g(this,Gr,e)}hasDefaultPopupPosition(){return r(this,Gr)===null}removeStandaloneCommentButton(){var e;(e=r(this,Ae))==null||e.remove(),g(this,Ae,null)}removeToolbarCommentButton(){var e;(e=r(this,Ns))==null||e.remove(),g(this,Ns,null)}setCommentButtonStates({selected:e,hasPopup:t}){r(this,Ae)&&(r(this,Ae).classList.toggle("selected",e),r(this,Ae).ariaExpanded=t)}edit(e){const t=this.commentPopupPositionInLayer;let s,i;if(t)[s,i]=t;else{[s,i]=r(this,Lt).commentButtonPosition;const{width:d,height:u,x:f,y:p}=r(this,Lt);s=f+s*d,i=p+i*u}const n=r(this,Lt).parent.boundingClientRect,{x:a,y:o,width:l,height:h}=n;r(this,Lt)._uiManager.editComment(r(this,Lt),a+s*l,o+i*h,{...e,parentDimensions:n})}finish(){r(this,Ns)&&(r(this,Ns).focus({focusVisible:r(this,$r)}),g(this,$r,!1))}isDeleted(){return r(this,Vr)||r(this,Ws)===""}isEmpty(){return r(this,Ws)===null}hasBeenEdited(){return this.isDeleted()||r(this,Ws)!==r(this,Uh)}serialize(){return this.data}get data(){return{text:r(this,Ws),richText:r(this,jr),date:r(this,zr),deleted:this.isDeleted()}}set data(e){if(e!==r(this,Ws)&&g(this,jr,null),e===null){g(this,Ws,""),g(this,Vr,!0);return}g(this,Ws,e),g(this,zr,new Date),g(this,Vr,!1)}setInitialText(e,t=null){g(this,Uh,e),this.data=e,g(this,zr,null),g(this,jr,t)}shown(){}destroy(){var e,t;(e=r(this,Ns))==null||e.remove(),g(this,Ns,null),(t=r(this,Ae))==null||t.remove(),g(this,Ae,null),g(this,Ws,""),g(this,jr,null),g(this,zr,null),g(this,Lt,null),g(this,$r,!1),g(this,Vr,!1)}}Ae=new WeakMap,Ns=new WeakMap,$r=new WeakMap,Lt=new WeakMap,Uh=new WeakMap,jr=new WeakMap,Ws=new WeakMap,zr=new WeakMap,Vr=new WeakMap,Gr=new WeakMap,Hh=new WeakSet,pf=function(e,t){if(!r(this,Lt)._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",t?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[r(this,Lt)._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button"));const s=r(this,Lt)._uiManager._signal;if(!(s instanceof AbortSignal)||s.aborted)return e;e.addEventListener("contextmenu",Ts,{signal:s}),t&&(e.addEventListener("focusin",n=>{r(this,Lt)._focusEventsAllowed=!1,$t(n)},{capture:!0,signal:s}),e.addEventListener("focusout",n=>{r(this,Lt)._focusEventsAllowed=!0,$t(n)},{capture:!0,signal:s})),e.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:s});const i=n=>{n.preventDefault(),e===r(this,Ns)?this.edit():r(this,Lt).toggleComment(!0)};return e.addEventListener("click",i,{capture:!0,signal:s}),e.addEventListener("keydown",n=>{n.target===e&&n.key==="Enter"&&(g(this,$r,!0),i(n))},{signal:s}),e.addEventListener("pointerenter",()=>{r(this,Lt).toggleComment(!1,!0)},{signal:s}),e.addEventListener("pointerleave",()=>{r(this,Lt).toggleComment(!1,!1)},{signal:s}),e};var Lo,Wr,$h,jh,zh,Vh,Gh,Wi,Xr,Xi,Yr,Yi,Rr,im,nm,rm;const zp=class zp{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:n=null,onPinchEnd:a=null,signal:o}){y(this,Rr);y(this,Lo);y(this,Wr,!1);y(this,$h,null);y(this,jh);y(this,zh);y(this,Vh);y(this,Gh);y(this,Wi,null);y(this,Xr);y(this,Xi,null);y(this,Yr);y(this,Yi,null);g(this,Lo,e),g(this,$h,s),g(this,jh,t),g(this,zh,i),g(this,Vh,n),g(this,Gh,a),g(this,Yr,new AbortController),g(this,Xr,AbortSignal.any([o,r(this,Yr).signal])),e.addEventListener("touchstart",w(this,Rr,im).bind(this),{passive:!1,signal:r(this,Xr)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/ri.pixelRatio}destroy(){var e,t;(e=r(this,Yr))==null||e.abort(),g(this,Yr,null),(t=r(this,Wi))==null||t.abort(),g(this,Wi,null)}};Lo=new WeakMap,Wr=new WeakMap,$h=new WeakMap,jh=new WeakMap,zh=new WeakMap,Vh=new WeakMap,Gh=new WeakMap,Wi=new WeakMap,Xr=new WeakMap,Xi=new WeakMap,Yr=new WeakMap,Yi=new WeakMap,Rr=new WeakSet,im=function(e){var i,n,a;if((i=r(this,jh))!=null&&i.call(this))return;if(e.touches.length===1){if(r(this,Wi))return;const o=g(this,Wi,new AbortController),l=AbortSignal.any([r(this,Xr),o.signal]),h=r(this,Lo),d={capture:!0,signal:l,passive:!1},u=f=>{var p;f.pointerType==="touch"&&((p=r(this,Wi))==null||p.abort(),g(this,Wi,null))};h.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&($t(f),u(f))},d),h.addEventListener("pointerup",u,d),h.addEventListener("pointercancel",u,d);return}if(!r(this,Yi)){g(this,Yi,new AbortController);const o=AbortSignal.any([r(this,Xr),r(this,Yi).signal]),l=r(this,Lo),h={signal:o,capture:!1,passive:!1};l.addEventListener("touchmove",w(this,Rr,nm).bind(this),h);const d=w(this,Rr,rm).bind(this);l.addEventListener("touchend",d,h),l.addEventListener("touchcancel",d,h),h.capture=!0,l.addEventListener("pointerdown",$t,h),l.addEventListener("pointermove",$t,h),l.addEventListener("pointercancel",$t,h),l.addEventListener("pointerup",$t,h),(n=r(this,zh))==null||n.call(this)}if($t(e),e.touches.length!==2||(a=r(this,$h))!=null&&a.call(this)){g(this,Xi,null);return}let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]),g(this,Xi,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:s.screenX,touch1Y:s.screenY})},nm=function(e){var T;if(!r(this,Xi)||e.touches.length!==2)return;$t(e);let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]);const{screenX:i,screenY:n}=t,{screenX:a,screenY:o}=s,l=r(this,Xi),{touch0X:h,touch0Y:d,touch1X:u,touch1Y:f}=l,p=u-h,m=f-d,v=a-i,A=o-n,b=Math.hypot(v,A)||1,S=Math.hypot(p,m)||1;if(!r(this,Wr)&&Math.abs(S-b)<=zp.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=i,l.touch0Y=n,l.touch1X=a,l.touch1Y=o,!r(this,Wr)){g(this,Wr,!0);return}const E=[(i+a)/2,(n+o)/2];(T=r(this,Vh))==null||T.call(this,E,S,b)},rm=function(e){var t;e.touches.length>=2||(r(this,Yi)&&(r(this,Yi).abort(),g(this,Yi,null),(t=r(this,Gh))==null||t.call(this)),r(this,Xi)&&($t(e),g(this,Xi,null),g(this,Wr,!1)))};let Ah=zp;var Kr,Xs,Ft,Pt,Ki,Oo,Yn,Wh,we,Jr,Ji,yi,Kn,Xh,Qr,rs,Yh,Zr,Qi,bi,ko,No,Fs,qr,Kh,Su,J,gf,Jh,mf,Td,am,om,vf,Cd,yf,lm,hm,cm,bf,dm,Af,um,fm,pm,wf,eh;const st=class st{constructor(e){y(this,J);y(this,Kr,null);y(this,Xs,null);y(this,Ft,null);y(this,Pt,null);y(this,Ki,null);y(this,Oo,!1);y(this,Yn,null);y(this,Wh,"");y(this,we,null);y(this,Jr,null);y(this,Ji,null);y(this,yi,null);y(this,Kn,null);y(this,Xh,"");y(this,Qr,!1);y(this,rs,null);y(this,Yh,!1);y(this,Zr,!1);y(this,Qi,!1);y(this,bi,null);y(this,ko,0);y(this,No,0);y(this,Fs,null);y(this,qr,null);M(this,"isSelected",!1);M(this,"_isCopy",!1);M(this,"_editToolbar",null);M(this,"_initialOptions",Object.create(null));M(this,"_initialData",null);M(this,"_isVisible",!0);M(this,"_uiManager",null);M(this,"_focusEventsAllowed",!0);y(this,Kh,!1);y(this,Su,st._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null;const{rotation:t,rawDims:{pageWidth:s,pageHeight:i,pageX:n,pageY:a}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[n,a];const[o,l]=this.parentDimensions;this.x=e.x/o,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=st.prototype._resizeWithKeyboard,t=Pr.TRANSLATE_SMALL,s=Pr.TRANSLATE_BIG;return at(this,"_resizerKeyboardManager",new od([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,s]}],[["Escape","mac+Escape"],st.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return at(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new ay({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(st._l10n??(st._l10n=e),st._l10nResizer||(st._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),st._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);st._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){Mt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return r(this,Kh)}set _isDraggable(e){var t;g(this,Kh,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=r(this,Su)}setParent(e){var t;e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(w(this,J,eh).call(this),(t=r(this,yi))==null||t.remove(),g(this,yi,null)),this.parent=e}focusin(e){this._focusEventsAllowed&&(r(this,Qr)?g(this,Qr,!1):this.parent.setSelected(this))}focusout(e){var s;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,s,i){const[n,a]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(e+s)/n,this.y=(t+i)/a,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[s,i]=this.parentDimensions;this.setAt(e*s,t*i,this.width*s,this.height*i),this._onTranslated()}translate(e,t){w(this,J,gf).call(this,this.parentDimensions,e,t)}translateInPage(e,t){r(this,rs)||g(this,rs,[this.x,this.y,this.width,this.height]),w(this,J,gf).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){r(this,rs)||g(this,rs,[this.x,this.y,this.width,this.height]);const{div:s,parentDimensions:[i,n]}=this;if(this.x+=e/i,this.y+=t/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:u,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,u,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this;const[l,h]=this.getBaseTranslation();a+=l,o+=h;const{style:d}=s;d.left=`${(100*a).toFixed(2)}%`,d.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),s.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!r(this,rs)&&(r(this,rs)[0]!==this.x||r(this,rs)[1]!==this.y)}get _hasBeenResized(){return!!r(this,rs)&&(r(this,rs)[2]!==this.width||r(this,rs)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:s}=st,i=s/e,n=s/t;switch(this.rotation){case 90:return[-i,n];case 180:return[i,n];case 270:return[i,-n];default:return[-i,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[s,i]}=this;let{x:n,y:a,width:o,height:l}=this;if(o*=s,l*=i,n*=s,a*=i,this._mustFixPosition)switch(e){case 0:n=Ne(n,0,s-o),a=Ne(a,0,i-l);break;case 90:n=Ne(n,0,s-l),a=Ne(a,o,i);break;case 180:n=Ne(n,o,s),a=Ne(a,l,i);break;case 270:n=Ne(n,l,s),a=Ne(a,0,i-o);break}this.x=n/=s,this.y=a/=i;const[h,d]=this.getBaseTranslation();n+=h,a+=d,t.left=`${(100*n).toFixed(2)}%`,t.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var s;return w(s=st,Jh,mf).call(s,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var s;return w(s=st,Jh,mf).call(s,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,s]}=this;return[t*e,s*e]}setDims(){const{div:{style:e},width:t,height:s}=this;e.width=`${(100*t).toFixed(2)}%`,e.height=`${(100*s).toFixed(2)}%`}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=r(this,Ft))==null||e.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||r(this,Zr))return this._editToolbar;this._editToolbar=new nf(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,s]of e)await this._editToolbar.addButton(t,s);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){var e;(e=this._editToolbar)==null||e.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){var e;(e=this._editToolbar)==null||e.removeButton("comment")}removeEditToolbar(){var e,t;(e=this._editToolbar)==null||e.remove(),this._editToolbar=null,(t=r(this,Ft))==null||t.destroy()}addContainer(e){var s;const t=(s=this._editToolbar)==null?void 0:s.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return r(this,Ft)||(tu.initialize(st._l10n),g(this,Ft,new tu(this)),r(this,Kr)&&(r(this,Ft).data=r(this,Kr),g(this,Kr,null))),r(this,Ft)}get altTextData(){var e;return(e=r(this,Ft))==null?void 0:e.data}set altTextData(e){r(this,Ft)&&(r(this,Ft).data=e)}get guessedAltText(){var e;return(e=r(this,Ft))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=r(this,Ft))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=r(this,Ft))==null?void 0:t.serialize(e)}hasAltText(){return!!r(this,Ft)&&!r(this,Ft).isEmpty()}hasAltTextData(){var e;return((e=r(this,Ft))==null?void 0:e.hasData())??!1}focusCommentButton(){var e;(e=r(this,Pt))==null||e.focusButton()}addCommentButton(){return r(this,Pt)||g(this,Pt,new ud(this))}addStandaloneCommentButton(){if(r(this,Ki)){this._uiManager.isEditingMode()&&r(this,Ki).classList.remove("hidden");return}this.hasComment&&(g(this,Ki,r(this,Pt).renderForStandalone()),this.div.append(r(this,Ki)))}removeStandaloneCommentButton(){r(this,Pt).removeStandaloneCommentButton(),g(this,Ki,null)}hideStandaloneCommentButton(){var e;(e=r(this,Ki))==null||e.classList.add("hidden")}get comment(){const{data:{richText:e,text:t,date:s,deleted:i}}=r(this,Pt);return{text:t,richText:e,date:s,deleted:i,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){r(this,Pt)||g(this,Pt,new ud(this)),r(this,Pt).data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:e,popupRef:t,richText:s}){if(!t||(r(this,Pt)||g(this,Pt,new ud(this)),r(this,Pt).setInitialText(e,s),!this.annotationElementId))return;const i=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);i&&this.updateFromAnnotationLayer(i)}get hasEditedComment(){var e;return(e=r(this,Pt))==null?void 0:e.hasBeenEdited()}get hasDeletedComment(){var e;return(e=r(this,Pt))==null?void 0:e.isDeleted()}get hasComment(){return!!r(this,Pt)&&!r(this,Pt).isEmpty()&&!r(this,Pt).isDeleted()}async editComment(e){r(this,Pt)||g(this,Pt,new ud(this)),r(this,Pt).edit(e)}toggleComment(e,t=void 0){this.hasComment&&this._uiManager.toggleComment(this,e,t)}setSelectedCommentButton(e){r(this,Pt).setSelectedButton(e)}addComment(e){if(this.hasEditedComment){const[,,,i]=e.rect,[n]=this.pageDimensions,[a]=this.pageTranslation,o=a+n+1,l=i-100,h=o+180;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[o,l,h,i]}}}updateFromAnnotationLayer({popup:{contents:e,deleted:t}}){r(this,Pt).data=t?null:e}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){var a;const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=r(this,Oo)?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),w(this,J,Af).call(this);const[t,s]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*s/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/s).toFixed(2)}%`);const[i,n]=this.getInitialTranslation();return this.translate(i,n),Gg(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(r(this,qr)||g(this,qr,new Ah({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:w(this,J,lm).bind(this),onPinching:w(this,J,hm).bind(this),onPinchEnd:w(this,J,cm).bind(this),signal:this._uiManager._signal}))),this.addStandaloneCommentButton(),(a=this._uiManager._editorUndoBar)==null||a.hide(),e}pointerdown(e){const{isMac:t}=ye.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(g(this,Qr,!0),this._isDraggable){w(this,J,dm).call(this,e);return}w(this,J,bf).call(this,e)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){r(this,bi)&&clearTimeout(r(this,bi)),g(this,bi,setTimeout(()=>{var e;g(this,bi,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,s){e.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,s=this.rotation){const i=this.parentScale,[n,a]=this.pageDimensions,[o,l]=this.pageTranslation,h=e/i,d=t/i,u=this.x*n,f=this.y*a,p=this.width*n,m=this.height*a;switch(s){case 0:return[u+h+o,a-f-d-m+l,u+h+p+o,a-f-d+l];case 90:return[u+d+o,a-f+h+l,u+d+m+o,a-f+h+p+l];case 180:return[u-h-p+o,a-f+d+l,u-h+o,a-f+d+m+l];case 270:return[u-d-m+o,a-f-h-p+l,u-d+o,a-f-h+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[s,i,n,a]=e,o=n-s,l=a-i;switch(this.rotation){case 0:return[s,t-a,o,l];case 90:return[s,t-i,l,o];case 180:return[n,t-i,o,l];case 270:return[n,t-a,l,o];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&st._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){var e;(e=r(this,Pt))==null||e.onUpdatedColor()}getData(){const{comment:{text:e,color:t,date:s,opacity:i,deleted:n,richText:a},uid:o,pageIndex:l,creationDate:h,modificationDate:d}=this;return{id:o,pageIndex:l,rect:this.getPDFRect(),richText:a,contentsObj:{str:e},creationDate:h,modificationDate:s||d,popupRef:!n,color:t,opacity:i}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),g(this,Zr,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),g(this,Zr,!1),!0):!1}isInEditMode(){return r(this,Zr)}shouldGetKeyboardEvents(){return r(this,Qi)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:n,innerWidth:a}=window;return t<a&&i>0&&e<n&&s>0}rebuild(){w(this,J,Af).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){var s;return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:((s=this._initialData)==null?void 0:s.popupRef)||""}}static async deserialize(e,t,s){const i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});i.rotation=e.rotation,g(i,Kr,e.accessibilityData),i._isCopy=e.isCopy||!1;const[n,a]=i.pageDimensions,[o,l,h,d]=i.getRectInCurrentCoords(e.rect,a);return i.x=o/n,i.y=l/a,i.width=h/n,i.height=d/a,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=r(this,Kn))==null||e.abort(),g(this,Kn,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),r(this,bi)&&(clearTimeout(r(this,bi)),g(this,bi,null)),w(this,J,eh).call(this),this.removeEditToolbar(),r(this,Fs)){for(const s of r(this,Fs).values())clearTimeout(s);g(this,Fs,null)}this.parent=null,(t=r(this,qr))==null||t.destroy(),g(this,qr,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(w(this,J,am).call(this),r(this,we).classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[e,t]}=this,[s,i,n,a]=this.getPDFRect();return[st._round(s+(n-s)*e),st._round(i+(a-i)*(1-t))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return r(this,Pt).commentPopupPositionInLayer}set commentPopupPosition(e){r(this,Pt).commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return r(this,Pt).hasDefaultPopupPosition()}get commentButtonWidth(){return r(this,Pt).commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){r(this,Pt).setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),g(this,Ji,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=r(this,we).children;if(!r(this,Xs)){g(this,Xs,Array.from(t));const a=w(this,J,um).bind(this),o=w(this,J,fm).bind(this),l=this._uiManager._signal;for(const h of r(this,Xs)){const d=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",a,{signal:l}),h.addEventListener("blur",o,{signal:l}),h.addEventListener("focus",w(this,J,pm).bind(this,d),{signal:l}),h.setAttribute("data-l10n-id",st._l10nResizer[d])}}const s=r(this,Xs)[0];let i=0;for(const a of t){if(a===s)break;i++}const n=(360-this.rotation+this.parentRotation)%360/90*(r(this,Xs).length/4);if(n!==i){if(n<i)for(let o=0;o<i-n;o++)r(this,we).append(r(this,we).firstChild);else if(n>i)for(let o=0;o<n-i;o++)r(this,we).firstChild.before(r(this,we).lastChild);let a=0;for(const o of t){const h=r(this,Xs)[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",st._l10nResizer[h])}}w(this,J,wf).call(this,0),g(this,Qi,!0),r(this,we).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){r(this,Qi)&&w(this,J,yf).call(this,r(this,Xh),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){w(this,J,eh).call(this),this.div.focus()}select(){var e,t,s;if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,n;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((n=this._editToolbar)==null||n.show())});return}(t=this._editToolbar)==null||t.show(),(s=r(this,Ft))==null||s.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>{var e;return(e=this.div)==null?void 0:e.focus({preventScroll:!0})},0)}unselect(){var e,t,s,i,n;this.isSelected&&(this.isSelected=!1,(e=r(this,we))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(s=this.div)!=null&&s.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(n=r(this,Ft))==null||n.toggleAltTextBadge(!0),this.hasComment&&this._uiManager.toggleComment(this,!1,!1))}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){e.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return r(this,Yh)}set isEditing(e){g(this,Yh,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){r(this,Fs)||g(this,Fs,new Map);const{action:s}=e;let i=r(this,Fs).get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(e),r(this,Fs).delete(s),r(this,Fs).size===0&&g(this,Fs,null)},st._telemetryTimeout),r(this,Fs).set(s,i);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),g(this,Oo,!1)}disable(){this.div&&(this.div.tabIndex=-1),g(this,Oo,!0)}updateFakeAnnotationElement(e){if(!r(this,yi)&&!this.deleted){g(this,yi,e.addFakeAnnotation(this));return}if(this.deleted){r(this,yi).remove(),g(this,yi,null);return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&r(this,yi).updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const s=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),s.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};Kr=new WeakMap,Xs=new WeakMap,Ft=new WeakMap,Pt=new WeakMap,Ki=new WeakMap,Oo=new WeakMap,Yn=new WeakMap,Wh=new WeakMap,we=new WeakMap,Jr=new WeakMap,Ji=new WeakMap,yi=new WeakMap,Kn=new WeakMap,Xh=new WeakMap,Qr=new WeakMap,rs=new WeakMap,Yh=new WeakMap,Zr=new WeakMap,Qi=new WeakMap,bi=new WeakMap,ko=new WeakMap,No=new WeakMap,Fs=new WeakMap,qr=new WeakMap,Kh=new WeakMap,Su=new WeakMap,J=new WeakSet,gf=function([e,t],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/e,this.y+=i/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},Jh=new WeakSet,mf=function(e,t,s){switch(s){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},Td=function(e){switch(e){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}},am=function(){if(r(this,we))return;g(this,we,document.createElement("div")),r(this,we).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const s of e){const i=document.createElement("div");r(this,we).append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",w(this,J,om).bind(this,s),{signal:t}),i.addEventListener("contextmenu",Ts,{signal:t}),i.tabIndex=-1}this.div.prepend(r(this,we))},om=function(e,t){var d;t.preventDefault();const{isMac:s}=ye.platform;if(t.button!==0||t.ctrlKey&&s)return;(d=r(this,Ft))==null||d.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,g(this,Jr,[t.screenX,t.screenY]);const n=new AbortController,a=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",w(this,J,yf).bind(this,e),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",$t,{passive:!1,signal:a}),window.addEventListener("contextmenu",Ts,{signal:a}),g(this,Ji,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const h=()=>{var u;n.abort(),this.parent.togglePointerEvents(!0),(u=r(this,Ft))==null||u.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=o,this.div.style.cursor=l,w(this,J,Cd).call(this)};window.addEventListener("pointerup",h,{signal:a}),window.addEventListener("blur",h,{signal:a})},vf=function(e,t,s,i){this.width=s,this.height=i,this.x=e,this.y=t,this.setDims(),this.fixAndSetPosition(),this._onResized()},Cd=function(){if(!r(this,Ji))return;const{savedX:e,savedY:t,savedWidth:s,savedHeight:i}=r(this,Ji);g(this,Ji,null);const n=this.x,a=this.y,o=this.width,l=this.height;n===e&&a===t&&o===s&&l===i||this.addCommands({cmd:w(this,J,vf).bind(this,n,a,o,l),undo:w(this,J,vf).bind(this,e,t,s,i),mustExec:!0})},yf=function(e,t){const[s,i]=this.parentDimensions,n=this.x,a=this.y,o=this.width,l=this.height,h=st.MIN_SIZE/s,d=st.MIN_SIZE/i,u=w(this,J,Td).call(this,this.rotation),f=(_,k)=>[u[0]*_+u[2]*k,u[1]*_+u[3]*k],p=w(this,J,Td).call(this,360-this.rotation),m=(_,k)=>[p[0]*_+p[2]*k,p[1]*_+p[3]*k];let v,A,b=!1,S=!1;switch(e){case"topLeft":b=!0,v=(_,k)=>[0,0],A=(_,k)=>[_,k];break;case"topMiddle":v=(_,k)=>[_/2,0],A=(_,k)=>[_/2,k];break;case"topRight":b=!0,v=(_,k)=>[_,0],A=(_,k)=>[0,k];break;case"middleRight":S=!0,v=(_,k)=>[_,k/2],A=(_,k)=>[0,k/2];break;case"bottomRight":b=!0,v=(_,k)=>[_,k],A=(_,k)=>[0,0];break;case"bottomMiddle":v=(_,k)=>[_/2,k],A=(_,k)=>[_/2,0];break;case"bottomLeft":b=!0,v=(_,k)=>[0,k],A=(_,k)=>[_,0];break;case"middleLeft":S=!0,v=(_,k)=>[0,k/2],A=(_,k)=>[_,k/2];break}const E=v(o,l),T=A(o,l);let x=f(...T);const C=st._round(n+x[0]),P=st._round(a+x[1]);let I=1,R=1,L,D;if(t.fromKeyboard)({deltaX:L,deltaY:D}=t);else{const{screenX:_,screenY:k}=t,[X,Z]=r(this,Jr);[L,D]=this.screenToPageTranslation(_-X,k-Z),r(this,Jr)[0]=_,r(this,Jr)[1]=k}if([L,D]=m(L/s,D/i),b){const _=Math.hypot(o,l);I=R=Math.max(Math.min(Math.hypot(T[0]-E[0]-L,T[1]-E[1]-D)/_,1/o,1/l),h/o,d/l)}else S?I=Ne(Math.abs(T[0]-E[0]-L),h,1)/o:R=Ne(Math.abs(T[1]-E[1]-D),d,1)/l;const O=st._round(o*I),F=st._round(l*R);x=f(...A(O,F));const B=C-x[0],W=P-x[1];r(this,rs)||g(this,rs,[this.x,this.y,this.width,this.height]),this.width=O,this.height=F,this.x=B,this.y=W,this.setDims(),this.fixAndSetPosition(),this._onResizing()},lm=function(){var e;g(this,Ji,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=r(this,Ft))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},hm=function(e,t,s){let n=.7*(s/t)+1-.7;if(n===1)return;const a=w(this,J,Td).call(this,this.rotation),o=(C,P)=>[a[0]*C+a[2]*P,a[1]*C+a[3]*P],[l,h]=this.parentDimensions,d=this.x,u=this.y,f=this.width,p=this.height,m=st.MIN_SIZE/l,v=st.MIN_SIZE/h;n=Math.max(Math.min(n,1/f,1/p),m/f,v/p);const A=st._round(f*n),b=st._round(p*n);if(A===f&&b===p)return;r(this,rs)||g(this,rs,[d,u,f,p]);const S=o(f/2,p/2),E=st._round(d+S[0]),T=st._round(u+S[1]),x=o(A/2,b/2);this.x=E-x[0],this.y=T-x[1],this.width=A,this.height=b,this.setDims(),this.fixAndSetPosition(),this._onResizing()},cm=function(){var e;(e=r(this,Ft))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),w(this,J,Cd).call(this)},bf=function(e){const{isMac:t}=ye.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},dm=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let s=!1;const i=new AbortController,n=this._uiManager.combinedSignal(i),a={capture:!0,passive:!1,signal:n},o=h=>{i.abort(),g(this,Yn,null),g(this,Qr,!1),this._uiManager.endDragSession()||w(this,J,bf).call(this,h),s&&this._onStopDragging()};t&&(g(this,ko,e.clientX),g(this,No,e.clientY),g(this,Yn,e.pointerId),g(this,Wh,e.pointerType),window.addEventListener("pointermove",h=>{s||(s=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:d,clientY:u,pointerId:f}=h;if(f!==r(this,Yn)){$t(h);return}const[p,m]=this.screenToPageTranslation(d-r(this,ko),u-r(this,No));g(this,ko,d),g(this,No,u),this._uiManager.dragSelectedEditors(p,m)},a),window.addEventListener("touchmove",$t,a),window.addEventListener("pointerdown",h=>{h.pointerType===r(this,Wh)&&(r(this,qr)||h.isPrimary)&&o(h),$t(h)},a));const l=h=>{if(!r(this,Yn)||r(this,Yn)===h.pointerId){o(h);return}$t(h)};window.addEventListener("pointerup",l,{signal:n}),window.addEventListener("blur",l,{signal:n})},Af=function(){if(r(this,Kn)||!this.div)return;g(this,Kn,new AbortController);const e=this._uiManager.combinedSignal(r(this,Kn));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},um=function(e){st._resizerKeyboardManager.exec(this,e)},fm=function(e){var t;r(this,Qi)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==r(this,we)&&w(this,J,eh).call(this)},pm=function(e){g(this,Xh,r(this,Qi)?e:"")},wf=function(e){if(r(this,Xs))for(const t of r(this,Xs))t.tabIndex=e},eh=function(){g(this,Qi,!1),w(this,J,wf).call(this,-1),w(this,J,Cd).call(this)},y(st,Jh),M(st,"_l10n",null),M(st,"_l10nResizer",null),M(st,"_borderLineWidth",-1),M(st,"_colorManager",new of),M(st,"_zIndex",1),M(st,"_telemetryTimeout",1e3);let Ot=st;class ay extends Ot{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const ig=3285377520,Ps=4294901760,li=65535;class gm{constructor(e){this.h1=e?e&4294967295:ig,this.h2=e?e&4294967295:ig}update(e){let t,s;if(typeof e=="string"){t=new Uint8Array(e.length*2),s=0;for(let v=0,A=e.length;v<A;v++){const b=e.charCodeAt(v);b<=255?t[s++]=b:(t[s++]=b>>>8,t[s++]=b&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),s=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,n=s-i*4,a=new Uint32Array(t.buffer,0,i);let o=0,l=0,h=this.h1,d=this.h2;const u=3432918353,f=461845907,p=u&li,m=f&li;for(let v=0;v<i;v++)v&1?(o=a[v],o=o*u&Ps|o*p&li,o=o<<15|o>>>17,o=o*f&Ps|o*m&li,h^=o,h=h<<13|h>>>19,h=h*5+3864292196):(l=a[v],l=l*u&Ps|l*p&li,l=l<<15|l>>>17,l=l*f&Ps|l*m&li,d^=l,d=d<<13|d>>>19,d=d*5+3864292196);switch(o=0,n){case 3:o^=t[i*4+2]<<16;case 2:o^=t[i*4+1]<<8;case 1:o^=t[i*4],o=o*u&Ps|o*p&li,o=o<<15|o>>>17,o=o*f&Ps|o*m&li,i&1?h^=o:d^=o}this.h1=h,this.h2=d}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Ps|e*36045&li,t=t*4283543511&Ps|((t<<16|e>>>16)*2950163797&Ps)>>>16,e^=t>>>1,e=e*444984403&Ps|e*60499&li,t=t*3301882366&Ps|((t<<16|e>>>16)*3120437893&Ps)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const Ef=Object.freeze({map:null,hash:"",transfer:void 0});var ta,ea,Zi,Ee,xu,mm;class Op{constructor(){y(this,xu);y(this,ta,!1);y(this,ea,null);y(this,Zi,null);y(this,Ee,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const s=r(this,Ee).get(e);return s===void 0?t:Object.assign(t,s)}getRawValue(e){return r(this,Ee).get(e)}remove(e){const t=r(this,Ee).get(e);if(t!==void 0&&(t instanceof Ot&&r(this,Zi).delete(t.annotationElementId),r(this,Ee).delete(e),r(this,Ee).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const s of r(this,Ee).values())if(s instanceof Ot)return;this.onAnnotationEditor(null)}}setValue(e,t){const s=r(this,Ee).get(e);let i=!1;if(s!==void 0)for(const[n,a]of Object.entries(t))s[n]!==a&&(i=!0,s[n]=a);else i=!0,r(this,Ee).set(e,t);i&&w(this,xu,mm).call(this),t instanceof Ot&&((r(this,Zi)||g(this,Zi,new Map)).set(t.annotationElementId,t),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type))}has(e){return r(this,Ee).has(e)}get size(){return r(this,Ee).size}resetModified(){r(this,ta)&&(g(this,ta,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new vm(this)}get serializable(){if(r(this,Ee).size===0)return Ef;const e=new Map,t=new gm,s=[],i=Object.create(null);let n=!1;for(const[a,o]of r(this,Ee)){const l=o instanceof Ot?o.serialize(!1,i):o;l&&(e.set(a,l),t.update(`${a}:${JSON.stringify(l)}`),n||(n=!!l.bitmap))}if(n)for(const a of e.values())a.bitmap&&s.push(a.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:s}:Ef}get editorStats(){let e=null;const t=new Map;let s=0,i=0;for(const n of r(this,Ee).values()){if(!(n instanceof Ot)){n.popup&&(n.popup.deleted?i+=1:s+=1);continue}n.isCommentDeleted?i+=1:n.hasEditedComment&&(s+=1);const a=n.telemetryFinalData;if(!a)continue;const{type:o}=a;t.has(o)||t.set(o,Object.getPrototypeOf(n).constructor),e||(e=Object.create(null));const l=e[o]||(e[o]=new Map);for(const[h,d]of Object.entries(a)){if(h==="type")continue;let u=l.get(h);u||(u=new Map,l.set(h,u));const f=u.get(d)??0;u.set(d,f+1)}}if((i>0||s>0)&&(e||(e=Object.create(null)),e.comments={deleted:i,edited:s}),!e)return null;for(const[n,a]of t)e[n]=a.computeTelemetryFinalData(e[n]);return e}resetModifiedIds(){g(this,ea,null)}updateEditor(e,t){var i;const s=(i=r(this,Zi))==null?void 0:i.get(e);return s?(s.updateFromAnnotationLayer(t),!0):!1}getEditor(e){var t;return((t=r(this,Zi))==null?void 0:t.get(e))||null}get modifiedIds(){if(r(this,ea))return r(this,ea);const e=[];if(r(this,Zi))for(const t of r(this,Zi).values())t.serialize()&&e.push(t.annotationElementId);return g(this,ea,{ids:new Set(e),hash:e.join(",")})}[Symbol.iterator](){return r(this,Ee).entries()}}ta=new WeakMap,ea=new WeakMap,Zi=new WeakMap,Ee=new WeakMap,xu=new WeakSet,mm=function(){r(this,ta)||(g(this,ta,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var Qh;class vm extends Op{constructor(t){super();y(this,Qh);const{map:s,hash:i,transfer:n}=t.serializable,a=structuredClone(s,n?{transfer:n}:null);g(this,Qh,{map:a,hash:i,transfer:n})}get print(){Mt("Should not call PrintAnnotationStorage.print")}get serializable(){return r(this,Qh)}get modifiedIds(){return at(this,"modifiedIds",{ids:new Set,hash:""})}}Qh=new WeakMap;var Fo;class oy{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){y(this,Fo,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),r(this,Fo).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:s}){if(!(!e||r(this,Fo).has(e.loadedName))){if(ut(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:n,style:a}=e,o=new FontFace(i,n,a);this.addNativeFontFace(o);try{await o.load(),r(this,Fo).add(i),s==null||s(e)}catch{Q(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}Mt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const s=e.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw Q(`Failed to load font '${s.family}': '${i}'.`),e.disableFontFace=!0,i}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(e,i)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return at(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return at(this,"isSyncFontLoadingSupported",je||ye.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(ut(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const n=s.shift();setTimeout(n.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:t,callback:e};return s.push(i),i}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return at(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function s(T,x){return T.charCodeAt(x)<<24|T.charCodeAt(x+1)<<16|T.charCodeAt(x+2)<<8|T.charCodeAt(x+3)&255}function i(T,x,C,P){const I=T.substring(0,x),R=T.substring(x+C);return I+P+R}let n,a;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let h=0;function d(T,x){if(++h>30){Q("Load test font never loaded."),x();return}if(l.font="30px "+T,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){x();return}setTimeout(d.bind(null,T,x))}const u=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=i(f,976,u.length,u);const m=16,v=1482184792;let A=s(f,m);for(n=0,a=u.length-3;n<a;n+=4)A=A-v+s(u,n)|0;n<u.length&&(A=A-v+s(u+"XXX",n)|0),f=i(f,m,4,Yv(A));const b=`url(data:font/opentype;base64,${btoa(f)});`,S=`@font-face {font-family:"${u}";src:${b}}`;this.insertRule(S);const E=this._document.createElement("div");E.style.visibility="hidden",E.style.width=E.style.height="10px",E.style.position="absolute",E.style.top=E.style.left="0px";for(const T of[e.loadedName,u]){const x=this._document.createElement("span");x.textContent="Hi",x.style.fontFamily=T,E.append(x)}this._document.body.append(E),d(u,()=>{E.remove(),t.complete()})}}Fo=new WeakMap;var Et;class ly{constructor(e,t=null,s,i){y(this,Et);this.compiledGlyphs=Object.create(null),g(this,Et,e),this._inspectFont=t,s&&Object.assign(this,s),i&&(this.charProcOperatorList=i)}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const s={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(s.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var s;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${Og(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return(s=this._inspectFont)==null||s.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const s=this.loadedName+"_path_"+t;let i;try{i=e.get(s)}catch(a){Q(`getPathGenerator - ignoring character: "${a}".`)}const n=new Path2D(i||"");return this.fontExtraProperties||e.delete(s),this.compiledGlyphs[t]=n}get black(){return r(this,Et).black}get bold(){return r(this,Et).bold}get disableFontFace(){return r(this,Et).disableFontFace??!1}get fontExtraProperties(){return r(this,Et).fontExtraProperties??!1}get isInvalidPDFjsFont(){return r(this,Et).isInvalidPDFjsFont}get isType3Font(){return r(this,Et).isType3Font}get italic(){return r(this,Et).italic}get missingFile(){return r(this,Et).missingFile}get remeasure(){return r(this,Et).remeasure}get vertical(){return r(this,Et).vertical}get ascent(){return r(this,Et).ascent}get defaultWidth(){return r(this,Et).defaultWidth}get descent(){return r(this,Et).descent}get bbox(){return r(this,Et).bbox}get fontMatrix(){return r(this,Et).fontMatrix}get fallbackName(){return r(this,Et).fallbackName}get loadedName(){return r(this,Et).loadedName}get mimetype(){return r(this,Et).mimetype}get name(){return r(this,Et).name}get data(){return r(this,Et).data}clearData(){r(this,Et).clearData()}get cssFontInfo(){return r(this,Et).cssFontInfo}get systemFontInfo(){return r(this,Et).systemFontInfo}get defaultVMetrics(){return r(this,Et).defaultVMetrics}}Et=new WeakMap;function hy(c){if(c instanceof URL)return c.href;if(typeof c=="string"){if(je)return c;const e=URL.parse(c,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function cy(c){if(je&&typeof Buffer<"u"&&c instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(c instanceof Uint8Array&&c.byteLength===c.buffer.byteLength)return c;if(typeof c=="string")return nd(c);if(c instanceof ArrayBuffer||ArrayBuffer.isView(c)||typeof c=="object"&&!isNaN(c==null?void 0:c.length))return new Uint8Array(c);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function fd(c){if(typeof c!="string")return null;if(c.endsWith("/"))return c;throw new Error(`Invalid factory url: "${c}" must include trailing slash.`)}const Sf=c=>typeof c=="object"&&Number.isInteger(c==null?void 0:c.num)&&c.num>=0&&Number.isInteger(c==null?void 0:c.gen)&&c.gen>=0,dy=c=>typeof c=="object"&&typeof(c==null?void 0:c.name)=="string",ym=Zv.bind(null,Sf,dy);var qi,Tu;class uy{constructor(){y(this,qi,new Map);y(this,Tu,Promise.resolve())}postMessage(e,t){const s={data:structuredClone(e,t?{transfer:t}:null)};r(this,Tu).then(()=>{for(const[i]of r(this,qi))i.call(this,s)})}addEventListener(e,t,s=null){let i=null;if((s==null?void 0:s.signal)instanceof AbortSignal){const{signal:n}=s;if(n.aborted){Q("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(e,t);i=()=>n.removeEventListener("abort",a),n.addEventListener("abort",a)}r(this,qi).set(t,i)}removeEventListener(e,t){const s=r(this,qi).get(t);s==null||s(),r(this,qi).delete(t)}terminate(){for(const[,e]of r(this,qi))e==null||e();r(this,qi).clear()}}qi=new WeakMap,Tu=new WeakMap;const pd={DATA:1,ERROR:2},Zt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function ng(){}function Ge(c){if(c instanceof Pn||c instanceof Zd||c instanceof Jp||c instanceof yh||c instanceof Wu)return c;switch(c instanceof Error||typeof c=="object"&&c!==null||Mt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),c.name){case"AbortException":return new Pn(c.message);case"InvalidPDFException":return new Zd(c.message);case"PasswordException":return new Jp(c.message,c.code);case"ResponseException":return new yh(c.message,c.status,c.missing);case"UnknownErrorException":return new Wu(c.message,c.details)}return new Wu(c.message,c.toString())}var Bo,$s,bm,Am,wm,Pd;class wh{constructor(e,t,s){y(this,$s);y(this,Bo,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",w(this,$s,bm).bind(this),{signal:r(this,Bo).signal})}on(e,t){const s=this.actionHandler;if(s[e])throw new Error(`There is already an actionName called "${e}"`);s[e]=t}send(e,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},s)}sendWithPromise(e,t,s){const i=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[i]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},s)}catch(a){n.reject(a)}return n.promise}sendWithStream(e,t,s,i){const n=this.streamId++,a=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:h=>{const d=Promise.withResolvers();return this.streamControllers[n]={controller:h,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:a,targetName:o,action:e,streamId:n,data:t,desiredSize:h.desiredSize},i),d.promise},pull:h=>{const d=Promise.withResolvers();return this.streamControllers[n].pullCall=d,l.postMessage({sourceName:a,targetName:o,stream:Zt.PULL,streamId:n,desiredSize:h.desiredSize}),d.promise},cancel:h=>{ut(h instanceof Error,"cancel must have a valid reason");const d=Promise.withResolvers();return this.streamControllers[n].cancelCall=d,this.streamControllers[n].isClosed=!0,l.postMessage({sourceName:a,targetName:o,stream:Zt.CANCEL,streamId:n,reason:Ge(h)}),d.promise}},s)}destroy(){var e;(e=r(this,Bo))==null||e.abort(),g(this,Bo,null)}}Bo=new WeakMap,$s=new WeakSet,bm=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){w(this,$s,wm).call(this,e);return}if(e.callback){const s=e.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],e.callback===pd.DATA)i.resolve(e.data);else if(e.callback===pd.ERROR)i.reject(Ge(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const s=this.sourceName,i=e.sourceName,n=this.comObj;Promise.try(t,e.data).then(function(a){n.postMessage({sourceName:s,targetName:i,callback:pd.DATA,callbackId:e.callbackId,data:a})},function(a){n.postMessage({sourceName:s,targetName:i,callback:pd.ERROR,callbackId:e.callbackId,reason:Ge(a)})});return}if(e.streamId){w(this,$s,Am).call(this,e);return}t(e.data)},Am=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,n=this.comObj,a=this,o=this.actionHandler[e.action],l={enqueue(h,d=1,u){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=d,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:s,targetName:i,stream:Zt.ENQUEUE,streamId:t,chunk:h},u)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:Zt.CLOSE,streamId:t}),delete a.streamSinks[t])},error(h){ut(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:Zt.ERROR,streamId:t,reason:Ge(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(o,e.data,l).then(function(){n.postMessage({sourceName:s,targetName:i,stream:Zt.START_COMPLETE,streamId:t,success:!0})},function(h){n.postMessage({sourceName:s,targetName:i,stream:Zt.START_COMPLETE,streamId:t,reason:Ge(h)})})},wm=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,n=this.comObj,a=this.streamControllers[t],o=this.streamSinks[t];switch(e.stream){case Zt.START_COMPLETE:e.success?a.startCall.resolve():a.startCall.reject(Ge(e.reason));break;case Zt.PULL_COMPLETE:e.success?a.pullCall.resolve():a.pullCall.reject(Ge(e.reason));break;case Zt.PULL:if(!o){n.postMessage({sourceName:s,targetName:i,stream:Zt.PULL_COMPLETE,streamId:t,success:!0});break}o.desiredSize<=0&&e.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=e.desiredSize,Promise.try(o.onPull||ng).then(function(){n.postMessage({sourceName:s,targetName:i,stream:Zt.PULL_COMPLETE,streamId:t,success:!0})},function(h){n.postMessage({sourceName:s,targetName:i,stream:Zt.PULL_COMPLETE,streamId:t,reason:Ge(h)})});break;case Zt.ENQUEUE:if(ut(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case Zt.CLOSE:if(ut(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),w(this,$s,Pd).call(this,a,t);break;case Zt.ERROR:ut(a,"error should have stream controller"),a.controller.error(Ge(e.reason)),w(this,$s,Pd).call(this,a,t);break;case Zt.CANCEL_COMPLETE:e.success?a.cancelCall.resolve():a.cancelCall.reject(Ge(e.reason)),w(this,$s,Pd).call(this,a,t);break;case Zt.CANCEL:if(!o)break;const l=Ge(e.reason);Promise.try(o.onCancel||ng,l).then(function(){n.postMessage({sourceName:s,targetName:i,stream:Zt.CANCEL_COMPLETE,streamId:t,success:!0})},function(h){n.postMessage({sourceName:s,targetName:i,stream:Zt.CANCEL_COMPLETE,streamId:t,reason:Ge(h)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},Pd=async function(e,t){var s,i,n;await Promise.allSettled([(s=e.startCall)==null?void 0:s.promise,(i=e.pullCall)==null?void 0:i.promise,(n=e.cancelCall)==null?void 0:n.promise]),delete this.streamControllers[t]};var Zh;class Em{constructor({enableHWA:e=!1}){y(this,Zh,!1);g(this,Zh,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(e,t);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!r(this,Zh)})}}reset(e,t,s){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||s<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=s}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){Mt("Abstract method `_createCanvas` called.")}}Zh=new WeakMap;class fy extends Em{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const s=this._document.createElement("canvas");return s.width=e,s.height=t,s}}class Sm{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){Mt("Abstract method `_fetch` called.")}}class rg extends Sm{async _fetch(e){const t=await zl(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):nd(t)}}nt(2489);class xm{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,s,i,n){return"none"}destroy(e=!1){}}var sa,_o,tn,en,De,ia,na,z,Re,sh,eo,Rd,so,Tm,xf,io,ih,nh,Tf,rh;class py extends xm{constructor({docId:t,ownerDocument:s=globalThis.document}){super();y(this,z);y(this,sa);y(this,_o);y(this,tn);y(this,en);y(this,De);y(this,ia);y(this,na,0);g(this,en,t),g(this,De,s)}addFilter(t){if(!t)return"none";let s=r(this,z,Re).get(t);if(s)return s;const[i,n,a]=w(this,z,Rd).call(this,t),o=t.length===1?i:`${i}${n}${a}`;if(s=r(this,z,Re).get(o),s)return r(this,z,Re).set(t,s),s;const l=`g_${r(this,en)}_transfer_map_${he(this,na)._++}`,h=w(this,z,so).call(this,l);r(this,z,Re).set(t,h),r(this,z,Re).set(o,h);const d=w(this,z,io).call(this,l);return w(this,z,nh).call(this,i,n,a,d),h}addHCMFilter(t,s){var m;const i=`${t}-${s}`,n="base";let a=r(this,z,sh).get(n);if((a==null?void 0:a.key)===i||(a?((m=a.filter)==null||m.remove(),a.key=i,a.url="none",a.filter=null):(a={key:i,url:"none",filter:null},r(this,z,sh).set(n,a)),!t||!s))return a.url;const o=w(this,z,rh).call(this,t);t=j.makeHexColor(...o);const l=w(this,z,rh).call(this,s);if(s=j.makeHexColor(...l),r(this,z,eo).style.color="",t==="#000000"&&s==="#ffffff"||t===s)return a.url;const h=new Array(256);for(let v=0;v<=255;v++){const A=v/255;h[v]=A<=.03928?A/12.92:((A+.055)/1.055)**2.4}const d=h.join(","),u=`g_${r(this,en)}_hcm_filter`,f=a.filter=w(this,z,io).call(this,u);w(this,z,nh).call(this,d,d,d,f),w(this,z,xf).call(this,f);const p=(v,A)=>{const b=o[v]/255,S=l[v]/255,E=new Array(A+1);for(let T=0;T<=A;T++)E[T]=b+T/A*(S-b);return E.join(",")};return w(this,z,nh).call(this,p(0,5),p(1,5),p(2,5),f),a.url=w(this,z,so).call(this,u),a.url}addAlphaFilter(t){let s=r(this,z,Re).get(t);if(s)return s;const[i]=w(this,z,Rd).call(this,[t]),n=`alpha_${i}`;if(s=r(this,z,Re).get(n),s)return r(this,z,Re).set(t,s),s;const a=`g_${r(this,en)}_alpha_map_${he(this,na)._++}`,o=w(this,z,so).call(this,a);r(this,z,Re).set(t,o),r(this,z,Re).set(n,o);const l=w(this,z,io).call(this,a);return w(this,z,Tf).call(this,i,l),o}addLuminosityFilter(t){let s=r(this,z,Re).get(t||"luminosity");if(s)return s;let i,n;if(t?([i]=w(this,z,Rd).call(this,[t]),n=`luminosity_${i}`):n="luminosity",s=r(this,z,Re).get(n),s)return r(this,z,Re).set(t,s),s;const a=`g_${r(this,en)}_luminosity_map_${he(this,na)._++}`,o=w(this,z,so).call(this,a);r(this,z,Re).set(t,o),r(this,z,Re).set(n,o);const l=w(this,z,io).call(this,a);return w(this,z,Tm).call(this,l),t&&w(this,z,Tf).call(this,i,l),o}addHighlightHCMFilter(t,s,i,n,a){var S;const o=`${s}-${i}-${n}-${a}`;let l=r(this,z,sh).get(t);if((l==null?void 0:l.key)===o||(l?((S=l.filter)==null||S.remove(),l.key=o,l.url="none",l.filter=null):(l={key:o,url:"none",filter:null},r(this,z,sh).set(t,l)),!s||!i))return l.url;const[h,d]=[s,i].map(w(this,z,rh).bind(this));let u=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),f=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),[p,m]=[n,a].map(w(this,z,rh).bind(this));f<u&&([u,f,p,m]=[f,u,m,p]),r(this,z,eo).style.color="";const v=(E,T,x)=>{const C=new Array(256),P=(f-u)/x,I=E/255,R=(T-E)/(255*x);let L=0;for(let D=0;D<=x;D++){const O=Math.round(u+D*P),F=I+D*R;for(let B=L;B<=O;B++)C[B]=F;L=O+1}for(let D=L;D<256;D++)C[D]=C[L-1];return C.join(",")},A=`g_${r(this,en)}_hcm_${t}_filter`,b=l.filter=w(this,z,io).call(this,A);return w(this,z,xf).call(this,b),w(this,z,nh).call(this,v(p[0],m[0],5),v(p[1],m[1],5),v(p[2],m[2],5),b),l.url=w(this,z,so).call(this,A),l.url}destroy(t=!1){var s,i,n,a;t&&((s=r(this,ia))!=null&&s.size)||((i=r(this,tn))==null||i.parentNode.parentNode.remove(),g(this,tn,null),(n=r(this,_o))==null||n.clear(),g(this,_o,null),(a=r(this,ia))==null||a.clear(),g(this,ia,null),g(this,na,0))}}sa=new WeakMap,_o=new WeakMap,tn=new WeakMap,en=new WeakMap,De=new WeakMap,ia=new WeakMap,na=new WeakMap,z=new WeakSet,Re=function(){return r(this,_o)||g(this,_o,new Map)},sh=function(){return r(this,ia)||g(this,ia,new Map)},eo=function(){if(!r(this,tn)){const t=r(this,De).createElement("div"),{style:s}=t;s.visibility="hidden",s.contain="strict",s.width=s.height=0,s.position="absolute",s.top=s.left=0,s.zIndex=-1;const i=r(this,De).createElementNS(Fi,"svg");i.setAttribute("width",0),i.setAttribute("height",0),g(this,tn,r(this,De).createElementNS(Fi,"defs")),t.append(i),i.append(r(this,tn)),r(this,De).body.append(t)}return r(this,tn)},Rd=function(t){if(t.length===1){const h=t[0],d=new Array(256);for(let f=0;f<256;f++)d[f]=h[f]/255;const u=d.join(",");return[u,u,u]}const[s,i,n]=t,a=new Array(256),o=new Array(256),l=new Array(256);for(let h=0;h<256;h++)a[h]=s[h]/255,o[h]=i[h]/255,l[h]=n[h]/255;return[a.join(","),o.join(","),l.join(",")]},so=function(t){if(r(this,sa)===void 0){g(this,sa,"");const s=r(this,De).URL;s!==r(this,De).baseURI&&(ad(s)?Q('#createUrl: ignore "data:"-URL for performance reasons.'):g(this,sa,Rp(s,"")))}return`url(${r(this,sa)}#${t})`},Tm=function(t){const s=r(this,De).createElementNS(Fi,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(s)},xf=function(t){const s=r(this,De).createElementNS(Fi,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(s)},io=function(t){const s=r(this,De).createElementNS(Fi,"filter");return s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("id",t),r(this,z,eo).append(s),s},ih=function(t,s,i){const n=r(this,De).createElementNS(Fi,s);n.setAttribute("type","discrete"),n.setAttribute("tableValues",i),t.append(n)},nh=function(t,s,i,n){const a=r(this,De).createElementNS(Fi,"feComponentTransfer");n.append(a),w(this,z,ih).call(this,a,"feFuncR",t),w(this,z,ih).call(this,a,"feFuncG",s),w(this,z,ih).call(this,a,"feFuncB",i)},Tf=function(t,s){const i=r(this,De).createElementNS(Fi,"feComponentTransfer");s.append(i),w(this,z,ih).call(this,i,"feFuncA",t)},rh=function(t){return r(this,z,eo).style.color=t,Vl(getComputedStyle(r(this,z,eo)).getPropertyValue("color"))};class Cm{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){Mt("Abstract method `_fetch` called.")}}class ag extends Cm{async _fetch(e){const t=await zl(e,"arraybuffer");return new Uint8Array(t)}}class Pm{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){Mt("Abstract method `_fetch` called.")}}class og extends Pm{async _fetch(e){const t=await zl(e,"arraybuffer");return new Uint8Array(t)}}var xg;if(je){let c;try{const e=process.getBuiltinModule("module").createRequire(import.meta.url);try{c=e("@napi-rs/canvas")}catch(t){Q(`Cannot load "@napi-rs/canvas" package: "${t}".`)}}catch(e){Q(`Cannot access the \`require\` function: "${e}".`)}globalThis.DOMMatrix||(c!=null&&c.DOMMatrix?globalThis.DOMMatrix=c.DOMMatrix:Q("Cannot polyfill `DOMMatrix`, rendering may be broken.")),globalThis.ImageData||(c!=null&&c.ImageData?globalThis.ImageData=c.ImageData:Q("Cannot polyfill `ImageData`, rendering may be broken.")),globalThis.Path2D||(c!=null&&c.Path2D?globalThis.Path2D=c.Path2D:Q("Cannot polyfill `Path2D`, rendering may be broken.")),(xg=globalThis.navigator)!=null&&xg.language||(globalThis.navigator={language:"en-US",platform:"",userAgent:""})}async function kp(c){const t=await process.getBuiltinModule("fs").promises.readFile(c);return new Uint8Array(t)}class gy extends xm{}class my extends Em{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class vy extends Sm{async _fetch(e){return kp(e)}}class yy extends Cm{async _fetch(e){return kp(e)}}class by extends Pm{async _fetch(e){return kp(e)}}nt(7588);const Za="__forcedDependency",{floor:lg,ceil:hg}=Math;function gd(c,e,t,s,i,n){c[e*4+0]=Math.min(c[e*4+0],t),c[e*4+1]=Math.min(c[e*4+1],s),c[e*4+2]=Math.max(c[e*4+2],i),c[e*4+3]=Math.max(c[e*4+3],n)}const Cf=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];var Uo,Jn;class Ay{constructor(e,t){y(this,Uo);y(this,Jn);g(this,Uo,e),g(this,Jn,t)}get length(){return r(this,Uo).length}isEmpty(e){return r(this,Uo)[e]===Cf}minX(e){return r(this,Jn)[e*4+0]/256}minY(e){return r(this,Jn)[e*4+1]/256}maxX(e){return(r(this,Jn)[e*4+2]+1)/256}maxY(e){return(r(this,Jn)[e*4+3]+1)/256}}Uo=new WeakMap,Jn=new WeakMap;const md=(c,e)=>{if(!c)return;let t=c.get(e);return t||(t={dependencies:new Set,isRenderingOperation:!1},c.set(e,t)),t};var Ye,Ke,ra,Ys,aa,sn,wt,St,nn,Je,qh,Ho,oa,la,rn,Le,Ai,tc,Pf;class wy{constructor(e,t,s=!1){y(this,tc);y(this,Ye,{__proto__:null});y(this,Ke,{__proto__:null,transform:[],moveText:[],sameLineText:[],[Za]:[]});y(this,ra,new Map);y(this,Ys,[]);y(this,aa,[]);y(this,sn,[[1,0,0,1,0,0]]);y(this,wt,[-1/0,-1/0,1/0,1/0]);y(this,St,new Float64Array([1/0,1/0,-1/0,-1/0]));y(this,nn,-1);y(this,Je,new Set);y(this,qh,new Map);y(this,Ho,new Map);y(this,oa);y(this,la);y(this,rn);y(this,Le);y(this,Ai);g(this,oa,e.width),g(this,la,e.height),w(this,tc,Pf).call(this,t),s&&g(this,Ai,new Map)}growOperationsCount(e){e>=r(this,Le).length&&w(this,tc,Pf).call(this,e,r(this,Le))}save(e){return g(this,Ye,{__proto__:r(this,Ye)}),g(this,Ke,{__proto__:r(this,Ke),transform:{__proto__:r(this,Ke).transform},moveText:{__proto__:r(this,Ke).moveText},sameLineText:{__proto__:r(this,Ke).sameLineText},[Za]:{__proto__:r(this,Ke)[Za]}}),g(this,wt,{__proto__:r(this,wt)}),r(this,Ys).push(e),this}restore(e){var i;const t=Object.getPrototypeOf(r(this,Ye));if(t===null)return this;g(this,Ye,t),g(this,Ke,Object.getPrototypeOf(r(this,Ke))),g(this,wt,Object.getPrototypeOf(r(this,wt)));const s=r(this,Ys).pop();return s!==void 0&&((i=md(r(this,Ai),e))==null||i.dependencies.add(s),r(this,Le)[e]=r(this,Le)[s]),this}recordOpenMarker(e){return r(this,Ys).push(e),this}getOpenMarker(){return r(this,Ys).length===0?null:r(this,Ys).at(-1)}recordCloseMarker(e){var s;const t=r(this,Ys).pop();return t!==void 0&&((s=md(r(this,Ai),e))==null||s.dependencies.add(t),r(this,Le)[e]=r(this,Le)[t]),this}beginMarkedContent(e){return r(this,aa).push(e),this}endMarkedContent(e){var s;const t=r(this,aa).pop();return t!==void 0&&((s=md(r(this,Ai),e))==null||s.dependencies.add(t),r(this,Le)[e]=r(this,Le)[t]),this}pushBaseTransform(e){return r(this,sn).push(j.multiplyByDOMMatrix(r(this,sn).at(-1),e.getTransform())),this}popBaseTransform(){return r(this,sn).length>1&&r(this,sn).pop(),this}recordSimpleData(e,t){return r(this,Ye)[e]=t,this}recordIncrementalData(e,t){return r(this,Ke)[e].push(t),this}resetIncrementalData(e,t){return r(this,Ke)[e].length=0,this}recordNamedData(e,t){return r(this,ra).set(e,t),this}recordSimpleDataFromNamed(e,t,s){r(this,Ye)[e]=r(this,ra).get(t)??s}recordFutureForcedDependency(e,t){return this.recordIncrementalData(Za,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(const t of e)t in r(this,Ye)&&this.recordFutureForcedDependency(t,r(this,Ye)[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const e of r(this,Je))this.recordFutureForcedDependency(Za,e);return this}resetBBox(e){return r(this,nn)!==e&&(g(this,nn,e),r(this,St)[0]=1/0,r(this,St)[1]=1/0,r(this,St)[2]=-1/0,r(this,St)[3]=-1/0),this}recordClipBox(e,t,s,i,n,a){const o=j.multiplyByDOMMatrix(r(this,sn).at(-1),t.getTransform()),l=[1/0,1/0,-1/0,-1/0];j.axialAlignedBoundingBox([s,n,i,a],o,l);const h=j.intersect(r(this,wt),l);return h?(r(this,wt)[0]=h[0],r(this,wt)[1]=h[1],r(this,wt)[2]=h[2],r(this,wt)[3]=h[3]):(r(this,wt)[0]=r(this,wt)[1]=1/0,r(this,wt)[2]=r(this,wt)[3]=-1/0),this}recordBBox(e,t,s,i,n,a){const o=r(this,wt);if(o[0]===1/0)return this;const l=j.multiplyByDOMMatrix(r(this,sn).at(-1),t.getTransform());if(o[0]===-1/0)return j.axialAlignedBoundingBox([s,n,i,a],l,r(this,St)),this;const h=[1/0,1/0,-1/0,-1/0];return j.axialAlignedBoundingBox([s,n,i,a],l,h),r(this,St)[0]=Math.min(r(this,St)[0],Math.max(h[0],o[0])),r(this,St)[1]=Math.min(r(this,St)[1],Math.max(h[1],o[1])),r(this,St)[2]=Math.max(r(this,St)[2],Math.min(h[2],o[2])),r(this,St)[3]=Math.max(r(this,St)[3],Math.min(h[3],o[3])),this}recordCharacterBBox(e,t,s,i=1,n=0,a=0,o){const l=s.bbox;let h,d;if(l&&(h=l[2]!==l[0]&&l[3]!==l[1]&&r(this,Ho).get(s),h!==!1&&(d=[0,0,0,0],j.axialAlignedBoundingBox(l,s.fontMatrix,d),(i!==1||n!==0||a!==0)&&j.scaleMinMax([i,0,0,-i,n,a],d),h)))return this.recordBBox(e,t,d[0],d[2],d[1],d[3]);if(!o)return this.recordFullPageBBox(e);const u=o();return l&&d&&h===void 0&&(h=d[0]<=n-u.actualBoundingBoxLeft&&d[2]>=n+u.actualBoundingBoxRight&&d[1]<=a-u.actualBoundingBoxAscent&&d[3]>=a+u.actualBoundingBoxDescent,r(this,Ho).set(s,h),h)?this.recordBBox(e,t,d[0],d[2],d[1],d[3]):this.recordBBox(e,t,n-u.actualBoundingBoxLeft,n+u.actualBoundingBoxRight,a-u.actualBoundingBoxAscent,a+u.actualBoundingBoxDescent)}recordFullPageBBox(e){return r(this,St)[0]=Math.max(0,r(this,wt)[0]),r(this,St)[1]=Math.max(0,r(this,wt)[1]),r(this,St)[2]=Math.min(r(this,oa),r(this,wt)[2]),r(this,St)[3]=Math.min(r(this,la),r(this,wt)[3]),this}getSimpleIndex(e){return r(this,Ye)[e]}recordDependencies(e,t){const s=r(this,Je),i=r(this,Ye),n=r(this,Ke);for(const a of t)a in r(this,Ye)?s.add(i[a]):a in n&&n[a].forEach(s.add,s);return this}recordNamedDependency(e,t){return r(this,ra).has(t)&&r(this,Je).add(r(this,ra).get(t)),this}recordOperation(e,t=!1){if(this.recordDependencies(e,[Za]),r(this,Ai)){const s=md(r(this,Ai),e),{dependencies:i}=s;r(this,Je).forEach(i.add,i),r(this,Ys).forEach(i.add,i),r(this,aa).forEach(i.add,i),i.delete(e),s.isRenderingOperation=!0}if(r(this,nn)===e){const s=lg(r(this,St)[0]*256/r(this,oa)),i=lg(r(this,St)[1]*256/r(this,la)),n=hg(r(this,St)[2]*256/r(this,oa)),a=hg(r(this,St)[3]*256/r(this,la));gd(r(this,rn),e,s,i,n,a);for(const o of r(this,Je))o!==e&&gd(r(this,rn),o,s,i,n,a);for(const o of r(this,Ys))o!==e&&gd(r(this,rn),o,s,i,n,a);for(const o of r(this,aa))o!==e&&gd(r(this,rn),o,s,i,n,a);t||(r(this,Je).clear(),g(this,nn,-1))}return this}recordShowTextOperation(e,t=!1){const s=Array.from(r(this,Je));this.recordOperation(e,t),this.recordIncrementalData("sameLineText",e);for(const i of s)this.recordIncrementalData("sameLineText",i);return this}bboxToClipBoxDropOperation(e,t=!1){return r(this,nn)===e&&(g(this,nn,-1),r(this,wt)[0]=Math.max(r(this,wt)[0],r(this,St)[0]),r(this,wt)[1]=Math.max(r(this,wt)[1],r(this,St)[1]),r(this,wt)[2]=Math.min(r(this,wt)[2],r(this,St)[2]),r(this,wt)[3]=Math.min(r(this,wt)[3],r(this,St)[3]),t||r(this,Je).clear()),this}_takePendingDependencies(){const e=r(this,Je);return g(this,Je,new Set),e}_extractOperation(e){const t=r(this,qh).get(e);return r(this,qh).delete(e),t}_pushPendingDependencies(e){for(const t of e)r(this,Je).add(t)}take(){return r(this,Ho).clear(),new Ay(r(this,Le),r(this,rn))}takeDebugMetadata(){return r(this,Ai)}}Ye=new WeakMap,Ke=new WeakMap,ra=new WeakMap,Ys=new WeakMap,aa=new WeakMap,sn=new WeakMap,wt=new WeakMap,St=new WeakMap,nn=new WeakMap,Je=new WeakMap,qh=new WeakMap,Ho=new WeakMap,oa=new WeakMap,la=new WeakMap,rn=new WeakMap,Le=new WeakMap,Ai=new WeakMap,tc=new WeakSet,Pf=function(e,t){const s=new ArrayBuffer(e*4);g(this,rn,new Uint8ClampedArray(s)),g(this,Le,new Uint32Array(s)),t&&t.length>0?(r(this,Le).set(t),r(this,Le).fill(Cf,t.length)):r(this,Le).fill(Cf)};var Rt,Gt,Ks,$o,jo;const Vp=class Vp{constructor(e,t,s){y(this,Rt);y(this,Gt);y(this,Ks);y(this,$o,0);y(this,jo,0);if(e instanceof Vp&&r(e,Ks)===!!s)return e;g(this,Rt,e),g(this,Gt,t),g(this,Ks,!!s)}growOperationsCount(){throw new Error("Unreachable")}save(e){return he(this,jo)._++,r(this,Rt).save(r(this,Gt)),this}restore(e){return r(this,jo)>0&&(r(this,Rt).restore(r(this,Gt)),he(this,jo)._--),this}recordOpenMarker(e){return he(this,$o)._++,this}getOpenMarker(){return r(this,$o)>0?r(this,Gt):r(this,Rt).getOpenMarker()}recordCloseMarker(e){return he(this,$o)._--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return r(this,Rt).pushBaseTransform(e),this}popBaseTransform(){return r(this,Rt).popBaseTransform(),this}recordSimpleData(e,t){return r(this,Rt).recordSimpleData(e,r(this,Gt)),this}recordIncrementalData(e,t){return r(this,Rt).recordIncrementalData(e,r(this,Gt)),this}resetIncrementalData(e,t){return r(this,Rt).resetIncrementalData(e,r(this,Gt)),this}recordNamedData(e,t){return this}recordSimpleDataFromNamed(e,t,s){return r(this,Rt).recordSimpleDataFromNamed(e,t,r(this,Gt)),this}recordFutureForcedDependency(e,t){return r(this,Rt).recordFutureForcedDependency(e,r(this,Gt)),this}inheritSimpleDataAsFutureForcedDependencies(e){return r(this,Rt).inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return r(this,Rt).inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return r(this,Ks)||r(this,Rt).resetBBox(r(this,Gt)),this}recordClipBox(e,t,s,i,n,a){return r(this,Ks)||r(this,Rt).recordClipBox(r(this,Gt),t,s,i,n,a),this}recordBBox(e,t,s,i,n,a){return r(this,Ks)||r(this,Rt).recordBBox(r(this,Gt),t,s,i,n,a),this}recordCharacterBBox(e,t,s,i,n,a,o){return r(this,Ks)||r(this,Rt).recordCharacterBBox(r(this,Gt),t,s,i,n,a,o),this}recordFullPageBBox(e){return r(this,Ks)||r(this,Rt).recordFullPageBBox(r(this,Gt)),this}getSimpleIndex(e){return r(this,Rt).getSimpleIndex(e)}recordDependencies(e,t){return r(this,Rt).recordDependencies(r(this,Gt),t),this}recordNamedDependency(e,t){return r(this,Rt).recordNamedDependency(r(this,Gt),t),this}recordOperation(e){return r(this,Rt).recordOperation(r(this,Gt),!0),this}recordShowTextOperation(e){return r(this,Rt).recordShowTextOperation(r(this,Gt),!0),this}bboxToClipBoxDropOperation(e){return r(this,Ks)||r(this,Rt).bboxToClipBoxDropOperation(r(this,Gt),!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}};Rt=new WeakMap,Gt=new WeakMap,Ks=new WeakMap,$o=new WeakMap,jo=new WeakMap;let eu=Vp;const Rs={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},Te={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Rf(c,e){if(!e)return;const t=e[2]-e[0],s=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],t,s),c.clip(i)}class Np{isModifyingCurrentTransform(){return!1}getPattern(){Mt("Abstract method `getPattern` called.")}}class Ey extends Np{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)t.addColorStop(s[0],s[1]);return t}getPattern(e,t,s,i){let n;if(i===Te.STROKE||i===Te.FILL){const a=t.current.getClippedPathBoundingBox(i,Ut(e))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,l=Math.ceil(a[3]-a[1])||1,h=t.cachedCanvases.getCanvas("pattern",o,l),d=h.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-a[0],-a[1]),s=j.transform(s,[1,0,0,1,a[0],a[1]]),d.transform(...t.baseTransform),this.matrix&&d.transform(...this.matrix),Rf(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),n=e.createPattern(h.canvas,"no-repeat");const u=new DOMMatrix(s);n.setTransform(u)}else Rf(e,this._bbox),n=this._createGradient(e);return n}}function Ku(c,e,t,s,i,n,a,o){const l=e.coords,h=e.colors,d=c.data,u=c.width*4;let f;l[t+1]>l[s+1]&&(f=t,t=s,s=f,f=n,n=a,a=f),l[s+1]>l[i+1]&&(f=s,s=i,i=f,f=a,a=o,o=f),l[t+1]>l[s+1]&&(f=t,t=s,s=f,f=n,n=a,a=f);const p=(l[t]+e.offsetX)*e.scaleX,m=(l[t+1]+e.offsetY)*e.scaleY,v=(l[s]+e.offsetX)*e.scaleX,A=(l[s+1]+e.offsetY)*e.scaleY,b=(l[i]+e.offsetX)*e.scaleX,S=(l[i+1]+e.offsetY)*e.scaleY;if(m>=S)return;const E=h[n],T=h[n+1],x=h[n+2],C=h[a],P=h[a+1],I=h[a+2],R=h[o],L=h[o+1],D=h[o+2],O=Math.round(m),F=Math.round(S);let B,W,_,k,X,Z,gt,zt;for(let q=O;q<=F;q++){if(q<A){const N=q<m?0:(m-q)/(m-A);B=p-(p-v)*N,W=E-(E-C)*N,_=T-(T-P)*N,k=x-(x-I)*N}else{let N;q>S?N=1:A===S?N=0:N=(A-q)/(A-S),B=v-(v-b)*N,W=C-(C-R)*N,_=P-(P-L)*N,k=I-(I-D)*N}let ht;q<m?ht=0:q>S?ht=1:ht=(m-q)/(m-S),X=p-(p-b)*ht,Z=E-(E-R)*ht,gt=T-(T-L)*ht,zt=x-(x-D)*ht;const bt=Math.round(Math.min(B,X)),Qt=Math.round(Math.max(B,X));let H=u*q+bt*4;for(let N=bt;N<=Qt;N++)ht=(B-N)/(B-X),ht<0?ht=0:ht>1&&(ht=1),d[H++]=W-(W-Z)*ht|0,d[H++]=_-(_-gt)*ht|0,d[H++]=k-(k-zt)*ht|0,d[H++]=255}}function Sy(c,e,t){const s=e.coords,i=e.colors;let n,a;switch(e.type){case"lattice":const o=e.verticesPerRow,l=Math.floor(s.length/o)-1,h=o-1;for(n=0;n<l;n++){let d=n*o;for(let u=0;u<h;u++,d++)Ku(c,t,s[d],s[d+1],s[d+o],i[d],i[d+1],i[d+o]),Ku(c,t,s[d+o+1],s[d+1],s[d+o],i[d+o+1],i[d+1],i[d+o])}break;case"triangles":for(n=0,a=s.length;n<a;n+=3)Ku(c,t,s[n],s[n+1],s[n+2],i[n],i[n+1],i[n+2]);break;default:throw new Error("illegal figure")}}class xy extends Np{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,s){const o=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-o,d=Math.ceil(this._bounds[3])-l,u=Math.min(Math.ceil(Math.abs(h*e[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(d*e[1]*1.1)),3e3),p=h/u,m=d/f,v={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-l,scaleX:1/p,scaleY:1/m},A=u+2*2,b=f+2*2,S=s.getCanvas("mesh",A,b),E=S.context,T=E.createImageData(u,f);if(t){const C=T.data;for(let P=0,I=C.length;P<I;P+=4)C[P]=t[0],C[P+1]=t[1],C[P+2]=t[2],C[P+3]=255}for(const C of this._figures)Sy(T,C,v);return E.putImageData(T,2,2),{canvas:S.canvas,offsetX:o-2*p,offsetY:l-2*m,scaleX:p,scaleY:m}}isModifyingCurrentTransform(){return!0}getPattern(e,t,s,i){Rf(e,this._bbox);const n=new Float32Array(2);if(i===Te.SHADING)j.singularValueDecompose2dScale(Ut(e),n);else if(this.matrix){j.singularValueDecompose2dScale(this.matrix,n);const[o,l]=n;j.singularValueDecompose2dScale(t.baseTransform,n),n[0]*=o,n[1]*=l}else j.singularValueDecompose2dScale(t.baseTransform,n);const a=this._createMeshCanvas(n,i===Te.SHADING?null:this._background,t.cachedCanvases);return i!==Te.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(a.offsetX,a.offsetY),e.scale(a.scaleX,a.scaleY),e.createPattern(a.canvas,"no-repeat")}}class Ty extends Np{getPattern(){return"hotpink"}}function Cy(c){switch(c[0]){case"RadialAxial":return new Ey(c);case"Mesh":return new xy(c);case"Dummy":return new Ty}throw new Error(`Unknown IR type: ${c[0]}`)}const cg={COLORED:1,UNCOLORED:2},Cu=class Cu{constructor(e,t,s,i){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=s,this.baseTransform=i}createPatternCanvas(e,t){var Z,gt;const{bbox:s,operatorList:i,paintType:n,tilingType:a,color:o,canvasGraphicsFactory:l}=this;let{xstep:h,ystep:d}=this;h=Math.abs(h),d=Math.abs(d),_u("TilingType: "+a);const u=s[0],f=s[1],p=s[2],m=s[3],v=p-u,A=m-f,b=new Float32Array(2);j.singularValueDecompose2dScale(this.matrix,b);const[S,E]=b;j.singularValueDecompose2dScale(this.baseTransform,b);const T=S*b[0],x=E*b[1];let C=v,P=A,I=!1,R=!1;const L=Math.ceil(h*T),D=Math.ceil(d*x),O=Math.ceil(v*T),F=Math.ceil(A*x);L>=O?C=h:I=!0,D>=F?P=d:R=!0;const B=this.getSizeAndScale(C,this.ctx.canvas.width,T),W=this.getSizeAndScale(P,this.ctx.canvas.height,x),_=e.cachedCanvases.getCanvas("pattern",B.size,W.size),k=_.context,X=l.createCanvasGraphics(k,t);if(X.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(X,n,o),k.translate(-B.scale*u,-W.scale*f),X.transform(0,B.scale,0,0,W.scale,0,0),k.save(),(Z=X.dependencyTracker)==null||Z.save(),this.clipBbox(X,u,f,p,m),X.baseTransform=Ut(X.ctx),X.executeOperatorList(i),X.endDrawing(),(gt=X.dependencyTracker)==null||gt.restore(),k.restore(),I||R){const zt=_.canvas;I&&(C=h),R&&(P=d);const q=this.getSizeAndScale(C,this.ctx.canvas.width,T),ht=this.getSizeAndScale(P,this.ctx.canvas.height,x),bt=q.size,Qt=ht.size,H=e.cachedCanvases.getCanvas("pattern-workaround",bt,Qt),N=H.context,$=I?Math.floor(v/h):0,et=R?Math.floor(A/d):0;for(let mt=0;mt<=$;mt++)for(let K=0;K<=et;K++)N.drawImage(zt,bt*mt,Qt*K,bt,Qt,0,0,bt,Qt);return{canvas:H.canvas,scaleX:q.scale,scaleY:ht.scale,offsetX:u,offsetY:f}}return{canvas:_.canvas,scaleX:B.scale,scaleY:W.scale,offsetX:u,offsetY:f}}getSizeAndScale(e,t,s){const i=Math.max(Cu.MAX_PATTERN_SIZE,t);let n=Math.ceil(e*s);return n>=i?n=i:s=n/e,{scale:s,size:n}}clipBbox(e,t,s,i,n){const a=i-t,o=n-s;e.ctx.rect(t,s,a,o),j.axialAlignedBoundingBox([t,s,i,n],Ut(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,s){const i=e.ctx,n=e.current;switch(t){case cg.COLORED:const{fillStyle:a,strokeStyle:o}=this.ctx;i.fillStyle=n.fillColor=a,i.strokeStyle=n.strokeColor=o;break;case cg.UNCOLORED:i.fillStyle=i.strokeStyle=s,n.fillColor=n.strokeColor=s;break;default:throw new Xv(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,s,i,n){let a=s;i!==Te.SHADING&&(a=j.transform(a,t.baseTransform),this.matrix&&(a=j.transform(a,this.matrix)));const o=this.createPatternCanvas(t,n);let l=new DOMMatrix(a);l=l.translate(o.offsetX,o.offsetY),l=l.scale(1/o.scaleX,1/o.scaleY);const h=e.createPattern(o.canvas,"repeat");return h.setTransform(l),h}};M(Cu,"MAX_PATTERN_SIZE",3e3);let If=Cu;function Py({src:c,srcPos:e=0,dest:t,width:s,height:i,nonBlackColor:n=4294967295,inverseDecode:a=!1}){const o=ye.isLittleEndian?4278190080:255,[l,h]=a?[n,o]:[o,n],d=s>>3,u=s&7,f=c.length;t=new Uint32Array(t.buffer);let p=0;for(let m=0;m<i;m++){for(const A=e+d;e<A;e++){const b=e<f?c[e]:255;t[p++]=b&128?h:l,t[p++]=b&64?h:l,t[p++]=b&32?h:l,t[p++]=b&16?h:l,t[p++]=b&8?h:l,t[p++]=b&4?h:l,t[p++]=b&2?h:l,t[p++]=b&1?h:l}if(u===0)continue;const v=e<f?c[e++]:255;for(let A=0;A<u;A++)t[p++]=v&1<<7-A?h:l}return{srcPos:e,destPos:p}}const dg=16,ug=100,Ry=15,fg=10,ts=16,Ju=new DOMMatrix,ws=new Float32Array(2),lo=new Float32Array([1/0,1/0,-1/0,-1/0]);function Iy(c,e){if(c._removeMirroring)throw new Error("Context is already forwarding operations.");c.__originalSave=c.save,c.__originalRestore=c.restore,c.__originalRotate=c.rotate,c.__originalScale=c.scale,c.__originalTranslate=c.translate,c.__originalTransform=c.transform,c.__originalSetTransform=c.setTransform,c.__originalResetTransform=c.resetTransform,c.__originalClip=c.clip,c.__originalMoveTo=c.moveTo,c.__originalLineTo=c.lineTo,c.__originalBezierCurveTo=c.bezierCurveTo,c.__originalRect=c.rect,c.__originalClosePath=c.closePath,c.__originalBeginPath=c.beginPath,c._removeMirroring=()=>{c.save=c.__originalSave,c.restore=c.__originalRestore,c.rotate=c.__originalRotate,c.scale=c.__originalScale,c.translate=c.__originalTranslate,c.transform=c.__originalTransform,c.setTransform=c.__originalSetTransform,c.resetTransform=c.__originalResetTransform,c.clip=c.__originalClip,c.moveTo=c.__originalMoveTo,c.lineTo=c.__originalLineTo,c.bezierCurveTo=c.__originalBezierCurveTo,c.rect=c.__originalRect,c.closePath=c.__originalClosePath,c.beginPath=c.__originalBeginPath,delete c._removeMirroring},c.save=function(){e.save(),this.__originalSave()},c.restore=function(){e.restore(),this.__originalRestore()},c.translate=function(t,s){e.translate(t,s),this.__originalTranslate(t,s)},c.scale=function(t,s){e.scale(t,s),this.__originalScale(t,s)},c.transform=function(t,s,i,n,a,o){e.transform(t,s,i,n,a,o),this.__originalTransform(t,s,i,n,a,o)},c.setTransform=function(t,s,i,n,a,o){e.setTransform(t,s,i,n,a,o),this.__originalSetTransform(t,s,i,n,a,o)},c.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},c.rotate=function(t){e.rotate(t),this.__originalRotate(t)},c.clip=function(t){e.clip(t),this.__originalClip(t)},c.moveTo=function(t,s){e.moveTo(t,s),this.__originalMoveTo(t,s)},c.lineTo=function(t,s){e.lineTo(t,s),this.__originalLineTo(t,s)},c.bezierCurveTo=function(t,s,i,n,a,o){e.bezierCurveTo(t,s,i,n,a,o),this.__originalBezierCurveTo(t,s,i,n,a,o)},c.rect=function(t,s,i,n){e.rect(t,s,i,n),this.__originalRect(t,s,i,n)},c.closePath=function(){e.closePath(),this.__originalClosePath()},c.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class My{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,s){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,t,s)):(i=this.canvasFactory.create(t,s),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function vd(c,e,t,s,i,n,a,o,l,h){const[d,u,f,p,m,v]=Ut(c);if(u===0&&f===0){const S=a*d+m,E=Math.round(S),T=o*p+v,x=Math.round(T),C=(a+l)*d+m,P=Math.abs(Math.round(C)-E)||1,I=(o+h)*p+v,R=Math.abs(Math.round(I)-x)||1;return c.setTransform(Math.sign(d),0,0,Math.sign(p),E,x),c.drawImage(e,t,s,i,n,0,0,P,R),c.setTransform(d,u,f,p,m,v),[P,R]}if(d===0&&p===0){const S=o*f+m,E=Math.round(S),T=a*u+v,x=Math.round(T),C=(o+h)*f+m,P=Math.abs(Math.round(C)-E)||1,I=(a+l)*u+v,R=Math.abs(Math.round(I)-x)||1;return c.setTransform(0,Math.sign(u),Math.sign(f),0,E,x),c.drawImage(e,t,s,i,n,0,0,R,P),c.setTransform(d,u,f,p,m,v),[R,P]}c.drawImage(e,t,s,i,n,a,o,l,h);const A=Math.hypot(d,u),b=Math.hypot(f,p);return[A*l,b*h]}class pg{constructor(e,t,s){M(this,"alphaIsShape",!1);M(this,"fontSize",0);M(this,"fontSizeScale",1);M(this,"textMatrix",null);M(this,"textMatrixScale",1);M(this,"fontMatrix",tf);M(this,"leading",0);M(this,"x",0);M(this,"y",0);M(this,"lineX",0);M(this,"lineY",0);M(this,"charSpacing",0);M(this,"wordSpacing",0);M(this,"textHScale",1);M(this,"textRenderingMode",be.FILL);M(this,"textRise",0);M(this,"fillColor","#000000");M(this,"strokeColor","#000000");M(this,"patternFill",!1);M(this,"patternStroke",!1);M(this,"fillAlpha",1);M(this,"strokeAlpha",1);M(this,"lineWidth",1);M(this,"activeSMask",null);M(this,"transferMaps","none");s==null||s(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=lo.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=Te.FILL,t=null){const s=this.minMax.slice();if(e===Te.STROKE){t||Mt("Stroke bounding box must include transform."),j.singularValueDecompose2dScale(t,ws);const i=ws[0]*this.lineWidth/2,n=ws[1]*this.lineWidth/2;s[0]-=i,s[1]-=n,s[2]+=i,s[3]+=n}return s}updateClipFromPath(){const e=j.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(lo,0)}getClippedPathBoundingBox(e=Te.FILL,t=null){return j.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function gg(c,e){if(e instanceof ImageData){c.putImageData(e,0,0);return}const t=e.height,s=e.width,i=t%ts,n=(t-i)/ts,a=i===0?n:n+1,o=c.createImageData(s,ts);let l=0,h;const d=e.data,u=o.data;let f,p,m,v;if(e.kind===si.GRAYSCALE_1BPP){const A=d.byteLength,b=new Uint32Array(u.buffer,0,u.byteLength>>2),S=b.length,E=s+7>>3,T=4294967295,x=ye.isLittleEndian?4278190080:255;for(f=0;f<a;f++){for(m=f<n?ts:i,h=0,p=0;p<m;p++){const C=A-l;let P=0;const I=C>E?s:C*8-7,R=I&-8;let L=0,D=0;for(;P<R;P+=8)D=d[l++],b[h++]=D&128?T:x,b[h++]=D&64?T:x,b[h++]=D&32?T:x,b[h++]=D&16?T:x,b[h++]=D&8?T:x,b[h++]=D&4?T:x,b[h++]=D&2?T:x,b[h++]=D&1?T:x;for(;P<I;P++)L===0&&(D=d[l++],L=128),b[h++]=D&L?T:x,L>>=1}for(;h<S;)b[h++]=0;c.putImageData(o,0,f*ts)}}else if(e.kind===si.RGBA_32BPP){for(p=0,v=s*ts*4,f=0;f<n;f++)u.set(d.subarray(l,l+v)),l+=v,c.putImageData(o,0,p),p+=ts;f<a&&(v=s*i*4,u.set(d.subarray(l,l+v)),c.putImageData(o,0,p))}else if(e.kind===si.RGB_24BPP)for(m=ts,v=s*m,f=0;f<a;f++){for(f>=n&&(m=i,v=s*m),h=0,p=v;p--;)u[h++]=d[l++],u[h++]=d[l++],u[h++]=d[l++],u[h++]=255;c.putImageData(o,0,f*ts)}else throw new Error(`bad image kind: ${e.kind}`)}function mg(c,e){if(e.bitmap){c.drawImage(e.bitmap,0,0);return}const t=e.height,s=e.width,i=t%ts,n=(t-i)/ts,a=i===0?n:n+1,o=c.createImageData(s,ts);let l=0;const h=e.data,d=o.data;for(let u=0;u<a;u++){const f=u<n?ts:i;({srcPos:l}=Py({src:h,srcPos:l,dest:d,width:s,height:f,nonBlackColor:0})),c.putImageData(o,0,u*ts)}}function Gl(c,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of t)c[s]!==void 0&&(e[s]=c[s]);c.setLineDash!==void 0&&(e.setLineDash(c.getLineDash()),e.lineDashOffset=c.lineDashOffset)}function yd(c){c.strokeStyle=c.fillStyle="#000000",c.fillRule="nonzero",c.globalAlpha=1,c.lineWidth=1,c.lineCap="butt",c.lineJoin="miter",c.miterLimit=10,c.globalCompositeOperation="source-over",c.font="10px sans-serif",c.setLineDash!==void 0&&(c.setLineDash([]),c.lineDashOffset=0);const{filter:e}=c;e!=="none"&&e!==""&&(c.filter="none")}function vg(c,e){if(e)return!0;j.singularValueDecompose2dScale(c,ws);const t=Math.fround(ri.pixelRatio*Rn.PDF_TO_CSS_UNITS);return ws[0]<=t&&ws[1]<=t}const Dy=["butt","round","square"],Ly=["miter","round","bevel"],Oy={},yg={};var ai,Mf,Df,Lf;const Gp=class Gp{constructor(e,t,s,i,n,{optionalContentConfig:a,markedContentStack:o=null},l,h,d){y(this,ai);this.ctx=e,this.current=new pg(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=s,this.canvasFactory=i,this.filterFactory=n,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new My(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=d??null}getObject(e,t,s=null){var i;return typeof t=="string"?((i=this.dependencyTracker)==null||i.recordNamedDependency(e,t),t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)):s}beginDrawing({transform:e,viewport:t,transparency:s=!1,background:i=null}){const n=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,n,a),this.ctx.fillStyle=o,s){const l=this.cachedCanvases.getCanvas("transparent",n,a);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...Ut(this.compositeCtx))}this.ctx.save(),yd(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Ut(this.ctx)}executeOperatorList(e,t,s,i,n){var b;const a=e.argsArray,o=e.fnArray;let l=t||0;const h=a.length;if(h===l)return l;const d=h-l>fg&&typeof s=="function",u=d?Date.now()+Ry:0;let f=0;const p=this.commonObjs,m=this.objs;let v,A;for(;;){if(i!==void 0&&l===i.nextBreakPoint)return i.breakIt(l,s),l;if(!n||n(l))if(v=o[l],A=a[l]??null,v!==ze.dependency)A===null?this[v](l):this[v](l,...A);else for(const S of A){(b=this.dependencyTracker)==null||b.recordNamedData(S,l);const E=S.startsWith("g_")?p:m;if(!E.has(S))return E.get(S,s),l}if(l++,l===h)return l;if(d&&++f>fg){if(Date.now()>u)return s(),l;f=0}}}endDrawing(){w(this,ai,Mf).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),w(this,ai,Df).call(this)}_scaleImage(e,t){const s=e.width??e.displayWidth,i=e.height??e.displayHeight;let n=Math.max(Math.hypot(t[0],t[1]),1),a=Math.max(Math.hypot(t[2],t[3]),1),o=s,l=i,h="prescale1",d,u;for(;n>2&&o>1||a>2&&l>1;){let f=o,p=l;n>2&&o>1&&(f=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),n/=o/f),a>2&&l>1&&(p=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,a/=l/p),d=this.cachedCanvases.getCanvas(h,f,p),u=d.context,u.clearRect(0,0,f,p),u.drawImage(e,0,0,o,l,0,0,f,p),e=d.canvas,o=f,l=p,h=h==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:o,paintHeight:l}}_createMaskCanvas(e,t){var L,D;const s=this.ctx,{width:i,height:n}=t,a=this.current.fillColor,o=this.current.patternFill,l=Ut(s);let h,d,u,f;if((t.bitmap||t.data)&&t.count>1){const O=t.bitmap||t.data.buffer;d=JSON.stringify(o?l:[l.slice(0,4),a]),h=this._cachedBitmapsMap.get(O),h||(h=new Map,this._cachedBitmapsMap.set(O,h));const F=h.get(d);if(F&&!o){const B=Math.round(Math.min(l[0],l[2])+l[4]),W=Math.round(Math.min(l[1],l[3])+l[5]);return(L=this.dependencyTracker)==null||L.recordDependencies(e,Rs.transformAndFill),{canvas:F,offsetX:B,offsetY:W}}u=F}u||(f=this.cachedCanvases.getCanvas("maskCanvas",i,n),mg(f.context,t));let p=j.transform(l,[1/i,0,0,-1/n,0,0]);p=j.transform(p,[1,0,0,1,0,-n]);const m=lo.slice();j.axialAlignedBoundingBox([0,0,i,n],p,m);const[v,A,b,S]=m,E=Math.round(b-v)||1,T=Math.round(S-A)||1,x=this.cachedCanvases.getCanvas("fillCanvas",E,T),C=x.context,P=v,I=A;C.translate(-P,-I),C.transform(...p),u||(u=this._scaleImage(f.canvas,oi(C)),u=u.img,h&&o&&h.set(d,u)),C.imageSmoothingEnabled=vg(Ut(C),t.interpolate),vd(C,u,0,0,u.width,u.height,0,0,i,n),C.globalCompositeOperation="source-in";const R=j.transform(oi(C),[1,0,0,1,-P,-I]);return C.fillStyle=o?a.getPattern(s,this,R,Te.FILL,e):a,C.fillRect(0,0,i,n),h&&!o&&(this.cachedCanvases.delete("fillCanvas"),h.set(d,x.canvas)),(D=this.dependencyTracker)==null||D.recordDependencies(e,Rs.transformAndFill),{canvas:x.canvas,offsetX:Math.round(P),offsetY:Math.round(I)}}setLineWidth(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("lineWidth",e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("lineCap",e),this.ctx.lineCap=Dy[t]}setLineJoin(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("lineJoin",e),this.ctx.lineJoin=Ly[t]}setMiterLimit(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("miterLimit",e),this.ctx.miterLimit=t}setDash(e,t,s){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("dash",e);const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(t),i.lineDashOffset=s)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){var s,i,n,a,o;for(const[l,h]of t)switch(l){case"LW":this.setLineWidth(e,h);break;case"LC":this.setLineCap(e,h);break;case"LJ":this.setLineJoin(e,h);break;case"ML":this.setMiterLimit(e,h);break;case"D":this.setDash(e,h[0],h[1]);break;case"RI":this.setRenderingIntent(e,h);break;case"FL":this.setFlatness(e,h);break;case"Font":this.setFont(e,h[0],h[1]);break;case"CA":(s=this.dependencyTracker)==null||s.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=h;break;case"ca":(i=this.dependencyTracker)==null||i.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=h;break;case"BM":(n=this.dependencyTracker)==null||n.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=h;break;case"SMask":(a=this.dependencyTracker)==null||a.recordSimpleData("SMask",e),this.current.activeSMask=h?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":(o=this.dependencyTracker)==null||o.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(h);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,s=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,n=this.cachedCanvases.getCanvas(i,t,s);this.suspendedCtx=this.ctx;const a=this.ctx=n.context;a.setTransform(this.suspendedCtx.getTransform()),Gl(this.suspendedCtx,a),Iy(a,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Gl(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,s,i){const n=i[0],a=i[1],o=i[2]-n,l=i[3]-a;o===0||l===0||(this.genericComposeSMask(t.context,s,o,l,t.subtype,t.backdrop,t.transferMap,n,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(s.canvas,0,0),e.restore())}genericComposeSMask(e,t,s,i,n,a,o,l,h,d,u){let f=e.canvas,p=l-d,m=h-u;if(a)if(p<0||m<0||p+s>f.width||m+i>f.height){const A=this.cachedCanvases.getCanvas("maskExtension",s,i),b=A.context;b.drawImage(f,-p,-m),b.globalCompositeOperation="destination-atop",b.fillStyle=a,b.fillRect(0,0,s,i),b.globalCompositeOperation="source-over",f=A.canvas,p=m=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const A=new Path2D;A.rect(p,m,s,i),e.clip(A),e.globalCompositeOperation="destination-atop",e.fillStyle=a,e.fillRect(p,m,s,i),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),n==="Alpha"&&o?t.filter=this.filterFactory.addAlphaFilter(o):n==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(o));const v=new Path2D;v.rect(l,h,s,i),t.clip(v),t.globalCompositeOperation="destination-in",t.drawImage(f,p,m,s,i,l,h,s,i),t.restore()}save(e){var s;this.inSMaskMode&&Gl(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone(),(s=this.dependencyTracker)==null||s.save(e)}restore(e){var t;if((t=this.dependencyTracker)==null||t.restore(e),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Gl(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,s,i,n,a,o){var l;(l=this.dependencyTracker)==null||l.recordIncrementalData("transform",e),this.ctx.transform(t,s,i,n,a,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,s,i){let[n]=s;if(!i){n||(n=s[0]=new Path2D),this[t](e,n);return}if(this.dependencyTracker!==null){const a=t===ze.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,i[0]-a,i[2]+a,i[1]-a,i[3]+a).recordDependencies(e,["transform"])}if(!(n instanceof Path2D)){const a=s[0]=new Path2D;for(let o=0,l=n.length;o<l;)switch(n[o++]){case dd.moveTo:a.moveTo(n[o++],n[o++]);break;case dd.lineTo:a.lineTo(n[o++],n[o++]);break;case dd.curveTo:a.bezierCurveTo(n[o++],n[o++],n[o++],n[o++],n[o++],n[o++]);break;case dd.closePath:a.closePath();break;default:Q(`Unrecognized drawing path operator: ${n[o-1]}`);break}n=a}j.axialAlignedBoundingBox(i,Ut(this.ctx),this.current.minMax),this[t](e,n),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t,s=!0){var a;const i=this.ctx,n=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof n=="object"&&(n!=null&&n.getPattern)){const o=n.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=n.getPattern(i,this,oi(i),Te.STROKE,e),o){const l=new Path2D;l.addPath(t,i.getTransform().invertSelf().multiplySelf(o)),t=l}this.rescaleAndStroke(t,!1),i.restore()}else this.rescaleAndStroke(t,!0);(a=this.dependencyTracker)==null||a.recordDependencies(e,Rs.stroke),s&&this.consumePath(e,t,this.current.getClippedPathBoundingBox(Te.STROKE,Ut(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t,s=!0){var h,d,u;const i=this.ctx,n=this.current.fillColor,a=this.current.patternFill;let o=!1;if(a){const f=n.isModifyingCurrentTransform()?i.getTransform():null;if((h=this.dependencyTracker)==null||h.save(e),i.save(),i.fillStyle=n.getPattern(i,this,oi(i),Te.FILL,e),f){const p=new Path2D;p.addPath(t,i.getTransform().invertSelf().multiplySelf(f)),t=p}o=!0}const l=this.current.getClippedPathBoundingBox();this.contentVisible&&l!==null&&(this.pendingEOFill?(i.fill(t,"evenodd"),this.pendingEOFill=!1):i.fill(t)),(d=this.dependencyTracker)==null||d.recordDependencies(e,Rs.fill),o&&(i.restore(),(u=this.dependencyTracker)==null||u.restore(e)),s&&this.consumePath(e,t,l)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){var s;this.ctx.fill(t),(s=this.dependencyTracker)==null||s.recordDependencies(e,Rs.rawFillPath).recordOperation(e)}clip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=Oy}eoClip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=yg}beginText(e){var t;this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,(t=this.dependencyTracker)==null||t.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){const t=this.pendingTextPaths,s=this.ctx;if(this.dependencyTracker){const{dependencyTracker:i}=this;t!==void 0&&i.recordFutureForcedDependency("textClip",i.getOpenMarker()).recordFutureForcedDependency("textClip",e),i.recordCloseMarker(e)}if(t!==void 0){const i=new Path2D,n=s.getTransform().invertSelf();for(const{transform:a,x:o,y:l,fontSize:h,path:d}of t)d&&i.addPath(d,new DOMMatrix(a).preMultiplySelf(n).translate(o,l).scale(h,-h));s.clip(i)}delete this.pendingTextPaths}setCharSpacing(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("charSpacing",e),this.current.charSpacing=t}setWordSpacing(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("wordSpacing",e),this.current.wordSpacing=t}setHScale(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("hScale",e),this.current.textHScale=t/100}setLeading(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("leading",e),this.current.leading=-t}setFont(e,t,s){var u,f;(u=this.dependencyTracker)==null||u.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",t,e);const i=this.commonObjs.get(t),n=this.current;if(!i)throw new Error(`Can't find font for ${t}`);if(n.fontMatrix=i.fontMatrix||tf,(n.fontMatrix[0]===0||n.fontMatrix[3]===0)&&Q("Invalid font matrix for font "+t),s<0?(s=-s,n.fontDirection=-1):n.fontDirection=1,this.current.font=i,this.current.fontSize=s,i.isType3Font)return;const a=i.loadedName||"sans-serif",o=((f=i.systemFontInfo)==null?void 0:f.css)||`"${a}", ${i.fallbackName}`;let l="normal";i.black?l="900":i.bold&&(l="bold");const h=i.italic?"italic":"normal";let d=s;s<dg?d=dg:s>ug&&(d=ug),this.current.fontSizeScale=s/d,this.ctx.font=`${h} ${l} ${d}px ${o}`}setTextRenderingMode(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=t}setTextRise(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("textRise",e),this.current.textRise=t}moveText(e,t,s){var i;(i=this.dependencyTracker)==null||i.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=s}setLeadingMoveText(e,t,s){this.setLeading(e,-s),this.moveText(e,t,s)}setTextMatrix(e,t){var i;(i=this.dependencyTracker)==null||i.recordSimpleData("textMatrix",e);const{current:s}=this;s.textMatrix=t,s.textMatrixScale=Math.hypot(t[0],t[1]),s.x=s.lineX=0,s.y=s.lineY=0}nextLine(e){var t;this.moveText(e,0,this.current.leading),(t=this.dependencyTracker)==null||t.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}paintChar(e,t,s,i,n,a){var b,S,E,T;const o=this.ctx,l=this.current,h=l.font,d=l.textRenderingMode,u=l.fontSize/l.fontSizeScale,f=d&be.FILL_STROKE_MASK,p=!!(d&be.ADD_TO_PATH_FLAG),m=l.patternFill&&!h.missingFile,v=l.patternStroke&&!h.missingFile;let A;if((h.disableFontFace||p||m||v)&&!h.missingFile&&(A=h.getPathGenerator(this.commonObjs,t)),A&&(h.disableFontFace||m||v)){o.save(),o.translate(s,i),o.scale(u,-u),(b=this.dependencyTracker)==null||b.recordCharacterBBox(e,o,h);let x;if(f===be.FILL||f===be.FILL_STROKE)if(n){x=o.getTransform(),o.setTransform(...n);const C=w(this,ai,Lf).call(this,A,x,n);o.fill(C)}else o.fill(A);if(f===be.STROKE||f===be.FILL_STROKE)if(a){x||(x=o.getTransform()),o.setTransform(...a);const{a:C,b:P,c:I,d:R}=x,L=j.inverseTransform(a),D=j.transform([C,P,I,R,0,0],L);j.singularValueDecompose2dScale(D,ws),o.lineWidth*=Math.max(ws[0],ws[1])/u,o.stroke(w(this,ai,Lf).call(this,A,x,a))}else o.lineWidth/=u,o.stroke(A);o.restore()}else(f===be.FILL||f===be.FILL_STROKE)&&(o.fillText(t,s,i),(S=this.dependencyTracker)==null||S.recordCharacterBBox(e,o,h,u,s,i,()=>o.measureText(t))),(f===be.STROKE||f===be.FILL_STROKE)&&(this.dependencyTracker&&((E=this.dependencyTracker)==null||E.recordCharacterBBox(e,o,h,u,s,i,()=>o.measureText(t)).recordDependencies(e,Rs.stroke)),o.strokeText(t,s,i));p&&((this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Ut(o),x:s,y:i,fontSize:u,path:A}),(T=this.dependencyTracker)==null||T.recordCharacterBBox(e,o,h,u,s,i))}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){s=!0;break}return at(this,"isFontSubpixelAAEnabled",s)}showText(e,t){var I,R,L,D;this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,Rs.showText).resetBBox(e),this.current.textRenderingMode&be.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());const s=this.current,i=s.font;if(i.isType3Font){this.showType3Text(e,t),(I=this.dependencyTracker)==null||I.recordShowTextOperation(e);return}const n=s.fontSize;if(n===0){(R=this.dependencyTracker)==null||R.recordOperation(e);return}const a=this.ctx,o=s.fontSizeScale,l=s.charSpacing,h=s.wordSpacing,d=s.fontDirection,u=s.textHScale*d,f=t.length,p=i.vertical,m=p?1:-1,v=i.defaultVMetrics,A=n*s.fontMatrix[0],b=s.textRenderingMode===be.FILL&&!i.disableFontFace&&!s.patternFill;a.save(),s.textMatrix&&a.transform(...s.textMatrix),a.translate(s.x,s.y+s.textRise),d>0?a.scale(u,-1):a.scale(u,1);let S,E;if(s.patternFill){a.save();const O=s.fillColor.getPattern(a,this,oi(a),Te.FILL,e);S=Ut(a),a.restore(),a.fillStyle=O}if(s.patternStroke){a.save();const O=s.strokeColor.getPattern(a,this,oi(a),Te.STROKE,e);E=Ut(a),a.restore(),a.strokeStyle=O}let T=s.lineWidth;const x=s.textMatrixScale;if(x===0||T===0){const O=s.textRenderingMode&be.FILL_STROKE_MASK;(O===be.STROKE||O===be.FILL_STROKE)&&(T=this.getSinglePixelWidth())}else T/=x;if(o!==1&&(a.scale(o,o),T/=o),a.lineWidth=T,i.isInvalidPDFjsFont){const O=[];let F=0;for(const W of t)O.push(W.unicode),F+=W.width;const B=O.join("");if(a.fillText(B,0,0),this.dependencyTracker!==null){const W=a.measureText(B);this.dependencyTracker.recordBBox(e,this.ctx,-W.actualBoundingBoxLeft,W.actualBoundingBoxRight,-W.actualBoundingBoxAscent,W.actualBoundingBoxDescent).recordShowTextOperation(e)}s.x+=F*A*u,a.restore(),this.compose();return}let C=0,P;for(P=0;P<f;++P){const O=t[P];if(typeof O=="number"){C+=m*O*n/1e3;continue}let F=!1;const B=(O.isSpace?h:0)+l,W=O.fontChar,_=O.accent;let k,X,Z=O.width;if(p){const q=O.vmetric||v,ht=-(O.vmetric?q[1]:Z*.5)*A,bt=q[2]*A;Z=q?-q[0]:Z,k=ht/o,X=(C+bt)/o}else k=C/o,X=0;let gt;if(i.remeasure&&Z>0){gt=a.measureText(W);const q=gt.width*1e3/n*o;if(Z<q&&this.isFontSubpixelAAEnabled){const ht=Z/q;F=!0,a.save(),a.scale(ht,1),k/=ht}else Z!==q&&(k+=(Z-q)/2e3*n/o)}if(this.contentVisible&&(O.isInFont||i.missingFile)){if(b&&!_)a.fillText(W,k,X),(L=this.dependencyTracker)==null||L.recordCharacterBBox(e,a,gt?{bbox:null}:i,n/o,k,X,()=>gt??a.measureText(W));else if(this.paintChar(e,W,k,X,S,E),_){const q=k+n*_.offset.x/o,ht=X-n*_.offset.y/o;this.paintChar(e,_.fontChar,q,ht,S,E)}}const zt=p?Z*A-B*d:Z*A+B*d;C+=zt,F&&a.restore()}p?s.y-=C:s.x+=C*u,a.restore(),this.compose(),(D=this.dependencyTracker)==null||D.recordShowTextOperation(e)}showType3Text(e,t){const s=this.ctx,i=this.current,n=i.font,a=i.fontSize,o=i.fontDirection,l=n.vertical?1:-1,h=i.charSpacing,d=i.wordSpacing,u=i.textHScale*o,f=i.fontMatrix||tf,p=t.length,m=i.textRenderingMode===be.INVISIBLE;let v,A,b,S;if(m||a===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,s.save(),i.textMatrix&&s.transform(...i.textMatrix),s.translate(i.x,i.y+i.textRise),s.scale(u,o);const E=this.dependencyTracker;for(this.dependencyTracker=E?new eu(E,e):null,v=0;v<p;++v){if(A=t[v],typeof A=="number"){S=l*A*a/1e3,this.ctx.translate(S,0),i.x+=S*u;continue}const T=(A.isSpace?d:0)+h,x=n.charProcOperatorList[A.operatorListId];x?this.contentVisible&&(this.save(),s.scale(a,a),s.transform(...f),this.executeOperatorList(x),this.restore()):Q(`Type3 character "${A.operatorListId}" is not available.`);const C=[A.width,0];j.applyTransform(C,f),b=C[0]*a+T,s.translate(b,0),i.x+=b*u}s.restore(),E&&(this.dependencyTracker=E)}setCharWidth(e,t,s){}setCharWidthAndBounds(e,t,s,i,n,a,o){var h;const l=new Path2D;l.rect(i,n,a-i,o-n),this.ctx.clip(l),(h=this.dependencyTracker)==null||h.recordBBox(e,this.ctx,i,a,n,o).recordClipBox(e,this.ctx,i,a,n,o),this.endPath(e)}getColorN_Pattern(e,t){let s;if(t[0]==="TilingPattern"){const i=this.baseTransform||Ut(this.ctx),n={createCanvasGraphics:(a,o)=>new Gp(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new eu(this.dependencyTracker,o,!0):null)};s=new If(t,this.ctx,n,i)}else s=this._getPattern(e,t[1],t[2]);return s}setStrokeColorN(e,...t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("strokeColor",e),this.current.strokeColor=this.getColorN_Pattern(e,t),this.current.patternStroke=!0}setFillColorN(e,...t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("fillColor",e),this.current.fillColor=this.getColorN_Pattern(e,t),this.current.patternFill=!0}setStrokeRGBColor(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t,s=null){let i;return this.cachedPatterns.has(t)?i=this.cachedPatterns.get(t):(i=Cy(this.getObject(e,t)),this.cachedPatterns.set(t,i)),s&&(i.matrix=s),i}shadingFill(e,t){var a;if(!this.contentVisible)return;const s=this.ctx;this.save(e);const i=this._getPattern(e,t);s.fillStyle=i.getPattern(s,this,oi(s),Te.SHADING,e);const n=oi(s);if(n){const{width:o,height:l}=s.canvas,h=lo.slice();j.axialAlignedBoundingBox([0,0,o,l],n,h);const[d,u,f,p]=h;this.ctx.fillRect(d,u,f-d,p-u)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);(a=this.dependencyTracker)==null||a.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,Rs.transform).recordDependencies(e,Rs.fill).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){Mt("Should not call beginInlineImage")}beginImageData(){Mt("Should not call beginImageData")}paintFormXObjectBegin(e,t,s){var i;if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=Ut(this.ctx),s)){j.axialAlignedBoundingBox(s,this.baseTransform,this.current.minMax);const[n,a,o,l]=s,h=new Path2D;h.rect(n,a,o-n,l-a),this.ctx.clip(h),(i=this.dependencyTracker)==null||i.recordClipBox(e,this.ctx,n,o,a,l),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){var E;if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const s=this.ctx;t.isolated||_u("TODO: Support non-isolated groups."),t.knockout&&Q("Knockout groups not supported.");const i=Ut(s);if(t.matrix&&s.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let n=lo.slice();j.axialAlignedBoundingBox(t.bbox,Ut(s),n);const a=[0,0,s.canvas.width,s.canvas.height];n=j.intersect(n,a)||[0,0,0,0];const o=Math.floor(n[0]),l=Math.floor(n[1]),h=Math.max(Math.ceil(n[2])-o,1),d=Math.max(Math.ceil(n[3])-l,1);this.current.startNewPathAndClipBox([0,0,h,d]);let u="groupAt"+this.groupLevel;t.smask&&(u+="_smask_"+this.smaskCounter++%2);const f=this.cachedCanvases.getCanvas(u,h,d),p=f.context;p.translate(-o,-l),p.transform(...i);let m=new Path2D;const[v,A,b,S]=t.bbox;if(m.rect(v,A,b-v,S-A),t.matrix){const T=new Path2D;T.addPath(m,new DOMMatrix(t.matrix)),m=T}p.clip(m),t.smask&&this.smaskStack.push({canvas:f.canvas,context:p,offsetX:o,offsetY:l,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),(!t.smask||this.dependencyTracker)&&(s.setTransform(1,0,0,1,0,0),s.translate(o,l),s.save()),Gl(s,p),this.ctx=p,(E=this.dependencyTracker)==null||E.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(s),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(s),this.groupLevel++}endGroup(e,t){var n;if(!this.contentVisible)return;this.groupLevel--;const s=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,(n=this.dependencyTracker)==null||n.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const a=Ut(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...a);const o=lo.slice();j.axialAlignedBoundingBox([0,0,s.canvas.width,s.canvas.height],a,o),this.ctx.drawImage(s.canvas,0,0),this.ctx.restore(),this.compose(o)}}beginAnnotation(e,t,s,i,n,a){if(w(this,ai,Mf).call(this),yd(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),s){const o=s[2]-s[0],l=s[3]-s[1];if(a&&this.annotationCanvasMap){i=i.slice(),i[4]-=s[0],i[5]-=s[1],s=s.slice(),s[0]=s[1]=0,s[2]=o,s[3]=l,j.singularValueDecompose2dScale(Ut(this.ctx),ws);const{viewportScale:h}=this,d=Math.ceil(o*this.outputScaleX*h),u=Math.ceil(l*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(d,u);const{canvas:f,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(t,f),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(ws[0],0,0,-ws[1],0,l*ws[1]),yd(this.ctx)}else{yd(this.ctx),this.endPath(e);const h=new Path2D;h.rect(s[0],s[1],o,l),this.ctx.clip(h)}}this.current=new pg(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...i),this.transform(e,...n)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),w(this,ai,Df).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){var o;if(!this.contentVisible)return;const s=t.count;t=this.getObject(e,t.data,t),t.count=s;const i=this.ctx,n=this._createMaskCanvas(e,t),a=n.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(a,n.offsetX,n.offsetY),(o=this.dependencyTracker)==null||o.resetBBox(e).recordBBox(e,this.ctx,n.offsetX,n.offsetX+a.width,n.offsetY,n.offsetY+a.height).recordOperation(e),i.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,s,i=0,n=0,a,o){var u,f,p;if(!this.contentVisible)return;t=this.getObject(e,t.data,t);const l=this.ctx;l.save();const h=Ut(l);l.transform(s,i,n,a,0,0);const d=this._createMaskCanvas(e,t);l.setTransform(1,0,0,1,d.offsetX-h[4],d.offsetY-h[5]),(u=this.dependencyTracker)==null||u.resetBBox(e);for(let m=0,v=o.length;m<v;m+=2){const A=j.transform(h,[s,i,n,a,o[m],o[m+1]]);l.drawImage(d.canvas,A[4],A[5]),(f=this.dependencyTracker)==null||f.recordBBox(e,this.ctx,A[4],A[4]+d.canvas.width,A[5],A[5]+d.canvas.height)}l.restore(),this.compose(),(p=this.dependencyTracker)==null||p.recordOperation(e)}paintImageMaskXObjectGroup(e,t){var a,o,l;if(!this.contentVisible)return;const s=this.ctx,i=this.current.fillColor,n=this.current.patternFill;(a=this.dependencyTracker)==null||a.resetBBox(e).recordDependencies(e,Rs.transformAndFill);for(const h of t){const{data:d,width:u,height:f,transform:p}=h,m=this.cachedCanvases.getCanvas("maskCanvas",u,f),v=m.context;v.save();const A=this.getObject(e,d,h);mg(v,A),v.globalCompositeOperation="source-in",v.fillStyle=n?i.getPattern(v,this,oi(s),Te.FILL,e):i,v.fillRect(0,0,u,f),v.restore(),s.save(),s.transform(...p),s.scale(1,-1),vd(s,m.canvas,0,0,u,f,0,-1,1,1),(o=this.dependencyTracker)==null||o.recordBBox(e,s,0,u,0,f),s.restore()}this.compose(),(l=this.dependencyTracker)==null||l.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;const s=this.getObject(e,t);if(!s){Q("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e,s)}paintImageXObjectRepeat(e,t,s,i,n){if(!this.contentVisible)return;const a=this.getObject(e,t);if(!a){Q("Dependent image isn't ready yet");return}const o=a.width,l=a.height,h=[];for(let d=0,u=n.length;d<u;d+=2)h.push({transform:[s,0,0,i,n[d],n[d+1]],x:0,y:0,w:o,h:l});this.paintInlineImageXObjectGroup(e,a,h)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:s,height:i}=e,n=this.cachedCanvases.getCanvas("inlineImage",s,i),a=n.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter="none",n.canvas}paintInlineImageXObject(e,t){var h;if(!this.contentVisible)return;const s=t.width,i=t.height,n=this.ctx;this.save(e);const{filter:a}=n;a!=="none"&&a!==""&&(n.filter="none"),n.scale(1/s,-1/i);let o;if(t.bitmap)o=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)o=t;else{const u=this.cachedCanvases.getCanvas("inlineImage",s,i).context;gg(u,t),o=this.applyTransferMapsToCanvas(u)}const l=this._scaleImage(o,oi(n));n.imageSmoothingEnabled=vg(Ut(n),t.interpolate),(h=this.dependencyTracker)==null||h.resetBBox(e).recordBBox(e,n,0,s,-i,0).recordDependencies(e,Rs.imageXObject).recordOperation(e),vd(n,l.img,0,0,l.paintWidth,l.paintHeight,0,-i,s,i),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,s){var a,o,l;if(!this.contentVisible)return;const i=this.ctx;let n;if(t.bitmap)n=t.bitmap;else{const h=t.width,d=t.height,f=this.cachedCanvases.getCanvas("inlineImage",h,d).context;gg(f,t),n=this.applyTransferMapsToCanvas(f)}(a=this.dependencyTracker)==null||a.resetBBox(e);for(const h of s)i.save(),i.transform(...h.transform),i.scale(1,-1),vd(i,n,h.x,h.y,h.w,h.h,0,-1,1,1),(o=this.dependencyTracker)==null||o.recordBBox(e,i,0,1,-1,0),i.restore();(l=this.dependencyTracker)==null||l.recordOperation(e),this.compose()}paintSolidColorImageMask(e){var t;this.contentVisible&&((t=this.dependencyTracker)==null||t.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,Rs.fill).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,s){}beginMarkedContent(e,t){var s;(s=this.dependencyTracker)==null||s.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,s){var i;(i=this.dependencyTracker)==null||i.beginMarkedContent(e),t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(s)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){var t;(t=this.dependencyTracker)==null||t.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,s){var a,o;const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(s);const n=this.ctx;this.pendingClip?(i||(this.pendingClip===yg?n.clip(t,"evenodd"):n.clip(t)),this.pendingClip=null,(a=this.dependencyTracker)==null||a.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):(o=this.dependencyTracker)==null||o.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Ut(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),s=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:s,c:i,d:n}=this.ctx.getTransform();let a,o;if(s===0&&i===0){const l=Math.abs(t),h=Math.abs(n);if(l===h)if(e===0)a=o=1/l;else{const d=l*e;a=o=d<1?1/d:1}else if(e===0)a=1/l,o=1/h;else{const d=l*e,u=h*e;a=d<1?1/d:1,o=u<1?1/u:1}}else{const l=Math.abs(t*n-s*i),h=Math.hypot(t,s),d=Math.hypot(i,n);if(e===0)a=d/l,o=h/l;else{const u=e*l;a=d>u?d/u:1,o=h>u?h/u:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:s,current:{lineWidth:i}}=this,[n,a]=this.getScaleForStroking();if(n===a){s.lineWidth=(i||1)*n,s.stroke(e);return}const o=s.getLineDash();t&&s.save(),s.scale(n,a),Ju.a=1/n,Ju.d=1/a;const l=new Path2D;if(l.addPath(e,Ju),o.length>0){const h=Math.max(n,a);s.setLineDash(o.map(d=>d/h)),s.lineDashOffset/=h}s.lineWidth=i||1,s.stroke(l),t&&s.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};ai=new WeakSet,Mf=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Df=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},Lf=function(e,t,s){const i=new Path2D;return i.addPath(e,new DOMMatrix(s).invertSelf().multiplySelf(t)),i};let go=Gp;for(const c in ze)go.prototype[c]!==void 0&&(go.prototype[ze[c]]=go.prototype[c]);var zo,Vo,ec,Go,Id;const co=class co{constructor(e){y(this,Go);y(this,zo);y(this,Vo);y(this,ec);g(this,zo,e),g(this,Vo,new DataView(r(this,zo))),g(this,ec,new TextDecoder)}static write(e){const t=new TextEncoder,s={};let i=0;for(const h of co.strings){const d=t.encode(e[h]);s[h]=d,i+=4+d.length}const n=new ArrayBuffer(i),a=new Uint8Array(n),o=new DataView(n);let l=0;for(const h of co.strings){const d=s[h],u=d.length;o.setUint32(l,u),a.set(d,l+4),l+=4+u}return ut(l===n.byteLength,"CssFontInfo.write: Buffer overflow"),n}get fontFamily(){return w(this,Go,Id).call(this,0)}get fontWeight(){return w(this,Go,Id).call(this,1)}get italicAngle(){return w(this,Go,Id).call(this,2)}};zo=new WeakMap,Vo=new WeakMap,ec=new WeakMap,Go=new WeakSet,Id=function(e){ut(e<co.strings.length,"Invalid string index");let t=0;for(let i=0;i<e;i++)t+=r(this,Vo).getUint32(t)+4;const s=r(this,Vo).getUint32(t);return r(this,ec).decode(new Uint8Array(r(this,zo),t+4,s))},M(co,"strings",["fontFamily","fontWeight","italicAngle"]);let su=co;var Qn,wi,ha,ca,ah;const uo=class uo{constructor(e){y(this,ca);y(this,Qn);y(this,wi);y(this,ha);g(this,Qn,e),g(this,wi,new DataView(r(this,Qn))),g(this,ha,new TextDecoder)}static write(e){const t=new TextEncoder,s={};let i=0;for(const f of uo.strings){const p=t.encode(e[f]);s[f]=p,i+=4+p.length}i+=4;let n,a,o=1+i;e.style&&(n=t.encode(e.style.style),a=t.encode(e.style.weight),o+=4+n.length+4+a.length);const l=new ArrayBuffer(o),h=new Uint8Array(l),d=new DataView(l);let u=0;d.setUint8(u++,e.guessFallback?1:0),d.setUint32(u,0),u+=4,i=0;for(const f of uo.strings){const p=s[f],m=p.length;i+=4+m,d.setUint32(u,m),h.set(p,u+4),u+=4+m}return d.setUint32(u-i-4,i),e.style&&(d.setUint32(u,n.length),h.set(n,u+4),u+=4+n.length,d.setUint32(u,a.length),h.set(a,u+4),u+=4+a.length),ut(u<=l.byteLength,"SubstitionInfo.write: Buffer overflow"),l.transferToFixedLength(u)}get guessFallback(){return r(this,wi).getUint8(0)!==0}get css(){return w(this,ca,ah).call(this,0)}get loadedName(){return w(this,ca,ah).call(this,1)}get baseFontName(){return w(this,ca,ah).call(this,2)}get src(){return w(this,ca,ah).call(this,3)}get style(){let e=1;e+=4+r(this,wi).getUint32(e);const t=r(this,wi).getUint32(e),s=r(this,ha).decode(new Uint8Array(r(this,Qn),e+4,t));e+=4+t;const i=r(this,wi).getUint32(e),n=r(this,ha).decode(new Uint8Array(r(this,Qn),e+4,i));return{style:s,weight:n}}};Qn=new WeakMap,wi=new WeakMap,ha=new WeakMap,ca=new WeakSet,ah=function(e){ut(e<uo.strings.length,"Invalid string index");let t=5;for(let i=0;i<e;i++)t+=r(this,wi).getUint32(t)+4;const s=r(this,wi).getUint32(t);return r(this,ha).decode(new Uint8Array(r(this,Qn),t+4,s))},M(uo,"strings",["css","loadedName","baseFontName","src"]);let iu=uo;var Wo,Xo,Yo,Ko,as,Ei,sc,xt,Xt,js,Md,oh;const it=class it{constructor({data:e,extra:t}){y(this,Xt);y(this,Ei);y(this,sc);y(this,xt);g(this,Ei,e),g(this,sc,new TextDecoder),g(this,xt,new DataView(r(this,Ei))),t&&Object.assign(this,t)}get black(){return w(this,Xt,js).call(this,0)}get bold(){return w(this,Xt,js).call(this,1)}get disableFontFace(){return w(this,Xt,js).call(this,2)}get fontExtraProperties(){return w(this,Xt,js).call(this,3)}get isInvalidPDFjsFont(){return w(this,Xt,js).call(this,4)}get isType3Font(){return w(this,Xt,js).call(this,5)}get italic(){return w(this,Xt,js).call(this,6)}get missingFile(){return w(this,Xt,js).call(this,7)}get remeasure(){return w(this,Xt,js).call(this,8)}get vertical(){return w(this,Xt,js).call(this,9)}get ascent(){return w(this,Xt,Md).call(this,0)}get defaultWidth(){return w(this,Xt,Md).call(this,1)}get descent(){return w(this,Xt,Md).call(this,2)}get bbox(){let e=r(it,Xo);if(r(this,xt).getUint8(e)===0)return;e+=1;const s=[];for(let i=0;i<4;i++)s.push(r(this,xt).getInt16(e,!0)),e+=2;return s}get fontMatrix(){let e=r(it,Yo);if(r(this,xt).getUint8(e)===0)return;e+=1;const s=[];for(let i=0;i<6;i++)s.push(r(this,xt).getFloat64(e,!0)),e+=8;return s}get defaultVMetrics(){let e=r(it,Ko);if(r(this,xt).getUint8(e)===0)return;e+=1;const s=[];for(let i=0;i<3;i++)s.push(r(this,xt).getInt16(e,!0)),e+=2;return s}get fallbackName(){return w(this,Xt,oh).call(this,0)}get loadedName(){return w(this,Xt,oh).call(this,1)}get mimetype(){return w(this,Xt,oh).call(this,2)}get name(){return w(this,Xt,oh).call(this,3)}get data(){let e=r(it,as);const t=r(this,xt).getUint32(e);e+=4+t;const s=r(this,xt).getUint32(e);e+=4+s;const i=r(this,xt).getUint32(e);e+=4+i;const n=r(this,xt).getUint32(e);if(n!==0)return new Uint8Array(r(this,Ei),e+4,n)}clearData(){let e=r(it,as);const t=r(this,xt).getUint32(e);e+=4+t;const s=r(this,xt).getUint32(e);e+=4+s;const i=r(this,xt).getUint32(e);e+=4+i;const n=r(this,xt).getUint32(e);new Uint8Array(r(this,Ei),e+4,n).fill(0),r(this,xt).setUint32(e,0)}get cssFontInfo(){let e=r(it,as);const t=r(this,xt).getUint32(e);e+=4+t;const s=r(this,xt).getUint32(e);e+=4+s;const i=r(this,xt).getUint32(e);if(i===0)return null;const n=new Uint8Array(i);return n.set(new Uint8Array(r(this,Ei),e+4,i)),new su(n.buffer)}get systemFontInfo(){let e=r(it,as);const t=r(this,xt).getUint32(e);e+=4+t;const s=r(this,xt).getUint32(e);if(s===0)return null;const i=new Uint8Array(s);return i.set(new Uint8Array(r(this,Ei),e+4,s)),new iu(i.buffer)}static write(e){const t=e.systemFontInfo?iu.write(e.systemFontInfo):null,s=e.cssFontInfo?su.write(e.cssFontInfo):null,i=new TextEncoder,n={};let a=0;for(const v of it.strings)n[v]=i.encode(e[v]),a+=4+n[v].length;const o=r(it,as)+4+a+4+(t?t.byteLength:0)+4+(s?s.byteLength:0)+4+(e.data?e.data.length:0),l=new ArrayBuffer(o),h=new Uint8Array(l),d=new DataView(l);let u=0;const f=it.bools.length;let p=0,m=0;for(let v=0;v<f;v++){const A=e[it.bools[v]];p|=(A===void 0?0:A?2:1)<<m,m+=2,(m===8||v===f-1)&&(d.setUint8(u++,p),p=0,m=0)}ut(u===r(it,Wo),"FontInfo.write: Boolean properties offset mismatch");for(const v of it.numbers)d.setFloat64(u,e[v]),u+=8;if(ut(u===r(it,Xo),"FontInfo.write: Number properties offset mismatch"),e.bbox){d.setUint8(u++,4);for(const v of e.bbox)d.setInt16(u,v,!0),u+=2}else d.setUint8(u++,0),u+=2*4;if(ut(u===r(it,Yo),"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix){d.setUint8(u++,6);for(const v of e.fontMatrix)d.setFloat64(u,v,!0),u+=8}else d.setUint8(u++,0),u+=8*6;if(ut(u===r(it,Ko),"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics){d.setUint8(u++,1);for(const v of e.defaultVMetrics)d.setInt16(u,v,!0),u+=2}else d.setUint8(u++,0),u+=3*2;ut(u===r(it,as),"FontInfo.write: DefaultVMetrics properties offset mismatch"),d.setUint32(r(it,as),0),u+=4;for(const v of it.strings){const A=n[v],b=A.length;d.setUint32(u,b),h.set(A,u+4),u+=4+b}if(d.setUint32(r(it,as),u-r(it,as)-4),!t)d.setUint32(u,0),u+=4;else{const v=t.byteLength;d.setUint32(u,v),ut(u+4+v<=l.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),h.set(new Uint8Array(t),u+4),u+=4+v}if(!s)d.setUint32(u,0),u+=4;else{const v=s.byteLength;d.setUint32(u,v),ut(u+4+v<=l.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),h.set(new Uint8Array(s),u+4),u+=4+v}return e.data===void 0?(d.setUint32(u,0),u+=4):(d.setUint32(u,e.data.length),h.set(e.data,u+4),u+=4+e.data.length),ut(u<=l.byteLength,"FontInfo.write: Buffer overflow"),l.transferToFixedLength(u)}};Wo=new WeakMap,Xo=new WeakMap,Yo=new WeakMap,Ko=new WeakMap,as=new WeakMap,Ei=new WeakMap,sc=new WeakMap,xt=new WeakMap,Xt=new WeakSet,js=function(e){ut(e<it.bools.length,"Invalid boolean index");const t=Math.floor(e/4),s=e*2%8,i=r(this,xt).getUint8(t)>>s&3;return i===0?void 0:i===2},Md=function(e){return ut(e<it.numbers.length,"Invalid number index"),r(this,xt).getFloat64(r(it,Wo)+e*8)},oh=function(e){ut(e<it.strings.length,"Invalid string index");let t=r(it,as)+4;for(let n=0;n<e;n++)t+=r(this,xt).getUint32(t)+4;const s=r(this,xt).getUint32(t),i=new Uint8Array(s);return i.set(new Uint8Array(r(this,Ei),t+4,s)),r(this,sc).decode(i)},M(it,"bools",["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"]),M(it,"numbers",["ascent","defaultWidth","descent"]),M(it,"strings",["fallbackName","loadedName","mimetype","name"]),y(it,Wo,Math.ceil(it.bools.length*2/8)),y(it,Xo,r(it,Wo)+it.numbers.length*8),y(it,Yo,r(it,Xo)+1+2*4),y(it,Ko,r(it,Yo)+1+8*6),y(it,as,r(it,Ko)+1+2*3);let Of=it;var ic,nc;class es{static get workerPort(){return r(this,ic)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");g(this,ic,e)}static get workerSrc(){return r(this,nc)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");g(this,nc,e)}}ic=new WeakMap,nc=new WeakMap,y(es,ic,null),y(es,nc,"");var Jo,rc;class ky{constructor({parsedData:e,rawData:t}){y(this,Jo);y(this,rc);g(this,Jo,e),g(this,rc,t)}getRaw(){return r(this,rc)}get(e){return r(this,Jo).get(e)??null}[Symbol.iterator](){return r(this,Jo).entries()}}Jo=new WeakMap,rc=new WeakMap;const no=Symbol("INTERNAL");var ac,oc,lc,Qo;class Ny{constructor(e,{name:t,intent:s,usage:i,rbGroups:n}){y(this,ac,!1);y(this,oc,!1);y(this,lc,!1);y(this,Qo,!0);g(this,ac,!!(e&As.DISPLAY)),g(this,oc,!!(e&As.PRINT)),this.name=t,this.intent=s,this.usage=i,this.rbGroups=n}get visible(){if(r(this,lc))return r(this,Qo);if(!r(this,Qo))return!1;const{print:e,view:t}=this.usage;return r(this,ac)?(t==null?void 0:t.viewState)!=="OFF":r(this,oc)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,s=!1){e!==no&&Mt("Internal method `_setVisible` called."),g(this,lc,s),g(this,Qo,t)}}ac=new WeakMap,oc=new WeakMap,lc=new WeakMap,Qo=new WeakMap;var Zn,Tt,Zo,qo,hc,kf;class Fy{constructor(e,t=As.DISPLAY){y(this,hc);y(this,Zn,null);y(this,Tt,new Map);y(this,Zo,null);y(this,qo,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,g(this,qo,e.order);for(const s of e.groups)r(this,Tt).set(s.id,new Ny(t,s));if(e.baseState==="OFF")for(const s of r(this,Tt).values())s._setVisible(no,!1);for(const s of e.on)r(this,Tt).get(s)._setVisible(no,!0);for(const s of e.off)r(this,Tt).get(s)._setVisible(no,!1);g(this,Zo,this.getHash())}}isVisible(e){if(r(this,Tt).size===0)return!0;if(!e)return _u("Optional content group not defined."),!0;if(e.type==="OCG")return r(this,Tt).has(e.id)?r(this,Tt).get(e.id).visible:(Q(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return w(this,hc,kf).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!r(this,Tt).has(t))return Q(`Optional content group not found: ${t}`),!0;if(r(this,Tt).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!r(this,Tt).has(t))return Q(`Optional content group not found: ${t}`),!0;if(!r(this,Tt).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!r(this,Tt).has(t))return Q(`Optional content group not found: ${t}`),!0;if(!r(this,Tt).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!r(this,Tt).has(t))return Q(`Optional content group not found: ${t}`),!0;if(r(this,Tt).get(t).visible)return!1}return!0}return Q(`Unknown optional content policy ${e.policy}.`),!0}return Q(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,s=!0){var n;const i=r(this,Tt).get(e);if(!i){Q(`Optional content group not found: ${e}`);return}if(s&&t&&i.rbGroups.length)for(const a of i.rbGroups)for(const o of a)o!==e&&((n=r(this,Tt).get(o))==null||n._setVisible(no,!1,!0));i._setVisible(no,!!t,!0),g(this,Zn,null)}setOCGState({state:e,preserveRB:t}){let s;for(const i of e){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const n=r(this,Tt).get(i);if(n)switch(s){case"ON":this.setVisibility(i,!0,t);break;case"OFF":this.setVisibility(i,!1,t);break;case"Toggle":this.setVisibility(i,!n.visible,t);break}}g(this,Zn,null)}get hasInitialVisibility(){return r(this,Zo)===null||this.getHash()===r(this,Zo)}getOrder(){return r(this,Tt).size?r(this,qo)?r(this,qo).slice():[...r(this,Tt).keys()]:null}getGroup(e){return r(this,Tt).get(e)||null}getHash(){if(r(this,Zn)!==null)return r(this,Zn);const e=new gm;for(const[t,s]of r(this,Tt))e.update(`${t}:${s.visible}`);return g(this,Zn,e.hexdigest())}[Symbol.iterator](){return r(this,Tt).entries()}}Zn=new WeakMap,Tt=new WeakMap,Zo=new WeakMap,qo=new WeakMap,hc=new WeakSet,kf=function(e){const t=e.length;if(t<2)return!0;const s=e[0];for(let i=1;i<t;i++){const n=e[i];let a;if(Array.isArray(n))a=w(this,hc,kf).call(this,n);else if(r(this,Tt).has(n))a=r(this,Tt).get(n).visible;else return Q(`Optional content group not found: ${n}`),!0;switch(s){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return s==="And"};class By{constructor(e,{disableRange:t=!1,disableStream:s=!1}){ut(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:n,progressiveDone:a,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,(n==null?void 0:n.length)>0){const l=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!s,this._isRangeSupported=!t,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,h)=>{this._onReceiveData({begin:l,chunk:h})}),e.addProgressListener((l,h)=>{this._onProgress({loaded:l,total:h})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const s=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(n){return n._begin!==e?!1:(n._enqueue(s),!0)});ut(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,s,i,n;e.total===void 0?(s=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||s.call(t,{loaded:e.loaded}):(n=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||n.call(i,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){ut(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new _y(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new Uy(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeReaders.slice(0))s.cancel(e);this._pdfDataRangeTransport.abort()}}class _y{constructor(e,t,s=!1,i=null){this._stream=e,this._done=s||!1,this._filename=Hu(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(const n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Uy{constructor(e,t,s){this._stream=e,this._begin=t,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Hy(c){let e=!0,t=s("filename\\*","i").exec(c);if(t){t=t[1];let d=o(t);return d=unescape(d),d=l(d),d=h(d),n(d)}if(t=a(c),t){const d=h(t);return n(d)}if(t=s("filename","i").exec(c),t){t=t[1];let d=o(t);return d=h(d),n(d)}function s(d,u){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',u)}function i(d,u){if(d){if(!/^[\x00-\xFF]+$/.test(u))return u;try{const f=new TextDecoder(d,{fatal:!0}),p=nd(u);u=f.decode(p),e=!1}catch{}}return u}function n(d){return e&&/[\x80-\xff]/.test(d)&&(d=i("utf-8",d),e&&(d=i("iso-8859-1",d))),d}function a(d){const u=[];let f;const p=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=p.exec(d))!==null;){let[,v,A,b]=f;if(v=parseInt(v,10),v in u){if(v===0)break;continue}u[v]=[A,b]}const m=[];for(let v=0;v<u.length&&v in u;++v){let[A,b]=u[v];b=o(b),A&&(b=unescape(b),v===0&&(b=l(b))),m.push(b)}return m.join("")}function o(d){if(d.startsWith('"')){const u=d.slice(1).split('\\"');for(let f=0;f<u.length;++f){const p=u[f].indexOf('"');p!==-1&&(u[f]=u[f].slice(0,p),u.length=f+1),u[f]=u[f].replaceAll(/\\(.)/g,"$1")}d=u.join('"')}return d}function l(d){const u=d.indexOf("'");if(u===-1)return d;const f=d.slice(0,u),m=d.slice(u+1).replace(/^[^']*'/,"");return i(f,m)}function h(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(u,f,p,m){if(p==="q"||p==="Q")return m=m.replaceAll("_"," "),m=m.replaceAll(/=([0-9a-fA-F]{2})/g,function(v,A){return String.fromCharCode(parseInt(A,16))}),i(f,m);try{m=atob(m)}catch{}return i(f,m)})}return""}function Rm(c,e){const t=new Headers;if(!c||!e||typeof e!="object")return t;for(const s in e){const i=e[s];i!==void 0&&t.append(s,i)}return t}function $u(c){var e;return((e=URL.parse(c))==null?void 0:e.origin)??null}function Im({responseHeaders:c,isHttp:e,rangeChunkSize:t,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(c.get("Content-Length"),10);return!Number.isInteger(n)||(i.suggestedLength=n,n<=2*t)||s||!e||c.get("Accept-Ranges")!=="bytes"||(c.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function Mm(c){const e=c.get("Content-Disposition");if(e){let t=Hy(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(Hu(t))return t}return null}function ld(c,e){return new yh(`Unexpected server response (${c}) while retrieving PDF "${e}".`,c,c===404||c===0&&e.startsWith("file:"))}function Dm(c){return c===200||c===206}function Lm(c,e,t){return{method:"GET",headers:c,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function Om(c){return c instanceof Uint8Array?c.buffer:c instanceof ArrayBuffer?c:(Q(`getArrayBuffer - unexpected data format: ${c}`),new Uint8Array(c).buffer)}class $y{constructor(e){M(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=Rm(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return ut(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new jy(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new zy(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class jy{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const s=new Headers(e.headers),i=t.url;fetch(i,Lm(s,this._withCredentials,this._abortController)).then(n=>{if(e._responseOrigin=$u(n.url),!Dm(n.status))throw ld(n.status,i);this._reader=n.body.getReader(),this._headersCapability.resolve();const a=n.headers,{allowRangeRequests:o,suggestedLength:l}=Im({responseHeaders:a,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=l||this._contentLength,this._filename=Mm(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Pn("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:Om(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class zy{constructor(e,t,s){this._stream=e,this._reader=null,this._loaded=0;const i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const n=new Headers(e.headers);n.append("Range",`bytes=${t}-${s-1}`);const a=i.url;fetch(a,Lm(n,this._withCredentials,this._abortController)).then(o=>{const l=$u(o.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!Dm(o.status))throw ld(o.status,a);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:Om(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const Qu=200,Zu=206;function Vy(c){const e=c.response;return typeof e!="string"?e:nd(e).buffer}class Gy{constructor({url:e,httpHeaders:t,withCredentials:s}){M(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=Rm(this.isHttp,t),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[n,a]of this.headers)t.setRequestHeader(n,a);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=Zu):i.expectedStatus=Qu,t.responseType="arraybuffer",ut(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,s),t.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),s}onProgress(e,t){var i;const s=this.pendingRequests[e];s&&((i=s.onProgress)==null||i.call(s,t))}onStateChange(e,t){const s=this.pendingRequests[e];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],i.status===0&&this.isHttp){s.onError(i.status);return}const n=i.status||Qu;if(!(n===Qu&&s.expectedStatus===Zu)&&n!==s.expectedStatus){s.onError(i.status);return}const o=Vy(i);if(n===Zu){const l=i.getResponseHeader("Content-Range"),h=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);h?s.onDone({begin:parseInt(h[1],10),chunk:o}):(Q('Missing or invalid "Content-Range" header.'),s.onError(0))}else o?s.onDone({begin:0,chunk:o}):s.onError(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class Wy{constructor(e){this._source=e,this._manager=new Gy(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return ut(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Xy(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const s=new Yy(this._manager,e,t);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class Xy{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=$u(t.responseURL);const s=t.getAllResponseHeaders(),i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[l,...h]=o.split(": ");return[l,h.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:a}=Im({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=Mm(i),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=ld(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Yy{constructor(e,t,s){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=$u((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=ld(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const Ky=/^[a-z][a-z0-9\-+.]+:/i;function Jy(c){if(Ky.test(c))return new URL(c);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(c))}class Qy{constructor(e){this.source=e,this.url=Jy(e.url),ut(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return ut(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Zy(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new qy(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class Zy{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=ld(0,this._url.href)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Pn("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class qy{constructor(e,t,s){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=e.source;this._isStreamingSupported=!i.disableStream;const n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:t,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Wl=Symbol("INITIAL_DATA");var os,cc,Nf;class km{constructor(){y(this,cc);y(this,os,Object.create(null))}get(e,t=null){if(t){const i=w(this,cc,Nf).call(this,e);return i.promise.then(()=>t(i.data)),null}const s=r(this,os)[e];if(!s||s.data===Wl)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return s.data}has(e){const t=r(this,os)[e];return!!t&&t.data!==Wl}delete(e){const t=r(this,os)[e];return!t||t.data===Wl?!1:(delete r(this,os)[e],!0)}resolve(e,t=null){const s=w(this,cc,Nf).call(this,e);s.data=t,s.resolve()}clear(){var e;for(const t in r(this,os)){const{data:s}=r(this,os)[t];(e=s==null?void 0:s.bitmap)==null||e.close()}g(this,os,Object.create(null))}*[Symbol.iterator](){for(const e in r(this,os)){const{data:t}=r(this,os)[e];t!==Wl&&(yield[e,t])}}}os=new WeakMap,cc=new WeakSet,Nf=function(e){var t;return(t=r(this,os))[e]||(t[e]={...Promise.withResolvers(),data:Wl})};const tb=1e5,bg=30;var Tg,qn,Qe,dc,uc,da,an,fc,pc,ua,tl,el,tr,sl,gc,il,fa,mc,vc,nl,pa,yc,er,rl,Mn,Nm,Fm,Ff,xs,Dd,Bf,Bm,_m;const se=class se{constructor({textContentSource:e,container:t,viewport:s}){y(this,Mn);y(this,qn,Promise.withResolvers());y(this,Qe,null);y(this,dc,!1);y(this,uc,!!((Tg=globalThis.FontInspector)!=null&&Tg.enabled));y(this,da,null);y(this,an,null);y(this,fc,0);y(this,pc,0);y(this,ua,null);y(this,tl,null);y(this,el,0);y(this,tr,0);y(this,sl,Object.create(null));y(this,gc,[]);y(this,il,null);y(this,fa,[]);y(this,mc,new WeakMap);y(this,vc,null);var l;if(e instanceof ReadableStream)g(this,il,e);else if(typeof e=="object")g(this,il,new ReadableStream({start(h){h.enqueue(e),h.close()}}));else throw new Error('No "textContentSource" parameter specified.');g(this,Qe,g(this,tl,t)),g(this,tr,s.scale*ri.pixelRatio),g(this,el,s.rotation),g(this,an,{div:null,properties:null,ctx:null});const{pageWidth:i,pageHeight:n,pageX:a,pageY:o}=s.rawDims;g(this,vc,[1,0,0,-1,-a,o+n]),g(this,pc,i),g(this,fc,n),w(l=se,xs,Bm).call(l),Cr(t,s),r(this,qn).promise.finally(()=>{r(se,rl).delete(this),g(this,an,null),g(this,sl,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=ye.platform;return at(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{r(this,ua).read().then(({value:t,done:s})=>{if(s){r(this,qn).resolve();return}r(this,da)??g(this,da,t.lang),Object.assign(r(this,sl),t.styles),w(this,Mn,Nm).call(this,t.items),e()},r(this,qn).reject)};return g(this,ua,r(this,il).getReader()),r(se,rl).add(this),e(),r(this,qn).promise}update({viewport:e,onBefore:t=null}){var n;const s=e.scale*ri.pixelRatio,i=e.rotation;if(i!==r(this,el)&&(t==null||t(),g(this,el,i),Cr(r(this,tl),{rotation:i})),s!==r(this,tr)){t==null||t(),g(this,tr,s);const a={div:null,properties:null,ctx:w(n=se,xs,Dd).call(n,r(this,da))};for(const o of r(this,fa))a.properties=r(this,mc).get(o),a.div=o,w(this,Mn,Ff).call(this,a)}}cancel(){var t;const e=new Pn("TextLayer task cancelled.");(t=r(this,ua))==null||t.cancel(e).catch(()=>{}),g(this,ua,null),r(this,qn).reject(e)}get textDivs(){return r(this,fa)}get textContentItemsStr(){return r(this,gc)}static cleanup(){if(!(r(this,rl).size>0)){r(this,nl).clear();for(const{canvas:e}of r(this,pa).values())e.remove();r(this,pa).clear()}}};qn=new WeakMap,Qe=new WeakMap,dc=new WeakMap,uc=new WeakMap,da=new WeakMap,an=new WeakMap,fc=new WeakMap,pc=new WeakMap,ua=new WeakMap,tl=new WeakMap,el=new WeakMap,tr=new WeakMap,sl=new WeakMap,gc=new WeakMap,il=new WeakMap,fa=new WeakMap,mc=new WeakMap,vc=new WeakMap,nl=new WeakMap,pa=new WeakMap,yc=new WeakMap,er=new WeakMap,rl=new WeakMap,Mn=new WeakSet,Nm=function(e){var i,n;if(r(this,dc))return;(n=r(this,an)).ctx??(n.ctx=w(i=se,xs,Dd).call(i,r(this,da)));const t=r(this,fa),s=r(this,gc);for(const a of e){if(t.length>tb){Q("Ignoring additional textDivs for performance reasons."),g(this,dc,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=r(this,Qe);g(this,Qe,document.createElement("span")),r(this,Qe).classList.add("markedContent"),a.id&&r(this,Qe).setAttribute("id",`${a.id}`),o.append(r(this,Qe))}else a.type==="endMarkedContent"&&g(this,Qe,r(this,Qe).parentNode);continue}s.push(a.str),w(this,Mn,Fm).call(this,a)}},Fm=function(e){var v;const t=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};r(this,fa).push(t);const i=j.transform(r(this,vc),e.transform);let n=Math.atan2(i[1],i[0]);const a=r(this,sl)[e.fontName];a.vertical&&(n+=Math.PI/2);let o=r(this,uc)&&a.fontSubstitution||a.fontFamily;o=se.fontFamilyMap.get(o)||o;const l=Math.hypot(i[2],i[3]),h=l*w(v=se,xs,_m).call(v,o,a,r(this,da));let d,u;n===0?(d=i[4],u=i[5]-h):(d=i[4]+h*Math.sin(n),u=i[5]-h*Math.cos(n));const f="calc(var(--total-scale-factor) *",p=t.style;r(this,Qe)===r(this,tl)?(p.left=`${(100*d/r(this,pc)).toFixed(2)}%`,p.top=`${(100*u/r(this,fc)).toFixed(2)}%`):(p.left=`${f}${d.toFixed(2)}px)`,p.top=`${f}${u.toFixed(2)}px)`),p.fontSize=`${f}${(r(se,er)*l).toFixed(2)}px)`,p.fontFamily=o,s.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,r(this,uc)&&(t.dataset.fontName=a.fontSubstitutionLoadedName||e.fontName),n!==0&&(s.angle=n*(180/Math.PI));let m=!1;if(e.str.length>1)m=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const A=Math.abs(e.transform[0]),b=Math.abs(e.transform[3]);A!==b&&Math.max(A,b)/Math.min(A,b)>1.5&&(m=!0)}if(m&&(s.canvasWidth=a.vertical?e.height:e.width),r(this,mc).set(t,s),r(this,an).div=t,r(this,an).properties=s,w(this,Mn,Ff).call(this,r(this,an)),s.hasText&&r(this,Qe).append(t),s.hasEOL){const A=document.createElement("br");A.setAttribute("role","presentation"),r(this,Qe).append(A)}},Ff=function(e){var o;const{div:t,properties:s,ctx:i}=e,{style:n}=t;let a="";if(r(se,er)>1&&(a=`scale(${1/r(se,er)})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:l}=n,{canvasWidth:h,fontSize:d}=s;w(o=se,xs,Bf).call(o,i,d*r(this,tr),l);const{width:u}=i.measureText(t.textContent);u>0&&(a=`scaleX(${h*r(this,tr)/u}) ${a}`)}s.angle!==0&&(a=`rotate(${s.angle}deg) ${a}`),a.length>0&&(n.transform=a)},xs=new WeakSet,Dd=function(e=null){let t=r(this,pa).get(e||(e=""));if(!t){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=e,document.body.append(s),t=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),r(this,pa).set(e,t),r(this,yc).set(t,{size:0,family:""})}return t},Bf=function(e,t,s){const i=r(this,yc).get(e);t===i.size&&s===i.family||(e.font=`${t}px ${s}`,i.size=t,i.family=s)},Bm=function(){if(r(this,er)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),g(this,er,e.getBoundingClientRect().height),e.remove()},_m=function(e,t,s){const i=r(this,nl).get(e);if(i)return i;const n=w(this,xs,Dd).call(this,s);n.canvas.width=n.canvas.height=bg,w(this,xs,Bf).call(this,n,bg,e);const a=n.measureText(""),o=a.fontBoundingBoxAscent,l=Math.abs(a.fontBoundingBoxDescent);n.canvas.width=n.canvas.height=0;let h=.8;return o?h=o/(o+l):(ye.platform.isFirefox&&Q("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?h=t.ascent:t.descent&&(h=1+t.descent)),r(this,nl).set(e,h),h},y(se,xs),y(se,nl,new Map),y(se,pa,new Map),y(se,yc,new WeakMap),y(se,er,null),y(se,rl,new Set);let $l=se;const eb=100;function Fp(c={}){typeof c=="string"||c instanceof URL?c={url:c}:(c instanceof ArrayBuffer||ArrayBuffer.isView(c))&&(c={data:c});const e=new _f,{docId:t}=e,s=c.url?hy(c.url):null,i=c.data?cy(c.data):null,n=c.httpHeaders||null,a=c.withCredentials===!0,o=c.password??null,l=c.range instanceof Bp?c.range:null,h=Number.isInteger(c.rangeChunkSize)&&c.rangeChunkSize>0?c.rangeChunkSize:2**16;let d=c.worker instanceof nu?c.worker:null;const u=c.verbosity,f=typeof c.docBaseUrl=="string"&&!ad(c.docBaseUrl)?c.docBaseUrl:null,p=fd(c.cMapUrl),m=c.cMapPacked!==!1,v=c.CMapReaderFactory||(je?vy:rg),A=fd(c.iccUrl),b=fd(c.standardFontDataUrl),S=c.StandardFontDataFactory||(je?yy:ag),E=fd(c.wasmUrl),T=c.WasmFactory||(je?by:og),x=c.stopAtErrors!==!0,C=Number.isInteger(c.maxImageSize)&&c.maxImageSize>-1?c.maxImageSize:-1,P=c.isEvalSupported!==!1,I=typeof c.isOffscreenCanvasSupported=="boolean"?c.isOffscreenCanvasSupported:!je,R=typeof c.isImageDecoderSupported=="boolean"?c.isImageDecoderSupported:!je&&(ye.platform.isFirefox||!globalThis.chrome),L=Number.isInteger(c.canvasMaxAreaInBytes)?c.canvasMaxAreaInBytes:-1,D=typeof c.disableFontFace=="boolean"?c.disableFontFace:je,O=c.fontExtraProperties===!0,F=c.enableXfa===!0,B=c.ownerDocument||globalThis.document,W=c.disableRange===!0,_=c.disableStream===!0,k=c.disableAutoFetch===!0,X=c.pdfBug===!0,Z=c.CanvasFactory||(je?my:fy),gt=c.FilterFactory||(je?gy:py),zt=c.enableHWA===!0,q=c.useWasm!==!1,ht=l?l.length:c.length??NaN,bt=typeof c.useSystemFonts=="boolean"?c.useSystemFonts:!je&&!D,Qt=typeof c.useWorkerFetch=="boolean"?c.useWorkerFetch:!!(v===rg&&S===ag&&T===og&&p&&b&&E&&Jl(p,document.baseURI)&&Jl(b,document.baseURI)&&Jl(E,document.baseURI)),H=null;Vv(u);const N={canvasFactory:new Z({ownerDocument:B,enableHWA:zt}),filterFactory:new gt({docId:t,ownerDocument:B}),cMapReaderFactory:Qt?null:new v({baseUrl:p,isCompressed:m}),standardFontDataFactory:Qt?null:new S({baseUrl:b}),wasmFactory:Qt?null:new T({baseUrl:E})};d||(d=nu.create({verbosity:u,port:es.workerPort}),e._worker=d);const $={docId:t,apiVersion:"5.4.296",data:i,password:o,disableAutoFetch:k,rangeChunkSize:h,length:ht,docBaseUrl:f,enableXfa:F,evaluatorOptions:{maxImageSize:C,disableFontFace:D,ignoreErrors:x,isEvalSupported:P,isOffscreenCanvasSupported:I,isImageDecoderSupported:R,canvasMaxAreaInBytes:L,fontExtraProperties:O,useSystemFonts:bt,useWasm:q,useWorkerFetch:Qt,cMapUrl:p,iccUrl:A,standardFontDataUrl:b,wasmUrl:E}},et={ownerDocument:B,pdfBug:X,styleElement:H,loadingParams:{disableAutoFetch:k,enableXfa:F}};return d.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const mt=d.messageHandler.sendWithPromise("GetDocRequest",$,i?[i.buffer]:null);let K;if(l)K=new By(l,{disableRange:W,disableStream:_});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");const Dt=Jl(s)?$y:je?Qy:Wy;K=new Dt({url:s,length:ht,httpHeaders:n,withCredentials:a,rangeChunkSize:h,disableRange:W,disableStream:_})}return mt.then(Dt=>{if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const kt=new wh(t,Dt,d.port),Cs=new nb(kt,e,K,et,N,zt);e._transport=Cs,kt.send("Ready",null)})}).catch(e._capability.reject),e}var Pu;const Ru=class Ru{constructor(){M(this,"_capability",Promise.withResolvers());M(this,"_transport",null);M(this,"_worker",null);M(this,"docId",`d${he(Ru,Pu)._++}`);M(this,"destroyed",!1);M(this,"onPassword",null);M(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var e,t,s,i;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(n){throw(s=this._worker)!=null&&s.port&&delete this._worker._pendingDestroy,n}this._transport=null,(i=this._worker)==null||i.destroy(),this._worker=null}async getData(){return this._transport.getData()}};Pu=new WeakMap,y(Ru,Pu,0);let _f=Ru;var ga,bc,Ac,wc,Ec;class Bp{constructor(e,t,s=!1,i=null){y(this,ga,Promise.withResolvers());y(this,bc,[]);y(this,Ac,[]);y(this,wc,[]);y(this,Ec,[]);this.length=e,this.initialData=t,this.progressiveDone=s,this.contentDispositionFilename=i}addRangeListener(e){r(this,Ec).push(e)}addProgressListener(e){r(this,wc).push(e)}addProgressiveReadListener(e){r(this,Ac).push(e)}addProgressiveDoneListener(e){r(this,bc).push(e)}onDataRange(e,t){for(const s of r(this,Ec))s(e,t)}onDataProgress(e,t){r(this,ga).promise.then(()=>{for(const s of r(this,wc))s(e,t)})}onDataProgressiveRead(e){r(this,ga).promise.then(()=>{for(const t of r(this,Ac))t(e)})}onDataProgressiveDone(){r(this,ga).promise.then(()=>{for(const e of r(this,bc))e()})}transportReady(){r(this,ga).resolve()}requestDataRange(e,t){Mt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}ga=new WeakMap,bc=new WeakMap,Ac=new WeakMap,wc=new WeakMap,Ec=new WeakMap;class sb{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return at(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var on,ma,lh;class ib{constructor(e,t,s,i=!1){y(this,ma);y(this,on,!1);this._pageIndex=e,this._pageInfo=t,this._transport=s,this._stats=i?new Zp:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new km,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:n=!1}={}){return new rd({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:n})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return at(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,canvas:t=e.canvas,viewport:s,intent:i="display",annotationMode:n=xn.ENABLE,transform:a=null,background:o=null,optionalContentConfigPromise:l=null,annotationCanvasMap:h=null,pageColors:d=null,printAnnotationStorage:u=null,isEditing:f=!1,recordOperations:p=!1,operationsFilter:m=null}){var R,L,D;(R=this._stats)==null||R.time("Overall");const v=this._transport.getRenderingIntent(i,n,u,f),{renderingIntent:A,cacheKey:b}=v;g(this,on,!1),l||(l=this._transport.getOptionalContentConfig(A));let S=this._intentStates.get(b);S||(S=Object.create(null),this._intentStates.set(b,S)),S.streamReaderCancelTimeout&&(clearTimeout(S.streamReaderCancelTimeout),S.streamReaderCancelTimeout=null);const E=!!(A&As.PRINT);S.displayReadyCapability||(S.displayReadyCapability=Promise.withResolvers(),S.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(L=this._stats)==null||L.time("Page Request"),this._pumpOperatorList(v));const T=!!(this._pdfBug&&((D=globalThis.StepperManager)!=null&&D.enabled)),x=!this.recordedBBoxes&&(p||T),C=O=>{var F,B;if(S.renderTasks.delete(P),x){const W=(F=P.gfx)==null?void 0:F.dependencyTracker.take();W&&(P.stepper&&P.stepper.setOperatorBBoxes(W,P.gfx.dependencyTracker.takeDebugMetadata()),p&&(this.recordedBBoxes=W))}E&&g(this,on,!0),w(this,ma,lh).call(this),O?(P.capability.reject(O),this._abortOperatorList({intentState:S,reason:O instanceof Error?O:new Error(O)})):P.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(B=globalThis.Stats)!=null&&B.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},P=new Uf({callback:C,params:{canvas:t,canvasContext:e,dependencyTracker:x?new wy(t,S.operatorList.length,T):null,viewport:s,transform:a,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:h,operatorList:S.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!E,pdfBug:this._pdfBug,pageColors:d,enableHWA:this._transport.enableHWA,operationsFilter:m});(S.renderTasks||(S.renderTasks=new Set)).add(P);const I=P.task;return Promise.all([S.displayReadyCapability.promise,l]).then(([O,F])=>{var B;if(this.destroyed){C();return}if((B=this._stats)==null||B.time("Rendering"),!(F.renderingIntent&A))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");P.initializeGraphics({transparency:O,optionalContentConfig:F}),P.operatorListChanged()}).catch(C),I}getOperatorList({intent:e="display",annotationMode:t=xn.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){var h;function n(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(l))}const a=this._transport.getRenderingIntent(e,t,s,i,!0);let o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let l;return o.opListReadCapability||(l=Object.create(null),l.operatorListChanged=n,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(l),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(h=this._stats)==null||h.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>bh.textContent(s));const t=this.streamTextContent(e);return new Promise(function(s,i){function n(){a.read().then(function({value:l,done:h}){if(h){s(o);return}o.lang??(o.lang=l.lang),Object.assign(o.styles,l.styles),o.items.push(...l.items),n()},i)}const a=t.getReader(),o={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const s of t.renderTasks)e.push(s.completed),s.cancel();return this.objs.clear(),g(this,on,!1),Promise.all(e)}cleanup(e=!1){g(this,on,!0);const t=w(this,ma,lh).call(this);return e&&t&&this._stats&&(this._stats=new Zp),t}_startRenderPage(e,t){var i,n;const s=this._intentStates.get(t);s&&((i=this._stats)==null||i.timeEnd("Page Request"),(n=s.displayReadyCapability)==null||n.resolve(e))}_renderPageChunk(e,t){for(let s=0,i=e.length;s<i;s++)t.operatorList.fnArray.push(e.fnArray[s]),t.operatorList.argsArray.push(e.argsArray[s]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const s of t.renderTasks)s.operatorListChanged();e.lastChunk&&w(this,ma,lh).call(this)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:s,modifiedIds:i}){const{map:n,transfer:a}=s,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:n,modifiedIds:i},a).getReader(),h=this._intentStates.get(t);h.streamReader=l;const d=()=>{l.read().then(({value:u,done:f})=>{if(f){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(u,h),d())},u=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(const f of h.renderTasks)f.operatorListChanged();w(this,ma,lh).call(this)}if(h.displayReadyCapability)h.displayReadyCapability.reject(u);else if(h.opListReadCapability)h.opListReadCapability.reject(u);else throw u}})};d()}_abortOperatorList({intentState:e,reason:t,force:s=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!s){if(e.renderTasks.size>0)return;if(t instanceof Uu){let i=eb;t.extraDelay>0&&t.extraDelay<1e3&&(i+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},i);return}}if(e.streamReader.cancel(new Pn(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[i,n]of this._intentStates)if(n===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}on=new WeakMap,ma=new WeakSet,lh=function(){if(!r(this,on)||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),g(this,on,!1),!0};const ae=class hh{constructor({name:e=null,port:t=null,verbosity:s=Gv()}={}){if(En(this,ii),En(this,Wa,Promise.withResolvers()),En(this,ki,null),En(this,Tr,null),En(this,po,null),this.name=e,this.destroyed=!1,this.verbosity=s,t){if(Ht(hh,oo).has(t))throw new Error("Cannot use more than one PDFWorker per port.");Ht(hh,oo).set(t,this),Sn(this,ii,Pg).call(this,t)}else Sn(this,ii,Rg).call(this)}get promise(){return Ht(this,Wa).promise}get port(){return Ht(this,Tr)}get messageHandler(){return Ht(this,ki)}destroy(){var e,t;this.destroyed=!0,(e=Ht(this,po))==null||e.terminate(),Ss(this,po,null),Ht(hh,oo).delete(Ht(this,Tr)),Ss(this,Tr,null),(t=Ht(this,ki))==null||t.destroy(),Ss(this,ki,null)}static create(e){const t=Ht(this,oo).get(e==null?void 0:e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new hh(e)}static get workerSrc(){if(es.workerSrc)return es.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return at(this,"_setupFakeWorkerGlobal",(async()=>Ht(this,mh,Qd)?Ht(this,mh,Qd):(await import(this.workerSrc)).WorkerMessageHandler)())}};Wa=new WeakMap;ki=new WeakMap;Tr=new WeakMap;po=new WeakMap;Cp=new WeakMap;Hl=new WeakMap;oo=new WeakMap;ii=new WeakSet;Fu=function(){Ht(this,Wa).resolve(),Ht(this,ki).send("configure",{verbosity:this.verbosity})};Pg=function(c){Ss(this,Tr,c),Ss(this,ki,new wh("main","worker",c)),Ht(this,ki).on("ready",()=>{}),Sn(this,ii,Fu).call(this)};Rg=function(){if(Ht(ae,Hl)||Ht(ae,mh,Qd)){Sn(this,ii,Kl).call(this);return}let{workerSrc:c}=ae;try{ae._isSameOrigin(window.location,c)||(c=ae._createCDNWrapper(new URL(c,window.location).href));const e=new Worker(c,{type:"module"}),t=new wh("main","worker",e),s=()=>{i.abort(),t.destroy(),e.terminate(),this.destroyed?Ht(this,Wa).reject(new Error("Worker was destroyed")):Sn(this,ii,Kl).call(this)},i=new AbortController;e.addEventListener("error",()=>{Ht(this,po)||s()},{signal:i.signal}),t.on("test",a=>{if(i.abort(),this.destroyed||!a){s();return}Ss(this,ki,t),Ss(this,Tr,e),Ss(this,po,e),Sn(this,ii,Fu).call(this)}),t.on("ready",a=>{if(i.abort(),this.destroyed){s();return}try{n()}catch{Sn(this,ii,Kl).call(this)}});const n=()=>{const a=new Uint8Array;t.send("test",a,[a.buffer])};n();return}catch{_u("The worker has been disabled.")}Sn(this,ii,Kl).call(this)};Kl=function(){Ht(ae,Hl)||(Q("Setting up fake worker."),Ss(ae,Hl,!0)),ae._setupFakeWorkerGlobal.then(c=>{if(this.destroyed){Ht(this,Wa).reject(new Error("Worker was destroyed"));return}const e=new uy;Ss(this,Tr,e);const t=`fake${jv(ae,Cp)._++}`,s=new wh(t+"_worker",t,e);c.setup(s,e),Ss(this,ki,new wh(t,t+"_worker",e)),Sn(this,ii,Fu).call(this)}).catch(c=>{Ht(this,Wa).reject(new Error(`Setting up fake worker failed: "${c.message}".`))})};mh=new WeakSet;Qd=function(){var c;try{return((c=globalThis.pdfjsWorker)==null?void 0:c.WorkerMessageHandler)||null}catch{return null}};En(ae,mh);En(ae,Cp,0);En(ae,Hl,!1);En(ae,oo,new WeakMap);je&&(Ss(ae,Hl,!0),es.workerSrc||(es.workerSrc="./pdf.worker.mjs")),ae._isSameOrigin=(c,e)=>{const t=URL.parse(c);if(!(t!=null&&t.origin)||t.origin==="null")return!1;const s=new URL(e,t);return t.origin===s.origin},ae._createCDNWrapper=c=>{const e=`await import("${c}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},ae.fromPort=c=>{if(ty("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(c!=null&&c.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return ae.create(c)};let nu=ae;var ln,Si,al,ol,hn,va,ch;class nb{constructor(e,t,s,i,n,a){y(this,va);y(this,ln,new Map);y(this,Si,new Map);y(this,al,new Map);y(this,ol,new Map);y(this,hn,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new km,this.fontLoader=new oy({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.wasmFactory=n.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=a,this.setupMessageHandler()}get annotationStorage(){return at(this,"annotationStorage",new Op)}getRenderingIntent(e,t=xn.ENABLE,s=null,i=!1,n=!1){let a=As.DISPLAY,o=Ef;switch(e){case"any":a=As.ANY;break;case"display":break;case"print":a=As.PRINT;break;default:Q(`getRenderingIntent - invalid intent: ${e}`)}const l=a&As.PRINT&&s instanceof vm?s:this.annotationStorage;switch(t){case xn.DISABLE:a+=As.ANNOTATIONS_DISABLE;break;case xn.ENABLE:break;case xn.ENABLE_FORMS:a+=As.ANNOTATIONS_FORMS;break;case xn.ENABLE_STORAGE:a+=As.ANNOTATIONS_STORAGE,o=l.serializable;break;default:Q(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(a+=As.IS_EDITING),n&&(a+=As.OPLIST);const{ids:h,hash:d}=l.modifiedIds,u=[a,o.hash,d];return{renderingIntent:a,cacheKey:u.join("_"),annotationStorageSerializable:o,modifiedIds:h}}destroy(){var s;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(s=r(this,hn))==null||s.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of r(this,Si).values())e.push(i._destroy());r(this,Si).clear(),r(this,al).clear(),r(this,ol).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var i,n;this.commonObjs.clear(),this.fontLoader.clear(),r(this,ln).clear(),this.filterFactory.destroy(),$l.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new Pn("Worker was terminated.")),(n=this.messageHandler)==null||n.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(s,i)=>{ut(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},i.onPull=()=>{this._fullReader.read().then(function({value:n,done:a}){if(a){i.close();return}ut(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{i.error(n)})},i.onCancel=n=>{this._fullReader.cancel(n),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("ReaderHeadersReady",async s=>{var o;await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:n,contentLength:a}=this._fullReader;return(!i||!n)&&(this._lastProgress&&((o=t.onProgress)==null||o.call(t,this._lastProgress)),this._fullReader.onProgress=l=>{var h;(h=t.onProgress)==null||h.call(t,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:i,isRangeSupported:n,contentLength:a}}),e.on("GetRangeReader",(s,i)=>{ut(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(s.begin,s.end);if(!n){i.close();return}i.onPull=()=>{n.read().then(function({value:a,done:o}){if(o){i.close();return}ut(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{i.error(a)})},i.onCancel=a=>{n.cancel(a),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,t._capability.resolve(new sb(s,this))}),e.on("DocException",s=>{t._capability.reject(Ge(s))}),e.on("PasswordRequest",s=>{g(this,hn,Promise.withResolvers());try{if(!t.onPassword)throw Ge(s);const i=n=>{n instanceof Error?r(this,hn).reject(n):r(this,hn).resolve({password:n})};t.onPassword(i,s.code)}catch(i){r(this,hn).reject(i)}return r(this,hn).promise}),e.on("DataLoaded",s=>{var i;(i=t.onProgress)==null||i.call(t,{loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),e.on("StartRenderPage",s=>{if(this.destroyed)return;r(this,Si).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),e.on("commonobj",([s,i,n])=>{var a;if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":if("error"in n){const u=n.error;Q(`Error during font loading: ${u}`),this.commonObjs.resolve(s,u);break}const o=new Of(n),l=this._params.pdfBug&&((a=globalThis.FontInspector)!=null&&a.enabled)?(u,f)=>globalThis.FontInspector.fontAdded(u,f):null,h=new ly(o,l,n.extra,n.charProcOperatorList);this.fontLoader.bind(h).catch(()=>e.sendWithPromise("FontFallback",{id:s})).finally(()=>{!h.fontExtraProperties&&h.data&&h.clearData(),this.commonObjs.resolve(s,h)});break;case"CopyLocalImage":const{imageRef:d}=n;ut(d,"The imageRef must be defined.");for(const u of r(this,Si).values())for(const[,f]of u.objs)if((f==null?void 0:f.ref)===d)return f.dataLen?(this.commonObjs.resolve(s,structuredClone(f)),f.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,n);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",([s,i,n,a])=>{var l;if(this.destroyed)return;const o=r(this,Si).get(i);if(!o.objs.has(s)){if(o._intentStates.size===0){(l=a==null?void 0:a.bitmap)==null||l.close();return}switch(n){case"Image":case"Pattern":o.objs.resolve(s,a);break;default:throw new Error(`Got unknown object type ${n}`)}}}),e.on("DocProgress",s=>{var i;this.destroyed||(i=t.onProgress)==null||i.call(t,{loaded:s.loaded,total:s.total})}),e.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const i=this[s.type];if(!i)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var s;this.annotationStorage.size<=0&&Q("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((s=this._fullReader)==null?void 0:s.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,s=r(this,al).get(t);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&r(this,ol).set(n.refStr,e);const a=new ib(t,n,this,this._params.pdfBug);return r(this,Si).set(t,a),a});return r(this,al).set(t,i),i}getPageIndex(e){return Sf(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return w(this,va,ch).call(this,"GetFieldObjects")}hasJSActions(){return w(this,va,ch).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:t})}getDocJSActions(){return w(this,va,ch).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return w(this,va,ch).call(this,"GetOptionalContentConfig").then(t=>new Fy(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=r(this,ln).get(e);if(t)return t;const s=this.messageHandler.sendWithPromise(e,null).then(i=>{var n,a;return{info:i[0],metadata:i[1]?new ky(i[1]):null,contentDispositionFilename:((n=this._fullReader)==null?void 0:n.filename)??null,contentLength:((a=this._fullReader)==null?void 0:a.contentLength)??null}});return r(this,ln).set(e,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of r(this,Si).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),r(this,ln).clear(),this.filterFactory.destroy(!0),$l.cleanup()}}cachedPageNumber(e){if(!Sf(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return r(this,ol).get(t)??null}}ln=new WeakMap,Si=new WeakMap,al=new WeakMap,ol=new WeakMap,hn=new WeakMap,va=new WeakSet,ch=function(e,t=null){const s=r(this,ln).get(e);if(s)return s;const i=this.messageHandler.sendWithPromise(e,t);return r(this,ln).set(e,i),i};var sr;class rb{constructor(e){y(this,sr,null);M(this,"onContinue",null);M(this,"onError",null);g(this,sr,e)}get promise(){return r(this,sr).capability.promise}cancel(e=0){r(this,sr).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=r(this,sr).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=r(this,sr);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}sr=new WeakMap;var ir,ya;const Nr=class Nr{constructor({callback:e,params:t,objs:s,commonObjs:i,annotationCanvasMap:n,operatorList:a,pageIndex:o,canvasFactory:l,filterFactory:h,useRequestAnimationFrame:d=!1,pdfBug:u=!1,pageColors:f=null,enableHWA:p=!1,operationsFilter:m=null}){y(this,ir,null);this.callback=e,this.params=t,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=h,this._pdfBug=u,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new rb(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvas,this._canvasContext=t.canvas?null:t.canvasContext,this._enableHWA=p,this._dependencyTracker=t.dependencyTracker,this._operationsFilter=m}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var l,h;if(this.cancelled)return;if(this._canvas){if(r(Nr,ya).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");r(Nr,ya).add(this._canvas)}this._pdfBug&&((l=globalThis.StepperManager)!=null&&l.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:s,transform:i,background:n,dependencyTracker:a}=this.params,o=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new go(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors,a),this.gfx.beginDrawing({transform:i,viewport:s,transparency:e,background:n}),this.operatorListIdx=0,this.graphicsReady=!0,(h=this.graphicsReadyCallback)==null||h.call(this)}cancel(e=null,t=0){var s,i,n;this.running=!1,this.cancelled=!0,(s=this.gfx)==null||s.endDrawing(),r(this,ir)&&(window.cancelAnimationFrame(r(this,ir)),g(this,ir,null)),r(Nr,ya).delete(this._canvas),e||(e=new Uu(`Rendering cancelled, page ${this._pageIndex+1}`,t)),this.callback(e),(n=(i=this.task).onError)==null||n.call(i,e)}operatorListChanged(){var e,t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.gfx.dependencyTracker)==null||e.growOperationsCount(this.operatorList.fnArray.length),(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?g(this,ir,window.requestAnimationFrame(()=>{g(this,ir,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),r(Nr,ya).delete(this._canvas),this.callback())))}};ir=new WeakMap,ya=new WeakMap,y(Nr,ya,new WeakSet);let Uf=Nr;const Um="5.4.296",Hm="f56dc8601";var ls,ba,ll,re,Sc,hl,cn,xc,nr,Js,Tc,Ct,Hf,$f,jf,Dr,$m,Dn;const We=class We{constructor({editor:e=null,uiManager:t=null}){y(this,Ct);y(this,ls,null);y(this,ba,null);y(this,ll);y(this,re,null);y(this,Sc,!1);y(this,hl,!1);y(this,cn,null);y(this,xc);y(this,nr,null);y(this,Js,null);var s,i;e?(g(this,hl,!1),g(this,cn,e)):g(this,hl,!0),g(this,Js,(e==null?void 0:e._uiManager)||t),g(this,xc,r(this,Js)._eventBus),g(this,ll,((s=e==null?void 0:e.color)==null?void 0:s.toUpperCase())||((i=r(this,Js))==null?void 0:i.highlightColors.values().next().value)||"#FFFF98"),r(We,Tc)||g(We,Tc,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return at(this,"_keyboardManager",new od([[["Escape","mac+Escape"],We.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],We.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],We.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],We.prototype._moveToPrevious],[["Home","mac+Home"],We.prototype._moveToBeginning],[["End","mac+End"],We.prototype._moveToEnd]]))}renderButton(){const e=g(this,ls,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",r(this,cn)&&(e.ariaControls=`${r(this,cn).id}_colorpicker_dropdown`);const t=r(this,Js)._signal;e.addEventListener("click",w(this,Ct,Dr).bind(this),{signal:t}),e.addEventListener("keydown",w(this,Ct,jf).bind(this),{signal:t});const s=g(this,ba,document.createElement("span"));return s.className="swatch",s.ariaHidden="true",s.style.backgroundColor=r(this,ll),e.append(s),e}renderMainDropdown(){const e=g(this,re,w(this,Ct,Hf).call(this));return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}_colorSelectFromKeyboard(e){if(e.target===r(this,ls)){w(this,Ct,Dr).call(this,e);return}const t=e.target.getAttribute("data-color");t&&w(this,Ct,$f).call(this,t,e)}_moveToNext(e){var t,s;if(!r(this,Ct,Dn)){w(this,Ct,Dr).call(this,e);return}if(e.target===r(this,ls)){(t=r(this,re).firstChild)==null||t.focus();return}(s=e.target.nextSibling)==null||s.focus()}_moveToPrevious(e){var t,s;if(e.target===((t=r(this,re))==null?void 0:t.firstChild)||e.target===r(this,ls)){r(this,Ct,Dn)&&this._hideDropdownFromKeyboard();return}r(this,Ct,Dn)||w(this,Ct,Dr).call(this,e),(s=e.target.previousSibling)==null||s.focus()}_moveToBeginning(e){var t;if(!r(this,Ct,Dn)){w(this,Ct,Dr).call(this,e);return}(t=r(this,re).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!r(this,Ct,Dn)){w(this,Ct,Dr).call(this,e);return}(t=r(this,re).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=r(this,re))==null||e.classList.add("hidden"),r(this,ls).ariaExpanded="false",(t=r(this,nr))==null||t.abort(),g(this,nr,null)}_hideDropdownFromKeyboard(){var e;if(!r(this,hl)){if(!r(this,Ct,Dn)){(e=r(this,cn))==null||e.unselect();return}this.hideDropdown(),r(this,ls).focus({preventScroll:!0,focusVisible:r(this,Sc)})}}updateColor(e){if(r(this,ba)&&(r(this,ba).style.backgroundColor=e),!r(this,re))return;const t=r(this,Js).highlightColors.values();for(const s of r(this,re).children)s.ariaSelected=t.next().value===e.toUpperCase()}destroy(){var e,t;(e=r(this,ls))==null||e.remove(),g(this,ls,null),g(this,ba,null),(t=r(this,re))==null||t.remove(),g(this,re,null)}};ls=new WeakMap,ba=new WeakMap,ll=new WeakMap,re=new WeakMap,Sc=new WeakMap,hl=new WeakMap,cn=new WeakMap,xc=new WeakMap,nr=new WeakMap,Js=new WeakMap,Tc=new WeakMap,Ct=new WeakSet,Hf=function(){const e=document.createElement("div"),t=r(this,Js)._signal;e.addEventListener("contextmenu",Ts,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),r(this,cn)&&(e.id=`${r(this,cn).id}_colorpicker_dropdown`);for(const[s,i]of r(this,Js).highlightColors){const n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",i),n.title=s,n.setAttribute("data-l10n-id",r(We,Tc)[s]);const a=document.createElement("span");n.append(a),a.className="swatch",a.style.backgroundColor=i,n.ariaSelected=i===r(this,ll),n.addEventListener("click",w(this,Ct,$f).bind(this,i),{signal:t}),e.append(n)}return e.addEventListener("keydown",w(this,Ct,jf).bind(this),{signal:t}),e},$f=function(e,t){t.stopPropagation(),r(this,xc).dispatch("switchannotationeditorparams",{source:this,type:dt.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)},jf=function(e){We._keyboardManager.exec(this,e)},Dr=function(e){if(r(this,Ct,Dn)){this.hideDropdown();return}if(g(this,Sc,e.detail===0),r(this,nr)||(g(this,nr,new AbortController),window.addEventListener("pointerdown",w(this,Ct,$m).bind(this),{signal:r(this,Js).combinedSignal(r(this,nr))})),r(this,ls).ariaExpanded="true",r(this,re)){r(this,re).classList.remove("hidden");return}const t=g(this,re,w(this,Ct,Hf).call(this));r(this,ls).append(t)},$m=function(e){var t;(t=r(this,re))!=null&&t.contains(e.target)||this.hideDropdown()},Dn=function(){return r(this,re)&&!r(this,re).classList.contains("hidden")},y(We,Tc,null);let Eh=We;var xi,Cc,cl,Pc;const Fr=class Fr{constructor(e){y(this,xi,null);y(this,Cc,null);y(this,cl,null);g(this,Cc,e),g(this,cl,e._uiManager),r(Fr,Pc)||g(Fr,Pc,Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"}))}renderButton(){if(r(this,xi))return r(this,xi);const{editorType:e,colorType:t,colorValue:s}=r(this,Cc),i=g(this,xi,document.createElement("input"));return i.type="color",i.value=s||"#000000",i.className="basicColorPicker",i.tabIndex=0,i.setAttribute("data-l10n-id",r(Fr,Pc)[e]),i.addEventListener("input",()=>{r(this,cl).updateParams(t,i.value)},{signal:r(this,cl)._signal}),i}update(e){r(this,xi)&&(r(this,xi).value=e)}destroy(){var e;(e=r(this,xi))==null||e.remove(),g(this,xi,null)}hideDropdown(){}};xi=new WeakMap,Cc=new WeakMap,cl=new WeakMap,Pc=new WeakMap,y(Fr,Pc,null);let ru=Fr;nt(116);nt(531);function Ag(c){return Math.floor(Math.max(0,Math.min(1,c))*255).toString(16).padStart(2,"0")}function Xl(c){return Math.max(0,Math.min(255,255*c))}class wg{static CMYK_G([e,t,s,i]){return["G",1-Math.min(1,.3*e+.59*s+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Xl(e),[e,e,e]}static G_HTML([e]){const t=Ag(e);return`#${t}${t}${t}`}static RGB_G([e,t,s]){return["G",.3*e+.59*t+.11*s]}static RGB_rgb(e){return e.map(Xl)}static RGB_HTML(e){return`#${e.map(Ag).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,s,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,s+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,s,i]){return[Xl(1-Math.min(1,e+i)),Xl(1-Math.min(1,s+i)),Xl(1-Math.min(1,t+i))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,s]){const i=1-e,n=1-t,a=1-s,o=Math.min(i,n,a);return["CMYK",i,n,a,o]}}class ab{create(e,t,s=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){Mt("Abstract method `_createSVG` called.")}}class Sh extends ab{_createSVG(e){return document.createElementNS(Fi,e)}}const ob=9,Ya=new WeakSet,lb=new Date().getTimezoneOffset()*60*1e3;class Eg{static create(e){switch(e.data.annotationType){case Yt.LINK:return new _p(e);case Yt.TEXT:return new cb(e);case Yt.WIDGET:switch(e.data.fieldType){case"Tx":return new db(e);case"Btn":return e.data.radioButton?new Vm(e):e.data.checkBox?new fb(e):new pb(e);case"Ch":return new gb(e);case"Sig":return new ub(e)}return new Ja(e);case Yt.POPUP:return new Vf(e);case Yt.FREETEXT:return new Km(e);case Yt.LINE:return new vb(e);case Yt.SQUARE:return new yb(e);case Yt.CIRCLE:return new bb(e);case Yt.POLYLINE:return new Jm(e);case Yt.CARET:return new wb(e);case Yt.INK:return new Up(e);case Yt.POLYGON:return new Ab(e);case Yt.HIGHLIGHT:return new Qm(e);case Yt.UNDERLINE:return new Eb(e);case Yt.SQUIGGLY:return new Sb(e);case Yt.STRIKEOUT:return new xb(e);case Yt.STAMP:return new Zm(e);case Yt.FILEATTACHMENT:return new Tb(e);default:return new jt(e)}}}var Aa,dl,Bs,Rc,zf;const Wp=class Wp{constructor(e,{isRenderable:t=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){y(this,Rc);y(this,Aa,null);y(this,dl,!1);y(this,Bs,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e!=null&&e.str||t!=null&&t.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Wp._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){var s;const{data:e}=this,t=(s=this.annotationStorage)==null?void 0:s.getEditor(e.id);return t?t.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){var o;const e=(o=this.annotationStorage)==null?void 0:o.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;const{quadPoints:t,inkLists:s,rect:i}=this.data;let n=-1/0,a=-1/0;if((t==null?void 0:t.length)>=8){for(let l=0;l<t.length;l+=8)t[l+1]>a?(a=t[l+1],n=t[l+2]):t[l+1]===a&&(n=Math.max(n,t[l+2]));return[n,a]}if((s==null?void 0:s.length)>=1){for(const l of s)for(let h=0,d=l.length;h<d;h+=2)l[h+1]>a?(a=l[h+1],n=l[h]):l[h+1]===a&&(n=Math.max(n,l[h]));if(n!==1/0)return[n,a]}return i?[i[2],i[3]]:null}_normalizePoint(e){const{page:{view:t},viewport:{rawDims:{pageWidth:s,pageHeight:i,pageX:n,pageY:a}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-n)/s,e[1]=100*(e[1]-a)/i,e}get commentText(){var t,s,i;const{data:e}=this;return((s=(t=this.annotationStorage.getRawValue(`${vh}${e.id}`))==null?void 0:t.popup)==null?void 0:s.contents)||((i=e.contentsObj)==null?void 0:i.str)||""}set commentText(e){const{data:t}=this,s={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(t.id,{popup:s})||this.annotationStorage.setValue(`${vh}${t.id}`,{id:t.id,annotationType:t.annotationType,pageIndex:this.parent.page._pageIndex,popup:s,popupRef:t.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){var e,t;(t=((e=r(this,Bs))==null?void 0:e.popup)||this.popup)==null||t.remove(),g(this,Bs,this.popup=null)}updateEdited(e){var n;if(!this.container)return;e.rect&&(r(this,Aa)||g(this,Aa,{rect:this.data.rect.slice(0)}));const{rect:t,popup:s}=e;t&&w(this,Rc,zf).call(this,t);let i=((n=r(this,Bs))==null?void 0:n.popup)||this.popup;!i&&(s!=null&&s.text)&&(this._createPopup(s),i=r(this,Bs).popup),i&&(i.updateEdited(e),s!=null&&s.deleted&&(i.remove(),g(this,Bs,null),this.popup=null))}resetEdited(){var e;r(this,Aa)&&(w(this,Rc,zf).call(this,r(this,Aa).rect),(e=r(this,Bs))==null||e.popup.resetEdited(),g(this,Aa,null))}_createContainer(e){const{data:t,parent:{page:s,viewport:i}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",t.id),!(this instanceof Ja)&&!(this instanceof _p)&&(n.tabIndex=0);const{style:a}=n;if(a.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(n.title=t.alternativeText),t.noRotate&&n.classList.add("norotate"),!t.rect||this instanceof Vf){const{rotation:v}=t;return!t.hasOwnCanvas&&v!==0&&this.setRotation(v,n),n}const{width:o,height:l}=this;if(!e&&t.borderStyle.width>0){a.borderWidth=`${t.borderStyle.width}px`;const v=t.borderStyle.horizontalCornerRadius,A=t.borderStyle.verticalCornerRadius;if(v>0||A>0){const S=`calc(${v}px * var(--total-scale-factor)) / calc(${A}px * var(--total-scale-factor))`;a.borderRadius=S}else if(this instanceof Vm){const S=`calc(${o}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`;a.borderRadius=S}switch(t.borderStyle.style){case qa.SOLID:a.borderStyle="solid";break;case qa.DASHED:a.borderStyle="dashed";break;case qa.BEVELED:Q("Unimplemented border style: beveled");break;case qa.INSET:Q("Unimplemented border style: inset");break;case qa.UNDERLINE:a.borderBottomStyle="solid";break}const b=t.borderColor||null;b?(g(this,dl,!0),a.borderColor=j.makeHexColor(b[0]|0,b[1]|0,b[2]|0)):a.borderWidth=0}const h=j.normalizeRect([t.rect[0],s.view[3]-t.rect[1]+s.view[1],t.rect[2],s.view[3]-t.rect[3]+s.view[1]]),{pageWidth:d,pageHeight:u,pageX:f,pageY:p}=i.rawDims;a.left=`${100*(h[0]-f)/d}%`,a.top=`${100*(h[1]-p)/u}%`;const{rotation:m}=t;return t.hasOwnCanvas||m===0?(a.width=`${100*o/d}%`,a.height=`${100*l/u}%`):this.setRotation(m,n),n}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims;let{width:n,height:a}=this;e%180!==0&&([n,a]=[a,n]),t.style.width=`${100*n/s}%`,t.style.height=`${100*a/i}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,s,i)=>{const n=i.detail[t],a=n[0],o=n.slice(1);i.target.style[s]=wg[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[s]:wg[`${a}_rgb`](o)})};return at(this,"_commonActions",{display:t=>{const{display:s}=t.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:s}=t.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const s=t.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(e,t){const s=this._commonActions;for(const i of Object.keys(t.detail)){const n=e[i]||s[i];n==null||n(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const s=this._commonActions;for(const[i,n]of Object.entries(t)){const a=s[i];if(a){const o={detail:{[i]:n},target:e};a(o),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,s,i,n]=this.data.rect.map(v=>Math.fround(v));if(e.length===8){const[v,A,b,S]=e.subarray(2,6);if(i===v&&n===A&&t===b&&s===S)return}const{style:a}=this.container;let o;if(r(this,dl)){const{borderColor:v,borderWidth:A}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${v}" stroke-width="${A}">`],this.container.classList.add("hasBorder")}const l=i-t,h=n-s,{svgFactory:d}=this,u=d.createElement("svg");u.classList.add("quadrilateralsContainer"),u.setAttribute("width",0),u.setAttribute("height",0),u.role="none";const f=d.createElement("defs");u.append(f);const p=d.createElement("clipPath"),m=`clippath_${this.data.id}`;p.setAttribute("id",m),p.setAttribute("clipPathUnits","objectBoundingBox"),f.append(p);for(let v=2,A=e.length;v<A;v+=8){const b=e[v],S=e[v+1],E=e[v+2],T=e[v+3],x=d.createElement("rect"),C=(E-t)/l,P=(n-S)/h,I=(b-E)/l,R=(S-T)/h;x.setAttribute("x",C),x.setAttribute("y",P),x.setAttribute("width",I),x.setAttribute("height",R),p.append(x),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${C}" y="${P}" width="${I}" height="${R}"/>`)}r(this,dl)&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(u),this.container.style.clipPath=`url(#${m})`}_createPopup(e=null){const{data:t}=this;let s,i;e?(s={str:e.text},i=e.date):(s=t.contentsObj,i=t.modificationDate);const n=g(this,Bs,new Vf({data:{color:t.color,titleObj:t.titleObj,modificationDate:i,contentsObj:s,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]}));this.parent._commentManager||this.parent.div.append(n.render())}get hasPopupElement(){return!!(r(this,Bs)||this.popup||this.data.popupRef)}get extraPopupElement(){return r(this,Bs)}render(){Mt("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[e];if(i)for(const{page:n,id:a,exportValues:o}of i){if(n===-1||a===t)continue;const l=typeof o=="string"?o:null,h=document.querySelector(`[data-element-id="${a}"]`);if(h&&!Ya.has(h)){Q(`_getElementsByName - element not allowed: ${a}`);continue}s.push({id:a,exportValue:l,domElement:h})}return s}for(const i of document.getElementsByName(e)){const{exportValue:n}=i,a=i.getAttribute("data-element-id");a!==t&&Ya.has(i)&&s.push({id:a,exportValue:n,domElement:i})}return s}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var s;(s=this.linkService.eventBus)==null||s.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};Aa=new WeakMap,dl=new WeakMap,Bs=new WeakMap,Rc=new WeakSet,zf=function(e){const{container:{style:t},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:l}}}}=this;s==null||s.splice(0,4,...e),t.left=`${100*(e[0]-o)/n}%`,t.top=`${100*(a-e[3]+l)/a}%`,i===0?(t.width=`${100*(e[2]-e[0])/n}%`,t.height=`${100*(e[3]-e[1])/a}%`):this.setRotation(i)};let jt=Wp;class hb extends jt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:e}=this;e.hasComment&&(this._createPopup(e.comment),this.extraPopupElement.popup.renderCommentButton())}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.container.remove(),this.container=null,this.removePopup()}}var Es,Lr,jm,zm;class _p extends jt{constructor(t,s=null){super(t,{isRenderable:!0,ignoreBorder:!!(s!=null&&s.ignoreBorder),createQuadrilaterals:!0});y(this,Es);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:s}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let n=!1;return t.url?(s.addLinkAttributes(i,t.url,t.newWindow),n=!0):t.action?(this._bindNamedAction(i,t.action,t.overlaidText),n=!0):t.attachment?(w(this,Es,jm).call(this,i,t.attachment,t.overlaidText,t.attachmentDest),n=!0):t.setOCGState?(w(this,Es,zm).call(this,i,t.setOCGState,t.overlaidText),n=!0):t.dest?(this._bindLink(i,t.dest,t.overlaidText),n=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),n=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(i,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&this.container.append(i),this.container}_bindLink(t,s,i=""){t.href=this.linkService.getDestinationHash(s),t.onclick=()=>(s&&this.linkService.goToDestination(s),!1),(s||s==="")&&w(this,Es,Lr).call(this),i&&(t.title=i)}_bindNamedAction(t,s,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(s),!1),i&&(t.title=i),w(this,Es,Lr).call(this)}_bindJSAction(t,s){t.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const n of Object.keys(s.actions)){const a=i.get(n);a&&(t[a]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s.id,name:n}}),!1})}s.overlaidText&&(t.title=s.overlaidText),t.onclick||(t.onclick=()=>!1),w(this,Es,Lr).call(this)}_bindResetFormAction(t,s){const i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),w(this,Es,Lr).call(this),!this._fieldObjects){Q('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{var u;i==null||i();const{fields:n,refs:a,include:o}=s,l=[];if(n.length!==0||a.length!==0){const f=new Set(a);for(const p of n){const m=this._fieldObjects[p]||[];for(const{id:v}of m)f.add(v)}for(const p of Object.values(this._fieldObjects))for(const m of p)f.has(m.id)===o&&l.push(m)}else for(const f of Object.values(this._fieldObjects))l.push(...f);const h=this.annotationStorage,d=[];for(const f of l){const{id:p}=f;switch(d.push(p),f.type){case"text":{const v=f.defaultValue||"";h.setValue(p,{value:v});break}case"checkbox":case"radiobutton":{const v=f.defaultValue===f.exportValues;h.setValue(p,{value:v});break}case"combobox":case"listbox":{const v=f.defaultValue||"";h.setValue(p,{value:v});break}default:continue}const m=document.querySelector(`[data-element-id="${p}"]`);if(m){if(!Ya.has(m)){Q(`_bindResetFormAction - element not allowed: ${p}`);continue}}else continue;m.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((u=this.linkService.eventBus)==null||u.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:d,name:"ResetForm"}})),!1}}}Es=new WeakSet,Lr=function(){this.container.setAttribute("data-internal-link","")},jm=function(t,s,i="",n=null){t.href=this.linkService.getAnchorUrl(""),s.description?t.title=s.description:i&&(t.title=i),t.onclick=()=>{var a;return(a=this.downloadManager)==null||a.openOrDownloadData(s.content,s.filename,n),!1},w(this,Es,Lr).call(this)},zm=function(t,s,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(s),!1),i&&(t.title=i),w(this,Es,Lr).call(this)};class cb extends jt{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class Ja extends jt{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return ye.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,s,i,n){s.includes("mouse")?e.addEventListener(s,a=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):e.addEventListener(s,a=>{var o;if(s==="blur"){if(!t.focused||!a.relatedTarget)return;t.focused=!1}else if(s==="focus"){if(t.focused)return;t.focused=!0}n&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(a)}}))})}_setEventListeners(e,t,s,i){var n,a,o;for(const[l,h]of s)(h==="Action"||(n=this.data.actions)!=null&&n[h])&&((h==="Focus"||h==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,l,h,i),h==="Focus"&&!((a=this.data.actions)!=null&&a.Blur)?this._setEventListener(e,t,"blur","Blur",null):h==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":j.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||ob,n=e.style;let a;const o=2,l=h=>Math.round(10*h)/10;if(this.data.multiLine){const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o),d=Math.round(h/(Gu*i))||1,u=h/d;a=Math.min(i,l(u/Gu))}else{const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(i,l(h/Gu))}n.fontSize=`calc(${a}px * var(--total-scale-factor))`,n.color=j.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(n.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class db extends Ja{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,s,i){const n=this.annotationStorage;for(const a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=s),n.setValue(a.id,{[i]:s})}render(){var i,n;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const a=e.getValue(t,{value:this.data.fieldValue});let o=a.value||"";const l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&o.length>l&&(o=o.slice(0,l));let h=a.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;h&&this.data.comb&&(h=h.replaceAll(/\s+/g,""));const d={userValue:o,formattedValue:h,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=h??o,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type=this.data.password?"password":"text",s.setAttribute("value",h??o),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Ya.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=0;const{datetimeFormat:u,datetimeType:f,timeStep:p}=this.data,m=!!f&&this.enableScripting;u&&(s.title=u),this._setRequired(s,this.data.required),l&&(s.maxLength=l),s.addEventListener("input",A=>{e.setValue(t,{value:A.target.value}),this.setPropertyOnSiblings(s,"value",A.target.value,"value"),d.formattedValue=null}),s.addEventListener("resetform",A=>{const b=this.data.defaultFieldValue??"";s.value=d.userValue=b,d.formattedValue=null});let v=A=>{const{formattedValue:b}=d;b!=null&&(A.target.value=b),A.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",b=>{var E;if(d.focused)return;const{target:S}=b;if(m&&(S.type=f,p&&(S.step=p)),d.userValue){const T=d.userValue;if(m)if(f==="time"){const x=new Date(T),C=[x.getHours(),x.getMinutes(),x.getSeconds()];S.value=C.map(P=>P.toString().padStart(2,"0")).join(":")}else S.value=new Date(T-lb).toISOString().split(f==="date"?"T":".",1)[0];else S.value=T}d.lastCommittedValue=S.value,d.commitKey=1,(E=this.data.actions)!=null&&E.Focus||(d.focused=!0)}),s.addEventListener("updatefromsandbox",b=>{this.showElementAndHideCanvas(b.target);const S={value(E){d.userValue=E.detail.value??"",m||e.setValue(t,{value:d.userValue.toString()}),E.target.value=d.userValue},formattedValue(E){const{formattedValue:T}=E.detail;d.formattedValue=T,T!=null&&E.target!==document.activeElement&&(E.target.value=T);const x={formattedValue:T};m&&(x.value=T),e.setValue(t,x)},selRange(E){E.target.setSelectionRange(...E.detail.selRange)},charLimit:E=>{var P;const{charLimit:T}=E.detail,{target:x}=E;if(T===0){x.removeAttribute("maxLength");return}x.setAttribute("maxLength",T);let C=d.userValue;!C||C.length<=T||(C=C.slice(0,T),x.value=d.userValue=C,e.setValue(t,{value:C}),(P=this.linkService.eventBus)==null||P.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:C,willCommit:!0,commitKey:1,selStart:x.selectionStart,selEnd:x.selectionEnd}}))}};this._dispatchEventFromSandbox(S,b)}),s.addEventListener("keydown",b=>{var T;d.commitKey=1;let S=-1;if(b.key==="Escape"?S=0:b.key==="Enter"&&!this.data.multiLine?S=2:b.key==="Tab"&&(d.commitKey=3),S===-1)return;const{value:E}=b.target;d.lastCommittedValue!==E&&(d.lastCommittedValue=E,d.userValue=E,(T=this.linkService.eventBus)==null||T.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:E,willCommit:!0,commitKey:S,selStart:b.target.selectionStart,selEnd:b.target.selectionEnd}}))});const A=v;v=null,s.addEventListener("blur",b=>{var T,x;if(!d.focused||!b.relatedTarget)return;(T=this.data.actions)!=null&&T.Blur||(d.focused=!1);const{target:S}=b;let{value:E}=S;if(m){if(E&&f==="time"){const C=E.split(":").map(P=>parseInt(P,10));E=new Date(2e3,0,1,C[0],C[1],C[2]||0).valueOf(),S.step=""}else E.includes("T")||(E=`${E}T00:00`),E=new Date(E).valueOf();S.type="text"}d.userValue=E,d.lastCommittedValue!==E&&((x=this.linkService.eventBus)==null||x.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:E,willCommit:!0,commitKey:d.commitKey,selStart:b.target.selectionStart,selEnd:b.target.selectionEnd}})),A(b)}),(n=this.data.actions)!=null&&n.Keystroke&&s.addEventListener("beforeinput",b=>{var R;d.lastCommittedValue=null;const{data:S,target:E}=b,{value:T,selectionStart:x,selectionEnd:C}=E;let P=x,I=C;switch(b.inputType){case"deleteWordBackward":{const L=T.substring(0,x).match(/\w*[^\w]*$/);L&&(P-=L[0].length);break}case"deleteWordForward":{const L=T.substring(x).match(/^[^\w]*\w*/);L&&(I+=L[0].length);break}case"deleteContentBackward":x===C&&(P-=1);break;case"deleteContentForward":x===C&&(I+=1);break}b.preventDefault(),(R=this.linkService.eventBus)==null||R.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:T,change:S||"",willCommit:!1,selStart:P,selEnd:I}})}),this._setEventListeners(s,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],b=>b.target.value)}if(v&&s.addEventListener("blur",v),this.data.comb){const b=(this.data.rect[2]-this.data.rect[0])/l;s.classList.add("comb"),s.style.letterSpacing=`calc(${b}px * var(--total-scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class ub extends Ja{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class fb extends Ja{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.exportValue===t.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",e.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");return Ya.add(n),n.setAttribute("data-element-id",s),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=t.fieldName,i&&n.setAttribute("checked",!0),n.setAttribute("exportValue",t.exportValue),n.tabIndex=0,n.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const h of this._getElementsByName(o,s)){const d=l&&h.exportValue===t.exportValue;h.domElement&&(h.domElement.checked=d),e.setValue(h.id,{value:d})}e.setValue(s,{value:l})}),n.addEventListener("resetform",a=>{const o=t.defaultFieldValue||"Off";a.target.checked=o===t.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",a=>{const o={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(s,{value:l.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Vm extends Ja{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.fieldValue===t.buttonValue}).value;if(typeof i=="string"&&(i=i!==t.buttonValue,e.setValue(s,{value:i})),i)for(const a of this._getElementsByName(t.fieldName,s))e.setValue(a.id,{value:!1});const n=document.createElement("input");if(Ya.add(n),n.setAttribute("data-element-id",s),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=t.fieldName,i&&n.setAttribute("checked",!0),n.tabIndex=0,n.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const h of this._getElementsByName(o,s))e.setValue(h.id,{value:!1});e.setValue(s,{value:l})}),n.addEventListener("resetform",a=>{const o=t.defaultFieldValue;a.target.checked=o!=null&&o===t.buttonValue}),this.enableScripting&&this.hasJSActions){const a=t.buttonValue;n.addEventListener("updatefromsandbox",o=>{const l={value:h=>{const d=a===h.detail.value;for(const u of this._getElementsByName(h.target.name)){const f=d&&u.id===s;u.domElement&&(u.domElement.checked=f),e.setValue(u.id,{value:f})}}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class pb extends _p{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),e}}class gb extends Ja{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,s=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");Ya.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=0;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",d=>{const u=this.data.defaultFieldValue;for(const f of i.options)f.selected=f.value===u});for(const d of this.data.options){const u=document.createElement("option");u.textContent=d.displayValue,u.value=d.exportValue,s.value.includes(d.exportValue)&&(u.setAttribute("selected",!0),n=!1),i.append(u)}let a=null;if(n){const d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),i.prepend(d),a=()=>{d.remove(),i.removeEventListener("input",a),a=null},i.addEventListener("input",a)}const o=d=>{const u=d?"value":"textContent",{options:f,multiple:p}=i;return p?Array.prototype.filter.call(f,m=>m.selected).map(m=>m[u]):f.selectedIndex===-1?null:f[f.selectedIndex][u]};let l=o(!1);const h=d=>{const u=d.target.options;return Array.prototype.map.call(u,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",d=>{const u={value(f){a==null||a();const p=f.detail.value,m=new Set(Array.isArray(p)?p:[p]);for(const v of i.options)v.selected=m.has(v.value);e.setValue(t,{value:o(!0)}),l=o(!1)},multipleSelection(f){i.multiple=!0},remove(f){const p=i.options,m=f.detail.remove;p[m].selected=!1,i.remove(m),p.length>0&&Array.prototype.findIndex.call(p,A=>A.selected)===-1&&(p[0].selected=!0),e.setValue(t,{value:o(!0),items:h(f)}),l=o(!1)},clear(f){for(;i.length!==0;)i.remove(0);e.setValue(t,{value:null,items:[]}),l=o(!1)},insert(f){const{index:p,displayValue:m,exportValue:v}=f.detail.insert,A=i.children[p],b=document.createElement("option");b.textContent=m,b.value=v,A?A.before(b):i.append(b),e.setValue(t,{value:o(!0),items:h(f)}),l=o(!1)},items(f){const{items:p}=f.detail;for(;i.length!==0;)i.remove(0);for(const m of p){const{displayValue:v,exportValue:A}=m,b=document.createElement("option");b.textContent=v,b.value=A,i.append(b)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:o(!0),items:h(f)}),l=o(!1)},indices(f){const p=new Set(f.detail.indices);for(const m of f.target.options)m.selected=p.has(m.index);e.setValue(t,{value:o(!0)}),l=o(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(u,d)}),i.addEventListener("input",d=>{var p;const u=o(!0),f=o(!1);e.setValue(t,{value:u}),d.preventDefault(),(p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:f,changeEx:u,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):i.addEventListener("input",function(d){e.setValue(t,{value:o(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}var Ic,Gf;class Vf extends jt{constructor(t){const{data:s,elements:i,parent:n}=t,a=!!n._commentManager;super(t,{isRenderable:!a&&jt._hasPopupData(s)});y(this,Ic);if(this.elements=i,a&&jt._hasPopupData(s)){const o=this.popup=w(this,Ic,Gf).call(this);for(const l of i)l.popup=o}else this.popup=null}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const s=this.popup=w(this,Ic,Gf).call(this),i=[];for(const n of this.elements)n.popup=s,n.container.ariaHasPopup="dialog",i.push(n.data.id),n.addHighlightArea();return this.container.setAttribute("aria-controls",i.map(n=>`${Mp}${n}`).join(",")),this.container}}Ic=new WeakSet,Gf=function(){return new mb({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})};var hs,rr,Iu,Mu,ul,fl,Wt,Ti,ar,wa,pl,gl,Ci,cs,dn,un,de,fn,or,Mc,pn,ml,Ea,lr,Oe,hr,lt,Ld,Wf,Xf,Yf,Od,Kf,Gm,Wm,Xm,Ym,kd,Nd,Jf;class mb{constructor({container:e,color:t,elements:s,titleObj:i,modificationDate:n,contentsObj:a,richText:o,parent:l,rect:h,parentRect:d,open:u,commentManager:f=null}){y(this,lt);y(this,hs,null);y(this,rr,w(this,lt,Xm).bind(this));y(this,Iu,w(this,lt,Jf).bind(this));y(this,Mu,w(this,lt,Nd).bind(this));y(this,ul,w(this,lt,kd).bind(this));y(this,fl,null);y(this,Wt,null);y(this,Ti,null);y(this,ar,null);y(this,wa,null);y(this,pl,null);y(this,gl,null);y(this,Ci,!1);y(this,cs,null);y(this,dn,null);y(this,un,null);y(this,de,null);y(this,fn,null);y(this,or,null);y(this,Mc,null);y(this,pn,null);y(this,ml,null);y(this,Ea,null);y(this,lr,!1);y(this,Oe,null);y(this,hr,null);g(this,Wt,e),g(this,ml,i),g(this,Ti,a),g(this,pn,o),g(this,pl,l),g(this,fl,t),g(this,Mc,h),g(this,gl,d),g(this,wa,s),g(this,hs,f),g(this,Oe,s[0]),g(this,ar,Xa.toDateObject(n)),this.trigger=s.flatMap(p=>p.getElementsToTriggerPopup()),f?this.renderCommentButton():(w(this,lt,Ld).call(this),r(this,Wt).hidden=!0,u&&w(this,lt,kd).call(this))}renderCommentButton(){if(r(this,de)||(r(this,fn)||w(this,lt,Wf).call(this),!r(this,fn)))return;const{signal:e}=g(this,dn,new AbortController),t=!!r(this,Oe).extraPopupElement,s=()=>{r(this,hs).toggleCommentPopup(this,!0,void 0,!t)},i=()=>{r(this,hs).toggleCommentPopup(this,!1,!0,!t)},n=()=>{r(this,hs).toggleCommentPopup(this,!1,!1)};if(t){g(this,de,r(this,Oe).container);for(const a of this.trigger)a.ariaHasPopup="dialog",a.ariaControls="commentPopup",a.addEventListener("keydown",r(this,rr),{signal:e}),a.addEventListener("click",s,{signal:e}),a.addEventListener("pointerenter",i,{signal:e}),a.addEventListener("pointerleave",n,{signal:e}),a.classList.add("popupTriggerArea")}else{const a=g(this,de,document.createElement("button"));a.className="annotationCommentButton";const o=r(this,Oe).container;a.style.zIndex=o.style.zIndex+1,a.tabIndex=0,a.ariaHasPopup="dialog",a.ariaControls="commentPopup",a.setAttribute("data-l10n-id","pdfjs-show-comment-button"),w(this,lt,Yf).call(this),w(this,lt,Xf).call(this),a.addEventListener("keydown",r(this,rr),{signal:e}),a.addEventListener("click",s,{signal:e}),a.addEventListener("pointerenter",i,{signal:e}),a.addEventListener("pointerleave",n,{signal:e}),o.after(a)}}get commentButtonColor(){const{color:e,opacity:t}=r(this,Oe).commentData;return e?r(this,pl)._commentManager.makeCommentColor(e,t):null}focusCommentButton(){setTimeout(()=>{var e;(e=r(this,de))==null||e.focus()},0)}getData(){const{richText:e,color:t,opacity:s,creationDate:i,modificationDate:n}=r(this,Oe).commentData;return{contentsObj:{str:this.comment},richText:e,color:t,opacity:s,creationDate:i,modificationDate:n}}get elementBeforePopup(){return r(this,de)}get comment(){return r(this,hr)||g(this,hr,r(this,Oe).commentText),r(this,hr)}set comment(e){e!==this.comment&&(r(this,Oe).commentText=g(this,hr,e))}get parentBoundingClientRect(){return r(this,Oe).layer.getBoundingClientRect()}setCommentButtonStates({selected:e,hasPopup:t}){r(this,de)&&(r(this,de).classList.toggle("selected",e),r(this,de).ariaExpanded=t)}setSelectedCommentButton(e){r(this,de).classList.toggle("selected",e)}get commentPopupPosition(){if(r(this,or))return r(this,or);const{x:e,y:t,height:s}=r(this,de).getBoundingClientRect(),{x:i,y:n,width:a,height:o}=r(this,Oe).layer.getBoundingClientRect();return[(e-i)/a,(t+s-n)/o]}set commentPopupPosition(e){g(this,or,e)}hasDefaultPopupPosition(){return r(this,or)===null}get commentButtonPosition(){return r(this,fn)}get commentButtonWidth(){return r(this,de).getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){const[t,s]=r(this,or)||this.commentButtonPosition.map(h=>h/100),i=this.parentBoundingClientRect,{x:n,y:a,width:o,height:l}=i;r(this,hs).showDialog(null,this,n+t*o,a+s*l,{...e,parentDimensions:i})}render(){var s,i;if(r(this,cs))return;const e=g(this,cs,document.createElement("div"));if(e.className="popup",r(this,fl)){const n=e.style.outlineColor=j.makeHexColor(...r(this,fl));e.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`}const t=document.createElement("span");if(t.className="header",(s=r(this,ml))!=null&&s.str){const n=document.createElement("span");n.className="title",t.append(n),{dir:n.dir,str:n.textContent}=r(this,ml)}if(e.append(t),r(this,ar)){const n=document.createElement("time");n.className="popupDate",n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:r(this,ar).valueOf()})),n.dateTime=r(this,ar).toISOString(),t.append(n)}Lp({html:r(this,lt,Od)||r(this,Ti).str,dir:(i=r(this,Ti))==null?void 0:i.dir,className:"popupContent"},e),r(this,Wt).append(e)}updateEdited({rect:e,popup:t,deleted:s}){var i;if(r(this,hs)){s?(this.remove(),g(this,hr,null)):t&&(t.deleted?this.remove():(w(this,lt,Yf).call(this),g(this,hr,t.text))),e&&(g(this,fn,null),w(this,lt,Wf).call(this),w(this,lt,Xf).call(this));return}if(s||t!=null&&t.deleted){this.remove();return}w(this,lt,Ld).call(this),r(this,Ea)||g(this,Ea,{contentsObj:r(this,Ti),richText:r(this,pn)}),e&&g(this,un,null),t&&t.text&&(g(this,pn,w(this,lt,Wm).call(this,t.text)),g(this,ar,Xa.toDateObject(t.date)),g(this,Ti,null)),(i=r(this,cs))==null||i.remove(),g(this,cs,null)}resetEdited(){var e;r(this,Ea)&&({contentsObj:he(this,Ti)._,richText:he(this,pn)._}=r(this,Ea),g(this,Ea,null),(e=r(this,cs))==null||e.remove(),g(this,cs,null),g(this,un,null))}remove(){var e,t,s;if((e=r(this,dn))==null||e.abort(),g(this,dn,null),(t=r(this,cs))==null||t.remove(),g(this,cs,null),g(this,lr,!1),g(this,Ci,!1),(s=r(this,de))==null||s.remove(),g(this,de,null),this.trigger)for(const i of this.trigger)i.classList.remove("popupTriggerArea")}forceHide(){g(this,lr,this.isVisible),r(this,lr)&&(r(this,Wt).hidden=!0)}maybeShow(){r(this,hs)||(w(this,lt,Ld).call(this),r(this,lr)&&(r(this,cs)||w(this,lt,Nd).call(this),g(this,lr,!1),r(this,Wt).hidden=!1))}get isVisible(){return r(this,hs)?!1:r(this,Wt).hidden===!1}}hs=new WeakMap,rr=new WeakMap,Iu=new WeakMap,Mu=new WeakMap,ul=new WeakMap,fl=new WeakMap,Wt=new WeakMap,Ti=new WeakMap,ar=new WeakMap,wa=new WeakMap,pl=new WeakMap,gl=new WeakMap,Ci=new WeakMap,cs=new WeakMap,dn=new WeakMap,un=new WeakMap,de=new WeakMap,fn=new WeakMap,or=new WeakMap,Mc=new WeakMap,pn=new WeakMap,ml=new WeakMap,Ea=new WeakMap,lr=new WeakMap,Oe=new WeakMap,hr=new WeakMap,lt=new WeakSet,Ld=function(){var t;if(r(this,dn))return;g(this,dn,new AbortController);const{signal:e}=r(this,dn);for(const s of this.trigger)s.addEventListener("click",r(this,ul),{signal:e}),s.addEventListener("pointerenter",r(this,Mu),{signal:e}),s.addEventListener("pointerleave",r(this,Iu),{signal:e}),s.classList.add("popupTriggerArea");for(const s of r(this,wa))(t=s.container)==null||t.addEventListener("keydown",r(this,rr),{signal:e})},Wf=function(){const e=r(this,wa).find(t=>t.hasCommentButton);e&&g(this,fn,e._normalizePoint(e.commentButtonPosition))},Xf=function(){if(r(this,Oe).extraPopupElement&&!r(this,Oe).editor)return;this.renderCommentButton();const[e,t]=r(this,fn),{style:s}=r(this,de);s.left=`calc(${e}%)`,s.top=`calc(${t}% - var(--comment-button-dim))`},Yf=function(){r(this,Oe).extraPopupElement||(this.renderCommentButton(),r(this,de).style.backgroundColor=this.commentButtonColor||"")},Od=function(){const e=r(this,pn),t=r(this,Ti);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&r(this,pn).html||null},Kf=function(){var e,t,s;return((s=(t=(e=r(this,lt,Od))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.fontSize)||0},Gm=function(){var e,t,s;return((s=(t=(e=r(this,lt,Od))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.color)||null},Wm=function(e){const t=[],s={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:r(this,lt,Gm),fontSize:r(this,lt,Kf)?`calc(${r(this,lt,Kf)}px * var(--total-scale-factor))`:""}};for(const n of e.split(`
`))t.push({name:"span",value:n,attributes:i});return s},Xm=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&r(this,Ci))&&w(this,lt,kd).call(this)},Ym=function(){if(r(this,un)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:s,pageX:i,pageY:n}}}=r(this,pl);let a=!!r(this,gl),o=a?r(this,gl):r(this,Mc);for(const m of r(this,wa))if(!o||j.intersect(m.data.rect,o)!==null){o=m.data.rect,a=!0;break}const l=j.normalizeRect([o[0],e[3]-o[1]+e[1],o[2],e[3]-o[3]+e[1]]),d=a?o[2]-o[0]+5:0,u=l[0]+d,f=l[1];g(this,un,[100*(u-i)/t,100*(f-n)/s]);const{style:p}=r(this,Wt);p.left=`${r(this,un)[0]}%`,p.top=`${r(this,un)[1]}%`},kd=function(){if(r(this,hs)){r(this,hs).toggleCommentPopup(this,!1);return}g(this,Ci,!r(this,Ci)),r(this,Ci)?(w(this,lt,Nd).call(this),r(this,Wt).addEventListener("click",r(this,ul)),r(this,Wt).addEventListener("keydown",r(this,rr))):(w(this,lt,Jf).call(this),r(this,Wt).removeEventListener("click",r(this,ul)),r(this,Wt).removeEventListener("keydown",r(this,rr)))},Nd=function(){r(this,cs)||this.render(),this.isVisible?r(this,Ci)&&r(this,Wt).classList.add("focused"):(w(this,lt,Ym).call(this),r(this,Wt).hidden=!1,r(this,Wt).style.zIndex=parseInt(r(this,Wt).style.zIndex)+1e3)},Jf=function(){r(this,Wt).classList.remove("focused"),!(r(this,Ci)||!this.isVisible)&&(r(this,Wt).hidden=!0,r(this,Wt).style.zIndex=parseInt(r(this,Wt).style.zIndex)-1e3)};class Km extends jt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=tt.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const s=document.createElement("span");s.textContent=t,e.append(s)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Dc;class vb extends jt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});y(this,Dc,null)}render(){this.container.classList.add("lineAnnotation");const{data:t,width:s,height:i}=this,n=this.svgFactory.create(s,i,!0),a=g(this,Dc,this.svgFactory.createElement("svg:line"));return a.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),a.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),a.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),a.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),a.setAttribute("stroke-width",t.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),n.append(a),this.container.append(n),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,Dc)}addHighlightArea(){this.container.classList.add("highlightArea")}}Dc=new WeakMap;var Lc;class yb extends jt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});y(this,Lc,null)}render(){this.container.classList.add("squareAnnotation");const{data:t,width:s,height:i}=this,n=this.svgFactory.create(s,i,!0),a=t.borderStyle.width,o=g(this,Lc,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",s-a),o.setAttribute("height",i-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,Lc)}addHighlightArea(){this.container.classList.add("highlightArea")}}Lc=new WeakMap;var Oc;class bb extends jt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});y(this,Oc,null)}render(){this.container.classList.add("circleAnnotation");const{data:t,width:s,height:i}=this,n=this.svgFactory.create(s,i,!0),a=t.borderStyle.width,o=g(this,Oc,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",s/2),o.setAttribute("cy",i/2),o.setAttribute("rx",s/2-a/2),o.setAttribute("ry",i/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,Oc)}addHighlightArea(){this.container.classList.add("highlightArea")}}Oc=new WeakMap;var kc;class Jm extends jt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});y(this,kc,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:s,borderStyle:i,popupRef:n},width:a,height:o}=this;if(!s)return this.container;const l=this.svgFactory.create(a,o,!0);let h=[];for(let u=0,f=s.length;u<f;u+=2){const p=s[u]-t[0],m=t[3]-s[u+1];h.push(`${p},${m}`)}h=h.join(" ");const d=g(this,kc,this.svgFactory.createElement(this.svgElementName));return d.setAttribute("points",h),d.setAttribute("stroke-width",i.width||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),l.append(d),this.container.append(l),!n&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,kc)}addHighlightArea(){this.container.classList.add("highlightArea")}}kc=new WeakMap;class Ab extends Jm{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class wb extends jt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var Nc,Sa,Fc,Qf;class Up extends jt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});y(this,Fc);y(this,Nc,null);y(this,Sa,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?tt.HIGHLIGHT:tt.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:s,inkLists:i,borderStyle:n,popupRef:a}}=this,{transform:o,width:l,height:h}=w(this,Fc,Qf).call(this,s,t),d=this.svgFactory.create(l,h,!0),u=g(this,Nc,this.svgFactory.createElement("svg:g"));d.append(u),u.setAttribute("stroke-width",n.width||1),u.setAttribute("stroke-linecap","round"),u.setAttribute("stroke-linejoin","round"),u.setAttribute("stroke-miterlimit",10),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),u.setAttribute("transform",o);for(let f=0,p=i.length;f<p;f++){const m=this.svgFactory.createElement(this.svgElementName);r(this,Sa).push(m),m.setAttribute("points",i[f].join(",")),u.append(m)}return!a&&this.hasPopupData&&this._createPopup(),this.container.append(d),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:s,points:i,rect:n}=t,a=r(this,Nc);if(s>=0&&a.setAttribute("stroke-width",s||1),i)for(let o=0,l=r(this,Sa).length;o<l;o++)r(this,Sa)[o].setAttribute("points",i[o].join(","));if(n){const{transform:o,width:l,height:h}=w(this,Fc,Qf).call(this,this.data.rotation,n);a.parentElement.setAttribute("viewBox",`0 0 ${l} ${h}`),a.setAttribute("transform",o)}}getElementsToTriggerPopup(){return r(this,Sa)}addHighlightArea(){this.container.classList.add("highlightArea")}}Nc=new WeakMap,Sa=new WeakMap,Fc=new WeakSet,Qf=function(t,s){switch(t){case 90:return{transform:`rotate(90) translate(${-s[0]},${s[1]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};case 180:return{transform:`rotate(180) translate(${-s[2]},${s[1]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]};case 270:return{transform:`rotate(270) translate(${-s[2]},${s[3]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};default:return{transform:`translate(${-s[0]},${s[3]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]}}};class Qm extends jt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=tt.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const s=document.createElement("mark");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class Eb extends jt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),e){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class Sb extends jt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),e){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class xb extends jt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),e){const s=document.createElement("s");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class Zm extends jt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=tt.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Bc,_c,Zf;class Tb extends jt{constructor(t){var i;super(t,{isRenderable:!0});y(this,_c);y(this,Bc,null);const{file:s}=this.data;this.filename=s.filename,this.content=s.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:s}=this;let i;s.hasAppearance||s.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(s.name)?"paperclip":"pushpin"}.svg`,s.fillAlpha&&s.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(s.fillAlpha*100)}%);`)),i.addEventListener("dblclick",w(this,_c,Zf).bind(this)),g(this,Bc,i);const{isMac:n}=ye.platform;return t.addEventListener("keydown",a=>{a.key==="Enter"&&(n?a.metaKey:a.ctrlKey)&&w(this,_c,Zf).call(this)}),!s.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return r(this,Bc)}addHighlightArea(){this.container.classList.add("highlightArea")}}Bc=new WeakMap,_c=new WeakSet,Zf=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var vl,xa,yl,cr,Uc,Ta,Ir,qf,tp;const Xp=class Xp{constructor({div:e,accessibilityManager:t,annotationCanvasMap:s,annotationEditorUIManager:i,page:n,viewport:a,structTreeLayer:o,commentManager:l,linkService:h,annotationStorage:d}){y(this,Ir);y(this,vl,null);y(this,xa,null);y(this,yl,null);y(this,cr,new Map);y(this,Uc,null);y(this,Ta,null);this.div=e,g(this,vl,t),g(this,xa,s),g(this,Uc,o||null),g(this,Ta,h||null),g(this,yl,d||new Op),this.page=n,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=i,this._commentManager=l||null}hasEditableAnnotations(){return r(this,cr).size>0}async render(e){var a,o,l;const{annotations:t}=e,s=this.div;Cr(s,this.viewport);const i=new Map,n={data:null,layer:s,linkService:r(this,Ta),downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new Sh,annotationStorage:r(this,yl),enableComment:e.enableComment===!0,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const h of t){if(h.noHTML)continue;const d=h.annotationType===Yt.POPUP;if(d){const p=i.get(h.id);if(!p)continue;n.elements=p}else if(h.rect[2]===h.rect[0]||h.rect[3]===h.rect[1])continue;n.data=h;const u=Eg.create(n);if(!u.isRenderable)continue;if(!d&&h.popupRef){const p=i.get(h.popupRef);p?p.push(u):i.set(h.popupRef,[u])}const f=u.render();h.hidden&&(f.style.visibility="hidden"),await w(this,Ir,qf).call(this,f,h.id,n.elements),(o=(a=u.extraPopupElement)==null?void 0:a.popup)==null||o.renderCommentButton(),u._isEditable&&(r(this,cr).set(u.data.id,u),(l=this._annotationEditorUIManager)==null||l.renderAnnotationElement(u))}w(this,Ir,tp).call(this)}async addLinkAnnotations(e){const t={data:null,layer:this.div,linkService:r(this,Ta),svgFactory:new Sh,parent:this};for(const s of e){s.borderStyle||(s.borderStyle=Xp._defaultBorderStyle),t.data=s;const i=Eg.create(t);if(!i.isRenderable)continue;const n=i.render();await w(this,Ir,qf).call(this,n,s.id,null)}}update({viewport:e}){const t=this.div;this.viewport=e,Cr(t,{rotation:e.rotation}),w(this,Ir,tp).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(r(this,cr).values())}getEditableAnnotation(e){return r(this,cr).get(e)}addFakeAnnotation(e){var o;const{div:t}=this,{id:s,rotation:i}=e,n=new hb({data:{id:s,rect:e.getPDFRect(),rotation:i},editor:e,layer:t,parent:this,enableComment:!!this._commentManager,linkService:r(this,Ta),annotationStorage:r(this,yl)}),a=n.render();return t.append(a),(o=r(this,vl))==null||o.moveElementInDOM(t,a,a,!1),n.createOrUpdatePopup(),n}static get _defaultBorderStyle(){return at(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:qa.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};vl=new WeakMap,xa=new WeakMap,yl=new WeakMap,cr=new WeakMap,Uc=new WeakMap,Ta=new WeakMap,Ir=new WeakSet,qf=async function(e,t,s){var o,l;const i=e.firstChild||e,n=i.id=`${Mp}${t}`,a=await((o=r(this,Uc))==null?void 0:o.getAriaAttributes(n));if(a)for(const[h,d]of a)i.setAttribute(h,d);s?s.at(-1).container.after(e):(this.div.append(e),(l=r(this,vl))==null||l.moveElementInDOM(this.div,e,i,!1))},tp=function(){var t;if(!r(this,xa))return;const e=this.div;for(const[s,i]of r(this,xa)){const n=e.querySelector(`[data-annotation-id="${s}"]`);if(!n)continue;i.className="annotationContent";const{firstChild:a}=n;a?a.nodeName==="CANVAS"?a.replaceWith(i):a.classList.contains("annotationContent")?a.after(i):a.before(i):n.append(i);const o=r(this,cr).get(s);o&&(o._hasNoCanvas?((t=this._annotationEditorUIManager)==null||t.setMissingCanvas(s,n.id,i),o._hasNoCanvas=!1):o.canvas=i)}r(this,xa).clear()};let au=Xp;const bd=/\r\n?|\n/g;var ds,Hc,Ca,us,ee,qm,tv,ev,Fd,Cn,Bd,_d,sv,sp,iv;const Nt=class Nt extends Ot{constructor(t){super({...t,name:"freeTextEditor"});y(this,ee);y(this,ds,"");y(this,Hc,`${this.id}-editor`);y(this,Ca,null);y(this,us);M(this,"_colorPicker",null);this.color=t.color||Nt._defaultColor||Ot._defaultLineColor,g(this,us,t.fontSize||Nt._defaultFontSize),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static get _keyboardManager(){const t=Nt.prototype,s=a=>a.isEmpty(),i=Pr.TRANSLATE_SMALL,n=Pr.TRANSLATE_BIG;return at(this,"_keyboardManager",new od([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-n,0],checker:s}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[n,0],checker:s}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-n],checker:s}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,n],checker:s}]]))}static initialize(t,s){Ot.initialize(t,s);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,s){switch(t){case dt.FREETEXT_SIZE:Nt._defaultFontSize=s;break;case dt.FREETEXT_COLOR:Nt._defaultColor=s;break}}updateParams(t,s){switch(t){case dt.FREETEXT_SIZE:w(this,ee,qm).call(this,s);break;case dt.FREETEXT_COLOR:w(this,ee,tv).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[dt.FREETEXT_SIZE,Nt._defaultFontSize],[dt.FREETEXT_COLOR,Nt._defaultColor||Ot._defaultLineColor]]}get propertiesToUpdate(){return[[dt.FREETEXT_SIZE,r(this,us)],[dt.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new ru(this)),[["colorPicker",this._colorPicker]]}get colorType(){return dt.FREETEXT_COLOR}onUpdatedColor(){var t;this.editorDiv.style.color=this.color,(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_translateEmpty(t,s){this._uiManager.translateSelectedEditors(t,s,!0)}getInitialTranslation(){const t=this.parentScale;return[-Nt._internalPadding*t,-(Nt._internalPadding+r(this,us))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),g(this,Ca,new AbortController);const t=this._uiManager.combinedSignal(r(this,Ca));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){var t;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",r(this,Hc)),this._isDraggable=!0,(t=r(this,Ca))==null||t.abort(),g(this,Ca,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var s;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(s=this._initialOptions)!=null&&s.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=r(this,ds),s=g(this,ds,w(this,ee,ev).call(this).trimEnd());if(t===s)return;const i=n=>{if(g(this,ds,n),!n){this.remove();return}w(this,ee,_d).call(this),this._uiManager.rebuild(this),w(this,ee,Fd).call(this)};this.addCommands({cmd:()=>{i(s)},undo:()=>{i(t)},mustExec:!1}),w(this,ee,Fd).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Nt._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,s;(this._isCopy||this.annotationElementId)&&(t=this.x,s=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",r(this,Hc)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${r(this,us)}px * var(--total-scale-factor))`,i.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[n,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[l,h]=this.getInitialTranslation();[l,h]=this.pageTranslationToScreen(l,h);const[d,u]=this.pageDimensions,[f,p]=this.pageTranslation;let m,v;switch(this.rotation){case 0:m=t+(o[0]-f)/d,v=s+this.height-(o[1]-p)/u;break;case 90:m=t+(o[0]-f)/d,v=s-(o[1]-p)/u,[l,h]=[h,-l];break;case 180:m=t-this.width+(o[0]-f)/d,v=s-(o[1]-p)/u,[l,h]=[-l,-h];break;case 270:m=t+(o[0]-f-this.height*u)/d,v=s+(o[1]-p-this.width*d)/u,[l,h]=[-h,l];break}this.setAt(m*n,v*a,l,h)}else this._moveAfterPaste(t,s);w(this,ee,_d).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var m,v,A;const s=t.clipboardData||window.clipboardData,{types:i}=s;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();const n=w(m=Nt,Cn,sp).call(m,s.getData("text")||"").replaceAll(bd,`
`);if(!n)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();const o=a.getRangeAt(0);if(!n.includes(`
`)){o.insertNode(document.createTextNode(n)),this.editorDiv.normalize(),a.collapseToStart();return}const{startContainer:l,startOffset:h}=o,d=[],u=[];if(l.nodeType===Node.TEXT_NODE){const b=l.parentElement;if(u.push(l.nodeValue.slice(h).replaceAll(bd,"")),b!==this.editorDiv){let S=d;for(const E of this.editorDiv.childNodes){if(E===b){S=u;continue}S.push(w(v=Nt,Cn,Bd).call(v,E))}}d.push(l.nodeValue.slice(0,h).replaceAll(bd,""))}else if(l===this.editorDiv){let b=d,S=0;for(const E of this.editorDiv.childNodes)S++===h&&(b=u),b.push(w(A=Nt,Cn,Bd).call(A,E))}g(this,ds,`${d.join(`
`)}${n}${u.join(`
`)}`),w(this,ee,_d).call(this);const f=new Range;let p=Math.sumPrecise(d.map(b=>b.length));for(const{firstChild:b}of this.editorDiv.childNodes)if(b.nodeType===Node.TEXT_NODE){const S=b.nodeValue.length;if(p<=S){f.setStart(b,p),f.setEnd(b,p);break}p-=S}a.removeAllRanges(),a.addRange(f)}get contentDiv(){return this.editorDiv}getPDFRect(){const t=Nt._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,s,i){var o;let n=null;if(t instanceof Km){const{data:{defaultAppearanceData:{fontSize:l,fontColor:h},rect:d,rotation:u,id:f,popupRef:p,richText:m,contentsObj:v,creationDate:A,modificationDate:b},textContent:S,textPosition:E,parent:{page:{pageNumber:T}}}=t;if(!S||S.length===0)return null;n=t={annotationType:tt.FREETEXT,color:Array.from(h),fontSize:l,value:S.join(`
`),position:E,pageIndex:T-1,rect:d.slice(0),rotation:u,annotationElementId:f,id:f,deleted:!1,popupRef:p,comment:(v==null?void 0:v.str)||null,richText:m,creationDate:A,modificationDate:b}}const a=await super.deserialize(t,s,i);return g(a,us,t.fontSize),a.color=j.makeHexColor(...t.color),g(a,ds,w(o=Nt,Cn,sp).call(o,t.value)),a._initialData=n,t.comment&&a.setCommentData(t),a}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=Ot._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),i=Object.assign(super.serialize(t),{color:s,fontSize:r(this,us),value:w(this,ee,sv).call(this)});return this.addComment(i),t?(i.isCopy=!0,i):this.annotationElementId&&!w(this,ee,iv).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){const s=super.renderAnnotationElement(t);if(!s)return null;const{style:i}=s;i.fontSize=`calc(${r(this,us)}px * var(--total-scale-factor))`,i.color=this.color,s.replaceChildren();for(const n of r(this,ds).split(`
`)){const a=document.createElement("div");a.append(n?document.createTextNode(n):document.createElement("br")),s.append(a)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:r(this,ds)}}),s}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};ds=new WeakMap,Hc=new WeakMap,Ca=new WeakMap,us=new WeakMap,ee=new WeakSet,qm=function(t){const s=n=>{this.editorDiv.style.fontSize=`calc(${n}px * var(--total-scale-factor))`,this.translate(0,-(n-r(this,us))*this.parentScale),g(this,us,n),w(this,ee,Fd).call(this)},i=r(this,us);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:dt.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},tv=function(t){const s=n=>{this.color=n,this.onUpdatedColor()},i=this.color;this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:dt.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},ev=function(){var i;const t=[];this.editorDiv.normalize();let s=null;for(const n of this.editorDiv.childNodes)(s==null?void 0:s.nodeType)===Node.TEXT_NODE&&n.nodeName==="BR"||(t.push(w(i=Nt,Cn,Bd).call(i,n)),s=n);return t.join(`
`)},Fd=function(){const[t,s]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:n,div:a}=this,o=a.style.display,l=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",n.div.append(this.div),i=a.getBoundingClientRect(),a.remove(),a.style.display=o,a.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/s):(this.width=i.height/t,this.height=i.width/s),this.fixAndSetPosition()},Cn=new WeakSet,Bd=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(bd,"")},_d=function(){if(this.editorDiv.replaceChildren(),!!r(this,ds))for(const t of r(this,ds).split(`
`)){const s=document.createElement("div");s.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(s)}},sv=function(){return r(this,ds).replaceAll(" "," ")},sp=function(t){return t.replaceAll(" "," ")},iv=function(t){const{value:s,fontSize:i,color:n,pageIndex:a}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==s||t.fontSize!==i||t.color.some((o,l)=>o!==n[l])||t.pageIndex!==a},y(Nt,Cn),M(Nt,"_freeTextDefaultContent",""),M(Nt,"_internalPadding",0),M(Nt,"_defaultColor",null),M(Nt,"_defaultFontSize",10),M(Nt,"_type","freetext"),M(Nt,"_editorType",tt.FREETEXT);let ep=Nt;class V{toSVGPath(){Mt("Abstract method `toSVGPath` must be implemented.")}get box(){Mt("Abstract getter `box` must be implemented.")}serialize(e,t){Mt("Abstract method `serialize` must be implemented.")}static _rescale(e,t,s,i,n,a){a||(a=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o]*i,a[o+1]=s+e[o+1]*n;return a}static _rescaleAndSwap(e,t,s,i,n,a){a||(a=new Float32Array(e.length));for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o+1]*i,a[o+1]=s+e[o]*n;return a}static _translate(e,t,s,i){i||(i=new Float32Array(e.length));for(let n=0,a=e.length;n<a;n+=2)i[n]=t+e[n],i[n+1]=s+e[n+1];return i}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,s,i,n){switch(n){case 90:return[1-t/s,e/i];case 180:return[1-e/s,1-t/i];case 270:return[t/s,1-e/i];default:return[e/s,t/i]}}static _normalizePagePoint(e,t,s){switch(s){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,s,i,n,a){return[(e+5*s)/6,(t+5*i)/6,(5*s+n)/6,(5*i+a)/6,(s+n)/2,(i+a)/2]}}M(V,"PRECISION",1e-4);var fs,Qs,bl,Al,Pi,ct,Pa,Ra,$c,jc,wl,El,dr,zc,Du,Lu,oe,dh,nv,rv,av,ov,lv,hv;const $i=class $i{constructor({x:e,y:t},s,i,n,a,o=0){y(this,oe);y(this,fs);y(this,Qs,[]);y(this,bl);y(this,Al);y(this,Pi,[]);y(this,ct,new Float32Array(18));y(this,Pa);y(this,Ra);y(this,$c);y(this,jc);y(this,wl);y(this,El);y(this,dr,[]);g(this,fs,s),g(this,El,n*i),g(this,Al,a),r(this,ct).set([NaN,NaN,NaN,NaN,e,t],6),g(this,bl,o),g(this,jc,r($i,zc)*i),g(this,$c,r($i,Lu)*i),g(this,wl,i),r(this,dr).push(e,t)}isEmpty(){return isNaN(r(this,ct)[8])}add({x:e,y:t}){var R;g(this,Pa,e),g(this,Ra,t);const[s,i,n,a]=r(this,fs);let[o,l,h,d]=r(this,ct).subarray(8,12);const u=e-h,f=t-d,p=Math.hypot(u,f);if(p<r(this,$c))return!1;const m=p-r(this,jc),v=m/p,A=v*u,b=v*f;let S=o,E=l;o=h,l=d,h+=A,d+=b,(R=r(this,dr))==null||R.push(e,t);const T=-b/m,x=A/m,C=T*r(this,El),P=x*r(this,El);return r(this,ct).set(r(this,ct).subarray(2,8),0),r(this,ct).set([h+C,d+P],4),r(this,ct).set(r(this,ct).subarray(14,18),12),r(this,ct).set([h-C,d-P],16),isNaN(r(this,ct)[6])?(r(this,Pi).length===0&&(r(this,ct).set([o+C,l+P],2),r(this,Pi).push(NaN,NaN,NaN,NaN,(o+C-s)/n,(l+P-i)/a),r(this,ct).set([o-C,l-P],14),r(this,Qs).push(NaN,NaN,NaN,NaN,(o-C-s)/n,(l-P-i)/a)),r(this,ct).set([S,E,o,l,h,d],6),!this.isEmpty()):(r(this,ct).set([S,E,o,l,h,d],6),Math.abs(Math.atan2(E-l,S-o)-Math.atan2(b,A))<Math.PI/2?([o,l,h,d]=r(this,ct).subarray(2,6),r(this,Pi).push(NaN,NaN,NaN,NaN,((o+h)/2-s)/n,((l+d)/2-i)/a),[o,l,S,E]=r(this,ct).subarray(14,18),r(this,Qs).push(NaN,NaN,NaN,NaN,((S+o)/2-s)/n,((E+l)/2-i)/a),!0):([S,E,o,l,h,d]=r(this,ct).subarray(0,6),r(this,Pi).push(((S+5*o)/6-s)/n,((E+5*l)/6-i)/a,((5*o+h)/6-s)/n,((5*l+d)/6-i)/a,((o+h)/2-s)/n,((l+d)/2-i)/a),[h,d,o,l,S,E]=r(this,ct).subarray(12,18),r(this,Qs).push(((S+5*o)/6-s)/n,((E+5*l)/6-i)/a,((5*o+h)/6-s)/n,((5*l+d)/6-i)/a,((o+h)/2-s)/n,((l+d)/2-i)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const e=r(this,Pi),t=r(this,Qs);if(isNaN(r(this,ct)[6])&&!this.isEmpty())return w(this,oe,nv).call(this);const s=[];s.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);w(this,oe,av).call(this,s);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return w(this,oe,rv).call(this,s),s.join(" ")}newFreeDrawOutline(e,t,s,i,n,a){return new cv(e,t,s,i,n,a)}getOutlines(){var u;const e=r(this,Pi),t=r(this,Qs),s=r(this,ct),[i,n,a,o]=r(this,fs),l=new Float32Array((((u=r(this,dr))==null?void 0:u.length)??0)+2);for(let f=0,p=l.length-2;f<p;f+=2)l[f]=(r(this,dr)[f]-i)/a,l[f+1]=(r(this,dr)[f+1]-n)/o;if(l[l.length-2]=(r(this,Pa)-i)/a,l[l.length-1]=(r(this,Ra)-n)/o,isNaN(s[6])&&!this.isEmpty())return w(this,oe,ov).call(this,l);const h=new Float32Array(r(this,Pi).length+24+r(this,Qs).length);let d=e.length;for(let f=0;f<d;f+=2){if(isNaN(e[f])){h[f]=h[f+1]=NaN;continue}h[f]=e[f],h[f+1]=e[f+1]}d=w(this,oe,hv).call(this,h,d);for(let f=t.length-6;f>=6;f-=6)for(let p=0;p<6;p+=2){if(isNaN(t[f+p])){h[d]=h[d+1]=NaN,d+=2;continue}h[d]=t[f+p],h[d+1]=t[f+p+1],d+=2}return w(this,oe,lv).call(this,h,d),this.newFreeDrawOutline(h,l,r(this,fs),r(this,wl),r(this,bl),r(this,Al))}};fs=new WeakMap,Qs=new WeakMap,bl=new WeakMap,Al=new WeakMap,Pi=new WeakMap,ct=new WeakMap,Pa=new WeakMap,Ra=new WeakMap,$c=new WeakMap,jc=new WeakMap,wl=new WeakMap,El=new WeakMap,dr=new WeakMap,zc=new WeakMap,Du=new WeakMap,Lu=new WeakMap,oe=new WeakSet,dh=function(){const e=r(this,ct).subarray(4,6),t=r(this,ct).subarray(16,18),[s,i,n,a]=r(this,fs);return[(r(this,Pa)+(e[0]-t[0])/2-s)/n,(r(this,Ra)+(e[1]-t[1])/2-i)/a,(r(this,Pa)+(t[0]-e[0])/2-s)/n,(r(this,Ra)+(t[1]-e[1])/2-i)/a]},nv=function(){const[e,t,s,i]=r(this,fs),[n,a,o,l]=w(this,oe,dh).call(this);return`M${(r(this,ct)[2]-e)/s} ${(r(this,ct)[3]-t)/i} L${(r(this,ct)[4]-e)/s} ${(r(this,ct)[5]-t)/i} L${n} ${a} L${o} ${l} L${(r(this,ct)[16]-e)/s} ${(r(this,ct)[17]-t)/i} L${(r(this,ct)[14]-e)/s} ${(r(this,ct)[15]-t)/i} Z`},rv=function(e){const t=r(this,Qs);e.push(`L${t[4]} ${t[5]} Z`)},av=function(e){const[t,s,i,n]=r(this,fs),a=r(this,ct).subarray(4,6),o=r(this,ct).subarray(16,18),[l,h,d,u]=w(this,oe,dh).call(this);e.push(`L${(a[0]-t)/i} ${(a[1]-s)/n} L${l} ${h} L${d} ${u} L${(o[0]-t)/i} ${(o[1]-s)/n}`)},ov=function(e){const t=r(this,ct),[s,i,n,a]=r(this,fs),[o,l,h,d]=w(this,oe,dh).call(this),u=new Float32Array(36);return u.set([NaN,NaN,NaN,NaN,(t[2]-s)/n,(t[3]-i)/a,NaN,NaN,NaN,NaN,(t[4]-s)/n,(t[5]-i)/a,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,(t[16]-s)/n,(t[17]-i)/a,NaN,NaN,NaN,NaN,(t[14]-s)/n,(t[15]-i)/a],0),this.newFreeDrawOutline(u,e,r(this,fs),r(this,wl),r(this,bl),r(this,Al))},lv=function(e,t){const s=r(this,Qs);return e.set([NaN,NaN,NaN,NaN,s[4],s[5]],t),t+=6},hv=function(e,t){const s=r(this,ct).subarray(4,6),i=r(this,ct).subarray(16,18),[n,a,o,l]=r(this,fs),[h,d,u,f]=w(this,oe,dh).call(this);return e.set([NaN,NaN,NaN,NaN,(s[0]-n)/o,(s[1]-a)/l,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,u,f,NaN,NaN,NaN,NaN,(i[0]-n)/o,(i[1]-a)/l],t),t+=24},y($i,zc,8),y($i,Du,2),y($i,Lu,r($i,zc)+r($i,Du));let ou=$i;var Sl,Ia,gn,Vc,ps,Gc,Jt,Ou,dv;class cv extends V{constructor(t,s,i,n,a,o){super();y(this,Ou);y(this,Sl);y(this,Ia,new Float32Array(4));y(this,gn);y(this,Vc);y(this,ps);y(this,Gc);y(this,Jt);g(this,Jt,t),g(this,ps,s),g(this,Sl,i),g(this,Gc,n),g(this,gn,a),g(this,Vc,o),this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],w(this,Ou,dv).call(this,o);const[l,h,d,u]=r(this,Ia);for(let f=0,p=t.length;f<p;f+=2)t[f]=(t[f]-l)/d,t[f+1]=(t[f+1]-h)/u;for(let f=0,p=s.length;f<p;f+=2)s[f]=(s[f]-l)/d,s[f+1]=(s[f+1]-h)/u}toSVGPath(){const t=[`M${r(this,Jt)[4]} ${r(this,Jt)[5]}`];for(let s=6,i=r(this,Jt).length;s<i;s+=6){if(isNaN(r(this,Jt)[s])){t.push(`L${r(this,Jt)[s+4]} ${r(this,Jt)[s+5]}`);continue}t.push(`C${r(this,Jt)[s]} ${r(this,Jt)[s+1]} ${r(this,Jt)[s+2]} ${r(this,Jt)[s+3]} ${r(this,Jt)[s+4]} ${r(this,Jt)[s+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,s,i,n],a){const o=i-t,l=n-s;let h,d;switch(a){case 0:h=V._rescale(r(this,Jt),t,n,o,-l),d=V._rescale(r(this,ps),t,n,o,-l);break;case 90:h=V._rescaleAndSwap(r(this,Jt),t,s,o,l),d=V._rescaleAndSwap(r(this,ps),t,s,o,l);break;case 180:h=V._rescale(r(this,Jt),i,s,-o,l),d=V._rescale(r(this,ps),i,s,-o,l);break;case 270:h=V._rescaleAndSwap(r(this,Jt),i,n,-o,-l),d=V._rescaleAndSwap(r(this,ps),i,n,-o,-l);break}return{outline:Array.from(h),points:[Array.from(d)]}}get box(){return r(this,Ia)}newOutliner(t,s,i,n,a,o=0){return new ou(t,s,i,n,a,o)}getNewOutline(t,s){const[i,n,a,o]=r(this,Ia),[l,h,d,u]=r(this,Sl),f=a*d,p=o*u,m=i*d+l,v=n*u+h,A=this.newOutliner({x:r(this,ps)[0]*f+m,y:r(this,ps)[1]*p+v},r(this,Sl),r(this,Gc),t,r(this,Vc),s??r(this,gn));for(let b=2;b<r(this,ps).length;b+=2)A.add({x:r(this,ps)[b]*f+m,y:r(this,ps)[b+1]*p+v});return A.getOutlines()}}Sl=new WeakMap,Ia=new WeakMap,gn=new WeakMap,Vc=new WeakMap,ps=new WeakMap,Gc=new WeakMap,Jt=new WeakMap,Ou=new WeakSet,dv=function(t){const s=r(this,Jt);let i=s[4],n=s[5];const a=[i,n,i,n];let o=i,l=n,h=i,d=n;const u=t?Math.max:Math.min,f=new Float32Array(4);for(let m=6,v=s.length;m<v;m+=6){const A=s[m+4],b=s[m+5];isNaN(s[m])?(j.pointBoundingBox(A,b,a),l>b?(o=A,l=b):l===b&&(o=u(o,A)),d<b?(h=A,d=b):d===b&&(h=u(h,A))):(f[0]=f[1]=1/0,f[2]=f[3]=-1/0,j.bezierBoundingBox(i,n,...s.slice(m,m+6),f),j.rectBoundingBox(f[0],f[1],f[2],f[3],a),l>f[1]?(o=f[0],l=f[1]):l===f[1]&&(o=u(o,f[0])),d<f[3]?(h=f[2],d=f[3]):d===f[3]&&(h=u(h,f[2]))),i=A,n=b}const p=r(this,Ia);p[0]=a[0]-r(this,gn),p[1]=a[1]-r(this,gn),p[2]=a[2]-a[0]+2*r(this,gn),p[3]=a[3]-a[1]+2*r(this,gn),this.firstPoint=[o,l],this.lastPoint=[h,d]};var Wc,Xc,Yc,ur,Zs,Ve,uv,Ud,fv,pv,np;class ip{constructor(e,t=0,s=0,i=!0){y(this,Ve);y(this,Wc);y(this,Xc);y(this,Yc);y(this,ur,[]);y(this,Zs,[]);const n=[1/0,1/0,-1/0,-1/0],a=10**-4;for(const{x:v,y:A,width:b,height:S}of e){const E=Math.floor((v-t)/a)*a,T=Math.ceil((v+b+t)/a)*a,x=Math.floor((A-t)/a)*a,C=Math.ceil((A+S+t)/a)*a,P=[E,x,C,!0],I=[T,x,C,!1];r(this,ur).push(P,I),j.rectBoundingBox(E,x,T,C,n)}const o=n[2]-n[0]+2*s,l=n[3]-n[1]+2*s,h=n[0]-s,d=n[1]-s;let u=i?-1/0:1/0,f=1/0;const p=r(this,ur).at(i?-1:-2),m=[p[0],p[2]];for(const v of r(this,ur)){const[A,b,S,E]=v;!E&&i?b<f?(f=b,u=A):b===f&&(u=Math.max(u,A)):E&&!i&&(b<f?(f=b,u=A):b===f&&(u=Math.min(u,A))),v[0]=(A-h)/o,v[1]=(b-d)/l,v[2]=(S-d)/l}g(this,Wc,new Float32Array([h,d,o,l])),g(this,Xc,[u,f]),g(this,Yc,m)}getOutlines(){r(this,ur).sort((t,s)=>t[0]-s[0]||t[1]-s[1]||t[2]-s[2]);const e=[];for(const t of r(this,ur))t[3]?(e.push(...w(this,Ve,np).call(this,t)),w(this,Ve,fv).call(this,t)):(w(this,Ve,pv).call(this,t),e.push(...w(this,Ve,np).call(this,t)));return w(this,Ve,uv).call(this,e)}}Wc=new WeakMap,Xc=new WeakMap,Yc=new WeakMap,ur=new WeakMap,Zs=new WeakMap,Ve=new WeakSet,uv=function(e){const t=[],s=new Set;for(const a of e){const[o,l,h]=a;t.push([o,l,a],[o,h,a])}t.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=t.length;a<o;a+=2){const l=t[a][2],h=t[a+1][2];l.push(h),h.push(l),s.add(l),s.add(h)}const i=[];let n;for(;s.size>0;){const a=s.values().next().value;let[o,l,h,d,u]=a;s.delete(a);let f=o,p=l;for(n=[o,h],i.push(n);;){let m;if(s.has(d))m=d;else if(s.has(u))m=u;else break;s.delete(m),[o,l,h,d,u]=m,f!==o&&(n.push(f,p,o,p===l?l:h),f=o),p=p===l?h:l}n.push(f,p)}return new Cb(i,r(this,Wc),r(this,Xc),r(this,Yc))},Ud=function(e){const t=r(this,Zs);let s=0,i=t.length-1;for(;s<=i;){const n=s+i>>1,a=t[n][0];if(a===e)return n;a<e?s=n+1:i=n-1}return i+1},fv=function([,e,t]){const s=w(this,Ve,Ud).call(this,e);r(this,Zs).splice(s,0,[e,t])},pv=function([,e,t]){const s=w(this,Ve,Ud).call(this,e);for(let i=s;i<r(this,Zs).length;i++){const[n,a]=r(this,Zs)[i];if(n!==e)break;if(n===e&&a===t){r(this,Zs).splice(i,1);return}}for(let i=s-1;i>=0;i--){const[n,a]=r(this,Zs)[i];if(n!==e)break;if(n===e&&a===t){r(this,Zs).splice(i,1);return}}},np=function(e){const[t,s,i]=e,n=[[t,s,i]],a=w(this,Ve,Ud).call(this,i);for(let o=0;o<a;o++){const[l,h]=r(this,Zs)[o];for(let d=0,u=n.length;d<u;d++){const[,f,p]=n[d];if(!(h<=f||p<=l)){if(f>=l){if(p>h)n[d][1]=h;else{if(u===1)return[];n.splice(d,1),d--,u--}continue}n[d][2]=l,p>h&&n.push([t,h,p])}}}return n};var Kc,xl;class Cb extends V{constructor(t,s,i,n){super();y(this,Kc);y(this,xl);g(this,xl,t),g(this,Kc,s),this.firstPoint=i,this.lastPoint=n}toSVGPath(){const t=[];for(const s of r(this,xl)){let[i,n]=s;t.push(`M${i} ${n}`);for(let a=2;a<s.length;a+=2){const o=s[a],l=s[a+1];o===i?(t.push(`V${l}`),n=l):l===n&&(t.push(`H${o}`),i=o)}t.push("Z")}return t.join(" ")}serialize([t,s,i,n],a){const o=[],l=i-t,h=n-s;for(const d of r(this,xl)){const u=new Array(d.length);for(let f=0;f<d.length;f+=2)u[f]=t+d[f]*l,u[f+1]=n-d[f+1]*h;o.push(u)}return o}get box(){return r(this,Kc)}get classNamesForOutlining(){return["highlightOutline"]}}Kc=new WeakMap,xl=new WeakMap;class rp extends ou{newFreeDrawOutline(e,t,s,i,n,a){return new Pb(e,t,s,i,n,a)}}class Pb extends cv{newOutliner(e,t,s,i,n,a=0){return new rp(e,t,s,i,n,a)}}var Tl,Jc,mn,Ma,Qc,Ze,Zc,qc,Da,gs,ms,Se,Cl,Pl,ke,Rl,_s,td,ot,ap,Hd,gv,mv,vv,op,Or,Hs,ro,yv,$d,jd,bv,Av,wv,Ev,Sv;const vt=class vt extends Ot{constructor(t){super({...t,name:"highlightEditor"});y(this,ot);y(this,Tl,null);y(this,Jc,0);y(this,mn);y(this,Ma,null);y(this,Qc,null);y(this,Ze,null);y(this,Zc,null);y(this,qc,0);y(this,Da,null);y(this,gs,null);y(this,ms,null);y(this,Se,!1);y(this,Cl,null);y(this,Pl,null);y(this,ke,null);y(this,Rl,"");y(this,_s);y(this,td,"");this.color=t.color||vt._defaultColor,g(this,_s,t.thickness||vt._defaultThickness),this.opacity=t.opacity||vt._defaultOpacity,g(this,mn,t.boxes||null),g(this,td,t.methodOfCreation||""),g(this,Rl,t.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(g(this,Se,!0),w(this,ot,Hd).call(this,t),w(this,ot,Or).call(this)):r(this,mn)&&(g(this,Tl,t.anchorNode),g(this,Jc,t.anchorOffset),g(this,Zc,t.focusNode),g(this,qc,t.focusOffset),w(this,ot,ap).call(this),w(this,ot,Or).call(this),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}static get _keyboardManager(){const t=vt.prototype;return at(this,"_keyboardManager",new od([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:r(this,Se)?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:r(this,_s),methodOfCreation:r(this,td)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,s){var i;Ot.initialize(t,s),vt._defaultColor||(vt._defaultColor=((i=s.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(t,s){switch(t){case dt.HIGHLIGHT_COLOR:vt._defaultColor=s;break;case dt.HIGHLIGHT_THICKNESS:vt._defaultThickness=s;break}}translateInPage(t,s){}get toolbarPosition(){return r(this,Pl)}get commentButtonPosition(){return r(this,Cl)}updateParams(t,s){switch(t){case dt.HIGHLIGHT_COLOR:w(this,ot,gv).call(this,s);break;case dt.HIGHLIGHT_THICKNESS:w(this,ot,mv).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[dt.HIGHLIGHT_COLOR,vt._defaultColor],[dt.HIGHLIGHT_THICKNESS,vt._defaultThickness]]}get propertiesToUpdate(){return[[dt.HIGHLIGHT_COLOR,this.color||vt._defaultColor],[dt.HIGHLIGHT_THICKNESS,r(this,_s)||vt._defaultThickness],[dt.HIGHLIGHT_FREE,r(this,Se)]]}onUpdatedColor(){var t,s;(t=this.parent)==null||t.drawLayer.updateProperties(r(this,ms),{root:{fill:this.color,"fill-opacity":this.opacity}}),(s=r(this,Qc))==null||s.updateColor(this.color),super.onUpdatedColor()}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",g(this,Qc,new Eh({editor:this}))]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(w(this,ot,jd).call(this))}getBaseTranslation(){return[0,0]}getRect(t,s){return super.getRect(t,s,w(this,ot,jd).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){w(this,ot,op).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(w(this,ot,Or).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?w(this,ot,op).call(this):t&&(w(this,ot,Or).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),s&&this.select()}rotate(t){var n,a,o;const{drawLayer:s}=this.parent;let i;r(this,Se)?(t=(t-this.rotation+360)%360,i=w(n=vt,Hs,ro).call(n,r(this,gs).box,t)):i=w(a=vt,Hs,ro).call(a,[this.x,this.y,this.width,this.height],t),s.updateProperties(r(this,ms),{bbox:i,root:{"data-main-rotation":t}}),s.updateProperties(r(this,ke),{bbox:w(o=vt,Hs,ro).call(o,r(this,Ze).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();r(this,Rl)&&(t.setAttribute("aria-label",r(this,Rl)),t.setAttribute("role","mark")),r(this,Se)?t.classList.add("free"):this.div.addEventListener("keydown",w(this,ot,yv).bind(this),{signal:this._uiManager._signal});const s=g(this,Da,document.createElement("div"));return t.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",s.style.clipPath=r(this,Ma),this.setDims(this.width,this.height),Gg(this,r(this,Da),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(r(this,ke),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(r(this,ke),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:w(this,ot,$d).call(this,!0);break;case 1:case 3:w(this,ot,$d).call(this,!1);break}}select(){var t;super.select(),r(this,ke)&&((t=this.parent)==null||t.drawLayer.updateProperties(r(this,ke),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),r(this,ke)&&((t=this.parent)==null||t.drawLayer.updateProperties(r(this,ke),{rootClass:{selected:!1}}),r(this,Se)||w(this,ot,$d).call(this,!1))}get _mustFixPosition(){return!r(this,Se)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(r(this,ms),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(r(this,ke),{rootClass:{hidden:!t}}))}static startHighlighting(t,s,{target:i,x:n,y:a}){const{x:o,y:l,width:h,height:d}=i.getBoundingClientRect(),u=new AbortController,f=t.combinedSignal(u),p=m=>{u.abort(),w(this,Hs,Ev).call(this,t,m)};window.addEventListener("blur",p,{signal:f}),window.addEventListener("pointerup",p,{signal:f}),window.addEventListener("pointerdown",$t,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",Ts,{signal:f}),i.addEventListener("pointermove",w(this,Hs,wv).bind(this,t),{signal:f}),this._freeHighlight=new rp({x:n,y:a},[o,l,h,d],t.scale,this._defaultThickness/2,s,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,s,i){var v,A,b,S;let n=null;if(t instanceof Qm){const{data:{quadPoints:E,rect:T,rotation:x,id:C,color:P,opacity:I,popupRef:R,richText:L,contentsObj:D,creationDate:O,modificationDate:F},parent:{page:{pageNumber:B}}}=t;n=t={annotationType:tt.HIGHLIGHT,color:Array.from(P),opacity:I,quadPoints:E,boxes:null,pageIndex:B-1,rect:T.slice(0),rotation:x,annotationElementId:C,id:C,deleted:!1,popupRef:R,richText:L,comment:(D==null?void 0:D.str)||null,creationDate:O,modificationDate:F}}else if(t instanceof Up){const{data:{inkLists:E,rect:T,rotation:x,id:C,color:P,borderStyle:{rawWidth:I},popupRef:R,richText:L,contentsObj:D,creationDate:O,modificationDate:F},parent:{page:{pageNumber:B}}}=t;n=t={annotationType:tt.HIGHLIGHT,color:Array.from(P),thickness:I,inkLists:E,boxes:null,pageIndex:B-1,rect:T.slice(0),rotation:x,annotationElementId:C,id:C,deleted:!1,popupRef:R,richText:L,comment:(D==null?void 0:D.str)||null,creationDate:O,modificationDate:F}}const{color:a,quadPoints:o,inkLists:l,opacity:h}=t,d=await super.deserialize(t,s,i);d.color=j.makeHexColor(...a),d.opacity=h||1,l&&g(d,_s,t.thickness),d._initialData=n,t.comment&&d.setCommentData(t);const[u,f]=d.pageDimensions,[p,m]=d.pageTranslation;if(o){const E=g(d,mn,[]);for(let T=0;T<o.length;T+=8)E.push({x:(o[T]-p)/u,y:1-(o[T+1]-m)/f,width:(o[T+2]-o[T])/u,height:(o[T+1]-o[T+5])/f});w(v=d,ot,ap).call(v),w(A=d,ot,Or).call(A),d.rotate(d.rotation)}else if(l){g(d,Se,!0);const E=l[0],T={x:E[0]-p,y:f-(E[1]-m)},x=new rp(T,[0,0,u,f],1,r(d,_s)/2,!0,.001);for(let I=0,R=E.length;I<R;I+=2)T.x=E[I]-p,T.y=f-(E[I+1]-m),x.add(T);const{id:C,clipPathId:P}=s.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:d.color,"fill-opacity":d._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:x.toSVGPath()}},!0,!0);w(b=d,ot,Hd).call(b,{highlightOutlines:x.getOutlines(),highlightId:C,clipPathId:P}),w(S=d,ot,Or).call(S),d.rotate(d.parentRotation)}return d}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const s=Ot._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),i=super.serialize(t);return Object.assign(i,{color:s,opacity:this.opacity,thickness:r(this,_s),quadPoints:w(this,ot,bv).call(this),outlines:w(this,ot,Av).call(this,i.rect)}),this.addComment(i),this.annotationElementId&&!w(this,ot,Sv).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}};Tl=new WeakMap,Jc=new WeakMap,mn=new WeakMap,Ma=new WeakMap,Qc=new WeakMap,Ze=new WeakMap,Zc=new WeakMap,qc=new WeakMap,Da=new WeakMap,gs=new WeakMap,ms=new WeakMap,Se=new WeakMap,Cl=new WeakMap,Pl=new WeakMap,ke=new WeakMap,Rl=new WeakMap,_s=new WeakMap,td=new WeakMap,ot=new WeakSet,ap=function(){const t=new ip(r(this,mn),.001);g(this,gs,t.getOutlines()),[this.x,this.y,this.width,this.height]=r(this,gs).box;const s=new ip(r(this,mn),.0025,.001,this._uiManager.direction==="ltr");g(this,Ze,s.getOutlines());const{firstPoint:i}=r(this,gs);g(this,Cl,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]);const{lastPoint:n}=r(this,Ze);g(this,Pl,[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height])},Hd=function({highlightOutlines:t,highlightId:s,clipPathId:i}){var f,p;if(g(this,gs,t),g(this,Ze,t.getNewOutline(r(this,_s)/2+1.5,.0025)),s>=0)g(this,ms,s),g(this,Ma,i),this.parent.drawLayer.finalizeDraw(s,{bbox:t.box,path:{d:t.toSVGPath()}}),g(this,ke,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:r(this,Ze).box,path:{d:r(this,Ze).toSVGPath()}},!0));else if(this.parent){const m=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(r(this,ms),{bbox:w(f=vt,Hs,ro).call(f,r(this,gs).box,(m-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(r(this,ke),{bbox:w(p=vt,Hs,ro).call(p,r(this,Ze).box,m),path:{d:r(this,Ze).toSVGPath()}})}const[a,o,l,h]=t.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=l,this.height=h;break;case 90:{const[m,v]=this.parentDimensions;this.x=o,this.y=1-a,this.width=l*v/m,this.height=h*m/v;break}case 180:this.x=1-a,this.y=1-o,this.width=l,this.height=h;break;case 270:{const[m,v]=this.parentDimensions;this.x=1-o,this.y=a,this.width=l*v/m,this.height=h*m/v;break}}const{firstPoint:d}=t;g(this,Cl,[(d[0]-a)/l,(d[1]-o)/h]);const{lastPoint:u}=r(this,Ze);g(this,Pl,[(u[0]-a)/l,(u[1]-o)/h])},gv=function(t){const s=(a,o)=>{this.color=a,this.opacity=o,this.onUpdatedColor()},i=this.color,n=this.opacity;this.addCommands({cmd:s.bind(this,t,vt._defaultOpacity),undo:s.bind(this,i,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:dt.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)},mv=function(t){const s=r(this,_s),i=n=>{g(this,_s,n),w(this,ot,vv).call(this,n)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:dt.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},vv=function(t){r(this,Se)&&(w(this,ot,Hd).call(this,{highlightOutlines:r(this,gs).getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims(this.width,this.height))},op=function(){r(this,ms)===null||!this.parent||(this.parent.drawLayer.remove(r(this,ms)),g(this,ms,null),this.parent.drawLayer.remove(r(this,ke)),g(this,ke,null))},Or=function(t=this.parent){r(this,ms)===null&&({id:he(this,ms)._,clipPathId:he(this,Ma)._}=t.drawLayer.draw({bbox:r(this,gs).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:r(this,Se)},path:{d:r(this,gs).toSVGPath()}},!1,!0),g(this,ke,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:r(this,Se)},bbox:r(this,Ze).box,path:{d:r(this,Ze).toSVGPath()}},r(this,Se))),r(this,Da)&&(r(this,Da).style.clipPath=r(this,Ma)))},Hs=new WeakSet,ro=function([t,s,i,n],a){switch(a){case 90:return[1-s-n,t,n,i];case 180:return[1-t-i,1-s-n,i,n];case 270:return[s,1-t-i,n,i]}return[t,s,i,n]},yv=function(t){vt._keyboardManager.exec(this,t)},$d=function(t){if(!r(this,Tl))return;const s=window.getSelection();t?s.setPosition(r(this,Tl),r(this,Jc)):s.setPosition(r(this,Zc),r(this,qc))},jd=function(){return r(this,Se)?this.rotation:0},bv=function(){if(r(this,Se))return null;const[t,s]=this.pageDimensions,[i,n]=this.pageTranslation,a=r(this,mn),o=new Float32Array(a.length*8);let l=0;for(const{x:h,y:d,width:u,height:f}of a){const p=h*t+i,m=(1-d)*s+n;o[l]=o[l+4]=p,o[l+1]=o[l+3]=m,o[l+2]=o[l+6]=p+u*t,o[l+5]=o[l+7]=m-f*s,l+=8}return o},Av=function(t){return r(this,gs).serialize(t,w(this,ot,jd).call(this))},wv=function(t,s){this._freeHighlight.add(s)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},Ev=function(t,s){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(s,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},Sv=function(t){const{color:s}=this._initialData;return this.hasEditedComment||t.color.some((i,n)=>i!==s[n])},y(vt,Hs),M(vt,"_defaultColor",null),M(vt,"_defaultOpacity",1),M(vt,"_defaultThickness",12),M(vt,"_type","highlight"),M(vt,"_editorType",tt.HIGHLIGHT),M(vt,"_freeHighlightId",-1),M(vt,"_freeHighlight",null),M(vt,"_freeHighlightClipId","");let lu=vt;var La;class xv{constructor(){y(this,La,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,s]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,s)}updateSVGProperty(e,t){r(this,La)[e]=t}toSVGProperties(){const e=r(this,La);return g(this,La,Object.create(null)),{root:e}}reset(){g(this,La,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){Mt("Not implemented")}}La=new WeakMap;var vs,Il,ue,Oa,ka,fr,pr,gr,Na,ft,lp,hp,cp,uh,Tv,zd,fh,ao;const G=class G extends Ot{constructor(t){super(t);y(this,ft);y(this,vs,null);y(this,Il);M(this,"_colorPicker",null);M(this,"_drawId",null);g(this,Il,t.mustBeCommitted||!1),this._addOutlines(t)}onUpdatedColor(){var t;(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(w(this,ft,lp).call(this,t),w(this,ft,uh).call(this))}static _mergeSVGProperties(t,s){const i=new Set(Object.keys(t));for(const[n,a]of Object.entries(s))i.has(n)?Object.assign(t[n],a):t[n]=a;return t}static getDefaultDrawingOptions(t){Mt("Not implemented")}static get typesMap(){Mt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,s){const i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,s),this._currentParent&&(r(G,ue).updateProperty(i,s),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,s){const i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,s)}static get defaultPropertiesToUpdate(){const t=[],s=this._defaultDrawingOptions;for(const[i,n]of this.typesMap)t.push([i,s[n]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:s}=this;for(const[i,n]of this.constructor.typesMap)t.push([i,s[n]]);return t}_updateProperty(t,s,i){const n=this._drawingOptions,a=n[s],o=l=>{var d;n.updateProperty(s,l);const h=r(this,vs).updateProperty(s,l);h&&w(this,ft,fh).call(this,h),(d=this.parent)==null||d.drawLayer.updateProperties(this._drawId,n.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:o.bind(this,i),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,G._mergeSVGProperties(r(this,vs).getPathResizingSVGProperties(w(this,ft,zd).call(this)),{bbox:w(this,ft,ao).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,G._mergeSVGProperties(r(this,vs).getPathResizedSVGProperties(w(this,ft,zd).call(this)),{bbox:w(this,ft,ao).call(this)}))}_onTranslating(t,s){var i;(i=this.parent)==null||i.drawLayer.updateProperties(this._drawId,{bbox:w(this,ft,ao).call(this)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,G._mergeSVGProperties(r(this,vs).getPathTranslatedSVGProperties(w(this,ft,zd).call(this),this.parentDimensions),{bbox:w(this,ft,ao).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,r(this,Il)&&(g(this,Il,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){w(this,ft,cp).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(w(this,ft,uh).call(this),w(this,ft,fh).call(this,r(this,vs).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),w(this,ft,cp).call(this)):t&&(this._uiManager.addShouldRescale(this),w(this,ft,uh).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),s&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,G._mergeSVGProperties({bbox:w(this,ft,ao).call(this)},r(this,vs).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&w(this,ft,fh).call(this,r(this,vs).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,s;this._isCopy&&(t=this.x,s=this.y);const i=super.render();i.classList.add("draw");const n=document.createElement("div");return i.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,s),i}static createDrawerInstance(t,s,i,n,a){Mt("Not implemented")}static startDrawing(t,s,i,n){var A;const{target:a,offsetX:o,offsetY:l,pointerId:h,pointerType:d}=n;if(r(G,pr)&&r(G,pr)!==d)return;const{viewport:{rotation:u}}=t,{width:f,height:p}=a.getBoundingClientRect(),m=g(G,Oa,new AbortController),v=t.combinedSignal(m);if(r(G,fr)||g(G,fr,h),r(G,pr)??g(G,pr,d),window.addEventListener("pointerup",b=>{var S;r(G,fr)===b.pointerId?this._endDraw(b):(S=r(G,gr))==null||S.delete(b.pointerId)},{signal:v}),window.addEventListener("pointercancel",b=>{var S;r(G,fr)===b.pointerId?this._currentParent.endDrawingSession():(S=r(G,gr))==null||S.delete(b.pointerId)},{signal:v}),window.addEventListener("pointerdown",b=>{r(G,pr)===b.pointerType&&((r(G,gr)||g(G,gr,new Set)).add(b.pointerId),r(G,ue).isCancellable()&&(r(G,ue).removeLastElement(),r(G,ue).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:v}),window.addEventListener("contextmenu",Ts,{signal:v}),a.addEventListener("pointermove",this._drawMove.bind(this),{signal:v}),a.addEventListener("touchmove",b=>{b.timeStamp===r(G,Na)&&$t(b)},{signal:v}),t.toggleDrawing(),(A=s._editorUndoBar)==null||A.hide(),r(G,ue)){t.drawLayer.updateProperties(this._currentDrawId,r(G,ue).startNew(o,l,f,p,u));return}s.updateUIForDefaultProperties(this),g(G,ue,this.createDrawerInstance(o,l,f,p,u)),g(G,ka,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(r(G,ka).toSVGProperties(),r(G,ue).defaultSVGProperties),!0,!1)}static _drawMove(t){var a;if(g(G,Na,-1),!r(G,ue))return;const{offsetX:s,offsetY:i,pointerId:n}=t;if(r(G,fr)===n){if(((a=r(G,gr))==null?void 0:a.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,r(G,ue).add(s,i)),g(G,Na,t.timeStamp),$t(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,g(G,ue,null),g(G,ka,null),g(G,pr,null),g(G,Na,NaN)),r(G,Oa)&&(r(G,Oa).abort(),g(G,Oa,null),g(G,fr,NaN),g(G,gr,null))}static _endDraw(t){const s=this._currentParent;if(s){if(s.toggleDrawing(!0),this._cleanup(!1),(t==null?void 0:t.target)===s.div&&s.drawLayer.updateProperties(this._currentDrawId,r(G,ue).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const i=r(G,ue),n=this._currentDrawId,a=i.getLastElement();s.addCommands({cmd:()=>{s.drawLayer.updateProperties(n,i.setLastElement(a))},undo:()=>{s.drawLayer.updateProperties(n,i.removeLastElement())},mustExec:!1,type:dt.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const s=this._currentParent;if(!s)return null;if(s.toggleDrawing(!0),s.cleanUndoStack(dt.DRAW_STEP),!r(G,ue).isEmpty()){const{pageDimensions:[i,n],scale:a}=s,o=s.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:r(G,ue).getOutlines(i*a,n*a,a,this._INNER_MARGIN),drawingOptions:r(G,ka),mustBeCommitted:!t});return this._cleanup(!0),o}return s.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,s,i,n,a,o){Mt("Not implemented")}static async deserialize(t,s,i){var u,f;const{rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:l}}=s.viewport,h=this.deserializeDraw(o,l,n,a,this._INNER_MARGIN,t),d=await super.deserialize(t,s,i);return d.createDrawingOptions(t),w(u=d,ft,lp).call(u,{drawOutlines:h}),w(f=d,ft,uh).call(f),d.onScaleChanging(),d.rotate(),d}serializeDraw(t){const[s,i]=this.pageTranslation,[n,a]=this.pageDimensions;return r(this,vs).serialize([s,i,n,a],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}};vs=new WeakMap,Il=new WeakMap,ue=new WeakMap,Oa=new WeakMap,ka=new WeakMap,fr=new WeakMap,pr=new WeakMap,gr=new WeakMap,Na=new WeakMap,ft=new WeakSet,lp=function({drawOutlines:t,drawId:s,drawingOptions:i}){g(this,vs,t),this._drawingOptions||(this._drawingOptions=i),this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),s>=0?(this._drawId=s,this.parent.drawLayer.finalizeDraw(s,t.defaultProperties)):this._drawId=w(this,ft,hp).call(this,t,this.parent),w(this,ft,fh).call(this,t.box)},hp=function(t,s){const{id:i}=s.drawLayer.draw(G._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i},cp=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},uh=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=w(this,ft,hp).call(this,r(this,vs),t)}},Tv=function([t,s,i,n]){const{parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[s,1-t,i*(o/a),n*(a/o)];case 180:return[1-t,1-s,i,n];case 270:return[1-s,t,i*(o/a),n*(a/o)];default:return[t,s,i,n]}},zd=function(){const{x:t,y:s,width:i,height:n,parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[1-s,t,i*(a/o),n*(o/a)];case 180:return[1-t,1-s,i,n];case 270:return[s,1-t,i*(a/o),n*(o/a)];default:return[t,s,i,n]}},fh=function(t){[this.x,this.y,this.width,this.height]=w(this,ft,Tv).call(this,t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()},ao=function(){const{x:t,y:s,width:i,height:n,rotation:a,parentRotation:o,parentDimensions:[l,h]}=this;switch((a*4+o)/90){case 1:return[1-s-n,t,n,i];case 2:return[1-t-i,1-s-n,i,n];case 3:return[s,1-t-i,n,i];case 4:return[t,s-i*(l/h),n*(h/l),i*(l/h)];case 5:return[1-s,t,i*(l/h),n*(h/l)];case 6:return[1-t-n*(h/l),1-s,n*(h/l),i*(l/h)];case 7:return[s-i*(l/h),1-t-n*(h/l),i*(l/h),n*(h/l)];case 8:return[t-i,s-n,i,n];case 9:return[1-s,t-i,n,i];case 10:return[1-t,1-s,i,n];case 11:return[s-n,1-t,n,i];case 12:return[t-n*(h/l),s,n*(h/l),i*(l/h)];case 13:return[1-s-i*(l/h),t-n*(h/l),i*(l/h),n*(h/l)];case 14:return[1-t,1-s-i*(l/h),n*(h/l),i*(l/h)];case 15:return[s,1-t,i*(l/h),n*(h/l)];default:return[t,s,i,n]}},M(G,"_currentDrawId",-1),M(G,"_currentParent",null),y(G,ue,null),y(G,Oa,null),y(G,ka,null),y(G,fr,NaN),y(G,pr,null),y(G,gr,null),y(G,Na,NaN),M(G,"_INNER_MARGIN",3);let hu=G;var Ri,fe,pe,Fa,Ml,Ue,xe,Us,Ba,_a,Ua,Dl,Vd;class Rb{constructor(e,t,s,i,n,a){y(this,Dl);y(this,Ri,new Float64Array(6));y(this,fe);y(this,pe);y(this,Fa);y(this,Ml);y(this,Ue);y(this,xe,"");y(this,Us,0);y(this,Ba,new hd);y(this,_a);y(this,Ua);g(this,_a,s),g(this,Ua,i),g(this,Fa,n),g(this,Ml,a),[e,t]=w(this,Dl,Vd).call(this,e,t);const o=g(this,fe,[NaN,NaN,NaN,NaN,e,t]);g(this,Ue,[e,t]),g(this,pe,[{line:o,points:r(this,Ue)}]),r(this,Ri).set(o,0)}updateProperty(e,t){e==="stroke-width"&&g(this,Ml,t)}isEmpty(){return!r(this,pe)||r(this,pe).length===0}isCancellable(){return r(this,Ue).length<=10}add(e,t){[e,t]=w(this,Dl,Vd).call(this,e,t);const[s,i,n,a]=r(this,Ri).subarray(2,6),o=e-n,l=t-a;return Math.hypot(r(this,_a)*o,r(this,Ua)*l)<=2?null:(r(this,Ue).push(e,t),isNaN(s)?(r(this,Ri).set([n,a,e,t],2),r(this,fe).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(r(this,Ri)[0])&&r(this,fe).splice(6,6),r(this,Ri).set([s,i,n,a,e,t],0),r(this,fe).push(...V.createBezierPoints(s,i,n,a,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const s=this.add(e,t);return s||(r(this,Ue).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,s,i,n){g(this,_a,s),g(this,Ua,i),g(this,Fa,n),[e,t]=w(this,Dl,Vd).call(this,e,t);const a=g(this,fe,[NaN,NaN,NaN,NaN,e,t]);g(this,Ue,[e,t]);const o=r(this,pe).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),r(this,pe).push({line:a,points:r(this,Ue)}),r(this,Ri).set(a,0),g(this,Us,0),this.toSVGPath(),null}getLastElement(){return r(this,pe).at(-1)}setLastElement(e){return r(this,pe)?(r(this,pe).push(e),g(this,fe,e.line),g(this,Ue,e.points),g(this,Us,0),{path:{d:this.toSVGPath()}}):r(this,Ba).setLastElement(e)}removeLastElement(){if(!r(this,pe))return r(this,Ba).removeLastElement();r(this,pe).pop(),g(this,xe,"");for(let e=0,t=r(this,pe).length;e<t;e++){const{line:s,points:i}=r(this,pe)[e];g(this,fe,s),g(this,Ue,i),g(this,Us,0),this.toSVGPath()}return{path:{d:r(this,xe)}}}toSVGPath(){const e=V.svgRound(r(this,fe)[4]),t=V.svgRound(r(this,fe)[5]);if(r(this,Ue).length===2)return g(this,xe,`${r(this,xe)} M ${e} ${t} Z`),r(this,xe);if(r(this,Ue).length<=6){const i=r(this,xe).lastIndexOf("M");g(this,xe,`${r(this,xe).slice(0,i)} M ${e} ${t}`),g(this,Us,6)}if(r(this,Ue).length===4){const i=V.svgRound(r(this,fe)[10]),n=V.svgRound(r(this,fe)[11]);return g(this,xe,`${r(this,xe)} L ${i} ${n}`),g(this,Us,12),r(this,xe)}const s=[];r(this,Us)===0&&(s.push(`M ${e} ${t}`),g(this,Us,6));for(let i=r(this,Us),n=r(this,fe).length;i<n;i+=6){const[a,o,l,h,d,u]=r(this,fe).slice(i,i+6).map(V.svgRound);s.push(`C${a} ${o} ${l} ${h} ${d} ${u}`)}return g(this,xe,r(this,xe)+s.join(" ")),g(this,Us,r(this,fe).length),r(this,xe)}getOutlines(e,t,s,i){const n=r(this,pe).at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),r(this,Ba).build(r(this,pe),e,t,s,r(this,Fa),r(this,Ml),i),g(this,Ri,null),g(this,fe,null),g(this,pe,null),g(this,xe,null),r(this,Ba)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}Ri=new WeakMap,fe=new WeakMap,pe=new WeakMap,Fa=new WeakMap,Ml=new WeakMap,Ue=new WeakMap,xe=new WeakMap,Us=new WeakMap,Ba=new WeakMap,_a=new WeakMap,Ua=new WeakMap,Dl=new WeakSet,Vd=function(e,t){return V._normalizePoint(e,t,r(this,_a),r(this,Ua),r(this,Fa))};var He,ed,sd,ys,Ii,Mi,Ll,Ol,Ha,Ce,_i,Cv,Pv,Rv;class hd extends V{constructor(){super(...arguments);y(this,Ce);y(this,He);y(this,ed,0);y(this,sd);y(this,ys);y(this,Ii);y(this,Mi);y(this,Ll);y(this,Ol);y(this,Ha)}build(t,s,i,n,a,o,l){g(this,Ii,s),g(this,Mi,i),g(this,Ll,n),g(this,Ol,a),g(this,Ha,o),g(this,sd,l??0),g(this,ys,t),w(this,Ce,Pv).call(this)}get thickness(){return r(this,Ha)}setLastElement(t){return r(this,ys).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return r(this,ys).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:s}of r(this,ys)){if(t.push(`M${V.svgRound(s[4])} ${V.svgRound(s[5])}`),s.length===6){t.push("Z");continue}if(s.length===12&&isNaN(s[6])){t.push(`L${V.svgRound(s[10])} ${V.svgRound(s[11])}`);continue}for(let i=6,n=s.length;i<n;i+=6){const[a,o,l,h,d,u]=s.subarray(i,i+6).map(V.svgRound);t.push(`C${a} ${o} ${l} ${h} ${d} ${u}`)}}return t.join("")}serialize([t,s,i,n],a){const o=[],l=[],[h,d,u,f]=w(this,Ce,Cv).call(this);let p,m,v,A,b,S,E,T,x;switch(r(this,Ol)){case 0:x=V._rescale,p=t,m=s+n,v=i,A=-n,b=t+h*i,S=s+(1-d-f)*n,E=t+(h+u)*i,T=s+(1-d)*n;break;case 90:x=V._rescaleAndSwap,p=t,m=s,v=i,A=n,b=t+d*i,S=s+h*n,E=t+(d+f)*i,T=s+(h+u)*n;break;case 180:x=V._rescale,p=t+i,m=s,v=-i,A=n,b=t+(1-h-u)*i,S=s+d*n,E=t+(1-h)*i,T=s+(d+f)*n;break;case 270:x=V._rescaleAndSwap,p=t+i,m=s+n,v=-i,A=-n,b=t+(1-d-f)*i,S=s+(1-h-u)*n,E=t+(1-d)*i,T=s+(1-h)*n;break}for(const{line:C,points:P}of r(this,ys))o.push(x(C,p,m,v,A,a?new Array(C.length):null)),l.push(x(P,p,m,v,A,a?new Array(P.length):null));return{lines:o,points:l,rect:[b,S,E,T]}}static deserialize(t,s,i,n,a,{paths:{lines:o,points:l},rotation:h,thickness:d}){const u=[];let f,p,m,v,A;switch(h){case 0:A=V._rescale,f=-t/i,p=s/n+1,m=1/i,v=-1/n;break;case 90:A=V._rescaleAndSwap,f=-s/n,p=-t/i,m=1/n,v=1/i;break;case 180:A=V._rescale,f=t/i+1,p=-s/n,m=-1/i,v=1/n;break;case 270:A=V._rescaleAndSwap,f=s/n+1,p=t/i+1,m=-1/n,v=-1/i;break}if(!o){o=[];for(const S of l){const E=S.length;if(E===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,S[0],S[1]]));continue}if(E===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,S[0],S[1],NaN,NaN,NaN,NaN,S[2],S[3]]));continue}const T=new Float32Array(3*(E-2));o.push(T);let[x,C,P,I]=S.subarray(0,4);T.set([NaN,NaN,NaN,NaN,x,C],0);for(let R=4;R<E;R+=2){const L=S[R],D=S[R+1];T.set(V.createBezierPoints(x,C,P,I,L,D),(R-2)*3),[x,C,P,I]=[P,I,L,D]}}}for(let S=0,E=o.length;S<E;S++)u.push({line:A(o[S].map(T=>T??NaN),f,p,m,v),points:A(l[S].map(T=>T??NaN),f,p,m,v)});const b=new this.prototype.constructor;return b.build(u,i,n,1,h,d,a),b}get box(){return r(this,He)}updateProperty(t,s){return t==="stroke-width"?w(this,Ce,Rv).call(this,s):null}updateParentDimensions([t,s],i){const[n,a]=w(this,Ce,_i).call(this);g(this,Ii,t),g(this,Mi,s),g(this,Ll,i);const[o,l]=w(this,Ce,_i).call(this),h=o-n,d=l-a,u=r(this,He);return u[0]-=h,u[1]-=d,u[2]+=2*h,u[3]+=2*d,u}updateRotation(t){return g(this,ed,t),{path:{transform:this.rotationTransform}}}get viewBox(){return r(this,He).map(V.svgRound).join(" ")}get defaultProperties(){const[t,s]=r(this,He);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${V.svgRound(t)} ${V.svgRound(s)}`}}}get rotationTransform(){const[,,t,s]=r(this,He);let i=0,n=0,a=0,o=0,l=0,h=0;switch(r(this,ed)){case 90:n=s/t,a=-t/s,l=t;break;case 180:i=-1,o=-1,l=t,h=s;break;case 270:n=-s/t,a=t/s,h=s;break;default:return""}return`matrix(${i} ${n} ${a} ${o} ${V.svgRound(l)} ${V.svgRound(h)})`}getPathResizingSVGProperties([t,s,i,n]){const[a,o]=w(this,Ce,_i).call(this),[l,h,d,u]=r(this,He);if(Math.abs(d-a)<=V.PRECISION||Math.abs(u-o)<=V.PRECISION){const A=t+i/2-(l+d/2),b=s+n/2-(h+u/2);return{path:{"transform-origin":`${V.svgRound(t)} ${V.svgRound(s)}`,transform:`${this.rotationTransform} translate(${A} ${b})`}}}const f=(i-2*a)/(d-2*a),p=(n-2*o)/(u-2*o),m=d/i,v=u/n;return{path:{"transform-origin":`${V.svgRound(l)} ${V.svgRound(h)}`,transform:`${this.rotationTransform} scale(${m} ${v}) translate(${V.svgRound(a)} ${V.svgRound(o)}) scale(${f} ${p}) translate(${V.svgRound(-a)} ${V.svgRound(-o)})`}}}getPathResizedSVGProperties([t,s,i,n]){const[a,o]=w(this,Ce,_i).call(this),l=r(this,He),[h,d,u,f]=l;if(l[0]=t,l[1]=s,l[2]=i,l[3]=n,Math.abs(u-a)<=V.PRECISION||Math.abs(f-o)<=V.PRECISION){const b=t+i/2-(h+u/2),S=s+n/2-(d+f/2);for(const{line:E,points:T}of r(this,ys))V._translate(E,b,S,E),V._translate(T,b,S,T);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${V.svgRound(t)} ${V.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const p=(i-2*a)/(u-2*a),m=(n-2*o)/(f-2*o),v=-p*(h+a)+t+a,A=-m*(d+o)+s+o;if(p!==1||m!==1||v!==0||A!==0)for(const{line:b,points:S}of r(this,ys))V._rescale(b,v,A,p,m,b),V._rescale(S,v,A,p,m,S);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${V.svgRound(t)} ${V.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,s],i){const[n,a]=i,o=r(this,He),l=t-o[0],h=s-o[1];if(r(this,Ii)===n&&r(this,Mi)===a)for(const{line:d,points:u}of r(this,ys))V._translate(d,l,h,d),V._translate(u,l,h,u);else{const d=r(this,Ii)/n,u=r(this,Mi)/a;g(this,Ii,n),g(this,Mi,a);for(const{line:f,points:p}of r(this,ys))V._rescale(f,l,h,d,u,f),V._rescale(p,l,h,d,u,p);o[2]*=d,o[3]*=u}return o[0]=t,o[1]=s,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${V.svgRound(t)} ${V.svgRound(s)}`}}}get defaultSVGProperties(){const t=r(this,He);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${V.svgRound(t[0])} ${V.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}He=new WeakMap,ed=new WeakMap,sd=new WeakMap,ys=new WeakMap,Ii=new WeakMap,Mi=new WeakMap,Ll=new WeakMap,Ol=new WeakMap,Ha=new WeakMap,Ce=new WeakSet,_i=function(t=r(this,Ha)){const s=r(this,sd)+t/2*r(this,Ll);return r(this,Ol)%180===0?[s/r(this,Ii),s/r(this,Mi)]:[s/r(this,Mi),s/r(this,Ii)]},Cv=function(){const[t,s,i,n]=r(this,He),[a,o]=w(this,Ce,_i).call(this,0);return[t+a,s+o,i-2*a,n-2*o]},Pv=function(){const t=g(this,He,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:n}of r(this,ys)){if(n.length<=12){for(let l=4,h=n.length;l<h;l+=6)j.pointBoundingBox(n[l],n[l+1],t);continue}let a=n[4],o=n[5];for(let l=6,h=n.length;l<h;l+=6){const[d,u,f,p,m,v]=n.subarray(l,l+6);j.bezierBoundingBox(a,o,d,u,f,p,m,v,t),a=m,o=v}}const[s,i]=w(this,Ce,_i).call(this);t[0]=Ne(t[0]-s,0,1),t[1]=Ne(t[1]-i,0,1),t[2]=Ne(t[2]+s,0,1),t[3]=Ne(t[3]+i,0,1),t[2]-=t[0],t[3]-=t[1]},Rv=function(t){const[s,i]=w(this,Ce,_i).call(this);g(this,Ha,t);const[n,a]=w(this,Ce,_i).call(this),[o,l]=[n-s,a-i],h=r(this,He);return h[0]-=o,h[1]-=l,h[2]+=2*o,h[3]+=2*l,h};class ju extends xv{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:Ot._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??(t=this["stroke-width"]),t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new ju(this._viewParameters);return e.updateAll(this),e}}var ku,Iv;const fo=class fo extends hu{constructor(t){super({...t,name:"inkEditor"});y(this,ku);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,s){Ot.initialize(t,s),this._defaultDrawingOptions=new ju(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!0}static get typesMap(){return at(this,"typesMap",new Map([[dt.INK_THICKNESS,"stroke-width"],[dt.INK_COLOR,"stroke"],[dt.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,s,i,n,a){return new Rb(t,s,i,n,a,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,s,i,n,a,o){return hd.deserialize(t,s,i,n,a,o)}static async deserialize(t,s,i){let n=null;if(t instanceof Up){const{data:{inkLists:o,rect:l,rotation:h,id:d,color:u,opacity:f,borderStyle:{rawWidth:p},popupRef:m,richText:v,contentsObj:A,creationDate:b,modificationDate:S},parent:{page:{pageNumber:E}}}=t;n=t={annotationType:tt.INK,color:Array.from(u),thickness:p,opacity:f,paths:{points:o},boxes:null,pageIndex:E-1,rect:l.slice(0),rotation:h,annotationElementId:d,id:d,deleted:!1,popupRef:m,richText:v,comment:(A==null?void 0:A.str)||null,creationDate:b,modificationDate:S}}const a=await super.deserialize(t,s,i);return a._initialData=n,t.comment&&a.setCommentData(t),a}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new ru(this)),[["colorPicker",this._colorPicker]]}get colorType(){return dt.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:s,parent:i}=this;s.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,s.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:s,opacity:i}){this._drawingOptions=fo.getDefaultDrawingOptions({stroke:j.makeHexColor(...t),"stroke-width":s,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:s,points:i}=this.serializeDraw(t),{_drawingOptions:{stroke:n,"stroke-opacity":a,"stroke-width":o}}=this,l=Object.assign(super.serialize(t),{color:Ot._colorManager.convert(n),opacity:a,thickness:o,paths:{lines:s,points:i}});return this.addComment(l),t?(l.isCopy=!0,l):this.annotationElementId&&!w(this,ku,Iv).call(this,l)?null:(l.id=this.annotationElementId,l)}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:s,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:s,popup:this.comment}),null}};ku=new WeakSet,Iv=function(t){const{color:s,thickness:i,opacity:n,pageIndex:a}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((o,l)=>o!==s[l])||t.thickness!==i||t.opacity!==n||t.pageIndex!==a},M(fo,"_type","ink"),M(fo,"_editorType",tt.INK),M(fo,"_defaultDrawingOptions",null);let dp=fo;class up extends hd{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const Ad=8,Yl=3;var $a,yt,fp,qs,Mv,Dv,pp,Gd,Lv,Ov,kv,gp,mp,Nv;class Oi{static extractContoursFromText(e,{fontFamily:t,fontStyle:s,fontWeight:i},n,a,o,l){let h=new OffscreenCanvas(1,1),d=h.getContext("2d",{alpha:!1});const u=200,f=d.font=`${s} ${i} ${u}px ${t}`,{actualBoundingBoxLeft:p,actualBoundingBoxRight:m,actualBoundingBoxAscent:v,actualBoundingBoxDescent:A,fontBoundingBoxAscent:b,fontBoundingBoxDescent:S,width:E}=d.measureText(e),T=1.5,x=Math.ceil(Math.max(Math.abs(p)+Math.abs(m)||0,E)*T),C=Math.ceil(Math.max(Math.abs(v)+Math.abs(A)||u,Math.abs(b)+Math.abs(S)||u)*T);h=new OffscreenCanvas(x,C),d=h.getContext("2d",{alpha:!0,willReadFrequently:!0}),d.font=f,d.filter="grayscale(1)",d.fillStyle="white",d.fillRect(0,0,x,C),d.fillStyle="black",d.fillText(e,x*(T-1)/2,C*(3-T)/2);const P=w(this,yt,gp).call(this,d.getImageData(0,0,x,C).data),I=w(this,yt,kv).call(this,P),R=w(this,yt,mp).call(this,I),L=w(this,yt,pp).call(this,P,x,C,R);return this.processDrawnLines({lines:{curves:L,width:x,height:C},pageWidth:n,pageHeight:a,rotation:o,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(e,t,s,i,n){const[a,o,l]=w(this,yt,Nv).call(this,e),[h,d]=w(this,yt,Ov).call(this,a,o,l,Math.hypot(o,l)*r(this,$a).sigmaSFactor,r(this,$a).sigmaR,r(this,$a).kernelSize),u=w(this,yt,mp).call(this,d),f=w(this,yt,pp).call(this,h,o,l,u);return this.processDrawnLines({lines:{curves:f,width:o,height:l},pageWidth:t,pageHeight:s,rotation:i,innerMargin:n,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:s,rotation:i,innerMargin:n,mustSmooth:a,areContours:o}){i%180!==0&&([t,s]=[s,t]);const{curves:l,width:h,height:d}=e,u=e.thickness??0,f=[],p=Math.min(t/h,s/d),m=p/t,v=p/s,A=[];for(const{points:S}of l){const E=a?w(this,yt,Lv).call(this,S):S;if(!E)continue;A.push(E);const T=E.length,x=new Float32Array(T),C=new Float32Array(3*(T===2?2:T-2));if(f.push({line:C,points:x}),T===2){x[0]=E[0]*m,x[1]=E[1]*v,C.set([NaN,NaN,NaN,NaN,x[0],x[1]],0);continue}let[P,I,R,L]=E;P*=m,I*=v,R*=m,L*=v,x.set([P,I,R,L],0),C.set([NaN,NaN,NaN,NaN,P,I],0);for(let D=4;D<T;D+=2){const O=x[D]=E[D]*m,F=x[D+1]=E[D+1]*v;C.set(V.createBezierPoints(P,I,R,L,O,F),(D-2)*3),[P,I,R,L]=[R,L,O,F]}}if(f.length===0)return null;const b=o?new up:new hd;return b.build(f,t,s,1,i,o?0:u,n),{outline:b,newCurves:A,areContours:o,thickness:u,width:h,height:d}}static async compressSignature({outlines:e,areContours:t,thickness:s,width:i,height:n}){let a=1/0,o=-1/0,l=0;for(const E of e){l+=E.length;for(let T=2,x=E.length;T<x;T++){const C=E[T]-E[T-2];a=Math.min(a,C),o=Math.max(o,C)}}let h;a>=-128&&o<=127?h=Int8Array:a>=-32768&&o<=32767?h=Int16Array:h=Int32Array;const d=e.length,u=Ad+Yl*d,f=new Uint32Array(u);let p=0;f[p++]=u*Uint32Array.BYTES_PER_ELEMENT+(l-2*d)*h.BYTES_PER_ELEMENT,f[p++]=0,f[p++]=i,f[p++]=n,f[p++]=t?0:1,f[p++]=Math.max(0,Math.floor(s??0)),f[p++]=d,f[p++]=h.BYTES_PER_ELEMENT;for(const E of e)f[p++]=E.length-2,f[p++]=E[0],f[p++]=E[1];const m=new CompressionStream("deflate-raw"),v=m.writable.getWriter();await v.ready,v.write(f);const A=h.prototype.constructor;for(const E of e){const T=new A(E.length-2);for(let x=2,C=E.length;x<C;x++)T[x-2]=E[x]-E[x-2];v.write(T)}v.close();const b=await new Response(m.readable).arrayBuffer(),S=new Uint8Array(b);return Og(S)}static async decompressSignature(e){try{const t=qv(e),{readable:s,writable:i}=new DecompressionStream("deflate-raw"),n=i.getWriter();await n.ready,n.write(t).then(async()=>{await n.ready,await n.close()}).catch(()=>{});let a=null,o=0;for await(const E of s)a||(a=new Uint8Array(new Uint32Array(E.buffer,0,4)[0])),a.set(E,o),o+=E.length;const l=new Uint32Array(a.buffer,0,a.length>>2),h=l[1];if(h!==0)throw new Error(`Invalid version: ${h}`);const d=l[2],u=l[3],f=l[4]===0,p=l[5],m=l[6],v=l[7],A=[],b=(Ad+Yl*m)*Uint32Array.BYTES_PER_ELEMENT;let S;switch(v){case Int8Array.BYTES_PER_ELEMENT:S=new Int8Array(a.buffer,b);break;case Int16Array.BYTES_PER_ELEMENT:S=new Int16Array(a.buffer,b);break;case Int32Array.BYTES_PER_ELEMENT:S=new Int32Array(a.buffer,b);break}o=0;for(let E=0;E<m;E++){const T=l[Yl*E+Ad],x=new Float32Array(T+2);A.push(x);for(let C=0;C<Yl-1;C++)x[C]=l[Yl*E+Ad+C+1];for(let C=0;C<T;C++)x[C+2]=x[C]+S[o++]}return{areContours:f,thickness:p,outlines:A,width:d,height:u}}catch(t){return Q(`decompressSignature: ${t}`),null}}}$a=new WeakMap,yt=new WeakSet,fp=function(e,t,s,i){return s-=e,i-=t,s===0?i>0?0:4:s===1?i+6:2-i},qs=new WeakMap,Mv=function(e,t,s,i,n,a,o){const l=w(this,yt,fp).call(this,s,i,n,a);for(let h=0;h<8;h++){const d=(-h+l-o+16)%8,u=r(this,qs)[2*d],f=r(this,qs)[2*d+1];if(e[(s+u)*t+(i+f)]!==0)return d}return-1},Dv=function(e,t,s,i,n,a,o){const l=w(this,yt,fp).call(this,s,i,n,a);for(let h=0;h<8;h++){const d=(h+l+o+16)%8,u=r(this,qs)[2*d],f=r(this,qs)[2*d+1];if(e[(s+u)*t+(i+f)]!==0)return d}return-1},pp=function(e,t,s,i){const n=e.length,a=new Int32Array(n);for(let d=0;d<n;d++)a[d]=e[d]<=i?1:0;for(let d=1;d<s-1;d++)a[d*t]=a[d*t+t-1]=0;for(let d=0;d<t;d++)a[d]=a[t*s-1-d]=0;let o=1,l;const h=[];for(let d=1;d<s-1;d++){l=1;for(let u=1;u<t-1;u++){const f=d*t+u,p=a[f];if(p===0)continue;let m=d,v=u;if(p===1&&a[f-1]===0)o+=1,v-=1;else if(p>=1&&a[f+1]===0)o+=1,v+=1,p>1&&(l=p);else{p!==1&&(l=Math.abs(p));continue}const A=[u,d],b=v===u+1,S={isHole:b,points:A,id:o,parent:0};h.push(S);let E;for(const D of h)if(D.id===l){E=D;break}E?E.isHole?S.parent=b?E.parent:l:S.parent=b?l:E.parent:S.parent=b?l:0;const T=w(this,yt,Mv).call(this,a,t,d,u,m,v,0);if(T===-1){a[f]=-o,a[f]!==1&&(l=Math.abs(a[f]));continue}let x=r(this,qs)[2*T],C=r(this,qs)[2*T+1];const P=d+x,I=u+C;m=P,v=I;let R=d,L=u;for(;;){const D=w(this,yt,Dv).call(this,a,t,R,L,m,v,1);x=r(this,qs)[2*D],C=r(this,qs)[2*D+1];const O=R+x,F=L+C;A.push(F,O);const B=R*t+L;if(a[B+1]===0?a[B]=-o:a[B]===1&&(a[B]=o),O===d&&F===u&&R===P&&L===I){a[f]!==1&&(l=Math.abs(a[f]));break}else m=R,v=L,R=O,L=F}}}return h},Gd=function(e,t,s,i){if(s-t<=4){for(let P=t;P<s-2;P+=2)i.push(e[P],e[P+1]);return}const n=e[t],a=e[t+1],o=e[s-4]-n,l=e[s-3]-a,h=Math.hypot(o,l),d=o/h,u=l/h,f=d*a-u*n,p=l/o,m=1/h,v=Math.atan(p),A=Math.cos(v),b=Math.sin(v),S=m*(Math.abs(A)+Math.abs(b)),E=m*(1-S+S**2),T=Math.max(Math.atan(Math.abs(b+A)*E),Math.atan(Math.abs(b-A)*E));let x=0,C=t;for(let P=t+2;P<s-2;P+=2){const I=Math.abs(f-d*e[P+1]+u*e[P]);I>x&&(C=P,x=I)}x>(h*T)**2?(w(this,yt,Gd).call(this,e,t,C+2,i),w(this,yt,Gd).call(this,e,C,s,i)):i.push(n,a)},Lv=function(e){const t=[],s=e.length;return w(this,yt,Gd).call(this,e,0,s,t),t.push(e[s-2],e[s-1]),t.length<=4?null:t},Ov=function(e,t,s,i,n,a){const o=new Float32Array(a**2),l=-2*i**2,h=a>>1;for(let v=0;v<a;v++){const A=(v-h)**2;for(let b=0;b<a;b++)o[v*a+b]=Math.exp((A+(b-h)**2)/l)}const d=new Float32Array(256),u=-2*n**2;for(let v=0;v<256;v++)d[v]=Math.exp(v**2/u);const f=e.length,p=new Uint8Array(f),m=new Uint32Array(256);for(let v=0;v<s;v++)for(let A=0;A<t;A++){const b=v*t+A,S=e[b];let E=0,T=0;for(let C=0;C<a;C++){const P=v+C-h;if(!(P<0||P>=s))for(let I=0;I<a;I++){const R=A+I-h;if(R<0||R>=t)continue;const L=e[P*t+R],D=o[C*a+I]*d[Math.abs(L-S)];E+=L*D,T+=D}}const x=p[b]=Math.round(E/T);m[x]++}return[p,m]},kv=function(e){const t=new Uint32Array(256);for(const s of e)t[s]++;return t},gp=function(e){const t=e.length,s=new Uint8ClampedArray(t>>2);let i=-1/0,n=1/0;for(let o=0,l=s.length;o<l;o++){const h=s[o]=e[o<<2];i=Math.max(i,h),n=Math.min(n,h)}const a=255/(i-n);for(let o=0,l=s.length;o<l;o++)s[o]=(s[o]-n)*a;return s},mp=function(e){let t,s=-1/0,i=-1/0;const n=e.findIndex(l=>l!==0);let a=n,o=n;for(t=n;t<256;t++){const l=e[t];l>s&&(t-a>i&&(i=t-a,o=t-1),s=l,a=t)}for(t=o-1;t>=0&&!(e[t]>e[t+1]);t--);return t},Nv=function(e){const t=e,{width:s,height:i}=e,{maxDim:n}=r(this,$a);let a=s,o=i;if(s>n||i>n){let f=s,p=i,m=Math.log2(Math.max(s,i)/n);const v=Math.floor(m);m=m===v?v-1:v;for(let b=0;b<m;b++){a=Math.ceil(f/2),o=Math.ceil(p/2);const S=new OffscreenCanvas(a,o);S.getContext("2d").drawImage(e,0,0,f,p,0,0,a,o),f=a,p=o,e!==t&&e.close(),e=S.transferToImageBitmap()}const A=Math.min(n/a,n/o);a=Math.round(a*A),o=Math.round(o*A)}const h=new OffscreenCanvas(a,o).getContext("2d",{willReadFrequently:!0});h.fillStyle="white",h.fillRect(0,0,a,o),h.filter="grayscale(1)",h.drawImage(e,0,0,e.width,e.height,0,0,a,o);const d=h.getImageData(0,0,a,o).data;return[w(this,yt,gp).call(this,d),a,o]},y(Oi,yt),y(Oi,$a,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),y(Oi,qs,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class Hp extends xv{constructor(){super(),super.updateProperties({fill:Ot._defaultLineColor,"stroke-width":0})}clone(){const e=new Hp;return e.updateAll(this),e}}class $p extends ju{constructor(e){super(e),super.updateProperties({stroke:Ot._defaultLineColor,"stroke-width":1})}clone(){const e=new $p(this._viewParameters);return e.updateAll(this),e}}var mr,Di,vr,ja;const ss=class ss extends hu{constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"});y(this,mr,!1);y(this,Di,null);y(this,vr,null);y(this,ja,null);this._willKeepAspectRatio=!0,g(this,vr,t.signatureData||null),g(this,Di,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,s){Ot.initialize(t,s),this._defaultDrawingOptions=new Hp,this._defaultDrawnSignatureOptions=new $p(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!1}static get typesMap(){return at(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!r(this,Di)}}static computeTelemetryFinalData(t){const s=t.get("hasDescription");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,s;const{_isCopy:i}=this;if(i&&(this._isCopy=!1,t=this.x,s=this.y),super.render(),this._drawId===null)if(r(this,vr)){const{lines:n,mustSmooth:a,areContours:o,description:l,uuid:h,heightInPage:d}=r(this,vr),{rawDims:{pageWidth:u,pageHeight:f},rotation:p}=this.parent.viewport,m=Oi.processDrawnLines({lines:n,pageWidth:u,pageHeight:f,rotation:p,innerMargin:ss._INNER_MARGIN,mustSmooth:a,areContours:o});this.addSignature(m,d,l,h)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:r(this,Di)||""}));return i&&(this._isCopy=!0,this._moveAfterPaste(t,s)),this.div}setUuid(t){g(this,ja,t),this.addEditToolbar()}getUuid(){return r(this,ja)}get description(){return r(this,Di)}set description(t){g(this,Di,t),this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(s=>{s==null||s.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:s,thickness:i,width:n,height:a}=r(this,vr),o=Math.max(n,a),l=Oi.processDrawnLines({lines:{curves:t.map(h=>({points:h})),thickness:i,width:n,height:a},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:s});return{areContours:s,outline:l.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,s,i,n){const{x:a,y:o}=this,{outline:l}=g(this,vr,t);g(this,mr,l instanceof up),this.description=i;let h;r(this,mr)?h=ss.getDefaultDrawingOptions():(h=ss._defaultDrawnSignatureOptions.clone(),h.updateProperties({"stroke-width":l.thickness})),this._addOutlines({drawOutlines:l,drawingOptions:h});const[,d]=this.pageDimensions;let u=s/d;u=u>=1?.5:u,this.width*=u/this.height,this.width>=1&&(u*=.9/this.width,this.width=.9),this.height=u,this.setDims(),this.x=a,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(n),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!n,hasDescription:!!i}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:s,pageHeight:i},rotation:n}=this.parent.viewport;return Oi.process(t,s,i,n,ss._INNER_MARGIN)}getFromText(t,s){const{rawDims:{pageWidth:i,pageHeight:n},rotation:a}=this.parent.viewport;return Oi.extractContoursFromText(t,s,i,n,a,ss._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:s,pageHeight:i},rotation:n}=this.parent.viewport;return Oi.processDrawnLines({lines:t,pageWidth:s,pageHeight:i,rotation:n,innerMargin:ss._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:s}){t?this._drawingOptions=ss.getDefaultDrawingOptions():(this._drawingOptions=ss._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":s}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:s,points:i}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":n}}=this,a=Object.assign(super.serialize(t),{isSignature:!0,areContours:r(this,mr),color:[0,0,0],thickness:r(this,mr)?0:n});return this.addComment(a),t?(a.paths={lines:s,points:i},a.uuid=r(this,ja),a.isCopy=!0):a.lines=s,r(this,Di)&&(a.accessibilityData={type:"Figure",alt:r(this,Di)}),a}static deserializeDraw(t,s,i,n,a,o){return o.areContours?up.deserialize(t,s,i,n,a,o):hd.deserialize(t,s,i,n,a,o)}static async deserialize(t,s,i){var a;const n=await super.deserialize(t,s,i);return g(n,mr,t.areContours),n.description=((a=t.accessibilityData)==null?void 0:a.alt)||"",g(n,ja,t.uuid),n}};mr=new WeakMap,Di=new WeakMap,vr=new WeakMap,ja=new WeakMap,M(ss,"_type","signature"),M(ss,"_editorType",tt.SIGNATURE),M(ss,"_defaultDrawingOptions",null);let vp=ss;var Bt,ge,yr,vn,br,kl,yn,za,Li,bs,Nl,pt,ph,gh,Wd,Xd,Yd,bp,Kd,Fv;class yp extends Ot{constructor(t){super({...t,name:"stampEditor"});y(this,pt);y(this,Bt,null);y(this,ge,null);y(this,yr,null);y(this,vn,null);y(this,br,null);y(this,kl,"");y(this,yn,null);y(this,za,!1);y(this,Li,null);y(this,bs,!1);y(this,Nl,!1);g(this,vn,t.bitmapUrl),g(this,br,t.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,s){Ot.initialize(t,s)}static isHandlingMimeForPasting(t){return qd.includes(t)}static paste(t,s){s.pasteEditor({mode:tt.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const s=t.get("hasAltText");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}async mlGuessAltText(t=null,s=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:n,width:a,height:o}=t||this.copyCanvas(null,null,!0).imageData,l=await i.guess({name:"altText",request:{data:n,width:a,height:o,channels:n.length/(a*o)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const h=l.output;return await this.setGuessedAltText(h),s&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),h}remove(){var t;r(this,ge)&&(g(this,Bt,null),this._uiManager.imageManager.deleteId(r(this,ge)),(t=r(this,yn))==null||t.remove(),g(this,yn,null),r(this,Li)&&(clearTimeout(r(this,Li)),g(this,Li,null))),super.remove()}rebuild(){if(!this.parent){r(this,ge)&&w(this,pt,Wd).call(this);return}super.rebuild(),this.div!==null&&(r(this,ge)&&r(this,yn)===null&&w(this,pt,Wd).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(r(this,yr)||r(this,Bt)||r(this,vn)||r(this,br)||r(this,ge)||r(this,za))}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,s;return this._isCopy&&(t=this.x,s=this.y),super.render(),this.div.hidden=!0,this.createAltText(),r(this,za)||(r(this,Bt)?w(this,pt,Xd).call(this):w(this,pt,Wd).call(this)),this._isCopy&&this._moveAfterPaste(t,s),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,s){const{id:i,bitmap:n}=this._uiManager.imageManager.getFromCanvas(t,s);s.remove(),i&&this._uiManager.imageManager.isValidId(i)&&(g(this,ge,i),n&&g(this,Bt,n),g(this,za,!1),w(this,pt,Xd).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;r(this,Li)!==null&&clearTimeout(r(this,Li)),g(this,Li,setTimeout(()=>{g(this,Li,null),w(this,pt,bp).call(this)},200))}copyCanvas(t,s,i=!1){t||(t=224);const{width:n,height:a}=r(this,Bt),o=new ri;let l=r(this,Bt),h=n,d=a,u=null;if(s){if(n>s||a>s){const P=Math.min(s/n,s/a);h=Math.floor(n*P),d=Math.floor(a*P)}u=document.createElement("canvas");const p=u.width=Math.ceil(h*o.sx),m=u.height=Math.ceil(d*o.sy);r(this,bs)||(l=w(this,pt,Yd).call(this,p,m));const v=u.getContext("2d");v.filter=this._uiManager.hcmFilter;let A="white",b="#cfcfd8";this._uiManager.hcmFilter!=="none"?b="black":sy.isDarkMode&&(A="#8f8f9d",b="#42414d");const S=15,E=S*o.sx,T=S*o.sy,x=new OffscreenCanvas(E*2,T*2),C=x.getContext("2d");C.fillStyle=A,C.fillRect(0,0,E*2,T*2),C.fillStyle=b,C.fillRect(0,0,E,T),C.fillRect(E,T,E,T),v.fillStyle=v.createPattern(x,"repeat"),v.fillRect(0,0,p,m),v.drawImage(l,0,0,l.width,l.height,0,0,p,m)}let f=null;if(i){let p,m;if(o.symmetric&&l.width<t&&l.height<t)p=l.width,m=l.height;else if(l=r(this,Bt),n>t||a>t){const b=Math.min(t/n,t/a);p=Math.floor(n*b),m=Math.floor(a*b),r(this,bs)||(l=w(this,pt,Yd).call(this,p,m))}const A=new OffscreenCanvas(p,m).getContext("2d",{willReadFrequently:!0});A.drawImage(l,0,0,l.width,l.height,0,0,p,m),f={width:p,height:m,data:A.getImageData(0,0,p,m).data}}return{canvas:u,width:h,height:d,imageData:f}}static async deserialize(t,s,i){var A;let n=null,a=!1;if(t instanceof Zm){const{data:{rect:b,rotation:S,id:E,structParent:T,popupRef:x,richText:C,contentsObj:P,creationDate:I,modificationDate:R},container:L,parent:{page:{pageNumber:D}},canvas:O}=t;let F,B;O?(delete t.canvas,{id:F,bitmap:B}=i.imageManager.getFromCanvas(L.id,O),O.remove()):(a=!0,t._hasNoCanvas=!0);const W=((A=await s._structTree.getAriaAttributes(`${Mp}${E}`))==null?void 0:A.get("aria-label"))||"";n=t={annotationType:tt.STAMP,bitmapId:F,bitmap:B,pageIndex:D-1,rect:b.slice(0),rotation:S,annotationElementId:E,id:E,deleted:!1,accessibilityData:{decorative:!1,altText:W},isSvg:!1,structParent:T,popupRef:x,richText:C,comment:(P==null?void 0:P.str)||null,creationDate:I,modificationDate:R}}const o=await super.deserialize(t,s,i),{rect:l,bitmap:h,bitmapUrl:d,bitmapId:u,isSvg:f,accessibilityData:p}=t;a?(i.addMissingCanvas(t.id,o),g(o,za,!0)):u&&i.imageManager.isValidId(u)?(g(o,ge,u),h&&g(o,Bt,h)):g(o,vn,d),g(o,bs,f);const[m,v]=o.pageDimensions;return o.width=(l[2]-l[0])/m,o.height=(l[3]-l[1])/v,p&&(o.altTextData=p),o._initialData=n,t.comment&&o.setCommentData(t),g(o,Nl,!!n),o}serialize(t=!1,s=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i=Object.assign(super.serialize(t),{bitmapId:r(this,ge),isSvg:r(this,bs)});if(this.addComment(i),t)return i.bitmapUrl=w(this,pt,Kd).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;const{decorative:n,altText:a}=this.serializeAltText(!1);if(!n&&a&&(i.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const l=w(this,pt,Fv).call(this,i);return l.isSame?null:(l.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1,i.id=this.annotationElementId,delete i.bitmapId,i)}if(s===null)return i;s.stamps||(s.stamps=new Map);const o=r(this,bs)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!s.stamps.has(r(this,ge)))s.stamps.set(r(this,ge),{area:o,serialized:i}),i.bitmap=w(this,pt,Kd).call(this,!1);else if(r(this,bs)){const l=s.stamps.get(r(this,ge));o>l.area&&(l.area=o,l.serialized.bitmap.close(),l.serialized.bitmap=w(this,pt,Kd).call(this,!1))}return i}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}Bt=new WeakMap,ge=new WeakMap,yr=new WeakMap,vn=new WeakMap,br=new WeakMap,kl=new WeakMap,yn=new WeakMap,za=new WeakMap,Li=new WeakMap,bs=new WeakMap,Nl=new WeakMap,pt=new WeakSet,ph=function(t,s=!1){if(!t){this.remove();return}g(this,Bt,t.bitmap),s||(g(this,ge,t.id),g(this,bs,t.isSvg)),t.file&&g(this,kl,t.file.name),w(this,pt,Xd).call(this)},gh=function(){if(g(this,yr,null),this._uiManager.enableWaiting(!1),!!r(this,yn)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&r(this,Bt)){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&r(this,Bt)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},Wd=function(){if(r(this,ge)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(r(this,ge)).then(i=>w(this,pt,ph).call(this,i,!0)).finally(()=>w(this,pt,gh).call(this));return}if(r(this,vn)){const i=r(this,vn);g(this,vn,null),this._uiManager.enableWaiting(!0),g(this,yr,this._uiManager.imageManager.getFromUrl(i).then(n=>w(this,pt,ph).call(this,n)).finally(()=>w(this,pt,gh).call(this)));return}if(r(this,br)){const i=r(this,br);g(this,br,null),this._uiManager.enableWaiting(!0),g(this,yr,this._uiManager.imageManager.getFromFile(i).then(n=>w(this,pt,ph).call(this,n)).finally(()=>w(this,pt,gh).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=qd.join(",");const s=this._uiManager._signal;g(this,yr,new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const n=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),w(this,pt,ph).call(this,n)}i()},{signal:s}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:s})}).finally(()=>w(this,pt,gh).call(this))),t.click()},Xd=function(){var h;const{div:t}=this;let{width:s,height:i}=r(this,Bt);const[n,a]=this.pageDimensions,o=.75;if(this.width)s=this.width*n,i=this.height*a;else if(s>o*n||i>o*a){const d=Math.min(o*n/s,o*a/i);s*=d,i*=d}this._uiManager.enableWaiting(!1);const l=g(this,yn,document.createElement("canvas"));l.setAttribute("role","img"),this.addContainer(l),this.width=s/n,this.height=i/a,this.setDims(),(h=this._initialOptions)!=null&&h.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),w(this,pt,bp).call(this),r(this,Nl)||(this.parent.addUndoableEditor(this),g(this,Nl,!0)),this._reportTelemetry({action:"inserted_image"}),r(this,kl)&&this.div.setAttribute("aria-description",r(this,kl)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")},Yd=function(t,s){const{width:i,height:n}=r(this,Bt);let a=i,o=n,l=r(this,Bt);for(;a>2*t||o>2*s;){const h=a,d=o;a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2)),o>2*s&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const u=new OffscreenCanvas(a,o);u.getContext("2d").drawImage(l,0,0,h,d,0,0,a,o),l=u.transferToImageBitmap()}return l},bp=function(){const[t,s]=this.parentDimensions,{width:i,height:n}=this,a=new ri,o=Math.ceil(i*t*a.sx),l=Math.ceil(n*s*a.sy),h=r(this,yn);if(!h||h.width===o&&h.height===l)return;h.width=o,h.height=l;const d=r(this,bs)?r(this,Bt):w(this,pt,Yd).call(this,o,l),u=h.getContext("2d");u.filter=this._uiManager.hcmFilter,u.drawImage(d,0,0,d.width,d.height,0,0,o,l)},Kd=function(t){if(t){if(r(this,bs)){const n=this._uiManager.imageManager.getSvgUrl(r(this,ge));if(n)return n}const s=document.createElement("canvas");return{width:s.width,height:s.height}=r(this,Bt),s.getContext("2d").drawImage(r(this,Bt),0,0),s.toDataURL()}if(r(this,bs)){const[s,i]=this.pageDimensions,n=Math.round(this.width*s*Rn.PDF_TO_CSS_UNITS),a=Math.round(this.height*i*Rn.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(n,a);return o.getContext("2d").drawImage(r(this,Bt),0,0,r(this,Bt).width,r(this,Bt).height,0,0,n,a),o.transferToImageBitmap()}return structuredClone(r(this,Bt))},Fv=function(t){var o;const{pageIndex:s,accessibilityData:{altText:i}}=this._initialData,n=t.pageIndex===s,a=(((o=t.accessibilityData)==null?void 0:o.alt)||"")===i;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&n&&a,isSameAltText:a}},M(yp,"_type","stamp"),M(yp,"_editorType",tt.STAMP);var Va,Fl,Ar,wr,bn,qe,Er,Bl,_l,ti,An,me,wn,Sr,Ul,Y,xr,It,Ap,Bv,hi,wp,Ep,Jd;const zs=class zs{constructor({uiManager:e,pageIndex:t,div:s,structTreeLayer:i,accessibilityManager:n,annotationLayer:a,drawLayer:o,textLayer:l,viewport:h,l10n:d}){y(this,It);y(this,Va);y(this,Fl,!1);y(this,Ar,null);y(this,wr,null);y(this,bn,null);y(this,qe,new Map);y(this,Er,!1);y(this,Bl,!1);y(this,_l,!1);y(this,ti,null);y(this,An,null);y(this,me,null);y(this,wn,null);y(this,Sr,null);y(this,Ul,-1);y(this,Y);const u=[...r(zs,xr).values()];if(!zs._initialized){zs._initialized=!0;for(const f of u)f.initialize(d,e)}e.registerEditorTypes(u),g(this,Y,e),this.pageIndex=t,this.div=s,g(this,Va,n),g(this,Ar,a),this.viewport=h,g(this,me,l),this.drawLayer=o,this._structTree=i,r(this,Y).addLayer(this)}get isEmpty(){return r(this,qe).size===0}get isInvisible(){return this.isEmpty&&r(this,Y).getMode()===tt.NONE}updateToolbar(e){r(this,Y).updateToolbar(e)}updateMode(e=r(this,Y).getMode()){switch(w(this,It,Jd).call(this),e){case tt.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case tt.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case tt.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;if(t.toggle("nonEditing",!1),e===tt.POPUP)t.toggle("commentEditing",!0);else{t.toggle("commentEditing",!1);for(const s of r(zs,xr).values())t.toggle(`${s._type}Editing`,e===s._editorType)}this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=r(this,me))==null?void 0:t.div)}setEditingState(e){r(this,Y).setEditingState(e)}addCommands(e){r(this,Y).addCommands(e)}cleanUndoStack(e){r(this,Y).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=r(this,Ar))==null||t.div.classList.toggle("disabled",!e)}async enable(){var s;g(this,_l,!0),this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),(s=r(this,Sr))==null||s.abort(),g(this,Sr,null);const e=new Set;for(const i of r(this,It,Ap))i.enableEditing(),i.show(!0),i.annotationElementId&&(r(this,Y).removeChangedExistingAnnotation(i),e.add(i.annotationElementId));const t=r(this,Ar);if(t)for(const i of t.getEditableAnnotations()){if(i.hide(),r(this,Y).isDeletedAnnotationElement(i.data.id)||e.has(i.data.id))continue;const n=await this.deserialize(i);n&&(this.addOrRebuild(n),n.enableEditing())}g(this,_l,!1),r(this,Y)._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){var s;if(g(this,Bl,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),r(this,me)&&!r(this,Sr)){g(this,Sr,new AbortController);const i=r(this,Y).combinedSignal(r(this,Sr));r(this,me).div.addEventListener("pointerdown",n=>{const{clientX:o,clientY:l,timeStamp:h}=n,d=r(this,Ul);if(h-d>500){g(this,Ul,h);return}g(this,Ul,-1);const{classList:u}=this.div;u.toggle("getElements",!0);const f=document.elementsFromPoint(o,l);if(u.toggle("getElements",!1),!this.div.contains(f[0]))return;let p;const m=new RegExp(`^${vh}[0-9]+$`);for(const A of f)if(m.test(A.id)){p=A.id;break}if(!p)return;const v=r(this,qe).get(p);(v==null?void 0:v.annotationElementId)===null&&(n.stopPropagation(),n.preventDefault(),v.dblclick(n))},{signal:i,capture:!0})}const e=r(this,Ar);if(e){const i=new Map,n=new Map;for(const o of r(this,It,Ap)){if(o.disableEditing(),!o.annotationElementId){o.updateFakeAnnotationElement(e);continue}if(o.serialize()!==null){i.set(o.annotationElementId,o);continue}else n.set(o.annotationElementId,o);(s=this.getEditableAnnotation(o.annotationElementId))==null||s.show(),o.remove()}const a=e.getEditableAnnotations();for(const o of a){const{id:l}=o.data;if(r(this,Y).isDeletedAnnotationElement(l)){o.updateEdited({deleted:!0});continue}let h=n.get(l);if(h){h.resetAnnotationElement(o),h.show(!1),o.show();continue}h=i.get(l),h&&(r(this,Y).addChangedExistingAnnotation(h),h.renderAnnotationElement(o)&&h.show(!1)),o.show()}}w(this,It,Jd).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:t}=this.div;for(const i of r(zs,xr).values())t.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),g(this,Bl,!1)}getEditableAnnotation(e){var t;return((t=r(this,Ar))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){r(this,Y).getActive()!==e&&r(this,Y).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=r(this,me))!=null&&e.div&&!r(this,wn)){g(this,wn,new AbortController);const t=r(this,Y).combinedSignal(r(this,wn));r(this,me).div.addEventListener("pointerdown",w(this,It,Bv).bind(this),{signal:t}),r(this,me).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=r(this,me))!=null&&e.div&&r(this,wn)&&(r(this,wn).abort(),g(this,wn,null),r(this,me).div.classList.remove("highlighting"))}enableClick(){if(r(this,wr))return;g(this,wr,new AbortController);const e=r(this,Y).combinedSignal(r(this,wr));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=r(this,wr))==null||e.abort(),g(this,wr,null)}attach(e){r(this,qe).set(e.id,e);const{annotationElementId:t}=e;t&&r(this,Y).isDeletedAnnotationElement(t)&&r(this,Y).removeDeletedAnnotationElement(e)}detach(e){var t;r(this,qe).delete(e.id),(t=r(this,Va))==null||t.removePointerInTextLayer(e.contentDiv),!r(this,Bl)&&e.annotationElementId&&r(this,Y).addDeletedAnnotationElement(e)}remove(e){this.detach(e),r(this,Y).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(r(this,Y).addDeletedAnnotationElement(e.annotationElementId),Ot.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),r(this,Y).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!r(this,_l)),r(this,Y).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var s;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!r(this,bn)&&(e._focusEventsAllowed=!1,g(this,bn,setTimeout(()=>{g(this,bn,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:r(this,Y)._signal}),t.focus())},0))),e._structTreeParentId=(s=r(this,Va))==null?void 0:s.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),s=()=>{e.remove()};this.addCommands({cmd:t,undo:s,mustExec:!1})}getEditorByUID(e){for(const t of r(this,qe).values())if(t.uid===e)return t;return null}getNextId(){return r(this,Y).getId()}combinedSignal(e){return r(this,Y).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=r(this,It,hi))==null?void 0:e.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await r(this,Y).updateMode(e.mode);const{offsetX:s,offsetY:i}=w(this,It,Ep).call(this),n=this.getNextId(),a=w(this,It,wp).call(this,{parent:this,id:n,x:s,y:i,uiManager:r(this,Y),isCentered:!0,...t});a&&this.add(a)}async deserialize(e){var t;return await((t=r(zs,xr).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,r(this,Y)))||null}createAndAddNewEditor(e,t,s={}){const i=this.getNextId(),n=w(this,It,wp).call(this,{parent:this,id:i,x:e.offsetX,y:e.offsetY,uiManager:r(this,Y),isCentered:t,...s});return n&&this.add(n),n}get boundingClientRect(){return this.div.getBoundingClientRect()}addNewEditor(e={}){this.createAndAddNewEditor(w(this,It,Ep).call(this),!0,e)}setSelected(e){r(this,Y).setSelected(e)}toggleSelected(e){r(this,Y).toggleSelected(e)}unselect(e){r(this,Y).unselect(e)}pointerup(e){var i;const{isMac:t}=ye.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!r(this,Er)||(g(this,Er,!1),(i=r(this,It,hi))!=null&&i.isDrawer&&r(this,It,hi).supportMultipleDrawings))return;if(!r(this,Fl)){g(this,Fl,!0);return}const s=r(this,Y).getMode();if(s===tt.STAMP||s===tt.SIGNATURE){r(this,Y).unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){var i;if(r(this,Y).getMode()===tt.HIGHLIGHT&&this.enableTextSelection(),r(this,Er)){g(this,Er,!1);return}const{isMac:t}=ye.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(g(this,Er,!0),(i=r(this,It,hi))!=null&&i.isDrawer){this.startDrawingSession(e);return}const s=r(this,Y).getActive();g(this,Fl,!s||s.isEmpty())}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),r(this,ti)){r(this,It,hi).startDrawing(this,r(this,Y),!1,e);return}r(this,Y).setCurrentDrawingSession(this),g(this,ti,new AbortController);const t=r(this,Y).combinedSignal(r(this,ti));this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(g(this,An,null),this.commitOrRemove())},{signal:t}),r(this,It,hi).startDrawing(this,r(this,Y),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&g(this,An,t);return}r(this,An)&&setTimeout(()=>{var t;(t=r(this,An))==null||t.focus(),g(this,An,null)},0)}endDrawingSession(e=!1){return r(this,ti)?(r(this,Y).setCurrentDrawingSession(null),r(this,ti).abort(),g(this,ti,null),g(this,An,null),r(this,It,hi).endDrawing(e)):null}findNewParent(e,t,s){const i=r(this,Y).findParent(t,s);return i===null||i===this?!1:(i.changeParent(e),!0)}commitOrRemove(){return r(this,ti)?(this.endDrawingSession(),!0):!1}onScaleChanging(){r(this,ti)&&r(this,It,hi).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=r(this,Y).getActive())==null?void 0:e.parent)===this&&(r(this,Y).commitOrRemove(),r(this,Y).setActiveEditor(null)),r(this,bn)&&(clearTimeout(r(this,bn)),g(this,bn,null));for(const s of r(this,qe).values())(t=r(this,Va))==null||t.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,r(this,qe).clear(),r(this,Y).removeLayer(this)}render({viewport:e}){this.viewport=e,Cr(this.div,e);for(const t of r(this,Y).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){r(this,Y).commitOrRemove(),w(this,It,Jd).call(this);const t=this.viewport.rotation,s=e.rotation;if(this.viewport=e,Cr(this.div,{rotation:s}),t!==s)for(const i of r(this,qe).values())i.rotate(s)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return r(this,Y).viewParameters.realScale}};Va=new WeakMap,Fl=new WeakMap,Ar=new WeakMap,wr=new WeakMap,bn=new WeakMap,qe=new WeakMap,Er=new WeakMap,Bl=new WeakMap,_l=new WeakMap,ti=new WeakMap,An=new WeakMap,me=new WeakMap,wn=new WeakMap,Sr=new WeakMap,Ul=new WeakMap,Y=new WeakMap,xr=new WeakMap,It=new WeakSet,Ap=function(){return r(this,qe).size!==0?r(this,qe).values():r(this,Y).getEditors(this.pageIndex)},Bv=function(e){r(this,Y).unselectAll();const{target:t}=e;if(t===r(this,me).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&r(this,me).div.contains(t)){const{isMac:s}=ye.platform;if(e.button!==0||e.ctrlKey&&s)return;r(this,Y).showAllEditors("highlight",!0,!0),r(this,me).div.classList.add("free"),this.toggleDrawing(),lu.startHighlighting(this,r(this,Y).direction==="ltr",{target:r(this,me).div,x:e.x,y:e.y}),r(this,me).div.addEventListener("pointerup",()=>{r(this,me).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:r(this,Y)._signal}),e.preventDefault()}},hi=function(){return r(zs,xr).get(r(this,Y).getMode())},wp=function(e){const t=r(this,It,hi);return t?new t.prototype.constructor(e):null},Ep=function(){const{x:e,y:t,width:s,height:i}=this.boundingClientRect,n=Math.max(0,e),a=Math.max(0,t),o=Math.min(window.innerWidth,e+s),l=Math.min(window.innerHeight,t+i),h=(n+o)/2-e,d=(a+l)/2-t,[u,f]=this.viewport.rotation%180===0?[h,d]:[d,h];return{offsetX:u,offsetY:f}},Jd=function(){for(const e of r(this,qe).values())e.isEmpty()&&e.remove()},M(zs,"_initialized",!1),y(zs,xr,new Map([ep,dp,yp,lu,vp].map(e=>[e._editorType,e])));let cu=zs;var ei,$e,Ga,id,Nu,_v,Ni,Sp,Uv,xp;const ie=class ie{constructor({pageIndex:e}){y(this,Ni);y(this,ei,null);y(this,$e,new Map);y(this,Ga,new Map);this.pageIndex=e}setParent(e){if(!r(this,ei)){g(this,ei,e);return}if(r(this,ei)!==e){if(r(this,$e).size>0)for(const t of r(this,$e).values())t.remove(),e.append(t);g(this,ei,e)}}static get _svgFactory(){return at(this,"_svgFactory",new Sh)}draw(e,t=!1,s=!1){const i=he(ie,id)._++,n=w(this,Ni,Sp).call(this),a=ie._svgFactory.createElement("defs");n.append(a);const o=ie._svgFactory.createElement("path");a.append(o);const l=`path_p${this.pageIndex}_${i}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),t&&r(this,Ga).set(i,o);const h=s?w(this,Ni,Uv).call(this,a,l):null,d=ie._svgFactory.createElement("use");return n.append(d),d.setAttribute("href",`#${l}`),this.updateProperties(n,e),r(this,$e).set(i,n),{id:i,clipPathId:`url(#${h})`}}drawOutline(e,t){const s=he(ie,id)._++,i=w(this,Ni,Sp).call(this),n=ie._svgFactory.createElement("defs");i.append(n);const a=ie._svgFactory.createElement("path");n.append(a);const o=`path_p${this.pageIndex}_${s}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){const u=ie._svgFactory.createElement("mask");n.append(u),l=`mask_p${this.pageIndex}_${s}`,u.setAttribute("id",l),u.setAttribute("maskUnits","objectBoundingBox");const f=ie._svgFactory.createElement("rect");u.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const p=ie._svgFactory.createElement("use");u.append(p),p.setAttribute("href",`#${o}`),p.setAttribute("stroke","none"),p.setAttribute("fill","black"),p.setAttribute("fill-rule","nonzero"),p.classList.add("mask")}const h=ie._svgFactory.createElement("use");i.append(h),h.setAttribute("href",`#${o}`),l&&h.setAttribute("mask",`url(#${l})`);const d=h.cloneNode();return i.append(d),h.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(i,e),r(this,$e).set(s,i),s}finalizeDraw(e,t){r(this,Ga).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;const{root:s,bbox:i,rootClass:n,path:a}=t,o=typeof e=="number"?r(this,$e).get(e):e;if(o){if(s&&w(this,Ni,xp).call(this,o,s),i&&w(l=ie,Nu,_v).call(l,o,i),n){const{classList:h}=o;for(const[d,u]of Object.entries(n))h.toggle(d,u)}if(a){const d=o.firstChild.firstChild;w(this,Ni,xp).call(this,d,a)}}}updateParent(e,t){if(t===this)return;const s=r(this,$e).get(e);s&&(r(t,ei).append(s),r(this,$e).delete(e),r(t,$e).set(e,s))}remove(e){r(this,Ga).delete(e),r(this,ei)!==null&&(r(this,$e).get(e).remove(),r(this,$e).delete(e))}destroy(){g(this,ei,null);for(const e of r(this,$e).values())e.remove();r(this,$e).clear(),r(this,Ga).clear()}};ei=new WeakMap,$e=new WeakMap,Ga=new WeakMap,id=new WeakMap,Nu=new WeakSet,_v=function(e,[t,s,i,n]){const{style:a}=e;a.top=`${100*s}%`,a.left=`${100*t}%`,a.width=`${100*i}%`,a.height=`${100*n}%`},Ni=new WeakSet,Sp=function(){const e=ie._svgFactory.create(1,1,!0);return r(this,ei).append(e),e.setAttribute("aria-hidden",!0),e},Uv=function(e,t){const s=ie._svgFactory.createElement("clipPath");e.append(s);const i=`clip_${t}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const n=ie._svgFactory.createElement("use");return s.append(n),n.setAttribute("href",`#${t}`),n.classList.add("clip"),i},xp=function(e,t){for(const[s,i]of Object.entries(t))i===null?e.removeAttribute(s):e.setAttribute(s,i)},y(ie,Nu),y(ie,id,0);let du=ie;globalThis._pdfjsTestingUtils={HighlightOutliner:ip};globalThis.pdfjsLib={AbortException:Pn,AnnotationEditorLayer:cu,AnnotationEditorParamsType:dt,AnnotationEditorType:tt,AnnotationEditorUIManager:Pr,AnnotationLayer:au,AnnotationMode:xn,AnnotationType:Yt,applyOpacity:_g,build:Hm,ColorPicker:Eh,createValidAbsoluteUrl:Pp,CSSConstants:Bg,DOMSVGFactory:Sh,DrawLayer:du,FeatureTest:ye,fetchData:zl,findContrastColor:Ug,getDocument:Fp,getFilenameFromUrl:kg,getPdfFilenameFromUrl:Ng,getRGB:Vl,getUuid:Ip,getXfaPageViewport:Fg,GlobalWorkerOptions:es,ImageKind:si,InvalidPDFException:Zd,isDataScheme:ad,isPdfFile:Hu,isValidExplicitDest:ym,MathClamp:Ne,noContextMenu:Ts,normalizeUnicode:Lg,OPS:ze,OutputScale:ri,PasswordResponses:Mg,PDFDataRangeTransport:Bp,PDFDateString:Xa,PDFWorker:nu,PermissionFlag:Ig,PixelsPerInch:Rn,RenderingCancelledException:Uu,renderRichText:Lp,ResponseException:yh,setLayerDimensions:Cr,shadow:at,SignatureExtractor:Oi,stopEvent:$t,SupportedImageMimeTypes:qd,TextLayer:$l,TouchManager:Ah,updateUrlHash:Rp,Util:j,VerbosityLevel:jl,version:Um,XfaLayer:Dp};const Ib=Object.freeze(Object.defineProperty({__proto__:null,AbortException:Pn,AnnotationEditorLayer:cu,AnnotationEditorParamsType:dt,AnnotationEditorType:tt,AnnotationEditorUIManager:Pr,AnnotationLayer:au,AnnotationMode:xn,AnnotationType:Yt,CSSConstants:Bg,ColorPicker:Eh,DOMSVGFactory:Sh,DrawLayer:du,FeatureTest:ye,GlobalWorkerOptions:es,ImageKind:si,InvalidPDFException:Zd,MathClamp:Ne,OPS:ze,OutputScale:ri,PDFDataRangeTransport:Bp,PDFDateString:Xa,PDFWorker:nu,PasswordResponses:Mg,PermissionFlag:Ig,PixelsPerInch:Rn,RenderingCancelledException:Uu,ResponseException:yh,SignatureExtractor:Oi,SupportedImageMimeTypes:qd,TextLayer:$l,TouchManager:Ah,Util:j,VerbosityLevel:jl,XfaLayer:Dp,applyOpacity:_g,build:Hm,createValidAbsoluteUrl:Pp,fetchData:zl,findContrastColor:Ug,getDocument:Fp,getFilenameFromUrl:kg,getPdfFilenameFromUrl:Ng,getRGB:Vl,getUuid:Ip,getXfaPageViewport:Fg,isDataScheme:ad,isPdfFile:Hu,isValidExplicitDest:ym,noContextMenu:Ts,normalizeUnicode:Lg,renderRichText:Lp,setLayerDimensions:Cr,shadow:at,stopEvent:$t,updateUrlHash:Rp,version:Um},Symbol.toStringTag,{value:"Module"}));class uu extends Error{constructor(e,t){t!==void 0?super(e??"Invalid PDF",{cause:t}):super(e??"Invalid PDF"),this.name="InvalidPDFException",Object.setPrototypeOf(this,uu.prototype),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,uu)}}class fu extends Error{constructor(e,t){t!==void 0?super(e??"Password required or incorrect",{cause:t}):super(e??"Password required or incorrect"),this.name="PasswordException",Object.setPrototypeOf(this,fu.prototype),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,fu)}}class pu extends Error{constructor(e,t){t!==void 0?super(e??"PDF format error",{cause:t}):super(e??"PDF format error"),this.name="FormatError",Object.setPrototypeOf(this,pu.prototype),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,pu)}}class gu extends Error{constructor(e,t,s){s!==void 0?super(e??"Unknown error",{cause:s}):super(e??"Unknown error"),this.name="UnknownErrorException",Object.setPrototypeOf(this,gu.prototype),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,gu),this.details=t}}class mu extends Error{constructor(e,t,s,i){i!==void 0?super(e??"Response error",{cause:i}):super(e??"Response error"),this.name="ResponseException",Object.setPrototypeOf(this,mu.prototype),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,mu),this.status=t,this.missing=s}}class vu extends Error{constructor(e,t){t!==void 0?super(e??"Operation aborted",{cause:t}):super(e??"Operation aborted"),this.name="AbortException",Object.setPrototypeOf(this,vu.prototype),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,vu)}}function Mb(c){if(c instanceof Error)switch(c.name){case"InvalidPDFException":return new uu(c.message,c);case"PasswordException":return new fu(c.message,c);case"FormatError":return new pu(c.message,c);case"UnknownErrorException":return new gu(c.message,c.details,c);case"ResponseException":return new mu(c.message,c.status,c.missing,c);case"AbortException":return new vu(c.message,c);default:return c}return new Error(String(c))}class te{static applyTransform(e,t){const s=e[0]*t[0]+e[1]*t[2]+t[4],i=e[0]*t[1]+e[1]*t[3]+t[5];return[s,i]}}M(te,"tolerance",2);class rt extends te{constructor(t,s){super();M(this,"x");M(this,"y");this.x=t,this.y=s}equal(t){return t.x===this.x&&t.y===this.y}transform(t){const s=te.applyTransform([this.x,this.y],t);return this.x=s[0],this.y=s[1],this}}var Vs=(c=>(c[c.None=0]="None",c[c.Horizontal=1]="Horizontal",c[c.Vertical=2]="Vertical",c))(Vs||{});class ve extends te{constructor(t,s){super();M(this,"from");M(this,"to");M(this,"direction",0);M(this,"length",0);M(this,"intersections",[]);M(this,"gaps",[]);M(this,"_valid");this.from=t,this.to=s,this.init()}init(){let t=this.from,s=this.to;if(Math.abs(t.y-s.y)<te.tolerance){if(this.direction=1,s.y=t.y,t.x>s.x){const i=t;t=s,s=i}this.length=s.x-t.x}else if(Math.abs(t.x-s.x)<te.tolerance){if(this.direction=2,s.x=t.x,t.y>s.y){const i=t;t=s,s=i}this.length=s.y-t.y}this.from=t,this.to=s}get valid(){return this._valid===void 0&&(this._valid=this.direction!==0&&this.length>te.tolerance),this._valid}get normalized(){return this.direction===1?new ve(new rt(this.from.x-te.tolerance,this.from.y),new rt(this.to.x+te.tolerance,this.from.y)):this.direction===2?new ve(new rt(this.from.x,this.from.y-te.tolerance),new rt(this.from.x,this.to.y+te.tolerance)):this}addGap(t){this.gaps.push(t)}containsPoint(t){return this.direction===2?this.from.x===t.x&&t.y>=this.from.y&&t.y<=this.to.y:this.direction===1?this.from.y===t.y&&t.x>=this.from.x&&t.x<=this.to.x:!1}addIntersectionPoint(t){for(const s of this.intersections)if(s.equal(t))return;this.intersections.push(t)}intersection(t){let s;if(!this.valid||!t.valid)return s;const i=this.normalized,n=t.normalized;if(this.direction===1&&t.direction===2){const a=n.from.x,o=i.from.y;if(a>i.from.x&&a<i.to.x&&o>n.from.y&&o<n.to.y){const h=new rt(a,o);this.addIntersectionPoint(h),t.addIntersectionPoint(h),s=h}}else if(this.direction===2&&t.direction===1){const a=i.from.x,o=n.from.y;if(a>n.from.x&&a<n.to.x&&o>i.from.y&&o<i.to.y){const h=new rt(a,o);this.addIntersectionPoint(h),t.addIntersectionPoint(h),s=h}}return s}transform(t){const s=this.from.transform(t),i=this.to.transform(t),n=Math.min(s.x,i.x),a=Math.min(s.y,i.y),o=Math.abs(s.x-i.x),l=Math.abs(s.y-i.y);return this.from=new rt(n,a),this.to=new rt(n+o,a+l),this.init(),this}}class Db{constructor(e,t,s,i){M(this,"minXY");M(this,"maxXY");M(this,"rows");M(this,"rowPivots");M(this,"colPivots");this.minXY=e,this.maxXY=t,this.rows=[],this.rowPivots=s,this.colPivots=i}findCell(e,t){if(e>=this.minXY.x&&t>=this.minXY.y&&e<=this.maxXY.x&&t<=this.maxXY.y){for(const s of this.rows)for(const i of s)if(i.minXY.x<=e&&i.minXY.y<=t&&i.maxXY.x>=e&&i.maxXY.y>=t)return i}}get cellCount(){return this.rows.reduce((e,t)=>e+t.length,0)}get rowCount(){return this.rows.length}check(){const e=(this.colPivots.length-1)*(this.rowPivots.length-1);let t=0;for(const s of this.rows)for(const i of s){const n=(i.colspan||1)*(i.rowspan||1);t+=n}return e===t}toArray(){const e=[];for(const t of this.rows){const s=[];for(const i of t){let n=i.text.join("");n=n.replace(/^[\s]+|[\s]+$/g,""),n=n.trim(),s.push(n)}e.push(s)}return e}}class Sg{constructor(e){M(this,"hLines",[]);M(this,"vLines",[]);e.direction===Vs.Horizontal?this.hLines.push(e):e.direction===Vs.Vertical&&this.vLines.push(e)}get isValid(){return this.hLines.length+this.vLines.length>4}get rowPivots(){const e=new Set;for(const t of this.hLines)e.add(t.from.y);return[...e].sort((t,s)=>t-s)}get colPivots(){const e=new Set;for(const t of this.vLines)e.add(t.from.x);return[...e].sort((t,s)=>t-s)}add(e){if(this.intersection(e)){if(e.direction===Vs.Horizontal)return this.hLines.push(e),!0;if(e.direction===Vs.Vertical)return this.vLines.push(e),!0}return!1}intersection(e){let t=!1;if(!e.valid)return t;if(e.direction===Vs.Horizontal)for(const s of this.vLines)e.intersection(s)&&(t=!0);else if(e.direction===Vs.Vertical)for(const s of this.hLines)e.intersection(s)&&(t=!0);return t}getSameHorizontal(e){const t=[e],s=[];for(;this.hLines.length>0;){const i=this.hLines.shift();i&&(i.from.y===e.from.y?t.push(i):s.push(i))}return this.hLines=s,t}getSameVertical(e){const t=[e],s=[];for(;this.vLines.length>0;){const i=this.vLines.shift();i&&(i.from.x===e.from.x?t.push(i):s.push(i))}return this.vLines=s,t}mergeHorizontalLines(e){e.sort((n,a)=>n.from.x-a.from.x);const t=e[0].from.x,s=e[e.length-1].to.x,i=new ve(new rt(t,e[0].from.y),new rt(s,e[0].from.y));for(let n=1;n<e.length;n++){const a=e[n-1],o=e[n];if(Math.abs(a.to.x-o.from.x)>te.tolerance){const l=new ve(new rt(a.to.x,a.from.y),new rt(o.from.x,o.from.y));i.addGap(l)}}return i}mergeVerticalLines(e){e.sort((n,a)=>n.from.y-a.from.y);const t=e[0].from.y,s=e[e.length-1].to.y,i=new ve(new rt(e[0].from.x,t),new rt(e[0].from.x,s));for(let n=1;n<e.length;n++){const a=e[n-1],o=e[n];if(Math.abs(a.to.y-o.from.y)>te.tolerance){const l=new ve(new rt(a.to.x,a.to.y),new rt(a.to.x,o.from.y));i.addGap(l)}}return i}normalize(){this.hLines=this.hLines.filter(s=>s.intersections.length>1),this.vLines=this.vLines.filter(s=>s.intersections.length>1),this.hLines.sort((s,i)=>s.from.y-i.from.y),this.vLines.sort((s,i)=>s.from.x-i.from.x);const e=[];for(;this.hLines.length>0;){const s=this.hLines.shift();if(!s)continue;const i=this.getSameHorizontal(s),n=this.mergeHorizontalLines(i);e.push(n)}this.hLines=e;const t=[];for(;this.vLines.length>0;){const s=this.vLines.shift();if(!s)continue;const i=this.getSameVertical(s),n=this.mergeVerticalLines(i);t.push(n)}this.vLines=t}verticalExists(e,t,s){if(e.direction!==Vs.Vertical)throw new Error("Line is not vertical");if(t>=s)throw new Error("y1 must be less than y2");if(e.from.y<=t&&e.to.y>=s){for(const i of e.gaps)if(i.from.y<=t&&i.to.y>=s)return!1;return!0}return!1}horizontalExists(e,t,s){if(e.direction!==Vs.Horizontal)throw new Error("Line is not horizontal");if(t>=s)throw new Error("x1 must be less than x2");if(e.from.x<=t&&e.to.x>=s){for(const i of e.gaps)if(i.from.x<=t&&i.to.x>=s)return!1;return!0}return!1}findBottomLineIndex(e,t){for(let s=e;s<this.hLines.length;s++){const i=this.hLines[s];if(i.from.x<=t&&i.to.x>=t)return s}return-1}findVerticalLineIndexs(e,t){const s=[];for(let i=0;i<this.vLines.length;i++){const n=this.vLines[i];n.from.y<=t&&n.to.y>=t&&e.intersection(n)&&s.push(i)}return s}getRow(e,t,s){const i=[],n=this.hLines[e],a=this.findVerticalLineIndexs(n,s);for(let o=1;o<a.length;o++){const l=this.vLines[a[o-1]],h=this.vLines[a[o]],d=(l.from.x+h.from.x)/2,u=this.findBottomLineIndex(t,d),f=this.hLines[u],p={minXY:new rt(l.from.x,n.from.y),maxXY:new rt(h.from.x,f.from.y),width:h.from.x-l.from.x,height:f.from.y-n.from.y,text:[]},m=a[o]-a[o-1],v=u-e;m>1&&(p.colspan=m),v>1&&(p.rowspan=v),i.push(p)}return i}toData(){const e=this.rowPivots,t=this.colPivots,s=new rt(t[0],e[0]),i=new rt(t[t.length-1],e[e.length-1]),n=new Db(s,i,e,t);for(let a=1;a<this.hLines.length;a++){const o=this.hLines[a-1],l=this.hLines[a],h=(o.from.y+l.from.y)/2,d=this.getRow(a-1,a,h);n.rows.push(d)}return n}}class Lb{constructor(){M(this,"hLines",[]);M(this,"vLines",[])}add(e){e.valid&&(e.direction===Vs.Horizontal?this.hLines.push(e):e.direction===Vs.Vertical&&this.vLines.push(e))}addRectangle(e){for(const t of e.getLines())this.add(t)}getTableData(){const e=[],t=this.getTables();for(const s of t){const i=s.toData();i&&e.push(i)}return e}getTables(){const e=[];for(;this.hLines.length!==0;){const s=this.hLines.shift();if(!s||this.tryFill(e,s))continue;const n=new Sg(s);this.fillTable(n),e.push(n)}for(;this.vLines.length!==0;){const s=this.vLines.shift();if(!s||this.tryFill(e,s))continue;const n=new Sg(s);this.fillTable(n),e.push(n)}const t=e.filter(s=>s.isValid);for(const s of t)s.normalize();return t}normalize(){this.normalizeHorizontal(),this.normalizeVertical()}normalizeHorizontal(){var s;this.hLines.sort((i,n)=>i.from.y-n.from.y);const e=[];let t=[];for(const i of this.hLines)if(t.length===0)t.push(i);else if(Math.abs(((s=t[0])==null?void 0:s.from.y)-i.from.y)<te.tolerance)t.push(i);else{const n=this.margeHorizontalLines(t);e.push(...n),t=[i]}if(t.length>0){const i=this.margeHorizontalLines(t);e.push(...i)}this.hLines=e}normalizeVertical(){var s;this.vLines.sort((i,n)=>i.from.x-n.from.x);const e=[];let t=[];for(const i of this.vLines)if(t.length===0)t.push(i);else if(Math.abs(((s=t[0])==null?void 0:s.from.x)-i.from.x)<te.tolerance)t.push(i);else{const n=this.margeVerticalLines(t);e.push(...n),t=[i]}if(t.length>0){const i=this.margeVerticalLines(t);e.push(...i)}this.vLines=e}fillTable(e){const t=[],s=[];for(const i of this.vLines)e.add(i)||t.push(i);for(const i of this.hLines)e.add(i)||s.push(i);this.hLines=s,this.vLines=t}tryFill(e,t){for(const s of e)if(s.add(t))return this.fillTable(s),!0;return!1}margeHorizontalLines(e){var o;const t=[];e.sort((l,h)=>l.from.x-h.from.x);const s=(o=e[0])==null?void 0:o.from.y;if(s===void 0)return t;let i=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;for(const l of e)l.from.x-n<te.tolerance?(l.from.x<i&&(i=l.from.x),l.to.x>n&&(n=l.to.x)):(n>i&&t.push(new ve(new rt(i,s),new rt(n,s))),i=l.from.x,n=l.to.x);const a=t[t.length-1];return a?a.from.x!==i&&a.to.x!==n&&t.push(new ve(new rt(i,s),new rt(n,s))):t.push(new ve(new rt(i,s),new rt(n,s))),t}margeVerticalLines(e){var o;const t=[];e.sort((l,h)=>l.from.y-h.from.y);const s=(o=e[0])==null?void 0:o.from.x;if(s===void 0)return t;let i=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;for(const l of e)l.from.y-n<te.tolerance?(l.from.y<i&&(i=l.from.y),l.to.y>n&&(n=l.to.y)):(n>i&&t.push(new ve(new rt(s,i),new rt(s,n))),i=l.from.y,n=l.to.y);const a=t[t.length-1];return a?a.from.y!==i&&a.to.y!==n&&t.push(new ve(new rt(s,i),new rt(s,n))):t.push(new ve(new rt(s,i),new rt(s,n))),t}}class Ob extends te{constructor(t,s,i){super();M(this,"from");M(this,"width");M(this,"height");this.from=t,this.width=s,this.height=i}get to(){return new rt(this.from.x+this.width,this.from.y+this.height)}getLines(){const t=this.to;return[new ve(this.from,new rt(t.x,this.from.y)),new ve(this.from,new rt(this.from.x,t.y)),new ve(new rt(t.x,this.from.y),t),new ve(new rt(this.from.x,t.y),t)].filter(i=>i.valid)}transform(t){const s=te.applyTransform([this.from.x,this.from.y],t),i=te.applyTransform([this.from.x+this.width,this.from.y+this.height],t),n=Math.min(s[0],i[0]),a=Math.min(s[1],i[1]),o=Math.abs(s[0]-i[0]),l=Math.abs(s[1]-i[1]);return this.from=new rt(n,a),this.width=o,this.height=l,this}}class kb{constructor(e){M(this,"pages",[]);M(this,"total",0);this.total=e}getPageImage(e,t){for(const s of this.pages)if(s.pageNumber===e){for(const i of s.images)if(i.name===t)return i}return null}}const Mr=["xmp:createdate","xmp:modifydate","xmp:metadatadate","xap:createdate","xap:modifydate","xap:metadatadate"];class Nb{constructor(e){M(this,"total");M(this,"info");M(this,"metadata");M(this,"fingerprints");M(this,"permission");M(this,"outline");M(this,"pages",[]);this.total=e}getDateNode(){var i,n,a;const e={},t=(i=this.info)==null?void 0:i.CreationDate;t&&(e.CreationDate=Xa.toDateObject(t));const s=(n=this.info)==null?void 0:n.ModDate;if(s&&(e.ModDate=Xa.toDateObject(s)),!this.metadata)return e;for(const o of Mr){const l=(a=this.metadata)==null?void 0:a.get(o),h=this.parseISODateString(l);switch(o){case Mr[0]:e.XmpCreateDate=h;break;case Mr[1]:e.XmpModifyDate=h;break;case Mr[2]:e.XmpMetadataDate=h;break;case Mr[3]:e.XapCreateDate=h;break;case Mr[4]:e.XapModifyDate=h;break;case Mr[5]:e.XapMetadataDate=h;break}}return e}parseISODateString(e){if(!e)return;const t=Date.parse(e);if(!Number.isNaN(t))return new Date(t)}}function qu(c){return c.lineThreshold=(c==null?void 0:c.lineThreshold)??4.6,c.cellThreshold=(c==null?void 0:c.cellThreshold)??7,c.cellSeparator=(c==null?void 0:c.cellSeparator)??"	",c.lineEnforce=(c==null?void 0:c.lineEnforce)??!0,c.pageJoiner=(c==null?void 0:c.pageJoiner)??`
-- page_number of total_number --`,c.imageThreshold=(c==null?void 0:c.imageThreshold)??80,c.imageDataUrl=(c==null?void 0:c.imageDataUrl)??!0,c.imageBuffer=(c==null?void 0:c.imageBuffer)??!0,c.scale=(c==null?void 0:c.scale)??1,c}var Ui=(c=>(c[c.undefined=0]="undefined",c[c.hline=1]="hline",c[c.vline=2]="vline",c[c.rectangle=3]="rectangle",c))(Ui||{});class Fb{constructor(e){M(this,"pages",[]);M(this,"total",0);this.total=e}}class Bb{constructor(e){M(this,"pages",[]);M(this,"mergedTables",[]);M(this,"total",0);this.total=e}}class _b{constructor(e){M(this,"pages",[]);M(this,"text","");M(this,"total",0);this.total=e}getPageText(e){for(const t of this.pages)if(t.num===e)return t.text;return""}}class Wb{constructor(e){M(this,"options");M(this,"doc");M(this,"progress",{loaded:-1,total:0});e.verbosity===void 0&&(e.verbosity=jl.ERRORS),typeof Buffer<"u"&&e.data instanceof Buffer&&(e.data=new Uint8Array(e.data)),this.options=e}async destroy(){this.doc&&(await this.doc.destroy(),this.doc=void 0)}static get isNodeJS(){return typeof process=="object"&&`${process}`=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&typeof process.type<"u"&&process.type!=="browser")}static setWorker(e){return typeof globalThis.pdfjs>"u"&&(globalThis.pdfjs=Ib),es===null?"":(e!==void 0&&(es.workerSrc=e),es.workerSrc)}async getInfo(e={}){const t=await this.load(),s=new Nb(t.numPages),{info:i,metadata:n}=await t.getMetadata();s.info=i,s.metadata=n,s.fingerprints=t.fingerprints,s.outline=await t.getOutline(),s.permission=await t.getPermissions();const a=await t.getPageLabels();if(e.parsePageInfo){for(let o=1;o<=s.total;o++)if(this.shouldParse(o,s.total,e)){const l=await t.getPage(o),h=await this.getPageLinks(l);h.pageLabel=a==null?void 0:a[l.pageNumber],s.pages.push(h),l.cleanup()}}return s}async getPageLinks(e){const t=e.getViewport({scale:1}),s={pageNumber:e.pageNumber,links:[],width:t.width,height:t.height},i=await e.getAnnotations({intent:"display"})||[];for(const n of i){if(n.subtype!=="Link")continue;const a=n.url??n.unsafeUrl;if(!a)continue;const o=n.overlaidText||"";s.links.push({url:a,text:o})}return s}async getText(e={}){const t=await this.load(),s=new _b(t.numPages);for(let i=1;i<=s.total;i++)if(this.shouldParse(i,s.total,e)){const n=await t.getPage(i),a=await this.getPageText(n,e,s.total);s.pages.push({text:a,num:i}),n.cleanup()}for(const i of s.pages)if(e.pageJoiner){let n=e.pageJoiner.replace("page_number",`${i.num}`);n=n.replace("total_number",`${s.total}`),s.text+=`${i.text}
${n}

`}else s.text+=`${i.text}

`;return s}async load(){try{if(this.doc===void 0){const e=Fp(this.options);e.onProgress=t=>{this.progress=t},this.doc=await e.promise}return this.doc}catch(e){throw Mb(e)}}shouldParse(e,t,s){return s.partial=(s==null?void 0:s.partial)??[],s.first=(s==null?void 0:s.first)??0,s.last=(s==null?void 0:s.last)??0,s.partial.length>0?!!s.partial.includes(e):s.first>0&&s.last>0?e>=s.first&&e<=s.last:s.first>0?e<=s.first:s.last>0?e>t-s.last:!0}async getPageText(e,t,s){const i=e.getViewport({scale:1}),n=qu(t),a=await e.getTextContent({includeMarkedContent:!!n.includeMarkedContent,disableNormalization:!!n.disableNormalization});let o=new Map;n.parseHyperlinks&&(o=await this.getHyperlinks(e,i));const l=[];let h,d,u=0;for(const f of a.items){if(!("str"in f))continue;const p=f.transform??f.transform,[m,v]=i.convertToViewportPoint(p[4],p[5]);if(n.parseHyperlinks){const b=(o.get(f.str)||[]).find(S=>m>=S.rect.left&&m<=S.rect.right&&v>=S.rect.top&&v<=S.rect.bottom);b&&(f.str=`[${f.str}](${b.url})`)}if(n.lineEnforce&&d!==void 0&&Math.abs(d-v)>n.lineThreshold){const A=l.length?l[l.length-1]:void 0,b=f.str.startsWith(`
`)||f.str.trim()===""&&f.hasEOL;(A==null?void 0:A.endsWith(`
`))===!1&&!b&&Math.abs(d-v)-1>u&&(l.push(`
`),u=0)}n.cellSeparator&&d!==void 0&&Math.abs(d-v)<n.lineThreshold&&h!==void 0&&Math.abs(h-m)>n.cellThreshold&&(f.str=`${n.cellSeparator}${f.str}`),l.push(f.str),h=m+f.width,d=v,u=Math.max(u,f.height),f.hasEOL&&l.push(`
`),(f.hasEOL||f.str.endsWith(`
`))&&(u=0)}return n.itemJoiner?l.join(n.itemJoiner):l.join("")}async getHyperlinks(e,t){const s=new Map,i=await e.getAnnotations({intent:"display"})||[];for(const n of i){if(n.subtype!=="Link")continue;const a=n.url??n.unsafeUrl;if(!a)continue;const o=n.overlaidText;if(!o)continue;const l=t.convertToViewportRectangle(n.rect),h=Math.min(l[0],l[2])-.5,d=Math.min(l[1],l[3])-.5,u=Math.max(l[0],l[2])+.5,f=Math.max(l[1],l[3])+.5,p={rect:{left:h,top:d,right:u,bottom:f},url:a,text:o,used:!1},m=s.get(o);m?m.push(p):s.set(o,[p])}return s}async getImage(e={}){const t=await this.load(),s=new kb(t.numPages);qu(e);for(let i=1;i<=s.total;i++)if(this.shouldParse(i,s.total,e)){const n=await t.getPage(i),a=await n.getOperatorList(),o={pageNumber:i,images:[]};s.pages.push(o);for(let l=0;l<a.fnArray.length;l++)if(a.fnArray[l]===ze.paintInlineImageXObject||a.fnArray[l]===ze.paintImageXObject){const h=a.argsArray[l][0],u=n.commonObjs.has(h)?this.resolveEmbeddedImage(n.commonObjs,h):this.resolveEmbeddedImage(n.objs,h),{width:f,height:p,kind:m,data:v}=await u;if(e.imageThreshold&&(e.imageThreshold>=f||e.imageThreshold>=p))continue;const b=t.canvasFactory.create(f,p),S=b.context;let E=null;m===si.RGBA_32BPP?(E=S.createImageData(f,p),E.data.set(v)):(E=S.createImageData(f,p),this.convertToRGBA({src:v,dest:new Uint32Array(E.data.buffer),width:f,height:p,kind:m})),S.putImageData(E,0,0);let T=new Uint8Array,x="";if(typeof b.canvas.toBuffer=="function"){let C;e.imageBuffer&&(C=b.canvas.toBuffer("image/png"),T=new Uint8Array(C)),e.imageDataUrl&&(C?x=`data:image/png;base64,${C.toString("base64")}`:(C=b.canvas.toBuffer("image/png"),T=new Uint8Array(C),x=`data:image/png;base64,${C.toString("base64")}`))}else{if(e.imageBuffer){const C=b.context.getImageData(0,0,b.canvas.width,b.canvas.height);T=new Uint8Array(C.data)}e.imageDataUrl&&(x=b.canvas.toDataURL("image/png"))}o.images.push({data:T,dataUrl:x,name:h,height:p,width:f,kind:m})}}return s}convertToRGBA({src:e,dest:t,width:s,height:i,kind:n}){if(n===si.RGB_24BPP)for(let a=0,o=0;a<e.length;a+=3,o++){const l=e[a],h=e[a+1],d=e[a+2];t[o]=255<<24|d<<16|h<<8|l}else if(n===si.GRAYSCALE_1BPP){let a=0;for(let o=0;o<e.length;o++){const l=e[o];for(let h=7;h>=0&&!(a>=s*i);h--){const u=(l>>h&1)===1?255:0;t[a++]=255<<24|u<<16|u<<8|u}}}else if(n==null){const a=e.length/(s*i);if(Math.abs(a-3)<.1)for(let o=0,l=0;o<e.length;o+=3,l++){const h=e[o],d=e[o+1],u=e[o+2];t[l]=255<<24|u<<16|d<<8|h}else if(Math.abs(a-4)<.1)for(let o=0,l=0;o<e.length;o+=4,l++){const h=e[o],d=e[o+1],u=e[o+2],f=e[o+3];t[l]=f<<24|u<<16|d<<8|h}else if(Math.abs(a-1)<.1)for(let o=0;o<e.length;o++){const l=e[o];t[o]=255<<24|l<<16|l<<8|l}else throw new Error(`convertToRGBA: Cannot infer image format. kind: ${n}, bytesPerPixel: ${a}, width: ${s}, height: ${i}, dataLength: ${e.length}`)}else throw new Error(`convertToRGBA: Unsupported image kind: ${n}. Available kinds: GRAYSCALE_1BPP=${si.GRAYSCALE_1BPP}, RGB_24BPP=${si.RGB_24BPP}, RGBA_32BPP=${si.RGBA_32BPP}`)}resolveEmbeddedImage(e,t){return new Promise((s,i)=>{e.get(t,n=>{var a;if(n){let o;if(n.data instanceof Uint8Array)o=n.data;else if(n.data instanceof Uint8ClampedArray)o=new Uint8Array(n.data);else if((a=n.data)!=null&&a.buffer)o=new Uint8Array(n.data.buffer);else if(n.bitmap){const h=this.doc.canvasFactory.create(n.bitmap.width,n.bitmap.height);h.context.drawImage(n.bitmap,0,0);const d=h.context.getImageData(0,0,n.bitmap.width,n.bitmap.height);o=new Uint8Array(d.data.buffer)}else ArrayBuffer.isView(n.data)&&(o=new Uint8Array(n.data.buffer,n.data.byteOffset,n.data.byteLength));if(!o){i(new Error(`Image object ${t}: data field is empty or invalid. Available fields: ${Object.keys(n).join(", ")}`));return}if(o.length===0){i(new Error(`Image object ${t}: data buffer is empty (length: 0)`));return}s({width:n.width,height:n.height,kind:n.kind,data:o})}else i(new Error(`Image object ${t} not found`))})})}async getScreenshot(e={}){const t=qu(e),s=await this.load(),i=new Fb(s.numPages);if(this.doc===void 0)throw new Error("PDF document not loaded");for(let n=1;n<=i.total;n++)if(this.shouldParse(n,i.total,t)){const a=await this.doc.getPage(n);let o=a.getViewport({scale:t.scale});if(t.desiredWidth){o=a.getViewport({scale:1});const m=t.desiredWidth/o.width;o=a.getViewport({scale:m})}const h=this.doc.canvasFactory.create(o.width,o.height),d={canvasContext:h.context,viewport:o,canvas:h.canvas};await a.render(d).promise;let f=new Uint8Array,p="";if(typeof h.canvas.toBuffer=="function"){let m;t.imageBuffer&&(m=h.canvas.toBuffer("image/png"),f=new Uint8Array(m)),t.imageDataUrl&&(m?p=`data:image/png;base64,${m.toString("base64")}`:(m=h.canvas.toBuffer("image/png"),f=new Uint8Array(m),p=`data:image/png;base64,${m.toString("base64")}`))}else{if(t.imageBuffer){const m=h.context.getImageData(0,0,h.canvas.width,h.canvas.height);f=new Uint8Array(m.data)}t.imageDataUrl&&(p=h.canvas.toDataURL("image/png"))}i.pages.push({data:f,dataUrl:p,pageNumber:n,width:o.width,height:o.height,scale:o.scale}),a.cleanup()}return i}async getTable(e={}){const t=await this.load(),s=new Bb(t.numPages);if(this.doc===void 0)throw new Error("PDF document not loaded");for(let i=1;i<=s.total;i++)if(this.shouldParse(i,s.total,e)){const n=await this.doc.getPage(i),a=await this.getPageTables(n);a.normalize();const o=a.getTableData();await this.fillPageTables(n,o);const l={num:i,tables:[]};for(const h of o)l.tables.push(h.toArray());s.pages.push(l),n.cleanup()}return s}getPathGeometry(e){const t=e[2]-e[0],s=e[3]-e[1];return e[0]===1/0?Ui.undefined:t>5&&s>5?Ui.rectangle:t>5&&s===0?Ui.hline:t===0&&s>5?Ui.vline:Ui.undefined}async getPageTables(e){const t=new Lb,s=e.getViewport({scale:1});let i=[1,0,0,1,0,0];const n=[],a=await e.getOperatorList();for(let o=0;o<a.fnArray.length;o++){const l=a.fnArray[o],h=a.argsArray[o],d=(h==null?void 0:h[0])??0,u=(h==null?void 0:h[2])??[1/0,1/0,-1/0,-1/0];if(l===ze.constructPath){if(ze.fill,d!==ze.stroke)continue;const f=this.getPathGeometry(u);if(f===Ui.rectangle){const p=new Ob(new rt(u[0],u[1]),u[2]-u[0],u[3]-u[1]);p.transform(i),p.transform(s.transform),t.addRectangle(p)}else if(f===Ui.hline||f===Ui.vline){const p=new rt(u[0],u[1]),m=new rt(u[2],u[3]),v=new ve(p,m);v.transform(i),v.transform(s.transform),t.add(v)}}else if(l!==ze.setLineWidth)if(l===ze.save)n.push(i);else if(l===ze.restore){const f=n.pop();f&&(i=f)}else l===ze.transform&&(i=j.transform(i,h))}return t}async fillPageTables(e,t){const s=e.getViewport({scale:1}),i=await e.getTextContent({includeMarkedContent:!1,disableNormalization:!1});for(const n of i.items){if(!("str"in n))continue;const a=j.transform(j.transform(s.transform,n.transform),[1,0,0,-1,0,0]);for(const o of t){const l=o.findCell(a[4],a[5]);if(l){l.text.push(n.str),n.hasEOL&&l.text.push(`
`);break}}}}}export{vu as AbortException,pu as FormatError,uu as InvalidPDFException,ve as Line,Vs as LineDirection,Lb as LineStore,Wb as PDFParse,fu as PasswordException,rt as Point,Ob as Rectangle,mu as ResponseException,te as Shape,Sg as Table,gu as UnknownErrorException,jl as VerbosityLevel,Mb as getException};
