import{j as e,S as C,I as j,bt as W,v as _,T as L,B as G,k as J,b9 as q,aB as ce,aK as B,L as de,em as V,aL as z,dd as X,o as w,dl as Z,bb as E,bc as y,ar as Q,d as N,r as p,n as pe,eX as me,b as he,h as ue,i as xe,dr as je,eZ as be,dA as H,p as T,e5 as ge,R as ve,dq as $,dM as M,cL as Ce,cK as fe,f0 as ye,cV as I,dh as we,e$ as Te,H as De,C as Se}from"./index-BSItzkt3.js";import{C as Y}from"./confirm-dialog-DqS9qtsb.js";import{C as ke}from"./custom-breadcrumbs-u_kfWYpE.js";import{u as Ie,g as Pe,r as Re,T as Fe,e as Ae}from"./table-selected-action-0G1slXmy.js";import{T as Be}from"./table-no-data-36lSiWIp.js";import{T as Le}from"./table-empty-rows-MM8A-hC6.js";import{T as Ee}from"./table-head-custom-Dm2EGBL8.js";import{T as Ne}from"./table-pagination-custom-FhZ3GpxG.js";import{c as Oe,b as ee}from"./format-number-BVcmMM5V.js";import{T as We,a as Ve,b as ze}from"./TableHead-DAuzvg-9.js";import{T as v}from"./TableCell-B7TbLBfh.js";import{C as te}from"./Checkbox-p5PKnry8.js";import{F as He}from"./FormControl-1z33WGqh.js";import{I as $e}from"./InputLabel-DqZ4yv4U.js";import{S as Me,O as Ke}from"./Select-QPCMlUZ4.js";import{D as K}from"./DatePicker-BK0jorBV.js";import{f as Ue}from"./FormHelperText-CBXzj8d7.js";import{T as _e}from"./TextField-DpdcsLRb.js";import{F as Ge,a as P,c as R}from"./filters-result-CMxzGTKR.js";import{C as F}from"./Chip-CHY_XJWs.js";import{C as U}from"./Card-BqWDE3fr.js";import"./invoice-details-Cs6IWuA5.js";import"./DialogTitle-D9mOMHyE.js";import"./dialogTitleClasses-BJYaWiXv.js";import"./DialogContent-CPx_wcNJ.js";import"./empty-content-Cx4hswZg.js";import"./TablePagination-BVQvXhS8.js";import"./LastPage-DHcM-itg.js";import"./FormControlLabel-CtXEP1QR.js";import"./FormLabel-Dg62SF9b.js";import"./Menu-Cy0n4kRw.js";import"./index-b5NUrSMh.js";import"./visuallyHidden-Dan1xhjv.js";import"./ListItem-Doeuyi4X.js";import"./zod-BOXuI70n.js";import"./form-provider-IFaCVrX4.js";import"./Rating-LRaLudfA.js";import"./editor-cOR4tKCy.js";import"./index-DC_o48Ax.js";import"./Slider-B4qW6LuH.js";import"./RadioGroup-DuXlXr3g.js";import"./FormGroup-DIAu_15X.js";import"./countries-DSLisFCy.js";import"./Autocomplete-B4c-hVbi.js";import"./country-select-B4qFdROS.js";import"./upload-C5NUn5Ko.js";import"./preview-multi-file-C1SdoyfF.js";import"./file-thumbnail-J0C6dV__.js";import"./upload-avatar-DTAGrxFf.js";import"./avatar-url-S8pB8DFh.js";import"./image-BuqYs7tq.js";import"./MobileDateTimePicker-Baldv5MM.js";import"./schema-helper-DeS_g_Vm.js";import"./address-new-form-Dd2-RYbJ.js";import"./LoadingButton-HyVDRRh6.js";import"./__vite-browser-external-DVYdme3K.js";function D({title:t,total:m,icon:s,color:l,percent:n,price:x}){return e.jsxs(C,{spacing:2.5,direction:"row",alignItems:"center",justifyContent:"center",sx:{width:1,minWidth:200},children:[e.jsxs(C,{alignItems:"center",justifyContent:"center",sx:{position:"relative"},children:[e.jsx(j,{icon:s,width:32,sx:{color:l,position:"absolute"}}),e.jsx(W,{size:56,thickness:2,value:n,variant:"determinate",sx:{color:l,opacity:.48}}),e.jsx(W,{size:56,value:100,thickness:3,variant:"determinate",sx:{top:0,left:0,opacity:.48,position:"absolute",color:b=>_(b.vars.palette.grey["500Channel"],.16)}})]}),e.jsxs(C,{spacing:.5,children:[e.jsx(L,{variant:"subtitle1",children:t}),e.jsxs(G,{component:"span",sx:{color:"text.disabled",typography:"body2"},children:[Oe(m)," فاکتور"]}),e.jsx(L,{variant:"subtitle2",children:ee(x)})]})]})}const Je=t=>({paid:"پرداخت شده",pending:"در انتظار",overdue:"سررسید گذشته",draft:"پیش‌نویس"})[t]||t;function qe({row:t,selected:m,onSelectRow:s,onViewRow:l,onEditRow:n,onDeleteRow:x}){const b=J(),c=q();return e.jsxs(e.Fragment,{children:[e.jsxs(We,{hover:!0,selected:m,children:[e.jsx(v,{padding:"checkbox",children:e.jsx(te,{checked:m,onClick:s,inputProps:{id:`row-checkbox-${t.id}`,"aria-label":"Row checkbox"}})}),e.jsx(v,{children:e.jsxs(C,{spacing:2,direction:"row",alignItems:"center",children:[e.jsx(ce,{alt:t.invoiceTo.name,children:t.invoiceTo.name.charAt(0).toUpperCase()}),e.jsx(B,{disableTypography:!0,primary:e.jsx(L,{variant:"body2",noWrap:!0,children:t.invoiceTo.name}),secondary:e.jsx(de,{noWrap:!0,variant:"body2",onClick:l,sx:{color:"text.disabled",cursor:"pointer"},children:t.invoiceNumber})})]})}),e.jsx(v,{children:e.jsx(B,{primary:z(t.createDate),secondary:V(t.createDate),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsx(v,{children:e.jsx(B,{primary:z(t.dueDate),secondary:V(t.dueDate),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsx(v,{children:ee(t.totalAmount)}),e.jsx(v,{align:"center",children:t.sent}),e.jsx(v,{children:e.jsx(X,{variant:"soft",color:t.status==="paid"&&"success"||t.status==="pending"&&"warning"||t.status==="overdue"&&"error"||"default",children:Je(t.status)})}),e.jsx(v,{align:"right",sx:{px:1},children:e.jsx(w,{color:c.open?"inherit":"default",onClick:c.onOpen,children:e.jsx(j,{icon:"eva:more-vertical-fill"})})})]}),e.jsx(Z,{open:c.open,anchorEl:c.anchorEl,onClose:c.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(E,{children:[e.jsxs(y,{onClick:()=>{l(),c.onClose()},children:[e.jsx(j,{icon:"solar:eye-bold"}),"مشاهده"]}),e.jsxs(y,{onClick:()=>{n(),c.onClose()},children:[e.jsx(j,{icon:"solar:pen-bold"}),"ویرایش"]}),e.jsx(Q,{sx:{borderStyle:"dashed"}}),e.jsxs(y,{onClick:()=>{b.onTrue(),c.onClose()},sx:{color:"error.main"},children:[e.jsx(j,{icon:"solar:trash-bin-trash-bold"}),"حذف"]})]})}),e.jsx(Y,{open:b.value,onClose:b.onFalse,title:"حذف",content:"آیا از حذف مطمئن هستید؟",action:e.jsx(N,{variant:"contained",color:"error",onClick:x,children:"حذف"})})]})}function Xe({filters:t,options:m,dateError:s,onResetPage:l}){const n=q(),x=p.useCallback(o=>{l(),t.setState({name:o.target.value})},[t,l]),b=p.useCallback(o=>{const r=typeof o.target.value=="string"?o.target.value.split(","):o.target.value;l(),t.setState({service:r})},[t,l]),c=p.useCallback(o=>{l(),t.setState({startDate:o})},[t,l]),h=p.useCallback(o=>{l(),t.setState({endDate:o})},[t,l]);return e.jsxs(e.Fragment,{children:[e.jsxs(C,{spacing:2,alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5,pr:{xs:2.5,md:1}},children:[e.jsxs(He,{sx:{flexShrink:0,width:{xs:1,md:180}},children:[e.jsx($e,{htmlFor:"invoice-filter-service-select-label",children:"خدمات"}),e.jsx(Me,{multiple:!0,value:t.state.service,onChange:b,input:e.jsx(Ke,{label:"خدمات"}),renderValue:o=>o.map(r=>r).join(", "),inputProps:{id:"invoice-filter-service-select-label"},sx:{textTransform:"capitalize"},children:m.services.map(o=>e.jsxs(y,{value:o,children:[e.jsx(te,{disableRipple:!0,size:"small",checked:t.state.service.includes(o)}),o]},o))})]}),e.jsx(K,{label:"تاریخ شروع",value:t.state.endDate,onChange:c,slotProps:{textField:{fullWidth:!0}},sx:{maxWidth:{md:180}}}),e.jsx(K,{label:"تاریخ پایان",value:t.state.endDate,onChange:h,slotProps:{textField:{fullWidth:!0,error:s,helperText:s?"تاریخ پایان باید بعد از تاریخ شروع باشد":null}},sx:{maxWidth:{md:180},[`& .${Ue.root}`]:{bottom:{md:-40},position:{md:"absolute"}}}}),e.jsxs(C,{direction:"row",alignItems:"center",spacing:2,flexGrow:1,sx:{width:1},children:[e.jsx(_e,{fullWidth:!0,value:t.state.name,onChange:x,placeholder:"جستجوی مشتری یا شماره فاکتور...",InputProps:{startAdornment:e.jsx(pe,{position:"start",children:e.jsx(j,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsx(w,{onClick:n.onOpen,children:e.jsx(j,{icon:"eva:more-vertical-fill"})})]})]}),e.jsx(Z,{open:n.open,anchorEl:n.anchorEl,onClose:n.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsx(E,{children:e.jsxs(E,{children:[e.jsxs(y,{onClick:()=>{n.onClose()},children:[e.jsx(j,{icon:"solar:printer-minimalistic-bold"}),"چاپ"]}),e.jsxs(y,{onClick:()=>{n.onClose()},children:[e.jsx(j,{icon:"solar:import-bold"}),"وارد کردن"]}),e.jsxs(y,{onClick:()=>{n.onClose()},children:[e.jsx(j,{icon:"solar:export-bold"}),"خروجی گرفتن"]})]})})})]})}function Ze({filters:t,totalResults:m,onResetPage:s,sx:l}){const n=p.useCallback(()=>{s(),t.setState({name:""})},[t,s]),x=p.useCallback(h=>{const o=t.state.service.filter(r=>r!==h);s(),t.setState({service:o})},[t,s]),b=p.useCallback(()=>{s(),t.setState({status:"all"})},[t,s]),c=p.useCallback(()=>{s(),t.setState({startDate:null,endDate:null})},[t,s]);return e.jsxs(Ge,{totalResults:m,onReset:t.onResetState,sx:l,children:[e.jsx(P,{label:"خدمات:",isShow:!!t.state.service.length,children:t.state.service.map(h=>p.createElement(F,{...R,key:h,label:h,onDelete:()=>x(h)}))}),e.jsx(P,{label:"وضعیت:",isShow:t.state.status!=="all",children:e.jsx(F,{...R,label:t.state.status==="paid"?"پرداخت شده":t.state.status==="pending"?"در انتظار":t.state.status==="overdue"?"سررسید گذشته":t.state.status==="draft"?"پیش‌نویس":t.state.status,onDelete:b})}),e.jsx(P,{label:"تاریخ:",isShow:!!(t.state.startDate&&t.state.endDate),children:e.jsx(F,{...R,label:me(t.state.startDate,t.state.endDate),onDelete:c})}),e.jsx(P,{label:"کلمه کلیدی:",isShow:!!t.state.name,children:e.jsx(F,{...R,label:t.state.name,onDelete:n})})]})}const Qe=[{id:"invoiceNumber",label:"مشتری"},{id:"createDate",label:"تاریخ ایجاد"},{id:"dueDate",label:"تاریخ سررسید"},{id:"price",label:"مبلغ"},{id:"sent",label:"ارسال شده",align:"center"},{id:"status",label:"وضعیت"},{id:""}];function Ye(){const t=he(),m=ue(),s=Ie({defaultOrderBy:"createDate"}),l=J(),[n,x]=p.useState([]),[b,c]=p.useState(!0),{user:h}=xe();p.useEffect(()=>{h&&(async()=>{try{c(!0);const A=((await we.get("/api/invoices",{headers:{Authorization:`Bearer ${h==null?void 0:h.accessToken}`}})).data.invoices||[]).map(u=>({id:u.id,invoiceNumber:u.invoiceNumber,createDate:u.createDate?new Date(u.createDate):new Date(u.createdAt),dueDate:u.dueDate?new Date(u.dueDate):null,totalAmount:u.totalAmount,status:u.status,sent:!!u.sentDate,invoiceTo:{name:u.title||"مشتری",email:"",phone:"",address:u.description||""},items:Array.isArray(u.items)?u.items:typeof u.items=="string"?JSON.parse(u.items||"[]"):[]}));x(A),c(!1)}catch(d){console.error("Error fetching invoices:",d),x([]),c(!1)}})()},[h]);const o=je({name:"",service:[],status:"all",startDate:null,endDate:null}),r=be(o.state.startDate,o.state.endDate),i=et({inputData:n,comparator:Pe(s.order,s.orderBy),filters:o.state,dateError:r}),f=Re(i,s.page,s.rowsPerPage),O=!!o.state.name||o.state.service.length>0||o.state.status!=="all"||!!o.state.startDate&&!!o.state.endDate,se=!i.length&&O||!i.length,g=a=>n.filter(d=>d.status===a).length,S=a=>M(n.filter(d=>d.status===a),d=>d.totalAmount),k=a=>g(a)/n.length*100,ae=[{value:"all",label:"همه",color:"default",count:n.length},{value:"paid",label:"پرداخت شده",color:"success",count:g("paid")},{value:"pending",label:"در انتظار",color:"warning",count:g("pending")},{value:"overdue",label:"سررسید گذشته",color:"error",count:g("overdue")},{value:"draft",label:"پیش‌نویس",color:"default",count:g("draft")}],oe=p.useCallback(a=>{const d=n.filter(A=>A.id!==a);H.success("حذف با موفقیت انجام شد!"),x(d),s.onUpdatePageDeleteRow(f.length)},[f.length,s,n]),ne=p.useCallback(()=>{const a=n.filter(d=>!s.selected.includes(d.id));H.success("حذف با موفقیت انجام شد!"),x(a),s.onUpdatePageDeleteRows({totalRowsInPage:f.length,totalRowsFiltered:i.length})},[i.length,f.length,s,n]),re=p.useCallback(a=>{m.push(T.dashboard.invoice.edit(a))},[m]),le=p.useCallback(a=>{m.push(T.dashboard.invoice.details(a))},[m]),ie=p.useCallback((a,d)=>{s.onResetPage(),o.setState({status:d})},[o,s]);return e.jsxs(e.Fragment,{children:[e.jsxs(ge,{children:[e.jsx(ke,{heading:"لیست فاکتورها",links:[{name:"داشبورد",href:T.dashboard.root},{name:"فاکتورها",href:T.dashboard.invoice.root},{name:"لیست"}],action:e.jsx(N,{component:ve,href:T.dashboard.invoice.new,variant:"contained",startIcon:e.jsx(j,{icon:"mingcute:add-line"}),children:"فاکتور جدید"}),sx:{mb:{xs:3,md:5}}}),e.jsx(U,{sx:{mb:{xs:3,md:5}},children:e.jsx($,{sx:{minHeight:108},children:e.jsxs(C,{direction:"row",divider:e.jsx(Q,{orientation:"vertical",flexItem:!0,sx:{borderStyle:"dashed"}}),sx:{py:2},children:[e.jsx(D,{title:"کل",total:n.length,percent:100,price:M(n,a=>a.totalAmount),icon:"solar:bill-list-bold-duotone",color:t.vars.palette.info.main}),e.jsx(D,{title:"پرداخت شده",total:g("paid"),percent:k("paid"),price:S("paid"),icon:"solar:file-check-bold-duotone",color:t.vars.palette.success.main}),e.jsx(D,{title:"در انتظار",total:g("pending"),percent:k("pending"),price:S("pending"),icon:"solar:sort-by-time-bold-duotone",color:t.vars.palette.warning.main}),e.jsx(D,{title:"سررسید گذشته",total:g("overdue"),percent:k("overdue"),price:S("overdue"),icon:"solar:bell-bing-bold-duotone",color:t.vars.palette.error.main}),e.jsx(D,{title:"پیش‌نویس",total:g("draft"),percent:k("draft"),price:S("draft"),icon:"solar:file-corrupted-bold-duotone",color:t.vars.palette.text.secondary})]})})}),e.jsxs(U,{children:[e.jsx(Ce,{value:o.state.status,onChange:ie,sx:{px:2.5,boxShadow:`inset 0 -2px 0 0 ${_(t.vars.palette.grey["500Channel"],.08)}`},children:ae.map(a=>e.jsx(fe,{value:a.value,label:a.label,iconPosition:"end",icon:e.jsx(X,{variant:(a.value==="all"||a.value===o.state.status)&&"filled"||"soft",color:a.color,children:a.count})},a.value))}),e.jsx(Xe,{filters:o,dateError:r,onResetPage:s.onResetPage,options:{services:ye.map(a=>a.name)}}),O&&e.jsx(Ze,{filters:o,onResetPage:s.onResetPage,totalResults:i.length,sx:{p:2.5,pt:0}}),e.jsxs(G,{sx:{position:"relative"},children:[e.jsx(Fe,{dense:s.dense,numSelected:s.selected.length,rowCount:i.length,onSelectAllRows:a=>{s.onSelectAllRows(a,i.map(d=>d.id))},action:e.jsxs(C,{direction:"row",children:[e.jsx(I,{title:"ارسال",children:e.jsx(w,{color:"primary",children:e.jsx(j,{icon:"iconamoon:send-fill"})})}),e.jsx(I,{title:"دانلود",children:e.jsx(w,{color:"primary",children:e.jsx(j,{icon:"eva:download-outline"})})}),e.jsx(I,{title:"چاپ",children:e.jsx(w,{color:"primary",children:e.jsx(j,{icon:"solar:printer-minimalistic-bold"})})}),e.jsx(I,{title:"حذف",children:e.jsx(w,{color:"primary",onClick:l.onTrue,children:e.jsx(j,{icon:"solar:trash-bin-trash-bold"})})})]})}),e.jsx($,{sx:{minHeight:444},children:e.jsxs(Ve,{size:s.dense?"small":"medium",sx:{minWidth:800},children:[e.jsx(Ee,{order:s.order,orderBy:s.orderBy,headLabel:Qe,rowCount:i.length,numSelected:s.selected.length,onSort:s.onSort,onSelectAllRows:a=>s.onSelectAllRows(a,i.map(d=>d.id))}),e.jsxs(ze,{children:[i.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(a=>e.jsx(qe,{row:a,selected:s.selected.includes(a.id),onSelectRow:()=>s.onSelectRow(a.id),onViewRow:()=>le(a.id),onEditRow:()=>re(a.id),onDeleteRow:()=>oe(a.id)},a.id)),e.jsx(Le,{height:s.dense?56:76,emptyRows:Ae(s.page,s.rowsPerPage,i.length)}),e.jsx(Be,{notFound:se})]})]})})]}),e.jsx(Ne,{page:s.page,dense:s.dense,count:i.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})]}),e.jsx(Y,{open:l.value,onClose:l.onFalse,title:"حذف",content:e.jsxs(e.Fragment,{children:["آیا از حذف ",e.jsxs("strong",{children:[" ",s.selected.length," "]})," مورد مطمئن هستید؟"]}),action:e.jsx(N,{variant:"contained",color:"error",onClick:()=>{ne(),l.onFalse()},children:"حذف"})})]})}function et({inputData:t,comparator:m,filters:s,dateError:l}){const{name:n,status:x,service:b,startDate:c,endDate:h}=s,o=t.map((r,i)=>[r,i]);return o.sort((r,i)=>{const f=m(r[0],i[0]);return f!==0?f:r[1]-i[1]}),t=o.map(r=>r[0]),n&&(t=t.filter(r=>r.invoiceNumber.toLowerCase().indexOf(n.toLowerCase())!==-1||r.invoiceTo.name.toLowerCase().indexOf(n.toLowerCase())!==-1)),x!=="all"&&(t=t.filter(r=>r.status===x)),b.length&&(t=t.filter(r=>r.items.some(i=>b.includes(i.service)))),l||c&&h&&(t=t.filter(r=>Te(r.createDate,c,h))),t}const tt={title:`لیست فاکتورها | داشبورد - ${Se.site.name}`};function os(){return e.jsxs(e.Fragment,{children:[e.jsx(De,{children:e.jsxs("title",{children:[" ",tt.title]})}),e.jsx(Ye,{})]})}export{os as default};
