import{b as fe,r as c,j as e,B as R,S as A,T as v,bf as ce,o as te,cG as oe,i as be,bc as ae,I as H,cI as we,d as K,dh as V,di as Q,dA as _}from"./index-BSItzkt3.js";import{T as je}from"./table-pagination-custom-FhZ3GpxG.js";import{C as se}from"./Card-BqWDE3fr.js";import{C as he}from"./CardContent-DE24Aeed.js";import{F as Z}from"./FormControlLabel-CtXEP1QR.js";import{T as ye}from"./TableContainer-BOBiasNg.js";import{a as ve,c as Le,T as le,b as Se}from"./TableHead-DAuzvg-9.js";import{T as f}from"./TableCell-B7TbLBfh.js";import{T as X}from"./TextField-DpdcsLRb.js";import{C as ie}from"./Checkbox-p5PKnry8.js";import{F as ue}from"./FormControl-1z33WGqh.js";import{I as me}from"./InputLabel-DqZ4yv4U.js";import{S as ge}from"./Select-QPCMlUZ4.js";import{D as Ne}from"./DialogTitle-D9mOMHyE.js";import{D as Ce}from"./DialogContent-CPx_wcNJ.js";import{D as qe}from"./dialogTitleClasses-BJYaWiXv.js";import"./TablePagination-BVQvXhS8.js";import"./LastPage-DHcM-itg.js";import"./FormHelperText-CBXzj8d7.js";import"./FormLabel-Dg62SF9b.js";import"./Menu-Cy0n4kRw.js";const Ie=[{universalNumber:1,quadrantNumber:1,quadrant:"Upper Right",jaw:"Upper",side:"Right"},{universalNumber:2,quadrantNumber:2,quadrant:"Upper Right",jaw:"Upper",side:"Right"},{universalNumber:3,quadrantNumber:3,quadrant:"Upper Right",jaw:"Upper",side:"Right"},{universalNumber:4,quadrantNumber:4,quadrant:"Upper Right",jaw:"Upper",side:"Right"},{universalNumber:5,quadrantNumber:5,quadrant:"Upper Right",jaw:"Upper",side:"Right"},{universalNumber:6,quadrantNumber:6,quadrant:"Upper Right",jaw:"Upper",side:"Right"},{universalNumber:7,quadrantNumber:7,quadrant:"Upper Right",jaw:"Upper",side:"Right"},{universalNumber:8,quadrantNumber:8,quadrant:"Upper Right",jaw:"Upper",side:"Right"},{universalNumber:9,quadrantNumber:1,quadrant:"Upper Left",jaw:"Upper",side:"Left"},{universalNumber:10,quadrantNumber:2,quadrant:"Upper Left",jaw:"Upper",side:"Left"},{universalNumber:11,quadrantNumber:3,quadrant:"Upper Left",jaw:"Upper",side:"Left"},{universalNumber:12,quadrantNumber:4,quadrant:"Upper Left",jaw:"Upper",side:"Left"},{universalNumber:13,quadrantNumber:5,quadrant:"Upper Left",jaw:"Upper",side:"Left"},{universalNumber:14,quadrantNumber:6,quadrant:"Upper Left",jaw:"Upper",side:"Left"},{universalNumber:15,quadrantNumber:7,quadrant:"Upper Left",jaw:"Upper",side:"Left"},{universalNumber:16,quadrantNumber:8,quadrant:"Upper Left",jaw:"Upper",side:"Left"},{universalNumber:17,quadrantNumber:1,quadrant:"Lower Left",jaw:"Lower",side:"Left"},{universalNumber:18,quadrantNumber:2,quadrant:"Lower Left",jaw:"Lower",side:"Left"},{universalNumber:19,quadrantNumber:3,quadrant:"Lower Left",jaw:"Lower",side:"Left"},{universalNumber:20,quadrantNumber:4,quadrant:"Lower Left",jaw:"Lower",side:"Left"},{universalNumber:21,quadrantNumber:5,quadrant:"Lower Left",jaw:"Lower",side:"Left"},{universalNumber:22,quadrantNumber:6,quadrant:"Lower Left",jaw:"Lower",side:"Left"},{universalNumber:23,quadrantNumber:7,quadrant:"Lower Left",jaw:"Lower",side:"Left"},{universalNumber:24,quadrantNumber:8,quadrant:"Lower Left",jaw:"Lower",side:"Left"},{universalNumber:25,quadrantNumber:1,quadrant:"Lower Right",jaw:"Lower",side:"Right"},{universalNumber:26,quadrantNumber:2,quadrant:"Lower Right",jaw:"Lower",side:"Right"},{universalNumber:27,quadrantNumber:3,quadrant:"Lower Right",jaw:"Lower",side:"Right"},{universalNumber:28,quadrantNumber:4,quadrant:"Lower Right",jaw:"Lower",side:"Right"},{universalNumber:29,quadrantNumber:5,quadrant:"Lower Right",jaw:"Lower",side:"Right"},{universalNumber:30,quadrantNumber:6,quadrant:"Lower Right",jaw:"Lower",side:"Right"},{universalNumber:31,quadrantNumber:7,quadrant:"Lower Right",jaw:"Lower",side:"Right"},{universalNumber:32,quadrantNumber:8,quadrant:"Lower Right",jaw:"Lower",side:"Right"}],ee=["MB","B","DB"],xe=["ML","L","DL"],pe=c.memo(({tooth:t,toothData:l,facialPD:h,lingualPD:u,facialGM:w,lingualGM:x,mesialBOP:L,distalBOP:C,showGingivalMargin:j,showMobility:$,theme:b,renderToothIcon:k,handleInputChange:B,handleUpdateBOP:N,handleUpdateField:q,hasFurcation:O,paginatedTeeth:y,handleToggleMissing:W})=>{var U,G,P,J,F,s,n;const[S,z]=c.useState({facial:[...h],lingual:[...u]}),[I,M]=c.useState({facial:[...w],lingual:[...x]});c.useEffect(()=>{z({facial:[...h],lingual:[...u]})},[h,u]),c.useEffect(()=>{M({facial:[...w],lingual:[...x]})},[w,x]);const E=c.useCallback((i,a,r)=>{z(i==="facial"?d=>({...d,facial:d.facial.map((o,m)=>m===a?r:o)}):d=>({...d,lingual:d.lingual.map((o,m)=>m===a?r:o)})),B(t.universalNumber,i,a,r,y)},[t.universalNumber,B,y]),T=c.useCallback((i,a,r)=>{M(i==="facial"?d=>({...d,facial:d.facial.map((o,m)=>m===a?r:o)}):d=>({...d,lingual:d.lingual.map((o,m)=>m===a?r:o)})),q(t.universalNumber,i,"gingivalMargin",a,r,!1)},[t.universalNumber,q]);return e.jsxs(le,{sx:{...l.missing&&{opacity:.6}},children:[e.jsx(f,{align:"center",sx:{width:{xs:45,md:55},minWidth:{xs:45,md:55},maxWidth:{xs:45,md:55},position:"sticky",left:0,zIndex:1,bgcolor:"var(--palette-background-neutral)",borderRight:`2px solid ${b.palette.divider}`,padding:{xs:"4px 2px",md:"4px 4px"}},children:e.jsxs(R,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:{xs:.2,md:.3}},children:[k(t.universalNumber,t.quadrantNumber,t.jaw),e.jsx(v,{variant:"caption",fontWeight:"bold",sx:{fontSize:{xs:"0.7rem",md:"0.75rem"}},children:t.quadrantNumber})]})}),ee.map((i,a)=>e.jsx(f,{align:"center",sx:{px:.05,py:.25,width:32,maxWidth:32},children:e.jsxs(A,{direction:"column",spacing:.1,alignItems:"center",children:[e.jsx(X,{id:`facial-${t.universalNumber}-${a}`,size:"small",type:"number",value:S.facial[a]??"",onChange:r=>{const d=r.target.value===""?null:parseInt(r.target.value,10)||null;E("facial",a,d)},inputProps:{min:0,max:9,style:{textAlign:"center",padding:"0px 1px",fontSize:"0.875rem"},maxLength:1},sx:{width:24,"& .MuiOutlinedInput-root":{padding:"0px 1px",height:"28px","& input":{padding:"4px 2px"}}},disabled:l.missing}),e.jsx(X,{id:`lingual-${t.universalNumber}-${a}`,size:"small",type:"number",value:S.lingual[a]??"",onChange:r=>{const d=r.target.value===""?null:parseInt(r.target.value,10)||null;E("lingual",a,d)},inputProps:{min:0,max:9,style:{textAlign:"center",padding:"0px 1px",fontSize:"0.875rem"},maxLength:1},sx:{width:24,"& .MuiOutlinedInput-root":{padding:"0px 1px",height:"28px","& input":{padding:"4px 2px"}}},disabled:l.missing})]})},`site-${a}`)),e.jsx(f,{align:"center",sx:{px:{xs:.25,md:.5},width:{xs:45,md:50},minWidth:{xs:45,md:50},maxWidth:{xs:45,md:50}},children:e.jsxs(A,{direction:"column",spacing:.2,alignItems:"center",children:[e.jsx(Z,{control:e.jsx(ie,{size:"small",checked:L,onChange:i=>{N(t.universalNumber,"mesial",i.target.checked)},disabled:l.missing,sx:{padding:{xs:"2px",md:"4px"}}}),label:e.jsx(v,{variant:"caption",sx:{fontSize:{xs:"0.65rem",md:"0.7rem"},ml:.5},children:"M"}),sx:{margin:0}}),e.jsx(Z,{control:e.jsx(ie,{size:"small",checked:C,onChange:i=>{N(t.universalNumber,"distal",i.target.checked)},disabled:l.missing,sx:{padding:{xs:"2px",md:"4px"}}}),label:e.jsx(v,{variant:"caption",sx:{fontSize:{xs:"0.65rem",md:"0.7rem"},ml:.5},children:"D"}),sx:{margin:0}})]})}),j&&ee.map((i,a)=>e.jsx(f,{align:"center",sx:{px:.05,py:.25,width:32,maxWidth:32},children:e.jsxs(A,{direction:"column",spacing:.1,alignItems:"center",children:[e.jsx(X,{id:`facial-gm-${t.universalNumber}-${a}`,size:"small",type:"number",value:I.facial[a]??"",onChange:r=>{const d=r.target.value,o=d===""?null:parseInt(d,10)||null;T("facial",a,o),o!==null&&o>=-9&&o<=9&&d.length<=2&&setTimeout(()=>{let m=null;if(a<2?m=`facial-gm-${t.universalNumber}-${a+1}`:m=`lingual-gm-${t.universalNumber}-0`,m){const g=document.getElementById(m);g&&(g.focus(),g.select())}},10)},inputProps:{min:-10,max:10,style:{textAlign:"center",padding:"0px 1px",fontSize:"0.875rem"},maxLength:2},sx:{width:24,"& .MuiOutlinedInput-root":{padding:"0px 1px",height:"28px","& input":{padding:"4px 2px"}}},disabled:l.missing}),e.jsx(X,{id:`lingual-gm-${t.universalNumber}-${a}`,size:"small",type:"number",value:I.lingual[a]??"",onChange:r=>{const d=r.target.value,o=d===""?null:parseInt(d,10)||null;T("lingual",a,o),o!==null&&o>=-9&&o<=9&&d.length<=2&&setTimeout(()=>{let m=null;if(a<2)m=`lingual-gm-${t.universalNumber}-${a+1}`;else{const g=y.findIndex(p=>p.universalNumber===t.universalNumber);g<y.length-1&&(m=`facial-${y[g+1].universalNumber}-0`)}if(m){const g=document.getElementById(m);g&&(g.focus(),g.select())}},10)},inputProps:{min:-10,max:10,style:{textAlign:"center",padding:"0px 1px",fontSize:"0.875rem"},maxLength:2},sx:{width:24,"& .MuiOutlinedInput-root":{padding:"0px 1px",height:"28px","& input":{padding:"4px 2px"}}},disabled:l.missing})]})},`gm-${a}`)),e.jsx(f,{align:"center",sx:{px:{xs:.25,md:.5},width:{xs:35,md:40},minWidth:{xs:35,md:40},maxWidth:{xs:35,md:40}},children:e.jsx(ie,{size:"small",checked:((U=l.facial)==null?void 0:U.plaque)||!1,onChange:i=>q(t.universalNumber,"facial","plaque",null,i.target.checked,!0),disabled:l.missing,sx:{p:0,padding:{xs:"2px",md:"4px"}}})}),e.jsx(f,{align:"center",sx:{px:{xs:.25,md:.5},width:{xs:50,md:55},minWidth:{xs:50,md:55},maxWidth:{xs:50,md:55}},children:O(t.universalNumber)?e.jsx(te,{size:"small",onClick:()=>{var r;const i=((r=l.facial)==null?void 0:r.furcation)||null;let a=null;i?i==="I"?a="II":i==="II"?a="III":a=null:a="I",q(t.universalNumber,"facial","furcation",null,a,!0)},disabled:l.missing,sx:{width:{xs:32,md:36},height:{xs:32,md:36},border:`2px solid ${(G=l.facial)!=null&&G.furcation?b.palette.warning.main:b.palette.divider}`,borderRadius:"50%",bgcolor:(P=l.facial)!=null&&P.furcation?oe(b.palette.warning.main,.1):"inherit",padding:0},children:e.jsx(v,{variant:"caption",fontWeight:"bold",sx:{fontSize:{xs:"0.7rem",md:"0.75rem"}},children:((J=l.facial)==null?void 0:J.furcation)||"-"})}):e.jsx(v,{variant:"caption",color:"text.disabled",sx:{fontSize:{xs:"0.7rem",md:"0.75rem"}},children:"-"})}),$&&e.jsx(f,{align:"center",sx:{px:{xs:.25,md:.5},width:{xs:50,md:55},minWidth:{xs:50,md:55},maxWidth:{xs:50,md:55}},children:e.jsx(te,{size:"small",onClick:()=>{var r;const a=((((r=l.facial)==null?void 0:r.mobility)||0)+1)%4;q(t.universalNumber,"facial","mobility",null,a,!0)},disabled:l.missing,sx:{width:{xs:32,md:36},height:{xs:32,md:36},border:`2px solid ${((F=l.facial)==null?void 0:F.mobility)>0?b.palette.error.main:b.palette.divider}`,borderRadius:"50%",bgcolor:((s=l.facial)==null?void 0:s.mobility)>0?oe(b.palette.error.main,.1):"inherit",padding:0},children:e.jsxs(v,{variant:"caption",fontWeight:"bold",sx:{fontSize:{xs:"0.7rem",md:"0.75rem"}},children:["M",((n=l.facial)==null?void 0:n.mobility)||0]})})})]},t.universalNumber)},(t,l)=>{var h,u,w,x,L,C;return t.tooth.universalNumber===l.tooth.universalNumber&&JSON.stringify(t.facialPD)===JSON.stringify(l.facialPD)&&JSON.stringify(t.lingualPD)===JSON.stringify(l.lingualPD)&&JSON.stringify(t.facialGM)===JSON.stringify(l.facialGM)&&JSON.stringify(t.lingualGM)===JSON.stringify(l.lingualGM)&&t.mesialBOP===l.mesialBOP&&t.distalBOP===l.distalBOP&&t.toothData.missing===l.toothData.missing&&t.toothData.implant===l.toothData.implant&&((h=t.toothData.facial)==null?void 0:h.plaque)===((u=l.toothData.facial)==null?void 0:u.plaque)&&((w=t.toothData.facial)==null?void 0:w.furcation)===((x=l.toothData.facial)==null?void 0:x.furcation)&&((L=t.toothData.facial)==null?void 0:L.mobility)===((C=l.toothData.facial)==null?void 0:C.mobility)&&t.showGingivalMargin===l.showGingivalMargin&&t.showMobility===l.showMobility});pe.displayName="PeriodontalChartRow";function Re({chartData:t,onUpdateTooth:l,onUpdateToothFields:h,selectedQuadrant:u,onQuadrantChange:w}){const x=fe(),[L,C]=c.useState(!1),[j,$]=c.useState(!1),[b,k]=c.useState(0),B=c.useMemo(()=>typeof window<"u"&&window.innerWidth<768?4:8,[]),[N,q]=c.useState(B),O=c.useCallback(s=>{const n=t.teeth[s]||{missing:!1,implant:!1},i=n.missing||!1,a=n.implant||!1;h?!i&&!a?h(s,{missing:!0,implant:!1}):i&&!a?h(s,{missing:!1,implant:!0}):h(s,{missing:!1,implant:!1}):!i&&!a?(l(s,"missing",!0),l(s,"implant",!1)):i&&!a?(l(s,"missing",!1),l(s,"implant",!0)):(l(s,"missing",!1),l(s,"implant",!1))},[l,h,t]);c.useCallback(s=>{const n=t.teeth[s]||{implant:!1};l(s,"implant",!n.implant)},[t,l]);const y=c.useRef({});c.useEffect(()=>()=>{Object.values(y.current).forEach(s=>{s&&clearTimeout(s)}),y.current={}},[]);const W=c.useCallback((s,n,i,a,r,d=100)=>{const o=`${s}-${n}-${i}-${a}`;y.current[o]&&clearTimeout(y.current[o]),y.current[o]=setTimeout(()=>{const p={...(t.teeth[s]||{[n]:{[i]:Array(3).fill(0)}})[n]||{[i]:Array(3).fill(0)}};if(Array.isArray(p[i]))if(a!=null){const D=[...p[i]];D[a]=r,p[i]=D}else p[i]=r;else p[i]=r;l(s,n,p),delete y.current[o]},d)},[t,l]),S=c.useCallback((s,n,i,a,r,d=!1)=>{if(d){const g={...(t.teeth[s]||{[n]:{[i]:Array(3).fill(0)}})[n]||{[i]:Array(3).fill(0)}};if(Array.isArray(g[i]))if(a!=null){const p=[...g[i]];p[a]=r,g[i]=p}else g[i]=r;else g[i]=r;l(s,n,g)}else W(s,n,i,a,r)},[t,l,W]),z=c.useCallback((s,n,i)=>{const a=n==="mesial"?0:2,d=(t.teeth[s]||{}).facial||{bleeding:[!1,!1,!1]},o=[...d.bleeding||[!1,!1,!1]];o[a]=i;const m={...d,bleeding:o};l(s,"facial",m)},[t,l]),I=c.useCallback((s,n)=>{k(n)},[]),M=c.useCallback(s=>{k(0),q(parseInt(s.target.value,10))},[]);c.useCallback(s=>{w&&w(s),k(0)},[w]);const E=u||"Upper Right",T=c.useMemo(()=>Ie.filter(s=>s.quadrant===E),[E]),U=c.useMemo(()=>T.slice(b*N,b*N+N),[T,b,N]),G=c.useMemo(()=>[1,2,3,11,12,13],[]),P=c.useCallback(s=>!G.includes(s),[G]),J=c.useCallback((s,n,i)=>{var m,g,p,D;const a=t.teeth[s]||{};let r;i==="Upper"?r=`${n}.png`:r=`${n+10}.png`;const d=!!(a.implant&&!a.missing),o=d?"/teeth/implant.png":`/teeth/${r}`;return e.jsxs(R,{sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",height:{xs:32,md:38},width:{xs:24,md:28},cursor:"pointer"},onClick:()=>O(s),children:[e.jsx(R,{component:"img",src:o,alt:d?`Implant ${s}`:`Tooth ${s}`,sx:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",opacity:a.missing?.4:1,filter:a.missing?"grayscale(100%)":"none"},onError:Y=>{console.error(`Failed to load image: ${o}`),Y.target.style.display="none"}}),a.missing&&e.jsx(R,{sx:{position:"absolute",top:"50%",left:0,right:0,height:{xs:2,md:2.5},bgcolor:x.palette.error.main,transform:"rotate(-20deg) translateY(-50%)",zIndex:1}}),!a.missing&&((g=(m=a.facial)==null?void 0:m.bleeding)==null?void 0:g[0])&&e.jsx(R,{sx:{position:"absolute",top:1,right:1,width:{xs:4,md:5},height:{xs:4,md:5},borderRadius:"50%",bgcolor:x.palette.error.main,zIndex:1}}),!a.missing&&((D=(p=a.facial)==null?void 0:p.bleeding)==null?void 0:D[2])&&e.jsx(R,{sx:{position:"absolute",top:1,left:1,width:{xs:4,md:5},height:{xs:4,md:5},borderRadius:"50%",bgcolor:x.palette.error.main,zIndex:1}})]})},[t,O,x]),F=c.useCallback((s,n,i,a,r)=>{S(s,n,"pocketDepth",i,a,!1),a!==null&&a>=0&&a<=9&&setTimeout(()=>{let d=null;if(n==="facial")i<2?d=`facial-${s}-${i+1}`:d=`lingual-${s}-0`;else if(i<2)d=`lingual-${s}-${i+1}`;else{const o=r.findIndex(m=>m.universalNumber===s);o<r.length-1&&(d=`facial-${r[o+1].universalNumber}-0`)}if(d){const o=document.getElementById(d);o&&(o.focus(),o.select())}},10)},[S]);return e.jsxs(R,{children:[e.jsx(se,{sx:{mb:2},children:e.jsx(he,{sx:{py:1.5},children:e.jsxs(A,{direction:"row",spacing:3,flexWrap:"wrap",children:[e.jsx(Z,{control:e.jsx(ce,{checked:L,onChange:s=>C(s.target.checked),size:"small"}),label:e.jsx(v,{variant:"body2",children:"نمایش ستون Gingival Margin"})}),e.jsx(Z,{control:e.jsx(ce,{checked:j,onChange:s=>$(s.target.checked),size:"small"}),label:e.jsx(v,{variant:"body2",children:"نمایش ستون Mobility"})})]})})}),e.jsx(ye,{component:se,sx:{maxHeight:{xs:"60vh",md:"none"},overflow:"auto","& .MuiTable-root":{minWidth:{xs:800,md:"auto"}}},children:e.jsxs(ve,{size:"small",sx:{"& .MuiTableCell-root":{fontSize:{xs:"0.75rem",md:"0.875rem"},padding:{xs:"4px 1px",md:"6px 2px"}}},children:[e.jsxs(Le,{children:[e.jsxs(le,{children:[e.jsx(f,{align:"center",rowSpan:2,sx:{width:{xs:45,md:55},minWidth:{xs:45,md:55},maxWidth:{xs:45,md:55},fontWeight:"bold",position:"sticky",left:0,zIndex:2,bgcolor:"var(--palette-background-neutral)",padding:{xs:"4px 2px",md:"4px 4px"},fontSize:{xs:"0.7rem",md:"0.875rem"}},children:"Tooth"}),e.jsx(f,{align:"center",colSpan:3,sx:{fontWeight:"bold",padding:"4px 0px"},children:"Probing Sites"}),e.jsx(f,{align:"center",rowSpan:2,sx:{fontWeight:"bold",width:{xs:45,md:50},minWidth:{xs:45,md:50},maxWidth:{xs:45,md:50},whiteSpace:"nowrap",fontSize:{xs:"0.7rem",md:"0.875rem"},padding:{xs:"4px 2px",md:"4px 4px"}},children:"BOP"}),L&&e.jsx(f,{align:"center",colSpan:3,sx:{fontWeight:"bold",padding:"4px 0px"},children:"Gingival margin"}),e.jsx(f,{align:"center",rowSpan:2,sx:{fontWeight:"bold",width:{xs:35,md:40},minWidth:{xs:35,md:40},maxWidth:{xs:35,md:40},whiteSpace:"nowrap",fontSize:{xs:"0.7rem",md:"0.875rem"},padding:{xs:"4px 2px",md:"4px 4px"}},children:"Plaque"}),e.jsx(f,{align:"center",rowSpan:2,sx:{fontWeight:"bold",width:{xs:50,md:55},minWidth:{xs:50,md:55},maxWidth:{xs:50,md:55},whiteSpace:"nowrap",fontSize:{xs:"0.7rem",md:"0.875rem"},padding:{xs:"4px 2px",md:"4px 4px"}},children:"Furcation"}),j&&e.jsx(f,{align:"center",rowSpan:2,sx:{fontWeight:"bold",width:{xs:50,md:55},minWidth:{xs:50,md:55},maxWidth:{xs:50,md:55},whiteSpace:"nowrap",fontSize:{xs:"0.7rem",md:"0.875rem"},padding:{xs:"4px 2px",md:"4px 4px"}},children:"Mobility"})]}),e.jsxs(le,{children:[ee.map((s,n)=>e.jsx(f,{align:"center",sx:{fontWeight:"bold",padding:"2px 0px",width:32,maxWidth:32},children:e.jsxs(A,{direction:"column",spacing:.1,alignItems:"center",children:[e.jsx(v,{variant:"caption",fontWeight:"bold",sx:{fontSize:"0.65rem",lineHeight:1},children:s}),e.jsx(v,{variant:"caption",fontWeight:"bold",sx:{fontSize:"0.65rem",color:"text.secondary",lineHeight:1},children:xe[n]})]})},s)),L&&ee.map((s,n)=>e.jsx(f,{align:"center",sx:{fontWeight:"bold",padding:"2px 1px",minWidth:40,maxWidth:45},children:e.jsxs(A,{direction:"column",spacing:.2,alignItems:"center",children:[e.jsx(v,{variant:"caption",fontWeight:"bold",sx:{fontSize:"0.7rem"},children:s}),e.jsx(v,{variant:"caption",fontWeight:"bold",sx:{fontSize:"0.7rem",color:"text.secondary"},children:xe[n]})]})},`gm-${s}`))]})]}),e.jsx(Se,{children:U.map(s=>{var p,D,Y,re,de;const n=t.teeth[s.universalNumber]||{},i=((p=n.facial)==null?void 0:p.pocketDepth)||[null,null,null],a=((D=n.lingual)==null?void 0:D.pocketDepth)||[null,null,null],r=((Y=n.facial)==null?void 0:Y.gingivalMargin)||[null,null,null],d=((re=n.lingual)==null?void 0:re.gingivalMargin)||[null,null,null],o=((de=n.facial)==null?void 0:de.bleeding)||[!1,!1,!1],m=o[0]||!1,g=o[2]||!1;return e.jsx(pe,{tooth:s,toothData:n,facialPD:i,lingualPD:a,facialGM:r,lingualGM:d,mesialBOP:m,distalBOP:g,showGingivalMargin:L,showMobility:j,theme:x,renderToothIcon:J,handleInputChange:F,handleUpdateBOP:z,handleUpdateField:S,hasFurcation:P,paginatedTeeth:U,handleToggleMissing:O},s.universalNumber)})})]})}),e.jsx(je,{count:T.length,page:b,rowsPerPage:N,onPageChange:I,onRowsPerPageChange:M,rowsPerPageOptions:[B]})]})}const ne=()=>{const t={};for(let l=1;l<=32;l+=1)t[l]={facial:{pocketDepth:[null,null,null],gingivalMargin:[null,null,null],bleeding:[!1,!1,!1],suppuration:[!1,!1,!1],furcation:null,mobility:0,plaque:!1},lingual:{pocketDepth:[null,null,null],gingivalMargin:[null,null,null],bleeding:[!1,!1,!1],suppuration:[!1,!1,!1],furcation:null,mobility:0,plaque:!1},missing:!1,implant:!1};return t};function $e({patient:t,onUpdate:l,onNavigateToAnalysis:h}){const{user:u}=be(),[w,x]=c.useState({teeth:ne(),date:new Date}),[L,C]=c.useState([]),[j,$]=c.useState(null),[b,k]=c.useState(!1),[B,N]=c.useState(!0),[q,O]=c.useState("Upper Right"),[y,W]=c.useState(!1),[S,z]=c.useState(null),[I,M]=c.useState(!1);c.useEffect(()=>{u&&t&&(async()=>{try{N(!0);const a=(await V.get(`${Q.patients}/${t.id}/periodontal-charts`,{headers:{Authorization:`Bearer ${u==null?void 0:u.accessToken}`}})).data.charts||[];if(C(a),a.length>0){const r=a[0];$(r.id),x({teeth:typeof r.teeth=="string"?JSON.parse(r.teeth):r.teeth,date:new Date(r.date)})}}catch(i){console.error("Error fetching charts:",i),_.error("خطا در بارگیری چارت‌ها")}finally{N(!1)}})()},[u,t]);const E=n=>{const i=n.target.value;if($(i),i==="new")x({teeth:ne(),date:new Date});else{const a=L.find(r=>r.id===i);a&&x({teeth:typeof a.teeth=="string"?JSON.parse(a.teeth):a.teeth,date:new Date(a.date)})}},T=async()=>{try{k(!0);const n={patientId:t.id,teeth:w.teeth,date:w.date};if(j&&j!=="new")await V.put(`${Q.patients}/${t.id}/periodontal-charts/${j}`,n,{headers:{Authorization:`Bearer ${u==null?void 0:u.accessToken}`}}),_.success("چارت با موفقیت بروزرسانی شد");else{const a=await V.post(`${Q.patients}/${t.id}/periodontal-charts`,n,{headers:{Authorization:`Bearer ${u==null?void 0:u.accessToken}`}});_.success("چارت جدید با موفقیت ذخیره شد"),$(a.data.chart.id)}l==null||l();const i=await V.get(`${Q.patients}/${t.id}/periodontal-charts`,{headers:{Authorization:`Bearer ${u==null?void 0:u.accessToken}`}});C(i.data.charts||[])}catch(n){console.error("Error saving chart:",n),_.error("خطا در ذخیره چارت")}finally{k(!1)}},U=c.useCallback((n,i,a)=>{x(r=>({...r,teeth:{...r.teeth,[n]:{...r.teeth[n],[i]:a}}}))},[]),G=c.useCallback((n,i)=>{x(a=>({...a,teeth:{...a.teeth,[n]:{...a.teeth[n],...i}}}))},[]);if(B)return e.jsx(R,{sx:{textAlign:"center",py:4},children:e.jsx(v,{children:"در حال بارگیری چارت..."})});const P=[{value:"Upper Right",label:"بالا راست"},{value:"Upper Left",label:"بالا چپ"},{value:"Lower Left",label:"پایین چپ"},{value:"Lower Right",label:"پایین راست"}],J=n=>{O(n.target.value)},F=n=>{z(n),W(!0)},s=async()=>{if(S)try{M(!0),await V.delete(`${Q.patients}/${t.id}/periodontal-charts/${S.id}`,{headers:{Authorization:`Bearer ${u==null?void 0:u.accessToken}`}}),_.success("چارت با موفقیت حذف شد");const i=(await V.get(`${Q.patients}/${t.id}/periodontal-charts`,{headers:{Authorization:`Bearer ${u==null?void 0:u.accessToken}`}})).data.charts||[];if(C(i),j===S.id)if(i.length>0){const a=i[0];$(a.id),x({teeth:typeof a.teeth=="string"?JSON.parse(a.teeth):a.teeth,date:new Date(a.date)})}else $("new"),x({teeth:ne(),date:new Date});W(!1),z(null),l==null||l()}catch(n){console.error("Error deleting chart:",n),_.error("خطا در حذف چارت")}finally{M(!1)}};return e.jsxs(A,{spacing:3,children:[e.jsx(se,{children:e.jsx(he,{children:e.jsxs(A,{direction:{xs:"column",md:"row"},spacing:2,alignItems:"center",children:[e.jsxs(ue,{fullWidth:!0,children:[e.jsx(me,{children:"انتخاب چارت"}),e.jsxs(ge,{value:j||"new",onChange:E,label:"انتخاب چارت",children:[e.jsx(ae,{value:"new",children:e.jsxs(R,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(H,{icon:"solar:add-circle-bold"}),"چارت جدید"]})}),L.map(n=>e.jsxs(ae,{value:n.id,children:[new Date(n.date).toLocaleDateString("fa-IR")," -"," ",new Date(n.date).toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})]},n.id))]})]}),e.jsxs(ue,{fullWidth:!0,children:[e.jsx(me,{children:"انتخاب کوادرانت"}),e.jsx(ge,{value:q,onChange:J,label:"انتخاب کوادرانت",children:P.map(n=>e.jsx(ae,{value:n.value,children:n.label},n.value))})]}),j&&j!=="new"&&e.jsx(te,{color:"error",onClick:()=>{const n=L.find(i=>i.id===j);n&&F(n)},sx:{minWidth:48,height:48},children:e.jsx(H,{icon:"solar:trash-bin-trash-bold",width:24})})]})})}),e.jsxs(we,{open:y,onClose:()=>!I&&W(!1),children:[e.jsx(Ne,{children:"حذف چارت پریودونتال"}),e.jsx(Ce,{children:e.jsxs(v,{children:["آیا از حذف چارت تاریخ"," ",S&&new Date(S.date).toLocaleDateString("fa-IR",{year:"numeric",month:"long",day:"numeric"})," ","مطمئن هستید؟ این عمل غیرقابل بازگشت است."]})}),e.jsxs(qe,{children:[e.jsx(K,{onClick:()=>W(!1),color:"inherit",disabled:I,children:"انصراف"}),e.jsx(K,{onClick:s,color:"error",variant:"contained",disabled:I,startIcon:I?e.jsx(H,{icon:"eva:loader-fill"}):e.jsx(H,{icon:"solar:trash-bin-trash-bold"}),children:I?"در حال حذف...":"حذف"})]})]}),e.jsx(Re,{chartData:w,onUpdateTooth:U,onUpdateToothFields:G,selectedQuadrant:q,onQuadrantChange:J}),e.jsxs(R,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:[e.jsx(K,{variant:"soft",color:"primary",onClick:T,disabled:b,startIcon:e.jsx(H,{icon:"solar:diskette-bold"}),sx:{minWidth:150},children:b?"در حال ذخیره...":"ذخیره چارت"}),e.jsx(K,{variant:"contained",color:"primary",onClick:()=>{h&&h()},startIcon:e.jsx(H,{icon:"solar:chart-2-bold"}),sx:{minWidth:150},children:"آنالیز"})]})]})}const Xe=c.memo($e,(t,l)=>{var h,u;return((h=t.patient)==null?void 0:h.id)===((u=l.patient)==null?void 0:u.id)&&t.onUpdate===l.onUpdate&&t.onNavigateToAnalysis===l.onNavigateToAnalysis});export{Xe as PeriodontalChartTab};
