# ุฑุงูููุง ุชุดุฎุต ููุงุท ฺฉุงูุจุฑุงุณูู (p1, p2)

## ๐ ุฎูุงุตู ุชุบุฑุงุช

### ูุดฺฉู ูุจู:
ฺฉุฏ ูุจู ุฏูุจุงู ููุงุท **ุชุงุฑฺฉ** (dark points) ุฑู ูพุณโุฒููู ุฑูุดู ูโฺฏุดุชุ ุงูุง ููุงุท ฺฉุงูุจุฑุงุณูู ุฑู ุฎุทฺฉุด **ุณูุฏุชุฑ ุงุฒ ุงุทุฑุงู** ูุณุชูุฏ.

### ุฑุงูโุญู ุฌุฏุฏ:
1. โ ุฏูุจุงู ููุงุท **ุฑูุดู** (bright spots) ุฏุฑ ุจุฎุด ุจุงูุง ู ุฑุงุณุช ุชุตูุฑ ูโฺฏุฑุฏู
2. โ ููุงุท ฺฉู brightness ุจุดุชุฑ ุงุฒ ูุญุท ุฏุงุฑูุฏ ุฑุง ูพุฏุง ูโฺฉูู
3. โ ุฏู ููุทู ฺฉู **ุนููุฏ ุฑุงุณุชุง** ูุณุชูุฏ ู ูุงุตูู ุดุงู **70-150 ูพฺฉุณู** ุงุณุช ุฑุง ุงูุชุฎุงุจ ูโฺฉูู
4. โ ุงู ุฏู ููุทู `p2` (ุจุงูุงุชุฑ) ู `p1` (ูพุงูโุชุฑ) ูุณุชูุฏ ฺฉู ูุงุตูู ุดุงู ุฏููุงู **10mm** ุงุณุช

---

## ๐งช ุชุณุช ฺฉุฑุฏู ุงูฺฏูุฑุชู

### ุชุณุช ุณุฑุน (ฺฉ ุชุตูุฑ):

```bash
cd aariz
python quick_test_calibration.py
```

ุง ุฏุฑ ููุฏูุฒ:
```bash
test_calibration_quick.bat
```

ุงู ุงุณฺฉุฑูพุช:
- ุชุตูุฑ `P1P2/cks2ip8fq29yq0yufc4scftj8.png` ุฑุง ุชุณุช ูโฺฉูุฏ
- ููุงุท p1 ู p2 ุฑุง ูพุฏุง ูโฺฉูุฏ
- ูุงุตููุ conversion factor ู DPI ุฑุง ููุงุด ูโุฏูุฏ
- ฺฉ ุชุตูุฑ `calibration_detection_result.png` ุฐุฎุฑู ูโฺฉูุฏ

### ุชุณุช ฺฉุงูู (18 ุชุตูุฑ):

```bash
cd aariz
python test_calibration_detection.py
```

ุง ุฏุฑ ููุฏูุฒ:
```bash
test_calibration_full.bat
```

ุงู ุงุณฺฉุฑูพุช:
- ููู 18 ุชุตูุฑ ุฑุง ุชุณุช ูโฺฉูุฏ
- ุจุง ground truth ููุงุณู ูโฺฉูุฏ
- ุฏูุช (accuracy) ุฑุง ูุญุงุณุจู ูโฺฉูุฏ
- ุชุตุงูุฑ ุจุง visualization ุฏุฑ ูพูุดู `calibration_test_results/` ุฐุฎุฑู ูโฺฉูุฏ
- ุฎุทุง ูุงูฺฏู ุฑุง ฺฏุฒุงุฑุด ูโุฏูุฏ

---

## ๐ ุงูฺฏูุฑุชู ุชุดุฎุต (ูุฑุงูุชโุงูุฏ)

### 1. ูุญุฏูุฏู ุฌุณุชุฌู:
```javascript
const searchArea = {
  x: imageWidth * 0.8,  // 80% ุงุฒ ุณูุช ฺูพ (ุจุฎุด ุฑุงุณุช)
  y: 0,                  // ุงุฒ ุจุงูุง ุดุฑูุน
  width: imageWidth * 0.2,   // 20% ุนุฑุถ
  height: imageHeight * 0.2  // 20% ุงุฑุชูุงุน
};
```

### 2. ุงูุชู ููุงุท ุฑูุดู:
```javascript
// ุฏูุจุงู ูพฺฉุณูโูุง ุฑูุดู ุจฺฏุฑุฏ (brightness > 180)
if (pixel > 180) {
  const surroundingBrightness = getAverageSurroundingBrightness(...);
  
  // ุงฺฏุฑ ุงู ูพฺฉุณู ุญุฏุงูู 30 ูุงุญุฏ ุฑูุดูโุชุฑ ุงุฒ ุงุทุฑุงู ุจูุฏ
  if (pixel - surroundingBrightness > 30) {
    points.push({ x: imageX, y: imageY, brightness: pixel });
  }
}
```

### 3. ุงูุชู ุฌูุช ุนููุฏ:
```javascript
// ุฏูุจุงู ุฏู ููุทู ฺฉู ุนููุฏ ุฑุงุณุชุง ูุณุชูุฏ
for (let i = 0; i < points.length; i++) {
  for (let j = i + 1; j < points.length; j++) {
    const dx = Math.abs(p1.x - p2.x);
    const dy = Math.abs(p1.y - p2.y);
    
    // ุนููุฏ ุฑุงุณุชุง (dx ฺฉูฺฺฉ) ู ูุงุตูู ููุงุณุจ (70-150 ูพฺฉุณู)
    if (dx < 30 && dy > 70 && dy < 150) {
      calibrationPairs = [upper_point, lower_point];  // [p2, p1]
      break;
    }
  }
}
```

### 4. ูุญุงุณุจู Conversion Factor:
```javascript
const distance = Math.sqrt(dx * dx + dy * dy);
const mmPerPixel = 10 / distance;  // ูุงุตูู p1 ู p2 ุฏููุงู 10mm ุงุณุช

// ุจุงุฒู ูุนููู ุจุฑุง ุฑุงุฏูฺฏุฑุงูโูุง ุฏูุฏุงููพุฒุดฺฉ
if (mmPerPixel >= 0.05 && mmPerPixel <= 0.20) {
  return mmPerPixel;  // โ ูุนุชุจุฑ
}
```

---

## ๐ฏ ูพุงุฑุงูุชุฑูุง ูุงุจู ุชูุธู

ุงฺฏุฑ ูุชุงุฌ ุฎูุจ ูุณุชูุฏุ ูโุชูุงูุฏ ุงู ูพุงุฑุงูุชุฑูุง ุฑุง ุชูุธู ฺฉูุฏ:

### ุฏุฑ ฺฉุฏ JavaScript (frontend):

```javascript
// 1. Threshold ุฑูุดูุง (ุฎุท 1017)
if (pixel > 180) {  // ฺฉุงูุด ุฏูุฏ ุงฺฏุฑ ููุงุท ฺฉูุชุฑ ูพุฏุง ูโุดูุฏ (ูุซูุงู 170)
                    // ุงูุฒุงุด ุฏูุฏ ุงฺฏุฑ ููุงุท ุฒุงุฏ ูพุฏุง ูโุดูุฏ (ูุซูุงู 190)

// 2. ุงุฎุชูุงู ุฑูุดูุง ุจุง ุงุทุฑุงู (ุฎุท 1022)
if (pixel - surroundingBrightness > 30) {  // ฺฉุงูุด ุฏูุฏ ุจุฑุง ุญุณุงุณุช ุจุดุชุฑ (ูุซูุงู 20)

// 3. ูุงุตูู ุงูู ูุฌุงุฒ (ุฎุท 1056)
if (dx < 30 && ...) {  // ุงูุฒุงุด ุฏูุฏ ุงฺฏุฑ ุฎุทฺฉุด ฺฉุฌ ุงุณุช (ูุซูุงู 40)

// 4. ูุงุตูู ุนููุฏ ูุฌุงุฒ (ุฎุท 1056)
if (... && dy > 70 && dy < 150) {  // ุชูุธู ุจุฑ ุงุณุงุณ DPI ุชุตุงูุฑ
```

### ุฏุฑ ฺฉุฏ Python (testing):

```python
# ุฏุฑ ูุงู test_calibration_detection.py ู quick_test_calibration.py

# 1. Threshold ุฑูุดูุง (ุฎุท ~40)
_, bright = cv2.threshold(gray_roi, 180, 255, cv2.THRESH_BINARY)
#                                    ^^^
# ฺฉุงูุด/ุงูุฒุงุด ุจุฑ ุงุณุงุณ ูุงุฒ

# 2. ูุญุฏูุฏู ุงูุฏุงุฒู blob (ุฎุท ~45)
if 10 < area < 500:
#   ^^      ^^^
# ุชูุธู ุจุฑ ุงุณุงุณ ุงูุฏุงุฒู ูุงูุน ููุงุท ุฑู ุฎุทฺฉุด

# 3. ูุงุตููโูุง ุนููุฏ (ุฎุท ~80)
if dx < 30 and 70 < dy < 150:
#      ^^      ^^      ^^^
```

---

## ๐ ูุชุงุฌ ููุฑุฏ ุงูุชุธุงุฑ

### ูุนุงุฑูุง ููููุช:
- **Accuracy**: > 90% (ุฎุทุง ฺฉูุชุฑ ุงุฒ 20 ูพฺฉุณู)
- **Average Error**: < 10 ูพฺฉุณู
- **Conversion Factor**: 0.08 - 0.17 mm/pixel
- **DPI Equivalent**: 150 - 300 DPI

### ุฎุฑูุฌ Console:
```
๐ Calibration points detected: 2
๐ Calibration pair distance:
   p2: (1520, 112)
   p1: (1518, 205)
   Distance: 93.02px
   dx: 2.00
   dy: 93.00
โ Using calculated calibration conversion: 0.1075 mm/pixel
   DPI equivalent: 236 DPI
```

---

## ๐ ุนุจโุงุจ

### ุงฺฏุฑ ููุงุท ูพุฏุง ูุดุฏูุฏ:
1. **Threshold ุฑุง ฺฉุงูุด ุฏูุฏ**: ุงุฒ 180 ุจู 170 ุง 160
2. **ูุญุฏูุฏู ุฌุณุชุฌู ุฑุง ุจุฒุฑฺฏโุชุฑ ฺฉูุฏ**: ุงุฒ 0.8 ุจู 0.7 (x-start)
3. **ูุงุตูู ุนููุฏ ุฑุง ุจุฒุฑฺฏโุชุฑ ฺฉูุฏ**: dy > 50 ุจู ุฌุง 70

### ุงฺฏุฑ ููุงุท ุงุดุชุจุงู ูพุฏุง ุดุฏูุฏ:
1. **Threshold ุฑุง ุงูุฒุงุด ุฏูุฏ**: ุงุฒ 180 ุจู 190 ุง 200
2. **ุงุฎุชูุงู ุฑูุดูุง ุฑุง ุงูุฒุงุด ุฏูุฏ**: ุงุฒ 30 ุจู 40 ุง 50
3. **ูุญุฏูุฏู ุงูุฏุงุฒู blob ุฑุง ูุญุฏูุฏุชุฑ ฺฉูุฏ**: area < 300 ุจู ุฌุง 500

### ุงฺฏุฑ ููุงุท ุนููุฏ ุฑุงุณุชุง ูุณุชูุฏ:
1. **dx ุฑุง ุงูุฒุงุด ุฏูุฏ**: ุงุฒ 30 ุจู 40 ุง 50
2. **ุจุฑุฑุณ ฺฉูุฏ ฺฉู ุชุตูุฑ ฺุฑุฎุฏู ูุจุงุดุฏ**

---

## ๐ ุงุฏุฏุงุดุชโูุง

### ฺุฑุง ุจู ุฌุง ูุฏู ML ุงุฒ Computer Vision ุงุณุชูุงุฏู ฺฉุฑุฏูุ
1. โ **ุณุฑุนโุชุฑ**: ุจุฏูู ูุงุฒ ุจู inference ูุฏู
2. โ **ูุงุจู ุงุทููุงูโุชุฑ**: ุงูฺฏูุฑุชู ุณุงุฏู ู ูุงุจู ุชูุธู
3. โ **ูุงุจู ุนุจโุงุจ**: ูโุชูุงู ูพุงุฑุงูุชุฑูุง ุฑุง ุจู ุฑุงุญุช ุชูุธู ฺฉุฑุฏ
4. โ **ุจุฏูู ูุงุฒ ุจู ุฏุชุงุณุช ุจุฒุฑฺฏ**: ููุท 18 ุชุตูุฑ ฺฉุงู ุงุณุช

### ุงฺฏุฑ ุฎูุงุณุชุฏ ูุฏู ML ุจุณุงุฒุฏ:
ุฏุชุงุณุช Label Studio ุฏุฑ `project-6-at-2025-11-11-03-58-db627e7c.json` ุขูุงุฏู ุงุณุช.

ูโุชูุงูุฏ ุงุฒ `train_p1_p2_i5_3070ti.py` ุงุณุชูุงุฏู ฺฉูุฏ ุง ฺฉ ูุฏู ุณุงุฏู ุจุณุงุฒุฏ:

```python
# ูุฏู ุณุงุฏู ุจุง 2 ููุฏูุงุฑฺฉ (p1, p2)
model = YourModel(num_landmarks=2)  # ููุท 2 ููุทู
```

---

## ๐ง ูุงูโูุง ูุฑุจูุทู

### Frontend (JavaScript):
- `vite-js/src/sections/orthodontics/patient/components/cephalometric-ai-analysis.jsx`
  - `detectCalibrationPoints()` (ุฎุท ~972)
  - `findHighContrastPoints()` (ุฎุท ~1003)
  - `calculatePixelToMmConversion()` (ุฎุท ~1128)

### Testing (Python):
- `aariz/quick_test_calibration.py` - ุชุณุช ุณุฑุน
- `aariz/test_calibration_detection.py` - ุชุณุช ฺฉุงูู
- `aariz/test_calibration_quick.bat` - ุงุฌุฑุง ุชุณุช ุณุฑุน
- `aariz/test_calibration_full.bat` - ุงุฌุฑุง ุชุณุช ฺฉุงูู

### Dataset:
- `aariz/Aariz/train/Annotations/Cephalometric Landmarks/Senior Orthodontists/*.json` - annotation ูุง Aariz ุจุง p1 ู p2
- `aariz/Aariz/train/Cephalograms/` - ุชุตุงูุฑ ูุชุฑุงู ุณูุงูููุชุฑ (700 ุชุตูุฑุ 18 ุชุง ุฏุงุฑุง p1/p2 ูุณุชูุฏ)

---

## โ ฺฺฉโูุณุช ููุง

ูุจู ุงุฒ ุงุณุชูุงุฏู ุฏุฑ production:

- [ ] ุชุณุช ฺฉุฑุฏู ุจุง `test_calibration_quick.bat`
- [ ] ุชุณุช ฺฉุฑุฏู ุจุง `test_calibration_full.bat`
- [ ] ุจุฑุฑุณ accuracy (ุจุงุฏ > 90% ุจุงุดุฏ)
- [ ] ุชูุธู ูพุงุฑุงูุชุฑูุง ุฏุฑ ุตูุฑุช ูุงุฒ
- [ ] ุชุณุช ุจุง ุชุตุงูุฑ ูุงูุน ุจูุงุฑุงู
- [ ] ุจุฑุฑุณ console logs ุฏุฑ ูุฑูุฑฺฏุฑ
- [ ] ููุงุณู ุจุง ุฑูุด fallback (0.11 mm/pixel)

---

**ูููู ุจุงุดุฏ! ๐**

