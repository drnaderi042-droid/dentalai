# ุฑุงูููุง ุฑูุน ูุดฺฉู Triton ุฏุฑ torch.compile

## โ๏ธ ูุดฺฉู

`torch.compile` ูุงุฒ ุจู **Triton** ุฏุงุฑุฏ ฺฉู ุฑู Windows ููฺฉู ุงุณุช ูุตุจ ูุจุงุดุฏ ุง ูุดฺฉู ุฏุงุดุชู ุจุงุดุฏ.

**ุฎุทุง:**
```
RuntimeError: Cannot find a working triton installation
```

## โ ุฑุงูฺฉุงุฑ ุงุนูุงู ุดุฏู

ฺฉุฏ ุจูโุฑูุฒุฑุณุงู ุดุฏู ู ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ:
1. ุงุจุชุฏุง ุณุน ูโฺฉูุฏ ุจุง `mode='reduce-overhead'` ฺฉุงููพุงู ฺฉูุฏ
2. ุงฺฏุฑ ุฎุทุง ุฏุงุฏุ ุจุง `mode='default'` ุงูุชุญุงู ูโฺฉูุฏ
3. ุงฺฏุฑ ุจุงุฒ ูู ุฎุทุง ุฏุงุฏุ ุจุฏูู ฺฉุงููพุงู ุงุฏุงูู ูโุฏูุฏ (ููุท ฺฉู ฺฉูุฏุชุฑ)

**ูุชุฌู:** ุขููุฒุด ุจุฏูู ุฎุทุง ุงุฏุงูู ูโุงุจุฏุ ููุท ุจุฏูู ุจูููโุณุงุฒ compile.

## ๐ ฺฏุฒููโูุง ุดูุง

### ฺฏุฒูู 1: ุงุณุชูุงุฏู ุจุฏูู compile (ูพุดููุงุฏ)

ูุงู `finetune_combined.bat` ุฑุง ูุฑุงุด ฺฉูุฏ ู ุฎุท 24 ุฑุง ฺฉุงููุช ฺฉูุฏ:

```batch
REM set USE_COMPILE=--use_compile  # ฺฉุงููุช ุดุฏู - compile ุบุฑูุนุงู
```

ุง ุฏุฑ command lineุ `--use_compile` ุฑุง ุญุฐู ฺฉูุฏ.

### ฺฏุฒูู 2: ูุตุจ Triton (ุงฺฏุฑ ูโุฎูุงูุฏ compile ูุนุงู ุจุงุดุฏ)

```bash
pip install triton
```

**ูฺฉุชู:** Triton ุฑู Windows ููฺฉู ุงุณุช ูุดฺฉู ุฏุงุดุชู ุจุงุดุฏ ู ูุงุฒ ุจู ุชูุธูุงุช ุฎุงุต ุฏุงุฑุฏ.

### ฺฏุฒูู 3: ุงุณุชูุงุฏู ุงุฒ ฺฉุฏ ูุนู (ูพุดููุงุฏ)

ฺฉุฏ ูุนู ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ fallback ูโฺฉูุฏ. ููุท ฺฉ warning ููุงุด ูโุฏูุฏ ู ุงุฏุงูู ูโุฏูุฏ.

## ๐ ุจูููโุณุงุฒโูุง ูุนุงู (ุจุฏูู compile)

ุญุช ุจุฏูู `torch.compile`ุ ุงู ุจูููโุณุงุฒโูุง ูุนุงู ูุณุชูุฏ:

- โ **Mixed Precision (FP16)**: 2x speedup
- โ **channels_last**: 10-20% speedup
- โ **num_workers=6**: ุงุณุชูุงุฏู ุจูุชุฑ ุงุฒ CPU
- โ **prefetch_factor=4**: ฺฉุงูุด idle time GPU
- โ **non_blocking transfers**: ูพุฑุฏุงุฒุด ููุฒูุงู CPU/GPU

## ๐ก ุชูุตู

ุจุฑุง Windowsุ ุจูุชุฑ ุงุณุช `torch.compile` ุฑุง ุบุฑูุนุงู ฺฉูุฏ ู ุงุฒ ุจูููโุณุงุฒโูุง ุฏฺฏุฑ ุงุณุชูุงุฏู ฺฉูุฏ:

```batch
REM ุฏุฑ finetune_combined.batุ ุฎุท 24 ุฑุง ฺฉุงููุช ฺฉูุฏ:
REM set USE_COMPILE=--use_compile
```

ุง ุฏุฑ command line:
```bash
python finetune_combined.py \
    --resume checkpoints/checkpoint_best.pth \
    --mixed_precision \
    --channels_last
    # --use_compile ุฑุง ุญุฐู ฺฉูุฏ
```

## โ ูุชุฌู

ุจุง ุงู ุชุบุฑุงุช:
- โ ุขููุฒุด ุจุฏูู ุฎุทุง ุงุฏุงูู ูโุงุจุฏ
- โ ููู ุจูููโุณุงุฒโูุง ุฏฺฏุฑ ูุนุงู ูุณุชูุฏ
- โ ุณุฑุนุช ูููุฒ ุฎูุจ ุงุณุช (30-40% ุณุฑุนโุชุฑ ุงุฒ ุญุงูุช ุนุงุฏ)
- โ๏ธ ููุท compile ุบุฑูุนุงู ุงุณุช (ฺฉู ุฑู Windows ูุนูููุงู ูุดฺฉู ุฏุงุฑุฏ)

## ๐ฏ ุฏุณุชูุฑ ููุง

ูุงู batch ุฑุง ุงุฌุฑุง ฺฉูุฏ - ุงฺฏุฑ compile ุจุง ุฎุทุง ููุงุฌู ุดุฏุ ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ fallback ูโฺฉูุฏ:

```bash
cd Aariz
.\finetune_combined.bat
```

ุง ุงฺฏุฑ ูโุฎูุงูุฏ compile ุฑุง ฺฉุงููุงู ุบุฑูุนุงู ฺฉูุฏุ ูุงู batch ุฑุง ูุฑุงุด ฺฉูุฏ ู ุฎุท 24 ุฑุง ฺฉุงููุช ฺฉูุฏ.

