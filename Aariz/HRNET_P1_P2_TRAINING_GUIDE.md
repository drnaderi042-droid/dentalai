# ๐ฅ ุฑุงูููุง ุขููุฒุด ูุฏู HRNet ุจุฑุง ุชุดุฎุต ููุงุท p1/p2

ุงู ุฑุงูููุง ุจุฑุง ุขููุฒุด ฺฉ ูุฏู **HRNet** (High-Resolution Network) ุฌูุช ุชุดุฎุต ููุงุท ฺฉุงูุจุฑุงุณูู `p1` ู `p2` ุฏุฑ ุชุตุงูุฑ ุณูุงูููุชุฑ ุงุณุช.

## ๐ ููุฑุณุช ูุทุงูุจ

1. [ูุนุฑู HRNet](#ูุนุฑู-hrnet)
2. [ูุฒุงุง HRNet ูุณุจุช ุจู ResNet](#ูุฒุงุง-hrnet)
3. [ูพุดโูุงุฒูุง](#ูพุดโูุงุฒูุง)
4. [ูุตุจ ฺฉุชุงุจุฎุงููโูุง](#ูุตุจ-ฺฉุชุงุจุฎุงููโูุง)
5. [ุขููุฒุด ูุฏู](#ุขููุฒุด-ูุฏู)
6. [ุชุณุช ูุฏู](#ุชุณุช-ูุฏู)
7. [ููุงุณู ุจุง ูุฏู ResNet](#ููุงุณู-ุจุง-ูุฏู-resnet)
8. [ุจูููโุณุงุฒ](#ุจูููโุณุงุฒ)

---

## ๐ฏ ูุนุฑู HRNet

**HRNet** (High-Resolution Network) ฺฉ ูุนูุงุฑ ุดุจฺฉู ุนุตุจ ุงุณุช ฺฉู ุจุฑุง ุชุดุฎุต ุฏูู landmarks ู pose estimation ุทุฑุงุญ ุดุฏู ุงุณุช.

### ูฺฺฏโูุง ฺฉูุฏ:

- โ **ุญูุธ ุฑุฒูููุดู ุจุงูุง**: ุจุฑุฎูุงู ุดุจฺฉูโูุง ูุนูููุ HRNet resolution ุจุงูุง ุฑุง ุฏุฑ ุชูุงู ูุงูโูุง ุญูุธ ูโฺฉูุฏ
- โ **Multi-Scale Feature Fusion**: ุชุฑฺฉุจ features ุงุฒ ููุงุณโูุง ูุฎุชูู
- โ **ุฏูุช ุจุงูุงุชุฑ**: ุจู ุฎุตูุต ุจุฑุง localization ุฏูู ููุงุท
- โ **ูพุดโุขููุฒุด ุฏุฏู**: ูุฏูโูุง ูพุดโุขููุฒุด ุฏุฏู ุฑู ImageNet

### ุงููุงุน HRNet:

| Variant | Parameters | Speed | Accuracy | Use Case |
|---------|-----------|-------|----------|----------|
| `hrnet_w18` | ~20M | โกโกโก Fast | โญโญโญ Good | ุขููุฒุด ุณุฑุนุ ุชุณุช ุงููู |
| `hrnet_w32` | ~29M | โกโก Medium | โญโญโญโญ Better | ุชุนุงุฏู ุจู ุณุฑุนุช ู ุฏูุช |
| `hrnet_w48` | ~65M | โก Slow | โญโญโญโญโญ Best | ุจูุชุฑู ุฏูุชุ production |

---

## ๐ ูุฒุงุง HRNet ูุณุจุช ุจู ResNet

| ูฺฺฏ | ResNet | HRNet |
|-------|--------|-------|
| **Resolution** | ฺฉู ูโุดูุฏ ุฏุฑ ูุงูโูุง ุนูู | ููุดู ุจุงูุง ูโูุงูุฏ |
| **Localization** | โญโญโญ ุฎูุจ | โญโญโญโญโญ ุนุงู |
| **Multi-Scale** | ููุท ุฏุฑ ุขุฎุฑ | ุฏุฑ ุชูุงู ุดุจฺฉู |
| **ุฏูุช ุจุฑุง landmarks** | ~30-50 px | ~10-20 px (ุงูุชุธุงุฑ) |
| **ุณุฑุนุช** | โกโกโก ุณุฑุน | โกโก ูุชูุณุท |
| **ุญุงูุธู GPU** | ฺฉู | ูุชูุณุท ุชุง ุฒุงุฏ |

### ฺู ูููุน ุงุฒ HRNet ุงุณุชูุงุฏู ฺฉููุ

- โ ููุช ฺฉู **ุฏูุช localization** ุจุณุงุฑ ููู ุงุณุช
- โ ุจุฑุง **ุชุดุฎุต ููุงุท ุฑุฒ** (ูุซู p1/p2 ุฑู ุฎุทฺฉุด)
- โ ุฒูุงู ฺฉู GPU ูู ุฏุฑ ุฏุณุชุฑุณ ุงุณุช
- โ ุจุฑุง **production deployment** ุจุง ฺฉูุช ุจุงูุง

### ฺู ูููุน ุงุฒ ResNet ุงุณุชูุงุฏู ฺฉููุ

- โ ุจุฑุง **ุขููุฒุด ุณุฑุน** ู ุชุณุช ุงููู
- โ ุฒูุงู ฺฉู ููุงุจุน ูุญุฏูุฏ ุงุณุช
- โ ุจุฑุง **edge deployment** (ููุจุงูุ embedded)
- โ ููุช ฺฉู ุฏูุช 30-50 ูพฺฉุณู ฺฉุงู ุงุณุช

---

## ๐ฆ ูพุดโูุงุฒูุง

### 1. ุฏุชุงุณุช

ุฏุงุฏูโูุง ุขููุฒุด ุจุงุฏ ุฏุฑ ุงู ูุณุฑ ุจุงุดูุฏ:

```
aariz/
โโโ Aariz/
โ   โโโ train/
โ       โโโ Cephalograms/              # ุชุตุงูุฑ (18 ุนุฏุฏ)
โ       โโโ Annotations/
โ           โโโ Cephalometric Landmarks/
โ               โโโ Senior Orthodontists/
โ                   โโโ project-6-at-2025-11-11-03-58-db627e7c.json
```

### 2. ูุฑูโุงูุฒุงุฑ

- Python 3.8+
- PyTorch 1.12+
- CUDA (ุงุฎุชุงุฑ ุงูุง ูพุดููุงุฏ)

---

## ๐ง ูุตุจ ฺฉุชุงุจุฎุงููโูุง

### ฺฏุงู 1: ูุตุจ PyTorch

```bash
# ุจุง CUDA (GPU)
pip install torch torchvision --index-url https://download.pytorch.org/whl/cu118

# ุจุฏูู CUDA (CPU only)
pip install torch torchvision
```

### ฺฏุงู 2: ูุตุจ timm (ุจุฑุง HRNet)

```bash
pip install timm
```

ฺฉุชุงุจุฎุงูู `timm` (PyTorch Image Models) ุดุงูู ูุฏูโูุง ูพุดโุขููุฒุด ุฏุฏู HRNet ุงุณุช.

### ฺฏุงู 3: ูุตุจ ฺฉุชุงุจุฎุงููโูุง ุงุถุงู

```bash
pip install pillow numpy tqdm
```

### ุชุฃุฏ ูุตุจ

```python
import torch
import timm

print(f"PyTorch: {torch.__version__}")
print(f"CUDA available: {torch.cuda.is_available()}")
print(f"timm version: {timm.__version__}")

# ุชุณุช HRNet
model = timm.create_model('hrnet_w18', pretrained=False)
print(f"HRNet loaded successfully!")
```

---

## ๐ ุขููุฒุด ูุฏู

### ุฑูุด 1: ุงุณุชูุงุฏู ุงุฒ Batch File (ุณุงุฏูโุชุฑู)

```bash
# ุฏุฑ ูพูุดู aariz/
train_hrnet.bat
```

### ุฑูุด 2: ุฏุณุช ุจุง Python

```bash
cd aariz
python train_p1_p2_hrnet.py
```

### ูพุงุฑุงูุชุฑูุง ุขููุฒุด

ูโุชูุงูุฏ ุฏุฑ ูุงู `train_p1_p2_hrnet.py` ุงู ูพุงุฑุงูุชุฑูุง ุฑุง ุชุบุฑ ุฏูุฏ:

```python
model = train_hrnet_p1_p2_model(
    annotations_file=annotations_file,
    images_dir=images_dir,
    output_dir='models',
    
    # ุงูุชุฎุงุจ variant (w18 ุณุฑุนโุชุฑุ w48 ุฏููโุชุฑ)
    hrnet_variant='hrnet_w18',  # ุง 'hrnet_w32' ุง 'hrnet_w48'
    
    # ุชูุธูุงุช ุชุตูุฑ
    image_size=512,             # ุงูุฏุงุฒู ุชุตูุฑ ูุฑูุฏ
    
    # ุชูุธูุงุช ุขููุฒุด
    batch_size=4,               # ฺฉู ฺฉูุฏ ุงฺฏุฑ out of memory
    num_epochs=200,             # ุชุนุฏุงุฏ epochs
    learning_rate=0.001,        # ูุฑุฎ ุงุฏฺฏุฑ
    
    # ุฏุณุชฺฏุงู
    device='cuda' if torch.cuda.is_available() else 'cpu'
)
```

### ูฺฉุงุช ููู ุขููุฒุด

#### 1. ุญุงูุธู GPU

HRNet ูุงุฒ ุจู ุญุงูุธู ุจุดุชุฑ ุฏุงุฑุฏ:

| Variant | Batch Size | GPU Memory |
|---------|-----------|-----------|
| `hrnet_w18` | 4 | ~6 GB |
| `hrnet_w32` | 4 | ~8 GB |
| `hrnet_w48` | 2 | ~10 GB |

**ุงฺฏุฑ "Out of Memory" ฺฏุฑูุชุฏ:**
- `batch_size` ุฑุง ฺฉู ฺฉูุฏ (ุจู 2 ุง 1)
- ุง ุจู variant ฺฉูฺฺฉโุชุฑ (`hrnet_w18`) ุชุบุฑ ุฏูุฏ

#### 2. ูุฏุช ุฒูุงู ุขููุฒุด

- **hrnet_w18**: ~2-4 ุณุงุนุช (GPU) / ~12-24 ุณุงุนุช (CPU)
- **hrnet_w32**: ~4-8 ุณุงุนุช (GPU) / ~24-48 ุณุงุนุช (CPU)
- **hrnet_w48**: ~8-16 ุณุงุนุช (GPU) / ~48+ ุณุงุนุช (CPU)

#### 3. Data Augmentation

ูุฏู ุงุฒ ุงู augmentationูุง ุงุณุชูุงุฏู ูโฺฉูุฏ:

- โ **Color Jitter**: ุชุบุฑ brightness ู contrast
- โ **Gaussian Blur**: blur ฺฉุฑุฏู ุชุตูุฑ
- โ **Random Sharpness**: ุชุฒ ฺฉุฑุฏู ุชุตุงูุฑ

ุงู ฺฉูฺฉ ูโฺฉูุฏ ูุฏู robustโุชุฑ ุดูุฏ.

---

## ๐งช ุชุณุช ูุฏู

### ุฑูุด 1: ุงุณุชูุงุฏู ุงุฒ Batch File

```bash
test_hrnet.bat
```

### ุฑูุด 2: ุฏุณุช ุจุง Python

```bash
python test_p1_p2_hrnet.py
```

### ุฎุฑูุฌ ุชุณุช

```
[RESULTS] Test Statistics:
  - Samples tested: 18
  - Average error: 15.32 px
  - Median error: 12.45 px
  - Std deviation: 8.21 px
  - Min error: 5.12 px
  - Max error: 35.67 px

  - P1 avg error: 14.89 px
  - P2 avg error: 15.75 px

  Visualizations saved to: test_results_hrnet/
```

**ุชูุณุฑ ูุชุงุฌ:**

| Average Error | ฺฉูุช | ุชูุถุญ |
|--------------|--------|-------|
| < 10 px | โญโญโญโญโญ ุนุงู | ูุฏู ุขูุงุฏู production ุงุณุช |
| 10-20 px | โญโญโญโญ ุฎูุจ | ูุงุจู ุงุณุชูุงุฏู ุจุง ุฏูุช ุฎูุจ |
| 20-30 px | โญโญโญ ูุชูุณุท | ูุงุฒ ุจู ุจูููโุณุงุฒ ุจุดุชุฑ |
| > 30 px | โญโญ ุถุนู | ูุงุฒ ุจู ุขููุฒุด ูุฌุฏุฏ ุง ุฏุงุฏู ุจุดุชุฑ |

---

## ๐ ููุงุณู ุจุง ูุฏู ResNet

### ุขููุฒุด ูุฑ ุฏู ูุฏู ู ููุงุณู:

```bash
# 1. ุขููุฒุด ResNet (ุณุฑุนโุชุฑ)
python train_p1_p2.py

# 2. ุขููุฒุด HRNet (ุฏููโุชุฑ)
python train_p1_p2_hrnet.py

# 3. ููุงุณู ูุชุงุฌ
python test_p1_p2_model.py      # ResNet
python test_p1_p2_hrnet.py      # HRNet
```

### ูุชุงุฌ ุงูุชุธุงุฑ (ุจุฑ ุงุณุงุณ 18 ุชุตูุฑ):

| Metric | ResNet-34 | HRNet-W18 | HRNet-W32 |
|--------|-----------|-----------|-----------|
| **Avg Error** | ~29 px | ~15 px (ุงูุชุธุงุฑ) | ~12 px (ุงูุชุธุงุฑ) |
| **Training Time** | 30-60 min | 2-4 hours | 4-8 hours |
| **Parameters** | 21M | 20M | 29M |
| **Inference Speed** | โกโกโก | โกโก | โก |

**ุชูุตู:**
- ุจุฑุง **ุชุณุช ุณุฑุน**: ResNet
- ุจุฑุง **production**: HRNet-W18 ุง W32
- ุจุฑุง **ุจูุชุฑู ุฏูุช**: HRNet-W48 (ุงฺฏุฑ GPU ูู ุฏุงุฑุฏ)

---

## โ๏ธ ุจูููโุณุงุฒ

### 1. ุงูุฒุงุด ุฏูุช

#### ุงูู) ุฏุงุฏู ุจุดุชุฑ

```python
# ุงฺฏุฑ ุฏุงุฏู ุจุดุชุฑ ุฏุงุฑุฏ:
- 50+ images: ุฏูุช ~10-15 px
- 100+ images: ุฏูุช ~5-10 px
- 500+ images: ุฏูุช ~3-5 px
```

#### ุจ) Hyperparameter Tuning

```python
# ุฏุฑ train_p1_p2_hrnet.py:

# 1. ุงูุฒุงุด epochs
num_epochs=300  # ุจู ุฌุง 200

# 2. ฺฉุงูุด learning rate
learning_rate=0.0005  # ุจู ุฌุง 0.001

# 3. ุงูุฒุงุด regularization
# ุฏุฑ ูุฏู: weight_decay=1e-4  # ุจู ุฌุง 1e-5
```

#### ุฌ) ุงุณุชูุงุฏู ุงุฒ Variant ุจุฒุฑฺฏโุชุฑ

```python
# ุจู ุฌุง hrnet_w18:
hrnet_variant='hrnet_w32'  # ุง 'hrnet_w48'
```

### 2. ฺฉุงูุด ุฒูุงู ุขููุฒุด

```python
# 1. ฺฉุงูุด epochs
num_epochs=100  # ุจุฑุง ุชุณุช ุณุฑุน

# 2. ุงูุฒุงุด batch size (ุงฺฏุฑ GPU ุงุฌุงุฒู ูโุฏูุฏ)
batch_size=8

# 3. ุงุณุชูุงุฏู ุงุฒ w18
hrnet_variant='hrnet_w18'
```

### 3. ฺฉุงูุด ุญุงูุธู GPU

```python
# 1. ฺฉุงูุด batch size
batch_size=2  # ุง ุญุช 1

# 2. ฺฉุงูุด image size
image_size=384  # ุจู ุฌุง 512

# 3. ุงุณุชูุงุฏู ุงุฒ gradient accumulation
# (ูุงุฒ ุจู ุชุบุฑ ฺฉุฏ ุฏุงุฑุฏ)
```

---

## ๐ ุนุจโุงุจ (Troubleshooting)

### ูุดฺฉู 1: "timm not found"

```bash
pip install timm
```

### ูุดฺฉู 2: "CUDA out of memory"

**ุฑุงูโุญู:**
```python
# ฺฉุงูุด batch size
batch_size=2  # ุง 1

# ุง ฺฉุงูุด image size
image_size=384
```

### ูุดฺฉู 3: "No module named 'model'"

```bash
# ูุทูุฆู ุดูุฏ ุฏุฑ ูพูุดู aariz/ ูุณุชุฏ:
cd aariz
python train_p1_p2_hrnet.py
```

### ูุดฺฉู 4: ุฏูุช ุฎู ูพุงู

**ุนูู ุงุญุชูุงู:**
- โ ุฏุงุฏู ฺฉู (< 18 ุชุตูุฑ): ูุงุฒ ุจู data augmentation ุจุดุชุฑ
- โ Learning rate ุฒุงุฏ: ฺฉุงูุด ุจู `0.0005` ุง `0.0001`
- โ Epochs ฺฉู: ุงูุฒุงุด ุจู `300` ุง ุจุดุชุฑ
- โ ฺฉูุช annotations: ุจุฑุฑุณ ุฏูุช labelโูุง

---

## ๐ ุณุงุฎุชุงุฑ ูุงูโูุง HRNet

```
aariz/
โโโ model.py                          # ุชุนุฑู HRNetP1P2Detector
โโโ train_p1_p2_hrnet.py             # ุงุณฺฉุฑูพุช ุขููุฒุด HRNet
โโโ test_p1_p2_hrnet.py              # ุงุณฺฉุฑูพุช ุชุณุช HRNet
โโโ train_hrnet.bat                  # Batch file ุขููุฒุด
โโโ test_hrnet.bat                   # Batch file ุชุณุช
โโโ HRNET_P1_P2_TRAINING_GUIDE.md   # ุงู ุฑุงูููุง
โ
โโโ models/                          # ูุฏูโูุง ุฐุฎุฑู ุดุฏู
โ   โโโ hrnet_p1p2_best_hrnet_w18.pth
โ
โโโ test_results_hrnet/              # ูุชุงุฌ ุชุณุช
    โโโ result_1_*.png
    โโโ ...
```

---

## ๐ ููุงุณู ููุง: ResNet vs HRNet

### ุงุณุชูุงุฏู ุงุฒ ResNet ููุช ฺฉู:

- โก ุณุฑุนุช ุขููุฒุด ููู ุงุณุช
- ๐ป ููุงุจุน GPU ูุญุฏูุฏ ุงุณุช
- ๐ฏ ุฏูุช 25-30 ูพฺฉุณู ฺฉุงู ุงุณุช
- ๐ฑ ูุงุฒ ุจู deployment ุฑู edge devices ุฏุงุฑุฏ

### ุงุณุชูุงุฏู ุงุฒ HRNet ููุช ฺฉู:

- ๐ฏ ุฏูุช ุจุงูุง (< 20 ูพฺฉุณู) ุถุฑูุฑ ุงุณุช
- ๐ช GPU ูู ุฏุฑ ุฏุณุชุฑุณ ุงุณุช
- ๐ฅ ุจุฑุง ฺฉุงุฑุจุฑุฏ ูพุฒุดฺฉ (ูุงุฒ ุจู ุฏูุช ุจุงูุง)
- ๐ ุจุฑุง production deployment

---

## ๐ ูพุดุชุจุงู

ุงฺฏุฑ ูุดฺฉู ูพุด ุขูุฏ:

1. **ฺฺฉ ฺฉูุฏ**: ุขุง timm ูุตุจ ุงุณุชุ (`pip list | grep timm`)
2. **ฺฺฉ ฺฉูุฏ**: ุขุง GPU ุฏุฑ ุฏุณุชุฑุณ ุงุณุชุ (`torch.cuda.is_available()`)
3. **ฺฉุงูุด ุฏูุฏ**: batch_size ุฑุง ุจู 2 ุง 1
4. **ุชุณุช ฺฉูุฏ**: ุงุจุชุฏุง ุจุง `hrnet_w18` ุดุฑูุน ฺฉูุฏ

---

## โ ฺฺฉโูุณุช ุขููุฒุด HRNet

- [ ] timm ูุตุจ ุดุฏู ุงุณุช
- [ ] ุฏุชุงุณุช ุฏุฑ ูุณุฑ ุตุญุญ ูุฑุงุฑ ุฏุงุฑุฏ (18 ุชุตูุฑ ุจุง p1/p2)
- [ ] PyTorch ู CUDA ูุตุจ ูุณุชูุฏ
- [ ] HRNet variant ุงูุชุฎุงุจ ุดุฏู (w18/w32/w48)
- [ ] Batch size ููุงุณุจ ุจุง GPU ุชูุธู ุดุฏู
- [ ] ุขููุฒุด ุดุฑูุน ุดุฏู ู ุฏุฑ ุญุงู ูพุดุฑูุช ุงุณุช
- [ ] ูุฏู ุฐุฎุฑู ุดุฏู ุงุณุช (models/hrnet_p1p2_best_*.pth)
- [ ] ุชุณุช ุงูุฌุงู ุดุฏู ู ุฏูุช ูุงุจู ูุจูู ุงุณุช
- [ ] ูุชุงุฌ ุจุตุฑ ุจุฑุฑุณ ุดุฏูโุงูุฏ (test_results_hrnet/)

---

**ูููู ุจุงุดุฏ! ๐**

ุจุฑุง ุณูุงูุงุช ุจุดุชุฑ ุง ูุดฺฉูุงุชุ ุจู documentation PyTorch ู timm ูุฑุงุฌุนู ฺฉูุฏ.

