# ๐ ุฑุงูููุง Annotation ุจุฑุง ููุงุท p1/p2

ุงู ุฑุงูููุง ูุญูู ุงุณุชูุงุฏู ุงุฒ ุงุจุฒุงุฑ annotation ุณูุงุฑุด ุจุฑุง label ฺฏุฐุงุฑ ููุงุท ฺฉุงูุจุฑุงุณูู p1 ู p2 ุฑุง ุชูุถุญ ูโุฏูุฏ.

## ๐ ููุฑุณุช ูุทุงูุจ

1. [ูุนุฑู ุงุจุฒุงุฑ](#ูุนุฑู-ุงุจุฒุงุฑ)
2. [ูุตุจ ู ุฑุงูโุงูุฏุงุฒ](#ูุตุจ-ู-ุฑุงูโุงูุฏุงุฒ)
3. [ูุญูู ุงุณุชูุงุฏู](#ูุญูู-ุงุณุชูุงุฏู)
4. [ฺฉูุฏูุง ูุงูุจุฑ](#ฺฉูุฏูุง-ูุงูุจุฑ)
5. [ูฺฉุงุช ููู](#ูฺฉุงุช-ููู)
6. [ุฎุฑูุฌ](#ุฎุฑูุฌ)
7. [ุนุจโุงุจ](#ุนุจโุงุจ)

---

## ๐ฏ ูุนุฑู ุงุจุฒุงุฑ

### ฺุณุชุ

ุงุจุฒุงุฑ **P1/P2 Annotator** ฺฉ ุจุฑูุงูู ุณุงุฏู ู ุณุฑุน ุจุฑุง label ฺฏุฐุงุฑ ููุงุท ฺฉุงูุจุฑุงุณูู ุฑู ุฎุทฺฉุด ุฏุฑ ุชุตุงูุฑ ุณูุงูููุชุฑ ุงุณุช.

### ฺุฑุง ุงู ุงุจุฒุงุฑุ

- โ **ุณุฑุนุช ุจุงูุง**: ุจุฏูู ูุงุฒ ุจู browser ุง server
- โ **ุณุงุฏู**: ููุท 2 ฺฉูฺฉ ุจุฑุง ูุฑ ุชุตูุฑ
- โ **ุณุงุฒฺฏุงุฑ**: ุฎุฑูุฌ JSON ุจู ูุฑูุช Aariz
- โ **Auto-save**: ุฎูุฏฺฉุงุฑ ุฐุฎุฑู ูโฺฉูุฏ
- โ **Resume**: ูโุชูุงูุฏ ุงุฏุงูู ุฏูุฏ

### ููุงุณู ุจุง ุณุงุฑ ุงุจุฒุงุฑูุง:

| ูฺฺฏ | Label Studio | CVAT | VIA | **P1/P2 Annotator** โญ |
|-------|--------------|------|-----|----------------------|
| ูุตุจ | ูพฺุฏู | ูุชูุณุท | ูุฏุงุฑุฏ | ุณุงุฏู |
| ุณุฑุนุช | ฺฉูุฏ | ูุชูุณุท | ุณุฑุน | **ุฎู ุณุฑุน** |
| ุณูุงุฑุดโุณุงุฒ | ฺฉู | ูุชูุณุท | ฺฉู | **ูุฎุตูุต p1/p2** |
| Auto-save | ุฎุฑ | ุฎุฑ | ุฎุฑ | **ุจูู** โ |
| Resume | ุจูู | ุจูู | ุฎุฑ | **ุจูู** โ |
| ุฎุฑูุฌ Aariz | ุฎุฑ | ุฎุฑ | ุฎุฑ | **ุจูู** โ |

---

## ๐ง ูุตุจ ู ุฑุงูโุงูุฏุงุฒ

### ูพุดโูุงุฒูุง

```bash
pip install opencv-python numpy
```

**ููู!** ุจุดุชุฑ ูุงุฒ ูุณุช.

### ุจุฑุฑุณ ูุตุจ

```bash
python -c "import cv2; print('OpenCV version:', cv2.__version__)"
```

ุงฺฏุฑ ุฎุทุง ูุฏุฏุ ุขูุงุฏู ูุณุชุฏ! โ

---

## ๐ ูุญูู ุงุณุชูุงุฏู

### ุฑูุด 1: ุงุณุชูุงุฏู ุงุฒ Batch File (ุณุงุฏูโุชุฑู)

```cmd
annotate_p1_p2.bat "path/to/images"
```

**ูุซุงู:**

```cmd
annotate_p1_p2.bat "Aariz/train/Cephalograms"
```

ุจุง ุฎุฑูุฌ ุณูุงุฑุด:

```cmd
annotate_p1_p2.bat "Aariz/train/Cephalograms" "my_annotations.json"
```

### ุฑูุด 2: ุงุณุชูุงุฏู ูุณุชูู ุงุฒ Python

```bash
python p1_p2_annotator.py path/to/images
```

ุจุง ฺฏุฒููโูุง ุงุถุงู:

```bash
python p1_p2_annotator.py path/to/images -o output.json
```

---

## โจ๏ธ ฺฉูุฏูุง ูุงูุจุฑ

### ฺฉูุฏูุง ุงุตู:

| ฺฉูุฏ | ุนููฺฉุฑุฏ |
|------|--------|
| **Mouse Click** | ุงูุชุฎุงุจ p2 (ุงููู ฺฉูฺฉ) ุง p1 (ุฏููู ฺฉูฺฉ) |
| **n** | ุชุตูุฑ ุจุนุฏ (Next) |
| **p** | ุชุตูุฑ ูุจู (Previous) |
| **r** | ูพุงฺฉ ฺฉุฑุฏู annotation ูุนู (Reset) |
| **s** | ุฐุฎุฑู ุชูุงู annotations (Save) |
| **q** | ุฎุฑูุฌ ู ุฐุฎุฑู (Quit) |
| **+** ุง **=** | ุจุฒุฑฺฏโููุง (Zoom in) |
| **-** | ฺฉูฺฺฉโููุง (Zoom out) |

### ุชุฑุชุจ ฺฉุงุฑ:

1. โ **ฺฉูฺฉ ุงูู**: ุฑู **p2** (ููุทู **ุจุงูุง** ุฎุทฺฉุด - 1cm)
2. โ **ฺฉูฺฉ ุฏูู**: ุฑู **p1** (ููุทู **ูพุงู** ุฎุทฺฉุด - 0cm)
3. โ **Auto-save**: ุฎูุฏฺฉุงุฑ ุฐุฎุฑู ูโุดูุฏ
4. โ ูุดุงุฑ **'n'**: ุจุฑุง ุฑูุชู ุจู ุชุตูุฑ ุจุนุฏ

---

## ๐ ูฺฉุงุช ููู

### 1. ุชุฑุชุจ ููุงุท

```
โโโโโโโโโโโ
โ  [p2]   โ  โ ููุทู ุจุงูุง (1cm) - ฺฉูฺฉ ุงูู
โ         โ
โ   10mm  โ  โ ูุงุตูู ุจู p1 ู p2
โ         โ
โ  [p1]   โ  โ ููุทู ูพุงู (0cm) - ฺฉูฺฉ ุฏูู
โโโโโโโโโโโ
```

โ๏ธ **ุชูุฌู:** ุชุฑุชุจ ููู ุงุณุช! ุงุจุชุฏุง p2 (ุจุงูุง) ุณูพุณ p1 (ูพุงู)

### 2. ุฏูุช ุฏุฑ ุงูุชุฎุงุจ

- โ ุฑู **ูุฑฺฉุฒ** ููุทู ุฑูุดู ฺฉูฺฉ ฺฉูุฏ
- โ ุงุฒ **zoom** ุงุณุชูุงุฏู ฺฉูุฏ ุจุฑุง ุฏูุช ุจุดุชุฑ (ฺฉูุฏ `+`)
- โ ููุงุท ุจุงุฏ **ุนููุฏ** ุฑู ูู ุจุงุดูุฏ (ููุงู ุฎุท ุฎุทฺฉุด)

### 3. Auto-save

- โ ุจุนุฏ ุงุฒ ูุฑ 2 ฺฉูฺฉุ ุฎูุฏฺฉุงุฑ ุฐุฎุฑู ูโุดูุฏ
- โ ุงฺฏุฑ ุจุฑูุงูู ุจุณุชู ุดูุฏุ ูพุดุฑูุช ุญูุธ ูโุดูุฏ
- โ ูโุชูุงูุฏ ุจุนุฏุงู ุงุฏุงูู ุฏูุฏ

### 4. Resume ฺฉุฑุฏู

```bash
# ุงุฌุฑุง ุฏูุจุงุฑู ุจุง ููุงู ูุงู ุฎุฑูุฌ
python p1_p2_annotator.py path/to/images -o annotations_p1_p2.json
```

ุจุฑูุงูู:
- โ ุชุตุงูุฑ annotate ุดุฏู ุฑุง ูุดุงู ูโุฏูุฏ
- โ ูโุชูุงูุฏ ุงุฒ ุฑู ุขูโูุง ุฑุฏ ุดูุฏ (ุจุง 'n')
- โ ุง ุฏูุจุงุฑู annotate ฺฉูุฏ (ุจุง 'r' ู ฺฉูฺฉ ูุฌุฏุฏ)

---

## ๐ ููุงุด ุงุทูุงุนุงุช

### ููฺฏุงู ุงุฌุฑุง:

```
P1/P2 Calibration Point Annotator
============================================================

Instructions:
  1. Click on p2 (TOP point on ruler, 1cm mark)
  2. Click on p1 (BOTTOM point on ruler, 0cm mark)
  3. Press 'n' for next image

Controls:
  n: Next image
  p: Previous image
  r: Reset current annotation
  s: Save all annotations
  +: Zoom in
  -: Zoom out
  q: Quit and save
============================================================

Loaded 100 images
Existing annotations: 25
```

### ุฑู ุชุตูุฑ:

- ๐ ูุงู ูุงู
- ๐ ูพุดุฑูุช: `[26/100]`
- โ ูุถุนุช: `Complete` ุง `Incomplete`

### ุฏุฑ Console:

```
p2 set at (1523, 45)
p1 set at (1520, 95)
Both points annotated! Press 'n' for next image or 'r' to reset.
```

---

## ๐พ ุฎุฑูุฌ

### ูุฑูุช JSON (Aariz Compatible)

```json
[
  {
    "id": 1,
    "data": {
      "image": "/data/upload/image001.png"
    },
    "annotations": [
      {
        "id": 1,
        "completed_by": 1,
        "created_at": "2025-11-12T10:30:00.000000Z",
        "result": [
          {
            "type": "keypointlabels",
            "value": {
              "x": 85.5,
              "y": 2.3,
              "width": 1.0,
              "keypointlabels": ["p1"]
            }
          },
          {
            "type": "keypointlabels",
            "value": {
              "x": 85.4,
              "y": 6.8,
              "width": 1.0,
              "keypointlabels": ["p2"]
            }
          }
        ]
      }
    ],
    "file_upload": "image001.png"
  }
]
```

### ูุฎุชุตุงุช (Coordinates)

- **x, y**: ุฏุฑุตุฏ (0-100) ูุณุจุช ุจู ุงูุฏุงุฒู ุชุตูุฑ
- **p1**: ููุทู ูพุงู (0cm mark)
- **p2**: ููุทู ุจุงูุง (1cm mark)

### ุงุณุชูุงุฏู ุฏุฑ Training

ุงู ูุงู JSON ูุณุชููุงู ุจุง:
- โ `train_p1_p2.py`
- โ `train_p1_p2_hrnet.py`
- โ `test_p1_p2_model.py`

ุณุงุฒฺฏุงุฑ ุงุณุช!

```python
# ุฏุฑ training script:
annotations_file = 'annotations_p1_p2.json'
dataset = P1P2Dataset(annotations_file, images_dir)
```

---

## ๐จ ุฑูฺฏโูุง ููุงุท

| ููุทู | ุฑูฺฏ | ูุนู |
|------|-----|------|
| **p1** | ๐ ูุงุฑูุฌ | ููุทู ูพุงู (ุฐุฎุฑู ุดุฏู) |
| **p2** | ๐ก ุทูุง | ููุทู ุจุงูุง (ุฐุฎุฑู ุดุฏู) |
| **temp** | ๐ข ุณุจุฒ | ููุทู ูููุช (ูููุฒ ุฐุฎุฑู ูุดุฏู) |

---

## ๐ ุนุจโุงุจ

### ูุดฺฉู 1: "No images found"

**ุนูุช:** ูุณุฑ ุงุดุชุจุงู ุง ูุฑูุช ูุงู ูุงูุนุชุจุฑ

**ุฑุงูโุญู:**
```bash
# ุจุฑุฑุณ ฺฉูุฏ ฺฉู ุชุตุงูุฑ ูุฌูุฏ ุฏุงุฑูุฏ:
dir path\to\images\*.png
dir path\to\images\*.jpg
```

ูุฑูุชโูุง ูพุดุชุจุงู ุดุฏู: `.png`, `.jpg`, `.jpeg`

### ูุดฺฉู 2: "Could not load image"

**ุนูุช:** ูุงู ุฎุฑุงุจ ุง ูุฑูุช ูุงุดูุงุฎุชู

**ุฑุงูโุญู:**
- ุจุฑุฑุณ ฺฉูุฏ ฺฉู ูุงู ุณุงูู ุงุณุช
- ุชุตูุฑ ุฑุง ุจุง ฺฉ ูุฑูโุงูุฒุงุฑ ุฏฺฏุฑ ุจุงุฒ ฺฉูุฏ
- ูุฑูุช ุฑุง ุจู PNG ุชุจุฏู ฺฉูุฏ

### ูุดฺฉู 3: ูพูุฌุฑู ุฎู ุจุฒุฑฺฏ/ฺฉูฺฺฉ ุงุณุช

**ุฑุงูโุญู:**
- ูพูุฌุฑู ูุงุจู resize ุงุณุช (ฺฏูุดูโูุง ุฑุง ุจฺฉุดุฏ)
- ุง ุงุฒ zoom ุงุณุชูุงุฏู ฺฉูุฏ (`+` / `-`)

### ูุดฺฉู 4: ุงุดุชุจุงู annotate ฺฉุฑุฏู

**ุฑุงูโุญู:**
```
ูุดุงุฑ 'r' โ ูพุงฺฉ ูโุดูุฏ
ฺฉูฺฉ ูุฌุฏุฏ โ annotate ุฏูุจุงุฑู
```

### ูุดฺฉู 5: ุจุฑูุงูู crash ฺฉุฑุฏ

**ุฑุงูโุญู:**
- ุขุฎุฑู annotations ุฐุฎุฑู ุดุฏูโุงูุฏ (auto-save)
- ุฏูุจุงุฑู ุงุฌุฑุง ฺฉูุฏ
- ุงุฒ ููุงูโุฌุง ุงุฏุงูู ุฏูุฏ

---

## ๐ ุจูุชุฑู ุฑูุดโูุง (Best Practices)

### 1. ูุจู ุงุฒ ุดุฑูุน

```bash
# ฺฉ backup ุงุฒ ุชุตุงูุฑ ุจฺฏุฑุฏ
cp -r Cephalograms Cephalograms_backup

# ฺฉ ููููู ฺฉูฺฺฉ ุชุณุช ฺฉูุฏ
python p1_p2_annotator.py test_images -o test_annotations.json
```

### 2. ุฏุฑ ุญู annotation

- โ ูุฑ 10-20 ุชุตูุฑ ูุดุงุฑ `'s'` ุฏูุฏ (ุฐุฎุฑู ุฏุณุช)
- โ ุงุณุชุฑุงุญุช ฺฉูุฏ (ุฎุณุชฺฏ ฺุดู = ุฎุทุง)
- โ ุงุฒ zoom ุงุณุชูุงุฏู ฺฉูุฏ ุจุฑุง ุฏูุช

### 3. ฺฉูุช ุจุงูุง

```
ุฏูุช ฺฉู โ ูุฏู ุถุนู
ุฏูุช ุจุงูุง โ ูุฏู ูู

ูุฏู: < 5 ูพฺฉุณู ุฎุทุง ุฏุฑ annotation
```

### 4. Batch Processing

```bash
# ุฑูุฒ 1: 50 ุชุตูุฑ
python p1_p2_annotator.py images -o day1.json

# ุฑูุฒ 2: 50 ุชุตูุฑ ุจุนุฏ
# (ุงุฏุงูู ุงุฒ day1.json)
python p1_p2_annotator.py images -o day1.json
```

---

## ๐ฏ ุณูุงุฑููุง ุงุณุชูุงุฏู

### ุณูุงุฑู 1: Dataset ุฌุฏุฏ (ุงุฒ ุตูุฑ)

```bash
# ฺฏุงู 1: annotation
python p1_p2_annotator.py new_images -o new_annotations.json

# ฺฏุงู 2: ุชุณุช
python check_p1_p2_annotations.py

# ฺฏุงู 3: training
python train_p1_p2_hrnet.py
```

### ุณูุงุฑู 2: ุงูุฒูุฏู ุจู dataset ููุฌูุฏ

```bash
# ฺฏุงู 1: annotation ุชุตุงูุฑ ุฌุฏุฏ
python p1_p2_annotator.py new_images -o new_annotations.json

# ฺฏุงู 2: ุงุฏุบุงู ุจุง annotations ูุฏู
# (manual merge ุฏุฑ Python ุง JSON editor)

# ฺฏุงู 3: training ูุฌุฏุฏ ุจุง dataset ุจุฒุฑฺฏโุชุฑ
```

### ุณูุงุฑู 3: ุงุตูุงุญ annotations ูุฏู

```bash
# ฺฏุงู 1: ุจุงุฑฺฏุฐุงุฑ annotations ููุฌูุฏ
python p1_p2_annotator.py images -o existing_annotations.json

# ฺฏุงู 2: ุฑูุชู ุจู ุชุตุงูุฑ ูุดฺฉูโุฏุงุฑ (ุจุง 'p' ู 'n')

# ฺฏุงู 3: ูพุงฺฉ ฺฉุฑุฏู annotation (ุจุง 'r')

# ฺฏุงู 4: annotate ูุฌุฏุฏ
```

---

## ๐ ฺฉูุช Annotations

### ฺฺฉ ฺฉุฑุฏู ฺฉูุช:

```bash
python check_p1_p2_annotations.py
```

ุงู ุงุณฺฉุฑูพุช ูุดุงู ูโุฏูุฏ:
- โ ุชุนุฏุงุฏ annotations
- โ ุชุตุงูุฑ ุจุฏูู annotation
- โ ูุงุตูู ุจู p1 ู p2 (ุจุงุฏ ~10mm ุจุงุดุฏ)
- โ๏ธ annotations ูุดฺฉูฺฉ (ูุงุตูู ุบุฑุนุงุฏ)

### ูุนุงุฑูุง ฺฉูุช:

| ูุนุงุฑ | ุฎูุจ โ | ูุงุจู ูุจูู โ๏ธ | ุถุนู โ |
|-------|--------|-------------|---------|
| ูุงุตูู p1-p2 | 80-120 px | 60-140 px | < 60 ุง > 140 px |
| ุชุฑุงุฒ ุนููุฏ | dx < 10 px | dx < 20 px | dx > 20 px |
| ุฏุฑ ูุญุฏูุฏู | top-right 20% | top-right 30% | ุฎุงุฑุฌ ุงุฒ ูุญุฏูุฏู |

---

## ๐ ูุซุงู ุนูู

### ฺฏุงู ุจู ฺฏุงู:

```bash
# 1. ูุตุจ dependencies
pip install opencv-python numpy

# 2. ุขูุงุฏูโุณุงุฒ ุชุตุงูุฑ
mkdir my_ceph_images
# ฺฉูพ ุชุตุงูุฑ ุณูุงูููุชุฑ ุจู ุงู ูพูุดู

# 3. ุดุฑูุน annotation
python p1_p2_annotator.py my_ceph_images -o my_annotations.json

# 4. ุฏุฑ ุญู ฺฉุงุฑ:
#    - ฺฉูฺฉ ุฑู p2 (ุจุงูุง ุฎุทฺฉุด)
#    - ฺฉูฺฉ ุฑู p1 (ูพุงู ุฎุทฺฉุด)
#    - ูุดุงุฑ 'n' ุจุฑุง ุชุตูุฑ ุจุนุฏ
#    - ูุดุงุฑ 'q' ุจุฑุง ุฎุฑูุฌ

# 5. ุจุฑุฑุณ ูุชุงุฌ
python check_p1_p2_annotations.py

# 6. ุงุณุชูุงุฏู ุจุฑุง training
python train_p1_p2_hrnet.py \
    --annotations my_annotations.json \
    --images my_ceph_images \
    --epochs 200
```

---

## ๐ ุงุฏุบุงู ุจุง Pipeline ุขููุฒุด

### Workflow ฺฉุงูู:

```
[ุชุตุงูุฑ ุณูุงูููุชุฑ]
         โ
[P1/P2 Annotator] โ annotations.json
         โ
[ุจุฑุฑุณ ฺฉูุช]
         โ
[Training HRNet]
         โ
[ุชุณุช ูุฏู]
         โ
[ุงุณุชูุงุฏู ุฏุฑ Production]
```

### ฺฉุฏ ููููู:

```python
# ุงุณุชูุงุฏู ุงุฒ annotations ุฏุฑ training
from train_p1_p2_hrnet import train_hrnet_p1_p2_model

model = train_hrnet_p1_p2_model(
    annotations_file='my_annotations.json',
    images_dir='my_ceph_images',
    hrnet_variant='hrnet_w18',
    batch_size=4,
    num_epochs=200
)
```

---

## ๐ ููุงุจุน ุจุดุชุฑ

- **Training Guide:** `HRNET_P1_P2_TRAINING_GUIDE.md`
- **Model Architecture:** `model.py`
- **Testing:** `test_p1_p2_hrnet.py`
- **Main README:** `README.md`

---

## ๐ ุฎูุงุตู

| ูฺฺฏ | ุชูุถุญ |
|-------|-------|
| **ุณุงุฏฺฏ** | ููุท 2 ฺฉูฺฉ ุจุฑุง ูุฑ ุชุตูุฑ |
| **ุณุฑุนุช** | ~10 ุซุงูู ุจุฑุง ูุฑ ุชุตูุฑ |
| **ุฏูุช** | zoom ุจุฑุง annotation ุฏูู |
| **Auto-save** | ูพุดุฑูุช ููุดู ุฐุฎุฑู ุงุณุช |
| **Resume** | ุงุฏุงูู ุงุฒ ุฌุง ฺฉู ูุงูุฏุฏ |
| **ุฎุฑูุฌ** | JSON ุณุงุฒฺฏุงุฑ ุจุง Aariz |

---

**ุดุฑูุน ฺฉูุฏ:**

```bash
python p1_p2_annotator.py path/to/images
```

**ูููู ุจุงุดุฏ! ๐**













