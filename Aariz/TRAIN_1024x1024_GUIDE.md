# ๐ฏ ุฑุงูููุง Training ุจุง Image Size 1024ร1024 Multi-GPU

## ๐ ฺุฑุง 1024ร1024?

- โ **ุฏูุช ุจุณุงุฑ ุจุงูุงุชุฑ**: Resolution ุจุดุชุฑ = ุฌุฒุฆุงุช ุจุดุชุฑ ู ุฏูุช ุจูุชุฑ
- โ **ูุชุงุฌ ุจูุชุฑ**: ูุนูููุงู 5-10% ุจูุจูุฏ SDR ูุณุจุช ุจู 512ร512
- โ **ุงุณุชูุงุฏู ุงุฒ ูุฑ ุฏู GPU**: ูพุฑุฏุงุฒุด ุณุฑุนโุชุฑ ุจุง 2x RTX 3060
- โ๏ธ **ูุงุฒ ุจู VRAM ุจุดุชุฑ**: ูุงุฒ ุจู 12GB VRAM ุจุฑุง ูุฑ GPU
- โ๏ธ **ุฒูุงู ุจุดุชุฑ**: ~3-4x ุฒูุงู training ูุณุจุช ุจู 512ร512

---

## ๐ฅ๏ธ ูุงุฒููุฏโูุง ุณุฎุชโุงูุฒุงุฑ

### ุญุฏุงูู ูุงุฒููุฏโูุง:
- **GPU**: 2x RTX 3060 (12GB VRAM ูุฑ ฺฉุฏุงู)
- **RAM**: ุญุฏุงูู 32GB
- **Storage**: ุญุฏุงูู 50GB ูุถุง ุฎุงู

### ุชูุธูุงุช ูพุดููุงุฏ:
- **Batch Size per GPU**: 4
- **Gradient Accumulation**: 4 steps
- **Effective Batch Size**: 16 (4 ร 2 GPUs ร 4 accumulation)

---

## ๐ ุฑูุดโูุง ุงุฌุฑุง

### ุฑูุด 1: ุงุณุชูุงุฏู ุงุฒ Batch File โญ **ุชูุตู ูโุดูุฏ**

```batch
Aariz\train_1024x1024.bat
```

ุงู batch file ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ:
- โ ุจุฑุฑุณ ูโฺฉูุฏ GPU ููุฌูุฏ ุงุณุช ุง ูู
- โ ุงุฒ ูุฑ ุฏู GPU ุงุณุชูุงุฏู ูโฺฉูุฏ
- โ ุชูุธูุงุช ุจููู ุฑุง ุงุนูุงู ูโฺฉูุฏ

### ุฑูุด 2: ุงุฌุฑุง ูุณุชูู ุฏุฑ PowerShell

```powershell
cd "C:\Users\Salah\Downloads\Compressed\Dentalai\main - Copy\Aariz"

python train_1024x1024.py \
    --dataset_path Aariz \
    --model hrnet \
    --image_size 1024 1024 \
    --batch_size 4 \
    --gradient_accumulation_steps 4 \
    --epochs 200 \
    --lr 3e-4 \
    --warmup_epochs 10 \
    --mixed_precision \
    --use_ema \
    --multi_gpu
```

---

## โ๏ธ ุชูุธูุงุช ุจููู ุจุฑุง ุจูุชุฑู ุฏูุช

### ุจูุชุฑู ูุฏู: **HRNet** โญ **ุชูุตู ูโุดูุฏ**

ุจุฑ ุงุณุงุณ ุจุฑุฑุณ ูุงูโูุง MD ู ูุชุงุฌ ุชุฌุฑุจ:
- โ **HRNet** ุจูุชุฑู ูุชุงุฌ ุฑุง ุจุฑุง landmark detection ุฏุงุฑุฏ
- โ ุจุฑุง resolution ุจุงูุง (1024ร1024) ุจููู ุงุณุช
- โ ุฏุฑ ุชูุงู ูุงูโูุง ุฑุงูููุง HRNet ูพุดููุงุฏ ุดุฏู ุงุณุช
- โ Default model ุฏุฑ script: `hrnet`

### ุชูุธูุงุช ูพุดููุงุฏ (ูพุดโูุฑุถ):

```bash
--model hrnet                    # โญ HRNet - ุจูุชุฑู ูุฏู ุจุฑุง ุฏูุช ุจุงูุง
--image_size 1024 1024          # ุณุงุฒ ุฌุฏุฏ โ
--batch_size 4                   # Batch size per GPU
--gradient_accumulation_steps 4  # ุจุฑุง Effective batch size = 16
--epochs 200                      # ุชุนุฏุงุฏ ุจุดุชุฑ epoch ุจุฑุง ุฏูุช ุจูุชุฑ
--lr 3e-4                        # Learning rate ูพุงูโุชุฑ ุจุฑุง resolution ุจุงูุง
--warmup_epochs 10               # Warmup ุจุดุชุฑ
--mixed_precision                 # FP16 ุจุฑุง ฺฉุงูุด VRAM
--use_ema                         # EMA ุจุฑุง ุฏูุช ุจูุชุฑ
--multi_gpu                       # ุงุณุชูุงุฏู ุงุฒ ูุฑ ุฏู GPU
```

### ูพุงุฑุงูุชุฑูุง ฺฉูุฏ:

1. **Model**: `hrnet` - โญ ุจูุชุฑู ูุฏู ุจุฑุง ุฏูุช ุจุงูุง
2. **Image Size**: `1024 x 1024` - ุณุงุฒ ุฌุฏุฏ โ
3. **Batch Size**: `4` per GPU - ฺฉุงูุด ุฏุงุฏู ุดุฏู ุจุฑุง VRAM
4. **Gradient Accumulation**: `4` - ุจุฑุง effective batch size = 16
5. **Mixed Precision**: `Enabled` - ุจุฑุง ฺฉุงูุด VRAM ุงุณุชูุงุฏู
6. **EMA**: `Enabled` - ุจุฑุง ุฏูุช ุจูุชุฑ
7. **Multi-GPU**: `Enabled` - ุงุณุชูุงุฏู ุงุฒ ูุฑ ุฏู RTX 3060

---

## ๐ ุณุงุฎุชุงุฑ ูุงูโูุง

### ูพูุดูโูุง ุฌุฏุฏ ุงุฌุงุฏ ุดุฏู:

```
Aariz/
โโโ checkpoints_1024x1024/      # โ ูพูุดู ุฌุฏุฏ ุจุฑุง checkpoint ูุง 1024x1024
โ   โโโ checkpoint_best.pth
โ   โโโ checkpoint_epoch_*.pth
โ   โโโ checkpoint_latest.pth
โโโ logs_1024x1024/               # โ ูพูุดู ุฌุฏุฏ ุจุฑุง tensorboard logs
โ   โโโ hrnet_1024x1024_*./
โโโ checkpoints/                  # โ ูพูุดู ูุจู (ุจุฏูู ุชุบุฑ)
    โโโ ... (ูุฏูโูุง ูุจู ุญูุธ ูโุดููุฏ)
```

**โ ูุฏูโูุง ูุจู ูพุงฺฉ ููโุดููุฏ!**

---

## ๐ฏ ูฺฉุงุช ููู ุจุฑุง ุจูุชุฑู ุฏูุช

### 1. Learning Rate:
- ุจุฑุง 1024ร1024ุ LR ูพุงูโุชุฑ ุจูุชุฑ ุงุณุช (`3e-4` ุจู ุฌุง `5e-4`)
- ุจุง warmup ุจุดุชุฑ (`10 epochs`)

### 2. Batch Size:
- Batch size ฺฉูฺฺฉโุชุฑ (`4` per GPU)
- ุงุณุชูุงุฏู ุงุฒ gradient accumulation ุจุฑุง effective batch size = 16

### 3. Epochs:
- ุชุนุฏุงุฏ ุจุดุชุฑ epoch (`200`) ุจุฑุง convergence ุจูุชุฑ
- ุจุง scheduler ููุงุณุจ (Cosine Annealing with Restarts)

### 4. EMA (Exponential Moving Average):
- ูุนุงู ุดุฏู ุจุฑุง ุฏูุช ุจูุชุฑ
- Decay rate: `0.9999`

### 5. Mixed Precision:
- ูุนุงู ุดุฏู ุจุฑุง ฺฉุงูุด VRAM
- ุจุฏูู ฺฉุงูุด ุฏูุช

---

## ๐ ูุชุงุฌ ุงูุชุธุงุฑ

### ุจุง 1024ร1024 (ูพุดโุจู):

**Training ุงุฒ ุงูู:**
- **MRE**: **1.0-1.3mm** (ุจูุจูุฏ ูุณุจุช ุจู 512ร512)
- **SDR @ 2mm**: **75-82%** (ุจูุจูุฏ 5-10%)
- **SDR @ 2.5mm**: **80-87%**
- **SDR @ 3mm**: **85-91%**
- **ุฒูุงู**: 24-36 ุณุงุนุช (ุจุง 2x RTX 3060)

**Fine-tuning ุงุฒ 512ร512 checkpoint:**
- **MRE**: **1.1-1.4mm**
- **SDR @ 2mm**: **73-80%**
- **ุฒูุงู**: 12-18 ุณุงุนุช (ุจุง 2x RTX 3060)

---

## ๐ ุฑุตุฏ ฺฉุฑุฏู Training

### Tensorboard:
```bash
tensorboard --logdir logs_1024x1024
```

### ุจุฑุฑุณ Checkpoints:
```bash
# ูุฑ 10 epoch ฺฉ checkpoint ุฐุฎุฑู ูโุดูุฏ
ls checkpoints_1024x1024/

# ูพุฏุง ฺฉุฑุฏู ุจูุชุฑู checkpoint:
python find_best_checkpoint.py checkpoints_1024x1024/
```

---

## โ๏ธ ูฺฉุงุช ููู

### 1. **VRAM**:
- ูุฑ GPU ุจุงุฏ ุญุฏุงูู 12GB VRAM ุฏุงุดุชู ุจุงุดุฏ
- ุงฺฏุฑ Out of Memory ฺฏุฑูุชุฏ:
  - `--batch_size` ุฑุง ุจู `2` ฺฉุงูุด ุฏูุฏ
  - `--gradient_accumulation_steps` ุฑุง ุจู `8` ุงูุฒุงุด ุฏูุฏ

### 2. **Heatmap Sigma**:
- ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุจุฑ ุงุณุงุณ image size ุชูุธู ูโุดูุฏ
- ุจุฑุง 1024ร1024: sigma โ 6.0

### 3. **ุฒูุงู Training**:
- ุจุง 2x RTX 3060: ~24-36 ุณุงุนุช (200 epochs)
- ุตุจุฑ ฺฉูุฏ ุชุง ุชูุงู ุดูุฏ!

### 4. **ูุฏูโูุง ูุจู**:
- โ ูุฏูโูุง ูุจู ุฏุฑ `checkpoints/` ุจุงู ูโูุงููุฏ
- โ ูุฏู ุฌุฏุฏ ุฏุฑ `checkpoints_1024x1024/` ุฐุฎุฑู ูโุดูุฏ

---

## ๐ ุนุจโุงุจ

### ูุดฺฉู 1: Out of Memory (OOM)

**ุฑุงู ุญู:**
```bash
# ฺฉุงูุด batch size
--batch_size 2

# ุงูุฒุงุด gradient accumulation
--gradient_accumulation_steps 8
```

### ูุดฺฉู 2: ฺฉ GPU ุงุณุชูุงุฏู ูโุดูุฏ (ูู ุฏู GPU)

**ุจุฑุฑุณ:**
```python
python -c "import torch; print('GPUs:', torch.cuda.device_count())"
```

**ุฑุงู ุญู:**
- ูุทูุฆู ุดูุฏ ูุฑ ุฏู GPU ุฏุฑ system ุดูุงุฎุชู ูโุดููุฏ
- Flag `--multi_gpu` ุฑุง ุงุถุงูู ฺฉูุฏ

### ูุดฺฉู 3: Training ุฎู ฺฉูุฏ ุงุณุช

**ุจุฑุฑุณ:**
- ุขุง `--mixed_precision` ูุนุงู ุงุณุชุ
- ุขุง `num_workers` ููุงุณุจ ุงุณุชุ (ูพุดโูุฑุถ: 8)

---

## ๐ ุฏุณุชูุฑุงุช ุณุฑุน

### ุดุฑูุน Training ุฌุฏุฏ:
```batch
Aariz\train_1024x1024.bat
```

### ุง ุฏุณุชูุฑ ูุณุชูู:
```bash
python train_1024x1024.py \
    --dataset_path Aariz \
    --model hrnet \
    --image_size 1024 1024 \
    --batch_size 4 \
    --gradient_accumulation_steps 4 \
    --epochs 200 \
    --lr 3e-4 \
    --warmup_epochs 10 \
    --mixed_precision \
    --use_ema \
    --multi_gpu
```

---

## ๐ ูุฑุงุญู ุจุนุฏ

ุจุนุฏ ุงุฒ training:

1. โ ุชุณุช ุฑู validation set
2. โ ููุงุณู ุจุง ูุชุงุฌ ูุจู (512ร512)
3. โ ุงุณุชูุงุฏู ุงุฒ TTA ุจุฑุง ุจูุจูุฏ ุจุดุชุฑ (ุงุฎุชุงุฑ)
4. โ Deploy ูุฏู ุฌุฏุฏ

---

## ๐ ุฎูุงุตู ุชูุธูุงุช

| ูพุงุฑุงูุชุฑ | ููุฏุงุฑ | ุชูุถุญุงุช |
|---------|-------|---------|
| Image Size | 1024 ร 1024 | ุณุงุฒ ุฌุฏุฏ |
| Batch Size | 4 per GPU | ุจุฑุง VRAM |
| Gradient Accumulation | 4 | Effective batch = 16 |
| Epochs | 200 | ุจุฑุง ุฏูุช ุจูุชุฑ |
| Learning Rate | 3e-4 | ูพุงูโุชุฑ ุจุฑุง resolution ุจุงูุง |
| Warmup Epochs | 10 | ุจุดุชุฑ ุจุฑุง stability |
| Mixed Precision | โ | FP16 |
| EMA | โ | ุจุฑุง ุฏูุช ุจูุชุฑ |
| Multi-GPU | โ | ุงุณุชูุงุฏู ุงุฒ ูุฑ ุฏู GPU |
| Save Dir | `checkpoints_1024x1024/` | ูพูุดู ุฌุฏุฏ |

---

**ุชุงุฑุฎ**: 2024-11-01  
**ูุถุนุช**: โ ุขูุงุฏู ุจุฑุง ุงุณุชูุงุฏู  
**ูพุดุชุจุงู**: ุงุฒ ูุฑ ุฏู RTX 3060 ุงุณุชูุงุฏู ูโฺฉูุฏ

