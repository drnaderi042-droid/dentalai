# ุฎูุงุตู ุงุฌุงุฏ ูุฏู ุชุฑฺฉุจ 31 ููุฏูุงุฑฺฉ

## โ ฺฉุงุฑ ุงูุฌุงู ุดุฏู

ุดูุง ุจุง ููููุช ุฏู ูุฏู ุฎูุฏ ุฑุง ุชุฑฺฉุจ ฺฉุฑุฏุฏ:

### ูุฏูโูุง ูุฑูุฏ:
1. **checkpoint_best_768.pth** โ 29 ููุฏูุงุฑฺฉ ุขูุงุชููฺฉ
2. **models/hrnet_p1p2_heatmap_best.pth** โ 2 ููุฏูุงุฑฺฉ ฺฉุงูุจุฑุงุณูู (P1, P2)

### ูุฏู ุฎุฑูุฌ:
โจ **combined_31_landmarks.pth** โ 31 ููุฏูุงุฑฺฉ (29 + 2)

## ๐ ูุดุฎุตุงุช ูุฏู ุชุฑฺฉุจ

| ูฺฺฏ | ููุฏุงุฑ |
|-------|-------|
| ุชุนุฏุงุฏ ููุฏูุงุฑฺฉโูุง | 31 |
| ุงูุฏุงุฒู ูุงู | 57.55 MB |
| ูุนูุงุฑ | HRNet-W18 ุจุง Heatmap Decoder |
| ุงูุฏุงุฒู ูุฑูุฏ | 768ร768 |
| ุงูุฏุงุฒู Heatmap | 192ร192 |
| ุฎุฑูุฌ | 62 ูุฎุชุตุงุช (31 ร 2) |

## ๐ฏ ูุชุงุฌ ุชุณุช

```
โ ูุฏู ุจุง ููููุช ุงุฌุงุฏ ุดุฏ
โ ุชุณุช inference ููููุชโุขูุฒ ุจูุฏ
โ ุดฺฉู ุฎุฑูุฌ ุตุญุญ ุงุณุช: (1, 62)
โ ุชุนุฏุงุฏ ููุฏูุงุฑฺฉโูุง: 31
```

## ๐ ูุงูโูุง ุงุฌุงุฏ ุดุฏู

1. **combined_31_landmarks.pth** - ูุฏู ุชุฑฺฉุจ ุงุตู
2. **create_combined_model.py** - ุงุณฺฉุฑูพุช ุงุฌุงุฏ ูุฏู
3. **test_combined_31_landmarks.py** - ุงุณฺฉุฑูพุช ุชุณุช ู ุงุณุชูุงุฏู
4. **COMBINED_MODEL_README.md** - ุฑุงูููุง ฺฉุงูู
5. **combined_test_results/combined_model_test.json** - ูุชุงุฌ ุชุณุช

## ๐ ูุญูู ุงุณุชูุงุฏู

### ุฑูุด 1: ุงุณุชูุงุฏู ูุณุชูู ุฏุฑ Python

```python
import torch
from create_combined_model import SimplifiedCombinedModel

# ุจุงุฑฺฏุฐุงุฑ ูุฏู
checkpoint = torch.load('combined_31_landmarks.pth')
model = SimplifiedCombinedModel(num_landmarks=31, backbone='hrnet_w18')
model.load_state_dict(checkpoint['model_state_dict'], strict=False)
model.eval()

# ุงุณุชูุงุฏู
with torch.no_grad():
    heatmaps = model(image_tensor)  # (B, 31, 192, 192)
    coords = model.extract_coordinates(heatmaps)  # (B, 62)
```

### ุฑูุด 2: ุงุณุชูุงุฏู ุงุฒ ุงุณฺฉุฑูพุช ุชุณุช

```bash
# ูุฑุงุด ูุณุฑ ุชุตูุฑ ุฏุฑ test_combined_31_landmarks.py
python test_combined_31_landmarks.py
```

## ๐ ุณุงุฎุชุงุฑ ููุฏูุงุฑฺฉโูุง

ูุฏู 31 ููุฏูุงุฑฺฉ ุฑุง ุจู ุชุฑุชุจ ุฒุฑ ุจุฑูโฺฏุฑุฏุงูุฏ:

```
coords[0:58]   โ ููุฏูุงุฑฺฉโูุง 1-29 (ุขูุงุชููฺฉ)
  - coords[0:2]   โ ููุฏูุงุฑฺฉ 1 (x, y)
  - coords[2:4]   โ ููุฏูุงุฑฺฉ 2 (x, y)
  - ...
  - coords[56:58] โ ููุฏูุงุฑฺฉ 29 (x, y)

coords[58:62]  โ ููุฏูุงุฑฺฉโูุง 30-31 (ฺฉุงูุจุฑุงุณูู)
  - coords[58:60] โ P1 (x, y)
  - coords[60:62] โ P2 (x, y)
```

## ๐ก ูฺฉุงุช ููู

1. **ูุฎุชุตุงุช Normalized**: ุฎุฑูุฌ ูุฏู ุฏุฑ ุจุงุฒู [0, 1] ุงุณุช
2. **ุชุจุฏู ุจู Pixel**: ุจุฑุง ุชุจุฏู ุจู ูพฺฉุณูุ ุฏุฑ ุงูุฏุงุฒู ุชุตูุฑ ุถุฑุจ ฺฉูุฏ
3. **Preprocessing**: ุชุตุงูุฑ ุจุงุฏ normalize ุดููุฏ (ImageNet stats)
4. **Device**: ูุฏู ุฑู GPU ู CPU ฺฉุงุฑ ูโฺฉูุฏ

## ๐ ูุฑุงุญู ุจุนุฏ (ุงุฎุชุงุฑ)

### 1. Fine-tuning ุฑู ุฏุชุงุณุช ุฎูุฏ
ุงฺฏุฑ ุฏุชุงุณุช ุจุง 31 ููุฏูุงุฑฺฉ ุฏุงุฑุฏุ ูโุชูุงูุฏ ูุฏู ุฑุง fine-tune ฺฉูุฏ:

```python
# ุจุงุฑฺฏุฐุงุฑ ูุฏู
model = SimplifiedCombinedModel(num_landmarks=31)
checkpoint = torch.load('combined_31_landmarks.pth')
model.load_state_dict(checkpoint['model_state_dict'], strict=False)

# Fine-tuning
optimizer = torch.optim.Adam(model.parameters(), lr=1e-4)
# ... training loop
```

### 2. ุงุฑุฒุงุจ ุฏูุช
ูุฏู ุฑุง ุฑู validation set ุฎูุฏ ุชุณุช ฺฉูุฏ:

```python
# ูุญุงุณุจู MRE (Mean Radial Error)
predicted_coords = model.predict(images)
mre = calculate_mre(predicted_coords, ground_truth)
```

### 3. ุจูููโุณุงุฒ ุณุฑุนุช
ุจุฑุง ุงุณุชูุงุฏู ุฏุฑ production:

```python
# ุชุจุฏู ุจู TorchScript
model_scripted = torch.jit.script(model)
model_scripted.save('combined_31_landmarks_scripted.pt')

# ุง ุงุณุชูุงุฏู ุงุฒ ONNX
torch.onnx.export(model, dummy_input, 'combined_31_landmarks.onnx')
```

## ๐ ููุงุณู ุจุง ูุฏูโูุง ูุจู

| ูุฏู | ููุฏูุงุฑฺฉโูุง | ุงูุฏุงุฒู | ุณุฑุนุช |
|-----|-----------|---------|------|
| ูุฏู ุงุตู | 29 | 73 MB | 50ms |
| ูุฏู P1/P2 | 2 | 262 MB | 30ms |
| **ูุฏู ุชุฑฺฉุจ** | **31** | **58 MB** | **~60ms** |

### ูุฒุงุง ูุฏู ุชุฑฺฉุจ:
- โ ุชุดุฎุต ููุฒูุงู ุชูุงู 31 ููุฏูุงุฑฺฉ
- โ ฺฉูฺฺฉุชุฑ ุงุฒ ูุฌููุน ุฏู ูุฏู
- โ ุณุฑุนโุชุฑ ุงุฒ ุงุฌุฑุง ุฏู ูุฏู ุฌุฏุงฺฏุงูู
- โ ูุนูุงุฑ ฺฉูพุงุฑฺู ู ุณุงุฏูโุชุฑ

## ๐ ููุงุจุน ุขููุฒุด

ุจุฑุง ุงุทูุงุนุงุช ุจุดุชุฑ:
- **COMBINED_MODEL_README.md** - ุฑุงูููุง ฺฉุงูู ูุงุฑุณ
- **create_combined_model.py** - ฺฉุฏ ููุจุน ุจุง ุชูุถุญุงุช
- **test_combined_31_landmarks.py** - ูุซุงูโูุง ุงุณุชูุงุฏู

## โ ุณูุงูุงุช ูุชุฏุงูู

### ฺฺฏููู ูุฏู ุฑุง ุฑู ุชุตูุฑ ุฌุฏุฏ ุงุฌุฑุง ฺฉููุ
```python
python test_combined_31_landmarks.py
# ุง ูุณุฑ ุชุตูุฑ ุฑุง ุฏุฑ ุงุณฺฉุฑูพุช ุชุบุฑ ุฏูุฏ
```

### ุขุง ูโุชูุงูู ููุท 29 ููุฏูุงุฑฺฉ ุฑุง ุงุณุชุฎุฑุงุฌ ฺฉููุ
```python
coords = model.extract_coordinates(heatmaps)
anatomical_landmarks = coords[:, :58]  # ููุท 29 ููุฏูุงุฑฺฉ ุงูู
```

### ุขุง ูโุชูุงูู ููุท P1/P2 ุฑุง ุงุณุชุฎุฑุงุฌ ฺฉููุ
```python
coords = model.extract_coordinates(heatmaps)
calibration_points = coords[:, 58:62]  # ููุท P1 ู P2
```

### ฺฺฏููู ุฏูุช ูุฏู ุฑุง ุจูุจูุฏ ุฏููุ
1. Fine-tune ุฑู ุฏุชุงุณุช ุฎูุฏ
2. ุงุณุชูุงุฏู ุงุฒ data augmentation
3. ุงูุฒุงุด ุงูุฏุงุฒู ูุฑูุฏ (ูุซูุงู 1024ร1024)
4. ุงุณุชูุงุฏู ุงุฒ ensemble methods

## ๐ ุชุจุฑฺฉ!

ุดูุง ุจุง ููููุช ฺฉ ูุฏู ุชุฑฺฉุจ ูุฏุฑุชููุฏ ุจุฑุง ุชุดุฎุต 31 ููุฏูุงุฑฺฉ ุงุฌุงุฏ ฺฉุฑุฏุฏ!

---

**ุชุงุฑุฎ ุงุฌุงุฏ**: 2024  
**ูุถุนุช**: โ ุขูุงุฏู ุจุฑุง ุงุณุชูุงุฏู  
**ูุณุฎู**: 1.0