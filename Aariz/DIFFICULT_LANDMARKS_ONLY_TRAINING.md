# Training فقط برای لندمارک‌های مشکل‌دار

## ⚠️ تغییر مهم در Training

### قبل (Weighted Loss):
- همه لندمارک‌ها آموزش می‌دیدند
- لندمارک‌های مشکل‌دار وزن بیشتر داشتند (2.5x)
- لندمارک‌های سالم وزن عادی داشتند (1.0x)

### حالا (Difficult Landmarks Only):
- **فقط** لندمارک‌های مشکل‌دار آموزش می‌بینند
- لندمارک‌های سالم **کاملاً ignore می‌شوند** (در loss محاسبه نمی‌شوند)
- زمان training **کوتاه‌تر** می‌شود

## 📋 لندمارک‌های مشکل‌دار که آموزش می‌بینند:

| لندمارک | خطای فعلی | وضعیت |
|---------|-----------|-------|
| **UMT** | 3.805 mm | ✅ آموزش می‌بیند |
| **UPM** | 3.486 mm | ✅ آموزش می‌بیند |
| **R** | 3.331 mm | ✅ آموزش می‌بیند |
| **Ar** | 2.645 mm | ✅ آموزش می‌بیند |
| **Go** | 2.618 mm | ✅ آموزش می‌بیند |
| **LMT** | 2.545 mm | ✅ آموزش می‌بیند |
| **LPM** | - | ✅ آموزش می‌بیند |
| **Or** | 2.326 mm | ✅ آموزش می‌بیند |
| **Co** | 2.200 mm | ✅ آموزش می‌بیند |
| **PNS** | 2.155 mm | ✅ آموزش می‌بیند |
| **Po** | 2.042 mm | ✅ آموزش می‌بیند |
| **ANS** | 1.822 mm | ✅ آموزش می‌بیند |

**تعداد:** 12 لندمارک از 29 لندمارک

## 🚫 لندمارک‌هایی که ignore می‌شوند:

| لندمارک | خطای فعلی | وضعیت |
|---------|-----------|-------|
| **Me** | 0.582 mm | ❌ Ignore (قبلاً خوب است) |
| **Gn** | 0.584 mm | ❌ Ignore (قبلاً خوب است) |
| **UIT** | 0.742 mm | ❌ Ignore (قبلاً خوب است) |
| **S** | 0.830 mm | ❌ Ignore (قبلاً خوب است) |
| **Pn** | 0.866 mm | ❌ Ignore (قبلاً خوب است) |
| **Li** | 0.890 mm | ❌ Ignore (قبلاً خوب است) |
| **Pog** | 0.989 mm | ❌ Ignore (قبلاً خوب است) |
| **B** | 1.130 mm | ❌ Ignore (قبلاً خوب است) |
| **A** | 1.175 mm | ❌ Ignore (قبلاً خوب است) |
| **N** | 1.232 mm | ❌ Ignore (قبلاً خوب است) |
| و بقیه... | - | ❌ Ignore |

**تعداد:** 17 لندمارک ignore می‌شوند

## ⚡ مزایا:

1. **سرعت بیشتر:** فقط 12 لندمارک به جای 29 → ~40% سریع‌تر
2. **تمرکز بیشتر:** همه attention روی لندمارک‌های مشکل‌دار
3. **GPU Memory کمتر:** کمتر computation → کمتر memory
4. **زمان training کوتاه‌تر:** کاهش قابل توجه در زمان

## ⚠️ نکات مهم:

1. **لندمارک‌های سالم تغییر نمی‌کنند:** چون در loss نیستند، gradient نمی‌گیرند
2. **اما پیش‌بینی می‌شوند:** مدل هنوز همه لندمارک‌ها را predict می‌کند
3. **فقط loss محاسبه نمی‌شود:** برای لندمارک‌های سالم loss = 0 (در training)

## 📊 انتظارات:

بعد از training:
- **لندمارک‌های مشکل‌دار:** بهبود قابل توجه (کاهش 40-50%)
- **لندمارک‌های سالم:** تقریباً بدون تغییر (چون gradient نمی‌گیرند)
- **Overall MRE:** کاهش 15-25% (فقط به خاطر بهبود مشکل‌دارها)

## 🚀 استفاده:

همان دستورات قبلی:
```bash
python train2.py \
    --resume checkpoint_best_768.pth \
    --dataset_path Aariz \
    --model hrnet \
    --image_size 768 768 \
    --batch_size 4 \
    --lr 1e-6 \
    --warmup_epochs 2 \
    --epochs 20 \
    --loss adaptive_wing \
    --mixed_precision
```

## 📝 خلاصه تغییرات:

```python
# قبل:
loss = weighted_loss(all_29_landmarks)  # همه با وزن‌های مختلف

# حالا:
loss = loss_only(12_difficult_landmarks)  # فقط مشکل‌دارها
```















