# ๐ ุดุฑูุน ุณุฑุน - Training ูุฏู HRNet

## โ ุขูุงุฏูโุณุงุฒ

### ูพุดโูุงุฒูุง:

- โ 100 ุชุตูุฑ label ุดุฏู ุจุง ุงุจุฒุงุฑ annotation
- โ ูุงู `annotations_p1_p2.json` ุฏุฑ ูพูุดู `aariz/` ููุฌูุฏ ุงุณุช
- โ GPU: RTX 3070 Ti (8GB VRAM)
- โ CPU: i5-9400f

### ุงฺฏุฑ ูููุฒ annotation ูฺฉุฑุฏูโุงุฏ:

```cmd
cd aariz
annotate_p1_p2.bat
```

ุจุนุฏ ุงุฒ annotationุ ูุงู `annotations_p1_p2.json` ุงุฌุงุฏ ูโุดูุฏ.

---

## ๐ฏ Training ูุฏู

### ุฑูุด 1: ุงุณุชูุงุฏู ุงุฒ Batch File (ุชูุตู ูโุดูุฏ)

```cmd
cd aariz
train_hrnet_768.bat
```

### ุฑูุด 2: ุงุณุชูุงุฏู ูุณุชูู ุงุฒ Python

```cmd
cd aariz
python train_p1_p2_hrnet.py
```

---

## โ๏ธ ุชูุธูุงุช ุจููู ุดุฏู

| ูพุงุฑุงูุชุฑ | ููุฏุงุฑ | ุชูุถุญ |
|---------|-------|-------|
| **Model** | HRNet-W18 | ุชุนุงุฏู ุฎูุจ ุณุฑุนุช/ุฏูุช |
| **Image Size** | 768ร768 px | ูุถูุญ ุจุงูุง ุจุฑุง ุฏูุช ุจูุชุฑ |
| **Batch Size** | 2 | ุจููู ุจุฑุง RTX 3070 Ti |
| **Epochs** | 200 | ุจุง early stopping |
| **Learning Rate** | 0.001 | ุจุง ReduceLROnPlateau |
| **Dataset Split** | 80/20 | 80 train / 20 validation |

---

## โฑ๏ธ ุฒูุงู ุชุฎูู

### ุจุฑุง RTX 3070 Ti:

| ูุฑุญูู | ุฒูุงู |
|-------|------|
| ูุฑ epoch | ~1.5-2 ุฏููู |
| ฺฉู training (200 epochs) | **3-5 ุณุงุนุช** |
| ุจุง early stopping | **2-3 ุณุงุนุช** (ูุนูููุงู) |

**ูฺฉุชู:** Training ุฎูุฏฺฉุงุฑ ูุชููู ูโุดูุฏ ุงฺฏุฑ 50 epoch ูพุงูพ ุจูุจูุฏ ูุฏุงุดุชู ุจุงุดุฏ.

---

## ๐ ูุธุงุฑุช ุจุฑ Training

### Output ุฏุฑ Console:

```
Epoch 10/200:
  Train Loss: 0.008234
  Val Loss: 0.010521
  Avg Pixel Error: 45.32 px
  Learning Rate: 0.001000
  >>> Best model! Saving...
------------------------------------------------------------
```

### ฺุฒูุง ฺฉู ุจุงุฏ ุจู ุขู ุชูุฌู ฺฉูุฏ:

- โ **Val Loss ฺฉุงูุด ุงุจุฏ** (ูุฏู: < 0.005)
- โ **Pixel Error ฺฉุงูุด ุงุจุฏ** (ูุฏู: < 30px)
- โ **Train/Val Loss ูุฒุฏฺฉ ูู ุจุงุดูุฏ** (ูุดุงูู ุนุฏู overfitting)

### ุนูุงุฆู ุฎูุจ:

```
Epoch 50:
  Train Loss: 0.002145
  Val Loss: 0.003458
  Avg Pixel Error: 28.15 px   โ ุฎูุจ!
  >>> Best model! Saving...
```

### ุนูุงุฆู ุจุฏ:

```
Epoch 50:
  Train Loss: 0.001234   โ ุฎู ฺฉู
  Val Loss: 0.015678     โ ุฎู ุจุงูุง (overfitting!)
  Avg Pixel Error: 95.32 px
```

**ุฑุงูโุญู:** ุงฺฏุฑ overfitting ุฏุฏุฏุ data augmentation ุฑุง ุงูุฒุงุด ุฏูุฏ ุง epochs ุฑุง ฺฉู ฺฉูุฏ.

---

## ๐พ ูุงูโูุง ุฎุฑูุฌ

### ูุฏู ุฐุฎุฑู ูโุดูุฏ ุฏุฑ:

```
models/hrnet_p1p2_best_hrnet_w18.pth
```

### ุดุงูู:

- โ ูุฒูโูุง ูุฏู
- โ ุจูุชุฑู validation loss
- โ ุชุนุฏุงุฏ epochs ุขููุฒุด ุฏุฏู
- โ Pixel error

---

## ๐งช ุจุนุฏ ุงุฒ Training: ุชุณุช ูุฏู

### ุฑูุด 1: Batch File

```cmd
test_hrnet.bat
```

### ุฑูุด 2: Python

```cmd
python test_p1_p2_hrnet.py
```

### ูุชุงุฌ ุฏุฑ:

```
test_results_hrnet/
  โโโ image001_pred.png    (ุชุตูุฑ + predictions)
  โโโ image002_pred.png
  โโโ ...
```

---

## ๐ ุงูุชุธุงุฑุงุช ุนููฺฉุฑุฏ

### ุจุง 100 ุชุตูุฑ label ุดุฏู:

| Metric | ุงูุชุธุงุฑ |
|--------|--------|
| **Avg Pixel Error** | 20-35 px |
| **Best Case** | 10-15 px |
| **Worst Case** | 50-70 px |
| **Validation Loss** | 0.003-0.006 |

### ุจุง 200+ ุชุตูุฑ:

| Metric | ุงูุชุธุงุฑ |
|--------|--------|
| **Avg Pixel Error** | 10-20 px |
| **Best Case** | 5-10 px |
| **Worst Case** | 30-50 px |
| **Validation Loss** | 0.001-0.003 |

---

## ๐ง ุนุจโุงุจ

### ูุดฺฉู 1: CUDA Out of Memory

**ุฎุทุง:**
```
RuntimeError: CUDA out of memory
```

**ุฑุงูโุญู:**
```python
# ุฏุฑ train_p1_p2_hrnet.pyุ ุฎุท 404:
batch_size=1,  # ฺฉุงูุด ุงุฒ 2 ุจู 1
```

ุง:

```python
image_size=512,  # ฺฉุงูุด ุงุฒ 768 ุจู 512
```

---

### ูุดฺฉู 2: Training ุฎู ฺฉูุฏ

**ุนูุช:** batch_size ฺฉูฺฺฉ ุง image_size ุจุฒุฑฺฏ

**ุฑุงูโุญู:**
- โ ูุทูุฆู ุดูุฏ GPU ุงุณุชูุงุฏู ูโุดูุฏ (ูู CPU)
- โ `num_workers=0` ุจุงุดุฏ (ุจุฑุง Windows)
- โ ุจุฑุฑุณ ฺฉูุฏ ฺฉู ูฺ ุจุฑูุงูู ุฏฺฏุฑ GPU ุฑุง ูุตุฑู ููโฺฉูุฏ

**ุจุฑุฑุณ GPU:**
```cmd
nvidia-smi
```

ุจุงุฏ ูุดุงู ุฏูุฏ:
```
Python.exe    12345   C   7542MB / 8192MB
```

---

### ูุดฺฉู 3: Overfitting

**ุนูุงูุช:** Train loss ฺฉู ุงูุง Val loss ุจุงูุง

**ุฑุงูโุญู:**
1. โ ุจุดุชุฑ data augmentation ฺฉูุฏ
2. โ epochs ุฑุง ฺฉู ฺฉูุฏ (100 ุจู ุฌุง 200)
3. โ learning rate ุฑุง ฺฉู ฺฉูุฏ (0.0005)
4. โ **ุจูุชุฑู:** ุจุดุชุฑ label ุจุฒูุฏ (200+ images)

---

### ูุดฺฉู 4: Training ูุชููู ููโุดูุฏ

**ุฏูู:** Early stopping ูุนุงู ุงุณุช (50 epochs ุตุจุฑ ูโฺฉูุฏ)

**ุงฺฏุฑ ูโุฎูุงูุฏ ูุชููู ฺฉูุฏ:**
```
Ctrl + C    (ฺฉ ุจุงุฑ)
```

ุจูุชุฑู ูุฏู ุชุง ุงูุงู ุฐุฎุฑู ุดุฏู ุงุณุช! โ

---

## ๐ ฺฺฉโูุณุช ูุจู ุงุฒ Training

- [ ] `annotations_p1_p2.json` ุฏุฑ ูพูุดู `aariz/` ููุฌูุฏ ุงุณุช โญ
- [ ] `Aariz/train/Cephalograms` ููุฌูุฏ ุงุณุช
- [ ] ุญุฏุงูู 50 ุชุตูุฑ label ุดุฏู (ุชูุตู: 100+)
- [ ] CUDA ูุตุจ ุงุณุช (`nvidia-smi` ฺฉุงุฑ ูโฺฉูุฏ)
- [ ] Python packages ูุตุจ ูุณุชูุฏ:
  ```cmd
  pip install torch torchvision timm opencv-python pillow tqdm
  ```

### ๐ ูฺฉุชู ููู: ูุงู Annotations

Training script ุงุฒ **`annotations_p1_p2.json`** ุงุณุชูุงุฏู ูโฺฉูุฏ ฺฉู ุชูุณุท ุงุจุฒุงุฑ `p1_p2_annotator.py` ุงุฌุงุฏ ุดุฏู ุงุณุช.

**ุงฺฏุฑ ูุงู ููุฌูุฏ ูุณุช:**
```cmd
cd aariz
annotate_p1_p2.bat
```

**ูุณุฑ ูุงู:**
```
aariz/
  โโโ annotations_p1_p2.json    โ ุงู ูุงู
  โโโ train_p1_p2_hrnet.py
  โโโ Aariz/train/Cephalograms/
```

---

## ๐ฏ ุฏุณุชูุฑุงุช ุณุฑุน

```cmd
# 1. Training
cd aariz
train_hrnet_768.bat

# 2. ูุธุงุฑุช
# ุฏุฑ ุญู trainingุ output ุฑุง ุจุจูุฏ

# 3. Testing
test_hrnet.bat

# 4. ุจุฑุฑุณ ูุชุงุฌ
cd test_results_hrnet
# ุนฺฉุณโูุง ุฑุง ุจุจูุฏ
```

---

## ๐ก ูฺฉุงุช ูพุดุฑูุชู

### ุชุบุฑ HRNet variant:

```python
# ุฏุฑ train_p1_p2_hrnet.pyุ ุฎุท 402:
hrnet_variant='hrnet_w32',  # ุฏูุช ุจุงูุงุชุฑุ ุณุฑุนุช ฺฉูุชุฑ
```

| Variant | Accuracy | Speed | VRAM | ุฒูุงู |
|---------|----------|-------|------|------|
| **W18** | 90-95% | โกโกโก | 6GB | 3-5h |
| **W32** | 95-97% | โกโก | 7GB | 5-8h |
| **W48** | 97-99% | โก | 8GB+ | 8-12h |

**ุชูุตู:** ุจุง W18 ุดุฑูุน ฺฉูุฏุ ุงฺฏุฑ ูุชุฌู ุฎูุจ ุจูุฏ ููุงู ุฑุง ูฺฏู ุฏุงุฑุฏ!

---

## ๐ ุดุฑูุน Training:

```cmd
cd aariz
train_hrnet_768.bat
```

**ูููู ุจุงุดุฏ! ๐**

ุฒูุงู ุชูุฑุจ: 3-5 ุณุงุนุช
ูุชุฌู: ูุฏู ุจุง ุฏูุช ุจุงูุง ุจุฑุง ุชุดุฎุต p1/p2

